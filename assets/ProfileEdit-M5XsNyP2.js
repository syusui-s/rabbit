import{av as Ye,aw as Z,ax as We,ay as or,az as ur,aA as dr,aB as cr,aC as fr,aD as Ve,a0 as er,aE as br,ae as vr,Y as rr,U as gr,z as pr,w as _r,u as mr,c as S,o as hr,v as $r,a as C,t as R,i as v,h as T,b as $,g as Y,F as yr,d as xr}from"./index-9cbshM_8.js";import{A as wr}from"./arrow-left-mspiIRQX.js";import{r as Pr,a as qr,b as Sr,c as tr,d as Cr}from"./_baseClone-R0fQdmlI.js";import{B as Rr}from"./BasicModal-C5pYuCW6.js";import{q as Lr,s as Or,y as Er,b as kr,i as Ar,g as Nr,z as Br}from"./SideBar-el7yUy1L.js";import"./resolveAsset-C5PFNW9K.js";var W,Ie;function Tr(){if(Ie)return W;Ie=1;function i(r){var e=r==null?0:r.length;return e?r[e-1]:void 0}return W=i,W}var V,Ue;function Ir(){if(Ue)return V;Ue=1;function i(r,e,t){var s=-1,a=r.length;e<0&&(e=-e>a?0:a+e),t=t>a?a:t,t<0&&(t+=a),a=e>t?0:t-e>>>0,e>>>=0;for(var o=Array(a);++s<a;)o[s]=r[s+e];return o}return V=i,V}var ee,Fe;function Ur(){if(Fe)return ee;Fe=1;var i=Ye(),r=Ir();function e(t,s){return s.length<2?t:i(t,r(s,0,-1))}return ee=e,ee}var re,Me;function Fr(){if(Me)return re;Me=1;var i=Z(),r=Tr(),e=Ur(),t=We(),s=Object.prototype,a=s.hasOwnProperty;function o(u,c){c=i(c,u);var f=-1,b=c.length;if(!b)return!0;for(var m=u==null||typeof u!="object"&&typeof u!="function";++f<b;){var g=c[f];if(typeof g=="string"){if(g==="__proto__"&&!a.call(u,"__proto__"))return!1;if(g==="constructor"&&f+1<b&&typeof c[f+1]=="string"&&c[f+1]==="prototype"){if(m&&f===0)continue;return!1}}}var p=e(u,c);return p==null||delete p[t(r(c))]}return re=o,re}var te,je;function Mr(){if(je)return te;je=1;var i=or(),r=Pr(),e=ur(),t="[object Object]",s=Function.prototype,a=Object.prototype,o=s.toString,u=a.hasOwnProperty,c=o.call(Object);function f(b){if(!e(b)||i(b)!=t)return!1;var m=r(b);if(m===null)return!0;var g=u.call(m,"constructor")&&m.constructor;return typeof g=="function"&&g instanceof g&&o.call(g)==c}return te=f,te}var ne,ze;function jr(){if(ze)return ne;ze=1;var i=Mr();function r(e){return i(e)?void 0:e}return ne=r,ne}var ie,Ke;function zr(){if(Ke)return ie;Ke=1;var i=dr();function r(e){var t=e==null?0:e.length;return t?i(e,1):[]}return ie=r,ie}var le,De;function Kr(){if(De)return le;De=1;var i=zr(),r=cr(),e=fr();function t(s){return e(r(s,void 0,i),s+"")}return le=t,le}var ae,Ge;function Dr(){if(Ge)return ae;Ge=1;var i=Ve(),r=qr(),e=Fr(),t=Z(),s=Sr(),a=jr(),o=Kr(),u=tr(),c=1,f=2,b=4,m=o(function(g,p){var _={};if(g==null)return _;var h=!1;p=i(p,function(y){return y=t(y,g),h||(h=y.length>1),y}),s(g,u(g),_),h&&(_=r(_,c|f|b,a));for(var w=p.length;w--;)e(_,p[w]);return _});return ae=m,ae}var Gr=Dr();const Xr=er(Gr);var se,Xe;function Zr(){if(Xe)return se;Xe=1;var i="Expected a function";function r(e){if(typeof e!="function")throw new TypeError(i);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}return se=r,se}var oe,Ze;function Jr(){if(Ze)return oe;Ze=1;var i=Cr(),r=Z(),e=br(),t=vr(),s=We();function a(o,u,c,f){if(!t(o))return o;u=r(u,o);for(var b=-1,m=u.length,g=m-1,p=o;p!=null&&++b<m;){var _=s(u[b]),h=c;if(_==="__proto__"||_==="constructor"||_==="prototype")return o;if(b!=g){var w=p[_];h=f?f(w,_,p):void 0,h===void 0&&(h=t(w)?w:e(u[b+1])?[]:{})}i(p,_,h),p=p[_]}return o}return oe=a,oe}var ue,Je;function Hr(){if(Je)return ue;Je=1;var i=Ye(),r=Jr(),e=Z();function t(s,a,o){for(var u=-1,c=a.length,f={};++u<c;){var b=a[u],m=i(s,b);o(m,b)&&r(f,e(b,s),m)}return f}return ue=t,ue}var de,He;function Qr(){if(He)return de;He=1;var i=Ve(),r=rr(),e=Hr(),t=tr();function s(a,o){if(a==null)return{};var u=i(t(a),function(c){return[c]});return o=r(o),e(a,u,function(c,f){return o(c,f[0])})}return de=s,de}var ce,Qe;function Yr(){if(Qe)return ce;Qe=1;var i=rr(),r=Zr(),e=Qr();function t(s,a){return e(s,r(i(a)))}return ce=t,ce}var Wr=Yr();const Vr=er(Wr),et=({pubkey:i,profile:r,otherProperties:e})=>{const t={...r,...e};delete t.deleted;const s=JSON.stringify(t);return{kind:gr,pubkey:i,created_at:Lr(),tags:[],content:s}},rt=i=>{const r=pr(),e=_r(i),{mutation:t,wrapMutate:s}=Or(()=>({mutationKey:["updateProfile",e().pubkey],onSuccess:o=>{const{pubkey:u}=e();if(u==null)return;const c=Er({pubkey:u});r.invalidateQueries({queryKey:c}).catch(f=>console.error("failed to invalidate profile",f)),e().onSuccess?.(o)},onError:o=>{e().onError?.(o)}})),a=s(et);return{mutation:t,publishProfile:a}},tt=R('<div class="h-40 w-full shrink-0 sm:h-52"><img alt=header class="size-full object-cover">'),nt=R('<img alt="user icon"class="size-full rounded-lg object-cover">'),it=R('<div><div class="mt-[-64px] ml-4 size-28 rounded-lg shadow-md">'),lt=R('<div class="px-4 pt-4">'),at=R("<div><span class=font-bold></span><div>"),st=R('<div><form class="flex flex-col gap-4 p-4"><div class="flex flex-col items-start gap-1"><label class=font-bold for=picture></label><input class="w-full rounded-md border-border bg-bg ring-border focus:border-border focus:ring-primary"type=text id=picture name=picture placeholder=https://....../picture.png></div><div class="flex flex-col items-start gap-1"><label class=font-bold for=picture></label><input class="w-full rounded-md border-border bg-bg focus:border-border focus:ring-primary"type=text id=banner name=banner placeholder=https://....../banner.png></div><div class="flex flex-col items-start gap-1"><label class=font-bold for=name></label><div class="flex w-full items-center gap-2"><span>@</span><input class="flex-1 rounded-md border-border bg-bg ring-border focus:border-border focus:ring-primary"type=text id=name name=name maxlength=32 required></div></div><div class="flex flex-col items-start gap-1"><label class=font-bold for=name></label><input class="w-full rounded-md border-border bg-bg ring-border focus:border-border focus:ring-primary"type=text name=displayName maxlength=32></div><div class="flex flex-col items-start gap-1"><label class=font-bold for=name></label><textarea class="w-full rounded-md border-border bg-bg ring-border focus:border-border focus:ring-primary"name=about rows=5></textarea></div><div class="flex flex-col items-start gap-1"><label class=font-bold for=name></label><input class="w-full rounded-md border-border bg-bg ring-border focus:border-border focus:ring-primary"type=text name=website placeholder=https://....../></div><div class="flex flex-col items-start gap-1"><label class=font-bold for=name></label><input class="w-full rounded-md border-border bg-bg ring-border focus:border-border focus:ring-primary"type=text name=nip05 placeholder=yourname@domain.example.com></div><div class="flex flex-col items-start gap-1"><label class=font-bold for=name></label><span class=text-xs></span><input class="w-full rounded-md border-border bg-bg ring-border focus:border-border focus:ring-primary"type=text name=website pattern=^((LNURL1[AC-HJ-NP-Z02-9]+|lnurl1[ac-hj-np-z02-9]+)|[-_a-zA-Z0-9.]+@[-a-zA-Z0-9.]+)$ placeholder="LNURL1XXXXXX / abcdef@wallet.example.com"></div><div class="flex gap-2"><button type=submit class="rounded-sm p-2 font-bold text-primary-fg hover:bg-primary-hover"></button><button type=button class="rounded-sm border border-primary p-2 font-bold text-primary hover:border-primary-hover hover:text-primary-hover">'),ot=R('<div class="h-24 shrink-0">'),ut=R('<div class="flex flex-col items-start"><span class="text-sm font-bold"></span><span class="text-sm break-all whitespace-pre-wrap">'),dt="(LNURL1[AC-HJ-NP-Z02-9]+|lnurl1[ac-hj-np-z02-9]+)",ct="[-_a-zA-Z0-9.]+@[-a-zA-Z0-9.]+",ft=new RegExp(`^${dt}$`),nr=new RegExp(`^${ct}$`),bt=i=>ft.test(i),vt=i=>nr.test(i),yt=i=>{const r=mr(),e=kr(),[t,s]=S(""),[a,o]=S(""),[u,c]=S(""),[f,b]=S(""),[m,g]=S(""),[p,_]=S(""),[h,w]=S(""),[y,J]=S(""),{profile:fe,query:be}=Ar(()=>Nr([e()])(([l])=>({pubkey:l}))),{mutation:O,publishProfile:ir}=rt(()=>({pubkey:e(),onSuccess:l=>{l.failed.length===0?window.alert(r.t("profile.edit.updateSucceeded")):l.succeeded.length>0?window.alert(r.t("profile.edit.failedToUpdatePartially",{count:l.failed.length})):window.alert(r.t("profile.edit.failedToUpdate")),i.onClose()}})),ve=()=>be.isPending||O.isPending,q=()=>ve(),H=()=>Xr(fe(),["picture","banner","name","display_name","about","website","nip05","lud06","lud16"]),lr=l=>{l.preventDefault();const d=e();if(d==null)return;const x=Vr({picture:t(),banner:a(),name:u(),display_name:f(),about:m(),website:p(),nip05:h(),lud06:bt(y())?y():null,lud16:vt(y())?y():null},P=>P==null||P.length===0);ir({pubkey:d,profile:x,otherProperties:H()}).catch(P=>{window.alert(Br(P))})},L=l=>l.key==="Enter"&&l.preventDefault();return hr(()=>{const l=fe();l!=null&&(be.refetch().catch(d=>console.error(d)),$r(()=>{s(d=>l.picture??d),o(d=>l.banner??d),c(d=>l.name??d),b(d=>l.display_name??d),g(d=>l.about??d),_(d=>l.website??d),w(d=>l.nip05??d),l.lud16!=null?J(l.lud16):l.lud06!=null&&J(l.lud06)}))}),C(Rr,{closeButton:()=>C(wr,{}),get onClose(){return i.onClose},get children(){return[(()=>{const l=it(),d=l.firstChild;return v(l,C(T,{get when(){return a().length>0},get fallback(){return ot()},keyed:!0,get children(){const x=tt(),P=x.firstChild;return $(()=>Y(P,"src",a())),x}}),d),v(d,C(T,{get when(){return t().length>0},get children(){const x=nt();return $(()=>Y(x,"src",t())),x}})),l})(),C(T,{get when(){return ve()},get children(){const l=lt();return v(l,()=>r.t("general.loading")),l}}),(()=>{const l=st(),d=l.firstChild,x=d.firstChild,P=x.firstChild,I=P.nextSibling,ge=x.nextSibling,pe=ge.firstChild,U=pe.nextSibling,_e=ge.nextSibling,me=_e.firstChild,ar=me.nextSibling,sr=ar.firstChild,F=sr.nextSibling,he=_e.nextSibling,$e=he.firstChild,M=$e.nextSibling,ye=he.nextSibling,xe=ye.firstChild,Q=xe.nextSibling,we=ye.nextSibling,Pe=we.firstChild,j=Pe.nextSibling,qe=we.nextSibling,Se=qe.firstChild,E=Se.nextSibling,Ce=qe.nextSibling,Re=Ce.firstChild,Le=Re.nextSibling,z=Le.nextSibling,Oe=Ce.nextSibling,k=Oe.firstChild,Ee=k.nextSibling;return d.addEventListener("submit",lr),v(P,()=>r.t("profile.edit.icon")),I.$$keydown=L,I.addEventListener("blur",n=>s(n.currentTarget.value)),v(pe,()=>r.t("profile.edit.banner")),U.$$keydown=L,U.addEventListener("blur",n=>o(n.currentTarget.value)),v(me,()=>r.t("profile.edit.name")),F.$$keydown=L,F.addEventListener("change",n=>c(n.currentTarget.value)),v($e,()=>r.t("profile.edit.displayName")),M.$$keydown=L,M.addEventListener("change",n=>b(n.currentTarget.value)),v(xe,()=>r.t("profile.edit.about")),Q.addEventListener("change",n=>g(n.currentTarget.value)),v(Pe,()=>r.t("profile.edit.website")),j.$$keydown=L,j.addEventListener("change",n=>_(n.currentTarget.value)),v(Se,()=>r.t("profile.edit.nip05")),E.$$keydown=L,E.addEventListener("change",n=>w(n.currentTarget.value)),v(Re,()=>r.t("profile.edit.lightningAddress")),v(Le,()=>r.t("profile.edit.lightningAddressDescription")),z.$$keydown=L,z.addEventListener("change",n=>J(n.currentTarget.value)),v(d,C(T,{get when(){return Object.entries(H()).length>0},get children(){const n=at(),A=n.firstChild,K=A.nextSibling;return v(A,()=>r.t("profile.edit.otherProperties")),v(K,C(yr,{get each(){return Object.entries(H())},children:([D,G])=>(()=>{const N=ut(),B=N.firstChild,X=B.nextSibling;return v(B,D),v(X,G),N})()})),n}}),Oe),v(k,()=>r.t("profile.edit.save")),Ee.$$click=()=>i.onClose(),v(Ee,()=>r.t("profile.edit.cancel")),v(d,C(T,{get when(){return O.isPending},get children(){return r.t("profile.edit.updating")}}),null),$(n=>{const A=q(),K=q(),D=q(),G=q(),N=q(),B=q(),X=nr.source,ke=q(),Ae=q(),Ne=!O.isPending,Be=!!O.isPending,Te=O.isPending;return A!==n._v$&&(I.disabled=n._v$=A),K!==n._v$2&&(U.disabled=n._v$2=K),D!==n._v$3&&(F.disabled=n._v$3=D),G!==n._v$4&&(M.disabled=n._v$4=G),N!==n._v$5&&(Q.disabled=n._v$5=N),B!==n._v$6&&(j.disabled=n._v$6=B),X!==n._v$7&&Y(E,"pattern",n._v$7=X),ke!==n._v$8&&(E.disabled=n._v$8=ke),Ae!==n._v$9&&(z.disabled=n._v$9=Ae),Ne!==n._v$10&&k.classList.toggle("bg-primary",n._v$10=Ne),Be!==n._v$11&&k.classList.toggle("bg-primary-disabled",n._v$11=Be),Te!==n._v$12&&(k.disabled=n._v$12=Te),n},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0,_v$5:void 0,_v$6:void 0,_v$7:void 0,_v$8:void 0,_v$9:void 0,_v$10:void 0,_v$11:void 0,_v$12:void 0}),$(()=>I.value=t()),$(()=>U.value=a()),$(()=>F.value=u()),$(()=>M.value=f()),$(()=>Q.value=m()),$(()=>j.value=p()),$(()=>E.value=h()),$(()=>z.value=y()),l})()]}})};xr(["keydown","click"]);export{yt as default};
//# sourceMappingURL=ProfileEdit-M5XsNyP2.js.map
