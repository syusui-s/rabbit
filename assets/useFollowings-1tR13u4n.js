const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/EventDebugModal-IBpuDzl_.js","assets/index-DUyFlgJ6.js","assets/index-BiEdKg80.css","assets/BasicModal-B9Dos9CH.js","assets/SideBar-C8WRO-Nb.js","assets/resolveAsset-CHYt4kq3.js","assets/Copy-BoWfS9l6.js","assets/UserList-CJXqRieu.js","assets/url-DPIb-kBm.js","assets/LazyLoad-DNicKGvk.js","assets/ZapRequestModal-Cc_mS282.js","assets/lud16ToLnurlPayUrl-B__Kbe6X.js","assets/_baseClone-DReS9UKi.js","assets/SafeLink-BVWsrr5b.js"])))=>i.map(i=>d[i]);
import{i as d,t as g,s as H,a as o,h as w,av as Le,aw as lt,r as p,y as z,u as I,ax as it,j as S,M as E,ag as ct,S as O,c as x,q as B,A as q,p as De,d as M,v as je,f as R,o as X,F as N,n as A,x as Q,B as Z,ab as ce,C as ae,_ as ue,b as T,m as J,w as de,al as at,ao as ut,aj as dt,ai as ht,K as gt,l as ft,D as vt,ay as $e,ak as ye}from"./index-DUyFlgJ6.js";import{r as Ae,t as ee,B as V,f as te,U as mt,g as he,q as Ue,s as Fe,o as ge,b as ne,v as $t,j as yt,P as bt,E as wt,e as qe,n as He,a as kt,k as _t,N as pt,w as xt,x as be,y as le,m as Et,z as Rt,A as Ct}from"./SideBar-C8WRO-Nb.js";import{L as j}from"./LazyLoad-DNicKGvk.js";import{S as L}from"./SafeLink-BVWsrr5b.js";import{t as Oe,a as Be,p as Tt,b as St,c as Mt,d as It,i as Pt}from"./url-DPIb-kBm.js";const Lt=g('<div class="block shrink-0 overflow-hidden border-b border-border p-1">'),ie=e=>(()=>{const t=Lt();return d(t,()=>e.children),t})(),Dt=g('<svg xmlns=http://www.w3.org/2000/svg fill=none stroke=currentColor stroke-width=1.5 aria-hidden=true data-slot=icon viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round d="M19.5 12c0-1.232-.046-2.453-.138-3.662a4.006 4.006 0 0 0-3.7-3.7 48.678 48.678 0 0 0-7.324 0 4.006 4.006 0 0 0-3.7 3.7c-.017.22-.032.441-.046.662M19.5 12l3-3m-3 3-3-3m-12 3c0 1.232.046 2.453.138 3.662a4.006 4.006 0 0 0 3.7 3.7 48.656 48.656 0 0 0 7.324 0 4.006 4.006 0 0 0 3.7-3.7c.017-.22.032-.441.046-.662M4.5 12l3 3m-3-3-3 3">'),Ke=(e={})=>(()=>{const t=Dt();return H(t,e,!0),t})(),jt=g('<button class="text-link underline">'),At=e=>{try{return Le(e)}catch(t){return console.error("failed to encode event id into Bech32 entity (NIP-19) but ignore",e,t),e}},Ut=e=>{try{return lt({id:e})}catch(t){return console.error("failed to encode event id into Bech32 entity (NIP-19) but ignore",e,t),e}},K=e=>(()=>{const t=jt();return d(t,o(w,{get when(){return e.kind==null||e.kind===1},get fallback(){return Ut(e.eventId)},get children(){return At(e.eventId)}})),t})(),Ft=e=>{const t=p(e),n=z(()=>({queryKey:["useEvent",t()],queryFn:({queryKey:a,signal:i})=>{const[,r]=a;if(r==null)return null;const{eventId:s}=r,c=new V({type:"Event",eventId:s}),u=c.firstEventPromise().catch(()=>{throw new Error(`event not found: ${s}`)});return console.log("useEvent",t()),Ae({task:c,signal:i}),ee(15e3,`useEvent: ${s}`)(u)},staleTime:4*60*60*1e3,gcTime:4*60*60*1e3,refetchOnWindowFocus:!1,refetchOnMount:!1}));return{event:()=>n.data??null,query:n}},qt=g("<span>"),Ht=g("<div class=truncate> "),W=e=>{const t=I(),[n,l]=it(e,["eventId"]),{shouldMuteEvent:a}=S(),{event:i,query:r}=Ft(()=>te([n.eventId])(([c])=>({eventId:c}))),s=()=>{const c=i();return c!=null&&a(c)};return o(O,{get fallback(){return(()=>{const c=qt();return d(c,()=>t.t("post.failedToFetchEvent"),null),d(c,()=>e.eventId,null),c})()},get children(){return[o(E,{get when(){return s()},children:null}),o(E,{get when(){return i()},keyed:!0,children:c=>o(ot,ct({event:c},l))}),o(E,{get when(){return r.isLoading&&n.eventId},keyed:!0,children:c=>(()=>{const u=Ht(),h=u.firstChild;return d(u,()=>t.t("general.loading"),h),d(u,o(K,{eventId:c}),null),u})()})]}})},We=e=>{const[t,n]=x(new Date);return B(()=>{const l=setInterval(()=>{n(new Date)},e().interval);q(()=>clearInterval(l))}),t},Ot=e=>{switch(e.kind){case"now":return"now";case"seconds":return`${e.value}s`;case"minutes":return`${e.value}m`;case"hours":return`${e.value}h`;case"days":return`${e.value}d`;case"abs":default:return e.value.toLocaleDateString()}},we=e=>`${e.getHours()}:${e.getMinutes().toString().padStart(2,"0")}`,Bt=e=>{switch(e.kind){case"today":return e.value.toLocaleTimeString();case"yesterday":case"abs":default:return e.value.toLocaleString()}},Kt=e=>{switch(e.kind){case"today":return we(e.value);case"yesterday":return`昨日 ${we(e.value)}`;case"abs":default:return e.value.toLocaleString()}},Wt=(e,t)=>Math.round(Number(t)-Number(e))/1e3,zt=(e,t)=>{const n=Wt(e,t);return n<10?{kind:"now"}:n<60?{kind:"seconds",value:Math.round(n)}:n<3600?{kind:"minutes",value:Math.round(n/60)}:n<86400?{kind:"hours",value:Math.round(n/3600)}:n<604800?{kind:"days",value:Math.round(n/86400)}:{kind:"abs",value:e}},ke=(e,t)=>e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate(),Nt=e=>new Date(+e-24*60*60*1e3),ze=(e,t,n)=>ke(e,t)?n({kind:"today",value:e}):ke(e,Nt(t))?n({kind:"yesterday",value:e}):n({kind:"abs",value:e}),Qt=(e,t=new Date)=>ze(e,t,Bt),Vt=(e,t=new Date)=>ze(e,t,Kt),_e=(e,t=new Date,n=Ot)=>n(zt(e,t)),pe=De(()=>We(()=>({interval:7e3}))),xe=De(()=>We(()=>({interval:60*1e3}))),Ne=()=>{const{config:e}=S();return t=>{switch(e().dateFormat){case"absolute-long":return Qt(t,xe());case"absolute-short":return Vt(t,xe());case"relative":return _e(t,pe());default:return _e(t,pe())}}},Gt=g('<div><div class="flex items-center gap-1"><div class="flex shrink-0 place-items-center pl-[2px]"aria-hidden=true><span class="size-4 text-r-repost"></span></div><div class="notification-user flex min-w-0 flex-1 overflow-hidden text-xs"><button class="select-text truncate hover:text-link hover:underline"></button><span class="shrink-0 whitespace-pre"></span></div><div class=text-xs></div></div><div class=pt-1>'),Yt=e=>{const t=I(),{showProfile:n}=he(),l=Ne(),a=p(()=>je(e.event)),i=()=>a().lastTaggedEventId();return(()=>{const r=Gt(),s=r.firstChild,c=s.firstChild,u=c.firstChild,h=c.nextSibling,v=h.firstChild,b=v.nextSibling,m=h.nextSibling,$=s.nextSibling;return d(u,o(Ke,{})),v.$$click=()=>n(e.event.pubkey),d(v,o(mt,{get pubkey(){return e.event.pubkey}})),d(b,()=>t.t("notification.reposted")),d(m,()=>l(a().createdAtAsDate())),d($,o(W,{get eventId(){return i()}})),r})()};M(["click"]);const Zt=g('<svg xmlns=http://www.w3.org/2000/svg fill=none stroke=currentColor stroke-width=1.5 aria-hidden=true data-slot=icon viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round d="m3.75 13.5 10.5-11.25L12 10.5h8.25L9.75 21.75 12 13.5z">'),Jt=(e={})=>(()=>{const t=Zt();return H(t,e,!0),t})(),Xt=g('<svg xmlns=http://www.w3.org/2000/svg fill=none stroke=currentColor stroke-width=1.5 aria-hidden=true data-slot=icon viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round d="M2.25 12.76c0 1.6 1.123 2.994 2.707 3.227 1.087.16 2.185.283 3.293.369V21l4.076-4.076a1.526 1.526 0 0 1 1.037-.443 48.282 48.282 0 0 0 5.68-.494c1.584-.233 2.707-1.626 2.707-3.228V6.741c0-1.602-1.123-2.995-2.707-3.228A48.394 48.394 0 0 0 12 3c-2.392 0-4.744.175-7.043.513C3.373 3.746 2.25 5.14 2.25 6.741z">'),en=(e={})=>(()=>{const t=Xt();return H(t,e,!0),t})(),tn=g('<svg xmlns=http://www.w3.org/2000/svg fill=none stroke=currentColor stroke-width=1.5 aria-hidden=true data-slot=icon viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round d="M6.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0m6 0a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0m6 0a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0">'),nn=(e={})=>(()=>{const t=tn();return H(t,e,!0),t})(),rn=g('<svg xmlns=http://www.w3.org/2000/svg fill=currentColor aria-hidden=true data-slot=icon viewBox="0 0 24 24"><path d="m11.645 20.91-.007-.003-.022-.012a15.247 15.247 0 0 1-.383-.218 25.18 25.18 0 0 1-4.244-3.17C4.688 15.36 2.25 12.174 2.25 8.25 2.25 5.322 4.714 3 7.688 3A5.5 5.5 0 0 1 12 5.052 5.5 5.5 0 0 1 16.313 3c2.973 0 5.437 2.322 5.437 5.25 0 3.925-2.438 7.111-4.739 9.256a25.175 25.175 0 0 1-4.244 3.17 15.247 15.247 0 0 1-.383.219l-.022.012-.007.004-.003.001a.752.752 0 0 1-.704 0l-.003-.001Z">'),Qe=(e={})=>(()=>{const t=rn();return H(t,e,!0),t})(),on=g('<span class="inline-block size-full pt-px text-r-reaction">'),Ee=g("<span class=truncate>"),sn=g('<img class="pointer-events-none h-full w-auto object-contain">'),ln=e=>e.type==="LikeDislike"&&(e.content==="+"||e.content.length===0),fe=e=>o(O,{get fallback(){return(()=>{const t=Ee();return d(t,()=>e.reactionTypes.content),t})()},get children(){return[o(E,{get when(){return ln(e.reactionTypes)},get children(){const t=on();return d(t,o(Qe,{})),t}}),o(E,{get when(){return e.reactionTypes.type==="Emoji"&&e.reactionTypes},keyed:!0,children:({content:t})=>(()=>{const n=Ee();return d(n,t),n})()}),o(E,{get when(){return e.reactionTypes.type==="CustomEmoji"&&e.reactionTypes},keyed:!0,children:({shortcode:t,url:n})=>(()=>{const l=sn();return R(l,"src",n),R(l,"alt",`:${t}:`),l})()})]}}),cn=300,an=e=>{let t,n=!1;return X(()=>{if(t==null)return;const{onLongPress:l,onClick:a,delay:i=cn}=e();let r;const s=()=>{n=!1,r=setTimeout(()=>{n=!0,l()},i)},c=()=>{r!=null&&clearTimeout(r)},u=b=>{b.preventDefault(),s()},h=b=>{b.preventDefault(),c()},v=()=>{n||(c(),a())};t.addEventListener("mousedown",u),t.addEventListener("mouseup",h),t.addEventListener("touchstart",u),t.addEventListener("touchend",h),t.addEventListener("click",v),q(()=>{c(),t?.removeEventListener("mouseddown",u),t?.removeEventListener("mouseup",h),t?.removeEventListener("touchstart",u),t?.removeEventListener("touchend",h),t?.removeEventListener("click",v)})}),{ref:l=>{t=l}}},un=g('<div><div class="max-w-screen flex h-24 min-w-24 items-center justify-center rounded border border-border bg-bg text-5xl shadow">'),dn=e=>{let t;const n=p(e),[l,a]=x(!1);let i;const r=()=>{setTimeout(()=>{l()||i.close()},100)},s=()=>{i.open()};i=Ue(()=>({popup:()=>(()=>{const u=un(),h=u.firstChild;return u.addEventListener("mouseleave",()=>{a(!1),r()}),u.addEventListener("mouseenter",()=>{a(!0)}),d(h,o(fe,{get reactionTypes(){return n().reactionTypes}})),u})(),position:{x:"center",y:"top"}}));const c=an(()=>({onLongPress:()=>s(),onClick:()=>n()?.onClick?.()}));return X(()=>{t?.addEventListener("mouseenter",s),t?.addEventListener("mouseleave",r)}),{emojiRef:u=>{t=u,i.targetRef(u),c.ref(u)},popup:i.popup}},hn=g('<svg xmlns=http://www.w3.org/2000/svg fill=none stroke=currentColor stroke-width=1.5 aria-hidden=true data-slot=icon viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round d="m8.25 4.5 7.5 7.5-7.5 7.5">'),gn=(e={})=>(()=>{const t=hn();return H(t,e,!0),t})(),fn=g('<li class="border-b border-border hover:bg-bg-tertiary"><button class="w-full px-4 py-1 text-start">'),vn=g('<li class="border-b border-border hover:bg-bg-tertiary"><button class="flex w-full items-center py-1 pe-2 ps-4 text-start"><span class=flex-1></span><span class="inline-block size-4 shrink-0">'),mn=g('<ul class="min-w-[96px] rounded border border-border bg-bg shadow-md">'),$n=e=>{const t=()=>{e.item?.onSelect?.(),e.onClose()};return(()=>{const n=fn(),l=n.firstChild;return l.$$click=t,d(l,()=>e.item.content),n})()},yn=e=>{const t=Ve(()=>({menu:e.submenu.items,position:{x:"right",y:"bottom"}})),n=()=>{t.open()};return(()=>{const l=vn(),a=l.firstChild,i=a.firstChild,r=i.nextSibling,s=t.targetRef;return typeof s=="function"?A(s,l):t.targetRef=l,a.$$click=n,d(i,()=>e.submenu.content),d(r,o(gn,{})),d(l,()=>t.popup(),null),l})()},bn=e=>"onSelect"in e?e:null,wn=e=>"items"in e?e:null,Ve=e=>{const t=p(e),n=Ue(()=>({ensureWidth:300,position:{x:"right",y:"bottom"},...t(),popup:(()=>{const l=mn();return d(l,o(N,{get each(){return t().menu.filter(a=>a.when==null||a.when())},children:a=>o(O,{get children(){return[o(E,{get when(){return bn(a)},keyed:!0,children:i=>o($n,{item:i,onClose:()=>n.close()})}),o(E,{get when(){return wn(a)},keyed:!0,children:i=>o(yn,{submenu:i,onClose:()=>n.close()})})]}})})),l})()}));return n};M(["click"]);const kn=/\p{Emoji_Presentation}/u,Ge=e=>["useReactions",e],ve=e=>{const{shouldMuteEvent:t}=S(),n=Q(),l=p(()=>Ge(e())),a=z(()=>({queryKey:l(),queryFn:Fe({taskProvider:([,u])=>{if(u==null)return null;const{eventId:h}=u;return new V({type:"Reactions",mentionedEventId:h})},queryClient:n}),staleTime:1*60*1e3,gcTime:4*60*60*1e3,refetchInterval:1*60*1e3})),i=()=>(a.data??[]).filter(h=>!t(h));return{reactions:i,reactionsGrouped:()=>{const u=new Map;return i().forEach(h=>{const v=Z(h).isCustomEmoji()?`${h.content}${Z(h).getUrl()??""}`:h.content,b=u.get(v)??[];b.push(h),u.set(v,b)}),u},isReactedBy:u=>i().findIndex(h=>h.pubkey===u)!==-1,isReactedByWithEmoji:u=>i().findIndex(h=>h.pubkey===u&&kn.test(h.content))!==-1,query:a}},Ye=e=>{const t=Q(),n=p(e),l=ge();return ce(()=>({mutationKey:["useReactionMutation",n().eventId],mutationFn:(...i)=>l.publishReaction(...i).then(r=>Promise.allSettled(r.map(ee(5e3)))),onSuccess:i=>{const r=i.filter(c=>c.status==="fulfilled").length,s=i.length-r;r===i.length?console.log("Succeeded to publish a reaction"):r>0?console.warn(`failed to publish a reaction on ${s} relays`):console.error("failed to publish reaction on all relays")},onError:i=>{console.error("failed to publish reaction: ",i)},onSettled:()=>{const i=Ge({eventId:n().eventId});t.refetchQueries({queryKey:i}).then(()=>t.invalidateQueries({queryKey:i})).catch(r=>console.error("failed to refetch reactions",r))}}))},Ze=e=>["useReposts",e],Je=e=>{const{shouldMuteEvent:t}=S(),n=Q(),l=p(e),a=p(()=>Ze(l())),i=z(()=>({queryKey:a(),queryFn:Fe({taskProvider:([,c])=>{if(c==null)return null;const{eventId:u}=c;return new V({type:"Reposts",mentionedEventId:u})},queryClient:n}),staleTime:1*60*1e3,gcTime:4*60*60*1e3,refetchInterval:1*60*1e3})),r=()=>(i.data??[]).filter(u=>!t(u));return{reposts:r,isRepostedBy:c=>r().findIndex(u=>u.pubkey===c)!==-1,query:i}},_n=e=>{const t=Q(),n=p(e),l=ge();return ce(()=>({mutationKey:["useRepostMutation",n().eventId],mutationFn:(...i)=>l.publishRepost(...i).then(r=>Promise.allSettled(r.map(ee(1e4)))),onSuccess:i=>{const r=i.filter(c=>c.status==="fulfilled").length,s=i.length-r;r===i.length?console.log("Succeeded to publish a repost"):r>0?console.warn(`Failed to publish a repost on ${s} relays`):console.error("Failed to publish a repost on all relays")},onError:i=>{console.error("failed to publish repost: ",i)},onSettled:()=>{const i=Ze({eventId:n().eventId});t.refetchQueries({queryKey:i}).then(()=>t.invalidateQueries({queryKey:i})).catch(r=>console.error("failed to refetch repost",r))}}))},Re=["k","M","G","T","P"],pn=(e,t)=>{const n=t?.precision,a=10**((t?.minDigits??4)-1);if(e<a)return{value:e,prefix:null};const i=10**(Math.floor(Math.log10(e)/3)*3),r=e/i;let s=Math.round(r*10**n)/10**n,c=Math.max(Math.floor(Math.log10(e)/3)-1,0);return s>=1e3&&(s/=1e3,c+=1),c>=Re.length?{value:e,prefix:null}:{value:s,prefix:Re[c]}},Xe=(e,t)=>{const{value:n,prefix:l}=pn(e,{precision:2,minDigits:t?.minDigits??5});if(l==null)return`${e}`;const a=t?.digits??3,i=Math.floor(Math.log10(n))+1,r=Math.max(a-i,0);return`${Math.round(n*10**r)/10**r}${l}`},et=g('<div class="text-sm text-fg-tertiary">'),Ce=g('<div class="flex shrink-0 items-center gap-1"><button class=size-4>'),xn=g('<div class="flex shrink-0 items-center gap-1"><button><span class="flex size-4">'),En=g('<div class="h-4 min-w-4 max-w-8">'),Rn=g('<div class="scrollbar flex gap-2 overflow-x-auto py-1">'),Cn=g('<span class="ml-1 text-sm">'),Tn=g('<button class="webkit-touch-callout-none flex h-6 touch-none select-none items-center rounded border border-border px-1"type=button><span class="flex h-5 min-w-5 max-w-[128px] items-center justify-center">'),Sn=g("<span class=text-red-500>"),Mn=g('<div class="actions flex w-64 max-w-full items-center justify-between pt-1"><button class="shrink-0 text-fg-tertiary hover:text-fg-tertiary/70"><span class="flex size-4"></span></button><button type=button><span class="flex size-4 text-fg-tertiary hover:text-r-zap"></span></button><button type=button class="size-4 shrink-0 text-fg-tertiary hover:text-fg-tertiary/70">'),In=ae(()=>ue(()=>import("./EventDebugModal-IBpuDzl_.js"),__vite__mapDeps([0,1,2,3,4,5,6]))),tt=ae(()=>ue(()=>import("./UserList-CJXqRieu.js"),__vite__mapDeps([7,1,2,4,5,8,3,9]))),Pn=ae(()=>ue(()=>import("./ZapRequestModal-Cc_mS282.js"),__vite__mapDeps([10,1,2,3,4,5,6,11,12,9,13,8]))),Ln=e=>{if(e.native!=null)return{type:"Emoji",content:e.native};if(e.src!=null)return{type:"CustomEmoji",content:`:${e.id}:`,shortcode:e.id,url:e.src};throw new Error("unknown emoji")},Dn=e=>{const{config:t}=S(),n=ne(),[l,a]=x(!1),{reactions:i,isReactedByWithEmoji:r,isReactedBy:s}=ve(()=>({eventId:e.event.id})),c=p(()=>{const f=n();return f!=null&&s(f)||l()}),u=p(()=>{const f=n();return f!=null&&r(f)}),h=Ye(()=>({eventId:e.event.id})),v=f=>{c()||te([n(),e.event.id])(([y,_])=>{h.mutate({relayUrls:t().relayUrls,pubkey:y,reactionTypes:f??{type:"LikeDislike",content:"+"},eventId:_,kind:e.event.kind,notifyPubkey:e.event.pubkey}),a(!0)})},b=f=>{f.stopPropagation(),v()},m=f=>{v(Ln(f))},$=$t(()=>({onEmojiSelect:m}));return[(()=>{const f=Ce(),y=f.firstChild;return y.$$click=b,d(y,o(w,{get when(){return p(()=>!!c())()&&!u()},get fallback(){return o(yt,{})},get children(){return o(Qe,{})}})),d(f,o(w,{get when(){return p(()=>!t().hideCount&&!t().showEmojiReaction)()&&i().length>0},get children(){const _=et();return d(_,()=>Xe(i().length,{minDigits:4})),_}}),null),T(_=>{const C={"text-fg-tertiary":!c()||u(),"hover:text-r-reaction":!c()||u(),"text-r-reaction":c()&&!u()||h.isPending},D=h.isPending;return _._v$=J(f,C,_._v$),D!==_._v$2&&(y.disabled=_._v$2=D),_},{_v$:void 0,_v$2:void 0}),f})(),o(w,{get when(){return t().useEmojiReaction},get children(){const f=Ce(),y=f.firstChild;y.$$click=()=>$.open();const _=$.targetRef;return typeof _=="function"?A(_,y):$.targetRef=y,d(y,o(bt,{})),d(f,()=>$.popup(),null),T(C=>J(f,{"text-fg-tertiary":!c()||!u(),"hover:text-r-reaction":!c()||!u(),"text-r-reaction":c()&&u()||h.isPending},C)),f}})]},jn=e=>{const{config:t}=S(),n=ne(),[l,a]=x(!1),{reposts:i,isRepostedBy:r}=Je(()=>({eventId:e.event.id})),s=p(()=>{const h=n();return h!=null&&r(h)||l()}),c=_n(()=>({eventId:e.event.id})),u=h=>{h.stopPropagation(),!s()&&te([n(),e.event.id])(([v,b])=>{c.mutate({relayUrls:t().relayUrls,pubkey:v,eventId:b,kind:e.event.kind,notifyPubkey:e.event.pubkey}),a(!0)})};return(()=>{const h=xn(),v=h.firstChild,b=v.firstChild;return v.$$click=u,d(b,o(Ke,{})),d(h,o(w,{get when(){return p(()=>!t().hideCount)()&&i().length>0},get children(){const m=et();return d(m,()=>Xe(i().length,{minDigits:4})),m}}),null),T(m=>{const $={"text-fg-tertiary":!s(),"hover:text-r-repost":!s(),"text-r-repost":s()||c.isPending},f=c.isPending;return m._v$3=J(h,$,m._v$3),f!==m._v$4&&(v.disabled=m._v$4=f),m},{_v$3:void 0,_v$4:void 0}),h})()},An=e=>{const{reactions:t}=ve(()=>({eventId:e.event.id}));return o(tt,{get data(){return t()},pubkeyExtractor:n=>n.pubkey,renderInfo:n=>(()=>{const l=En();return d(l,o(fe,{get reactionTypes(){return Z(n).toReactionTypes()}})),l})(),get onClose(){return e.onClose}})},Un=e=>{const{reposts:t}=Je(()=>({eventId:e.event.id}));return o(tt,{get data(){return t()},pubkeyExtractor:n=>n.pubkey,get onClose(){return e.onClose}})},Fn=e=>{const{config:t}=S(),n=ne(),[l,a]=x(!1),{reactions:i,reactionsGrouped:r,isReactedBy:s}=ve(()=>({eventId:e.event.id})),c=Ye(()=>({eventId:e.event.id})),u=()=>{const v=n();return v==null?l():l()||s(v)},h=v=>{u()||te([n(),e.event.id])(([b,m])=>{c.mutate({relayUrls:t().relayUrls,pubkey:b,reactionTypes:v??{type:"LikeDislike",content:"+"},eventId:m,kind:e.event.kind,notifyPubkey:e.event.pubkey}),a(!0)})};return o(w,{get when(){return p(()=>!!t().showEmojiReaction)()&&i().length>0},get children(){const v=Rn();return d(v,o(N,{get each(){return[...r().entries()]},children:([,b])=>{const m=b.findIndex(y=>y.pubkey===n())>=0,$=Z(b[0]).toReactionTypes(),f=dn(()=>({reactionTypes:$,onClick:()=>{u()||c.isPending||h($)}}));return(()=>{const y=Tn(),_=y.firstChild;return A(C=>f.emojiRef(C),y),d(_,o(fe,{reactionTypes:$})),d(y,o(w,{get when(){return!t().hideCount},get children(){const C=Cn();return d(C,()=>b.length),C}}),null),d(y,()=>f.popup(),null),T(C=>J(y,{"text-fg-tertiary":!m,"hover:bg-r-reaction/10":!m,"hover:border-r-reaction/40":!m,"bg-r-reaction/10":m,"border-r-reaction/40":m,"text-r-reaction":m},C)),y})()}})),v}})},qn=e=>{const t=I(),{config:n}=S(),l=ne(),a=ge(),[i,r]=x(null),s=()=>r(null),c=ce(()=>({mutationKey:["deleteEvent",e.event.id],mutationFn:(...h)=>a.deleteEvent(...h).then(v=>Promise.allSettled(v.map(ee(1e4)))),onSuccess:h=>{const v=h.filter(m=>m.status==="fulfilled").length,b=h.length-v;v===h.length?window.alert(t.t("post.deletedSuccessfully")):v>0?window.alert(t.t("post.failedToDeletePartially",{count:b})):window.alert(t.t("post.failedToDelete"))},onError:h=>{console.error("failed to delete",h)}})),u=Ve(()=>({menu:[{content:t.t("post.copyEventId"),onSelect:()=>{navigator.clipboard.writeText(Le(e.event.id)).catch(h=>window.alert(h))}},{content:t.t("post.showJSON"),onSelect:()=>{r("EventDebugModal")}},{content:t.t("post.showReposts"),onSelect:()=>{r("Reposts")}},{content:t.t("post.showReactions"),onSelect:()=>{r("Reactions")}},{when:()=>e.event.pubkey===l(),content:(()=>{const h=Sn();return d(h,()=>t.t("post.deletePost")),h})(),onSelect:()=>{const h=l();h!=null&&window.confirm(t.t("post.confirmDelete"))&&c.mutate({relayUrls:n().relayUrls,pubkey:h,eventId:e.event.id,kind:e.event.kind})}}]}));return[o(Fn,{get event(){return e.event}}),(()=>{const h=Mn(),v=h.firstChild,b=v.firstChild,m=v.nextSibling,$=m.firstChild,f=m.nextSibling;v.$$click=_=>{_.stopPropagation(),e.onClickReply()},d(b,o(en,{})),d(h,o(jn,{get event(){return e.event}}),m),d(h,o(Dn,{get event(){return e.event}}),m),m.$$click=()=>r("ZapRequest"),d($,o(Jt,{})),f.$$click=()=>u.open();const y=u.targetRef;return typeof y=="function"?A(y,f):u.targetRef=f,d(f,o(nn,{})),d(h,()=>u.popup(),null),h})(),o(O,{get children(){return[o(E,{get when(){return i()==="EventDebugModal"},get children(){return o(In,{get event(){return e.event},onClose:s})}}),o(E,{get when(){return i()==="Reactions"},get children(){return o(An,{get event(){return e.event},onClose:s})}}),o(E,{get when(){return i()==="Reposts"},get children(){return o(Un,{get event(){return e.event},onClose:s})}}),o(E,{get when(){return i()==="ZapRequest"},get children(){return o(Pn,{get zapTo(){return{event:e.event}},onClose:s})}})]}})]};M(["click"]);const Hn=g("<div>"),On=g('<button class="text-xs text-fg-secondary hover:text-fg-secondary/70">'),Bn=g("<span>: "),Kn=g('<button class="mt-2 flex w-full flex-col items-center rounded border border-border p-2 text-center text-xs text-fg-secondary"><span class="inline-block size-4"></span><span>'),Wn=e=>{const t=I(),[n,l]=x(!1);return o(w,{get when(){return!e.contentWarning.contentWarning||n()},get fallback(){return(()=>{const a=Kn(),i=a.firstChild,r=i.nextSibling;return a.$$click=()=>l(!0),d(i,o(wt,{})),d(r,()=>t.t("post.contentWarning.show")),d(a,o(w,{get when(){return e.contentWarning.reason!=null},get children(){const s=Bn(),c=s.firstChild;return d(s,()=>t.t("post.contentWarning.reason"),c),d(s,()=>e.contentWarning.reason,null),s}}),null),a})()},get children(){return[(()=>{const a=Hn();return d(a,()=>e.children),a})(),o(w,{get when(){return e.contentWarning.contentWarning},get children(){const a=On();return a.$$click=()=>l(!1),d(a,()=>t.t("post.contentWarning.hide")),a}})]}})};M(["click"]);const nt=e=>{const{profile:t}=qe(()=>({pubkey:e.pubkey}));return o(w,{get when(){return(t()?.name?.length??0)>0},get fallback(){return`@${He(e.pubkey)}`},get children(){return["@",p(()=>t()?.name??e.pubkey)]}})},zn=g('<button class="rounded bg-bg-tertiary p-3 text-xs text-fg-secondary hover:shadow">'),Nn=g("<div class=max-w-full>"),Qn=g("<audio controls><a>"),Vn=e=>{const t=I(),[n,l]=x(e.initialHidden);return o(w,{get when(){return!n()},get fallback(){return(()=>{const a=zn();return a.$$click=()=>l(!1),d(a,()=>t.t("post.showAudio")),a})()},get children(){return o(j,{get fallback(){return Nn()},children:()=>o(L,{class:"my-2 block",get href(){return e.url},get children(){const a=Qn(),i=a.firstChild;return d(i,()=>t.t("post.download")),T(r=>{const s=e.url,c=e.url;return s!==r._v$&&R(a,"src",r._v$=s),c!==r._v$2&&R(i,"href",r._v$2=c),r},{_v$:void 0,_v$2:void 0}),a}})})}})};M(["click"]);const Gn=g('<button class="rounded bg-bg-tertiary p-3 text-xs text-fg-secondary hover:shadow">'),Yn=g('<div class="aspect-video max-w-full">'),Zn=g('<img class="max-h-64 max-w-full rounded object-contain shadow hover:shadow-md">'),Jn=e=>{let t;const n=I(),[l,a]=x(e.initialHidden),[i,r]=x(!1);return o(w,{get when(){return!l()},get fallback(){return(()=>{const s=Gn();return s.$$click=()=>a(!1),d(s,()=>n.t("post.showImage")),s})()},get children(){return o(j,{get fallback(){return(()=>{const s=Yn();return d(s,o(L,{class:"text-link underline",get href(){return e.url}})),s})()},children:()=>o(w,{get when(){return!i()},get fallback(){return o(L,{class:"text-link underline",get href(){return e.url}})},get children(){return o(L,{class:"my-2 block",get href(){return e.url},get children(){const s=Zn();s.addEventListener("error",()=>r(!0));const c=t;return typeof c=="function"?A(c,s):t=s,T(u=>{const h=Oe(e.url),v=e.url;return h!==u._v$&&R(s,"src",u._v$=h),v!==u._v$2&&R(s,"alt",u._v$2=v),u},{_v$:void 0,_v$2:void 0}),s}})}})})}})};M(["click"]);const Xn=g('<div class="my-1 rounded border p-1">'),er=e=>o(w,{get when(){return e.mentionedEvent.marker!=null&&e.mentionedEvent.marker.length>0},get fallback(){return o(K,{get eventId(){return e.mentionedEvent.eventId}})},get children(){const t=Xn();return d(t,o(j,{children:()=>o(W,{get eventId(){return e.mentionedEvent.eventId},embedding:!1,actions:!1,get ensureKinds(){return[de]}})})),t}}),tr=g('<button class="inline select-text text-link underline">'),re=e=>{const{showProfile:t}=he(),n=()=>{t(e.pubkey)};return(()=>{const l=tr();return l.$$click=n,d(l,o(nt,{get pubkey(){return e.pubkey}})),l})()};M(["click"]);const nr=["www3.nhk.or.jp"],rr=(e,t)=>{const n={};Array.from(e.head.querySelectorAll("meta")).forEach(s=>{const c=s.getAttribute("property")||s.getAttribute("name"),u=s.getAttribute("content");c!=null&&u!=null&&(n[c]=u)});const l=n["og:image"]||n["twitter:image"],a=n["og:title"]||n["twitter:title"],i=n["og:description"]||n["twitter:description"]||"",r=n["og:url"]||t;return l!=null&&a!=null&&i!=null&&r?{title:a,description:i,image:l,url:r}:null},or=(e,t)=>{const n=new DOMParser().parseFromString(e,"text/html");return rr(n,t)},rt=e=>new URL(e).protocol==="https:",sr=e=>{const t=new URL(e);return nr.includes(t.hostname)},lr=e=>sr(e)?e:`https://corsproxy.io/?${encodeURIComponent(e)}`,ir=async e=>{if(!rt(e))return null;const t=lr(e),l=await(await fetch(t,{mode:"cors",headers:{Accept:"text/html"},credentials:"omit"})).text();return or(l,e)},cr=e=>{const t=()=>["useOgp",e().url],n=z(()=>({queryKey:t(),queryFn:({queryKey:[,a]})=>ir(a),staleTime:144e5,gcTime:144e5,refetchOnWindowFocus:!1,refetchOnMount:!1}));return{query:n,ogp:()=>n.data}},ar=g('<blockquote class=twitter-tweet><a class="text-link underline"target=_blank rel="noreferrer noopener">'),ur=g('<div class="my-2 rounded-lg border border-border transition-colors hover:bg-bg-tertiary"><img class="max-w-full rounded-t-lg object-contain shadow"><div class="mb-1 p-1"><div class="text-xs text-fg-secondary"></div><div class=text-sm></div><div class="text-xs text-fg-secondary">'),dr=g('<div><button class="flex flex-col items-center rounded bg-bg-tertiary p-3 text-xs text-fg-secondary hover:shadow">'),hr=g('<div class="aspect-video max-w-full">'),gr=g('<div class="my-2 aspect-video w-full"><iframe loading=lazy title=YouTube class="my-2 size-full"allowfullscreen>'),Te=e=>{try{const t=new URL(e);return t.host="twitter.com",t.href}catch{return e}},fr=e=>{const t=new URL("https://www.youtube-nocookie.com/embed/");return t.pathname+=e,t.searchParams.set("origin",window.location.origin),t.href},vr=e=>{let t;const{getColorTheme:n}=S();B(()=>{Be(e.url)&&window.twttr?.widgets?.load(t)});const l=()=>n().brightness==="dark"?"dark":"light";return(()=>{const a=ar(),i=a.firstChild,r=t;return typeof r=="function"?A(r,a):t=a,d(i,()=>Te(e.url)),T(s=>{const c=l(),u=Te(e.url);return c!==s._v$&&R(a,"data-theme",s._v$=c),u!==s._v$2&&R(i,"href",s._v$2=u),s},{_v$:void 0,_v$2:void 0}),a})()},mr=e=>{const{ogp:t}=cr(()=>({url:e.url}));return o(w,{get when(){return t()},get fallback(){return o(L,{class:"text-link underline",get href(){return e.url}})},keyed:!0,children:n=>o(L,{get href(){return e.url},get children(){const l=ur(),a=l.firstChild,i=a.nextSibling,r=i.firstChild,s=r.nextSibling,c=s.nextSibling;return d(r,()=>new URL(n.url).host),d(s,()=>n.title),d(c,()=>n.description),T(u=>{const h=n.title,v=n.image;return h!==u._v$3&&R(a,"alt",u._v$3=h),v!==u._v$4&&R(a,"src",u._v$4=v),u},{_v$3:void 0,_v$4:void 0}),l}})})},oe=e=>{const t=I(),[n,l]=x(e.initialHidden);return o(w,{get when(){return!n()},get fallback(){return(()=>{const a=dr(),i=a.firstChild;return i.$$click=()=>l(!1),d(i,()=>t.t("post.showPreview")),d(a,o(L,{class:"text-link underline",get href(){return e.url}}),null),a})()},get children(){return e.children}})},$r=e=>{const{config:t}=S();return o(O,{get fallback(){return o(L,{class:"text-link underline",get href(){return e.url}})},get children(){return[o(E,{get when(){return p(()=>!!t().embedding.twitter)()&&Be(e.url)},get children(){return o(oe,{get url(){return e.url},get initialHidden(){return e.initialHidden},get children(){return o(vr,{get url(){return e.url}})}})}}),o(E,{get when(){return p(()=>!!t().embedding.youtube)()&&Tt(e.url)},keyed:!0,children:({videoId:n})=>o(oe,{get url(){return e.url},get initialHidden(){return e.initialHidden},get children(){return o(j,{get fallback(){return(()=>{const l=hr();return d(l,o(L,{get href(){return e.url}})),l})()},children:()=>(()=>{const l=gr(),a=l.firstChild;return T(()=>R(a,"src",fr(n))),l})()})}})}),o(E,{get when(){return p(()=>!!t().embedding.ogp)()&&rt(e.url)},get children(){return o(oe,{get url(){return e.url},get initialHidden(){return e.initialHidden},get children(){return o(j,{children:()=>o(mr,{get url(){return e.url}})})}})}})]}})};M(["click"]);const yr=g('<button class="rounded bg-bg-tertiary p-3 text-xs text-fg-secondary hover:shadow">'),br=g('<div class="aspect-video max-w-full">'),wr=g('<video class="max-h-64 max-w-full rounded-sm object-contain shadow"controls><a>'),kr=e=>{let t;const n=I(),[l,a]=x(e.initialHidden);return o(w,{get when(){return!l()},get fallback(){return(()=>{const i=yr();return i.$$click=()=>a(!1),d(i,()=>n.t("post.showVideo")),i})()},get children(){return o(j,{get fallback(){return br()},children:()=>o(L,{class:"my-2 block",get href(){return e.url},get children(){const i=wr(),r=i.firstChild,s=t;return typeof s=="function"?A(s,i):t=i,d(r,()=>n.t("post.download")),T(c=>{const u=e.url,h=e.url;return u!==c._v$&&R(i,"src",c._v$=u),h!==c._v$2&&R(r,"href",c._v$2=h),c},{_v$:void 0,_v$2:void 0}),i}})})}})};M(["click"]);const se=g("<span>"),Se=g('<button class="select-text text-link underline">'),Me=g('<div class="my-1 rounded border border-border p-1">'),_r=g('<button class="select-text text-link underline"> (<!>)'),pr=g('<span class="text-link underline">'),xr=g('<img class="inline-block h-8 max-w-32">'),Er=e=>{const{config:t,saveColumn:n}=S(),l=kt(),a=r=>{n(at({query:r})),l({command:"moveToLastColumn"}).catch(s=>console.error(s))},i=r=>{n(ut({name:r,relayUrls:[r]})),l({command:"moveToLastColumn"}).catch(s=>console.error(s))};return o(N,{get each(){return e.parsed},children:r=>{if(r.type==="PlainText")return(()=>{const s=se();return d(s,()=>r.content),s})();if(r.type==="URL"){const s=()=>!t().showMedia||!e.embedding||(e.initialHidden??!1);return St(r.content)?o(Jn,{get url(){return r.content},get initialHidden(){return s()}}):Mt(r.content)?o(kr,{get url(){return r.content},get initialHidden(){return s()}}):It(r.content)?o(Vn,{get url(){return r.content},get initialHidden(){return s()}}):Pt(r.content)?(()=>{const c=Se();return c.$$click=()=>i(r.content),d(c,()=>r.content),c})():o($r,{get url(){return r.content},get initialHidden(){return s()}})}if(r.type==="TagReferenceResolved"){if(r.reference==null)return(()=>{const s=se();return d(s,()=>r.content),s})();if(r.reference.type==="MentionedUser")return o(re,{get pubkey(){return r.reference.pubkey}});if(r.reference.type==="MentionedEvent")return e.embedding?o(er,{get mentionedEvent(){return r.reference}}):o(K,{get eventId(){return r.reference.eventId}})}if(r.type==="Bech32Entity"){if(r.data.type==="note"&&e.embedding)return(()=>{const s=Me();return d(s,o(W,{get eventId(){return r.data.data},actions:!1,embedding:!1,get ensureKinds(){return[de]}})),s})();if(r.data.type==="nevent"&&e.embedding)return(()=>{const s=Me();return d(s,o(W,{get eventId(){return r.data.data.id},actions:!1,embedding:!1})),s})();if(r.data.type==="npub")return o(re,{get pubkey(){return r.data.data}});if(r.data.type==="nprofile")return o(re,{get pubkey(){return r.data.data.pubkey}});if(r.data.type==="nrelay"){const s=r.data.data;return(()=>{const c=_r(),u=c.firstChild,h=u.nextSibling;return h.nextSibling,c.$$click=()=>i(s),d(c,s,u),d(c,()=>r.content,h),c})()}return(()=>{const s=pr();return d(s,()=>r.content),s})()}return r.type==="HashTag"?(()=>{const s=Se();return s.$$click=()=>a(r.content),d(s,()=>r.content),s})():r.type==="CustomEmojiResolved"?r.url==null?(()=>{const s=se();return d(s,()=>r.content),s})():(()=>{const s=xr();return T(c=>{const u=r.url,h=r.content,v=r.shortcode;return u!==c._v$&&R(s,"src",c._v$=u),h!==c._v$2&&R(s,"alt",c._v$2=h),v!==c._v$3&&R(s,"title",c._v$3=v),c},{_v$:void 0,_v$2:void 0,_v$3:void 0}),s})():(console.error("Not all ParsedTextNoteNodes are covered",r),null)}})};M(["click"]);const Ie=2,Rr=200,Cr=()=>{let e;const[t,n]=x(!1),l=i=>{e=i},a=_t(()=>{e!=null&&n(e.scrollHeight>e.clientHeight+Ie||e.scrollHeight>document.documentElement.clientHeight+Ie)},Rr);return X(()=>{if(e!=null){a();const i=new IntersectionObserver(s=>{s.forEach(c=>{c.isIntersecting&&a()})},{threshold:[0,.25,.5,.75,1]});i.observe(e);const r=()=>a();window.addEventListener("resize",r),q(()=>{i.disconnect(),window.removeEventListener("resize",r)})}}),{overflow:t,elementRef:l}},Tr=g('<div class="author-name truncate pr-1 font-bold hover:underline">'),Sr=g('<button class="mt-2 w-full rounded border border-border p-2 text-center text-xs text-fg-secondary shadow-sm hover:bg-bg-tertiary hover:shadow">'),Mr=g('<div class="post flex flex-col"><div class="flex w-full gap-1"><button type=button class="author-icon size-10 shrink-0 overflow-hidden rounded"></button><div class="min-w-0 flex-auto"><div class="flex justify-between gap-1 text-xs"><button type=button class="author flex min-w-0 select-text truncate hover:text-link"><span class="author flex min-w-0 truncate hover:text-link"><div class="author-username truncate text-fg-secondary"></div></span></button><div class="created-at shrink-0"><button type=button class="select-text hover:underline"></button></div></div><div class=overflow-hidden></div><div class=actions>'),Ir=g('<img alt=icon referrerpolicy=no-referrer class="size-full object-cover">'),Pr=e=>{const t=I(),{overflow:n,elementRef:l}=Cr(),a=Ne(),[i,r]=x(!1),s=()=>a(e.createdAt),c=()=>e.createdAt.toLocaleString(),{profile:u}=qe(()=>({pubkey:e.authorPubkey}));return(()=>{const h=Mr(),v=h.firstChild,b=v.firstChild,m=b.nextSibling,$=m.firstChild,f=$.firstChild,y=f.firstChild,_=y.firstChild,C=f.nextSibling,D=C.firstChild,U=$.nextSibling,G=U.nextSibling;return b.$$click=k=>{k.preventDefault(),e.onShowProfile?.()},d(b,o(w,{get when(){return u()?.picture},keyed:!0,children:k=>o(j,{children:()=>(()=>{const P=Ir();return T(()=>R(P,"src",Oe(k,"icon"))),P})()})})),f.$$click=k=>{k.preventDefault(),e?.onShowProfile?.()},d(y,o(w,{get when(){return(u()?.display_name?.length??0)>0},get children(){const k=Tr();return d(k,()=>u()?.display_name),k}}),_),d(_,o(w,{get when(){return u()?.name!=null},get fallback(){return`@${He(e.authorPubkey)}`},get children(){return["@",p(()=>u()?.name)]}})),D.$$click=k=>{k.preventDefault(),e.onShowEvent?.()},d(D,s),A(l,U),d(U,()=>e.content),d(m,o(w,{get when(){return n()},get children(){const k=Sr();return k.$$click=P=>{P.stopPropagation(),r(F=>!F)},d(k,o(w,{get when(){return!i()},get fallback(){return t.t("post.hideOverflow")},get children(){return t.t("post.showOverflow")}})),k}}),G),d(G,()=>e.actions),d(h,o(w,{get when(){return e.footer},get children(){return e.footer}}),null),T(k=>{const P=c(),F=!i(),me=!!i();return P!==k._v$&&R(D,"title",k._v$=P),F!==k._v$2&&U.classList.toggle("max-h-screen",k._v$2=F),me!==k._v$3&&U.classList.toggle("max-h-none",k._v$3=me),k},{_v$:void 0,_v$2:void 0,_v$3:void 0}),h})()};M(["click"]);const Lr=ht(),Dr=()=>dt(Lr),eo=()=>{const[e,t]=gt({});return{timelineState:e,setTimeline:n=>t("content",n),clearTimeline:()=>t("content",void 0)}},jr=g("<div class=nostr-textnote>"),Ar=g("<div class=text-xs>"),Ur=g('<div class="content whitespace-pre-wrap break-words">'),Fr=g("<div class=textnote-content>"),qr=g('<div class="mt-1 rounded border border-border p-1">'),Hr=g("<div class=h-12>"),Or=g('<button class="select-text pr-1 text-link hover:underline">'),Br=g("<div class=h-5>"),Kr=e=>{let t;const n=I(),{showProfile:l}=he(),a=Dr(),[i,r]=x(!1),s=()=>r(!1),c=()=>{r(m=>!m),i()&&t!=null&&t.focus()},u=p(()=>ft(e.event)),h=()=>e.embedding??!0,v=()=>e.actions??!0,b=()=>{if(h()){const m=u().replyingToEvent();if(m!=null&&!u().containsEventMention(m.id))return m.id;const $=u().rootEvent();if(m==null&&$!=null&&!u().containsEventMention($.id))return $.id}};return(()=>{const m=jr();return d(m,o(Pr,{get authorPubkey(){return u().pubkey},get createdAt(){return u().createdAtAsDate()},get content(){return(()=>{const $=Fr();return d($,o(w,{get when(){return b()},keyed:!0,children:f=>(()=>{const y=qr();return d(y,o(j,{get fallback(){return Hr()},children:()=>o(W,{eventId:f,actions:!1,embedding:!1})})),y})()}),null),d($,o(w,{get when(){return u().taggedPubkeys().length>0},get children(){const f=Ar();return d(f,()=>n.t("post.replyToPre"),null),d(f,o(N,{get each(){return u().taggedPubkeys()},children:y=>(()=>{const _=Or();return _.$$click=C=>{C.stopPropagation(),l(y)},d(_,o(nt,{pubkey:y})),_})()}),null),d(f,()=>n.t("post.replyToPost"),null),f}}),null),d($,o(Wn,{get contentWarning(){return u().contentWarning()},get children(){const f=Ur();return d(f,o(Er,{get parsed(){return u().parsed()},get embedding(){return h()},get initialHidden(){return u().contentWarning().contentWarning}})),f}}),null),$})()},get actions(){return o(w,{get when(){return v()},get children(){return o(j,{get fallback(){return Br()},children:()=>o(qn,{get event(){return e.event},onClickReply:c})})}})},get footer(){return o(w,{get when(){return i()},get children(){return o(pt,{textAreaRef:$=>{t=$},mode:"reply",get replyTo(){return e.event},onClose:s,onPost:s})}})},onShowProfile:()=>{l(u().pubkey)},onShowEvent:()=>{a?.setTimeline({type:"Replies",event:e.event})}})),m})()};M(["click"]);const Pe=g("<div><span>"),ot=e=>{const t=I(),n=()=>e.ensureKinds==null||e.ensureKinds.length===0||e.ensureKinds.includes(e.event.kind);return o(O,{get fallback(){return(()=>{const l=Pe(),a=l.firstChild;return d(a,()=>t.t("post.unsupportedKind",{kind:e.event.kind})),d(l,o(K,{get eventId(){return e.event.id},get kind(){return e.event.kind}}),null),l})()},get children(){return[o(E,{get when(){return!n()},keyed:!0,get children(){const l=Pe(),a=l.firstChild;return d(a,()=>t.t("post.unexpectedKind",{kind:e.event.kind})),d(l,o(K,{get eventId(){return e.event.id},get kind(){return e.event.kind}}),null),l}}),o(E,{get when(){return e.event.kind===de},get children(){return o(Kr,{get event(){return e.event},get embedding(){return e.actions},get actions(){return e.actions}})}}),o(E,{get when(){return e.event.kind===vt},get children(){return o(Yt,{get event(){return e.event}})}})]}})},to=e=>{const{shouldMuteEvent:t}=S();return o(N,{get each(){return e.events},children:n=>o(w,{get when(){return!t(n)},get children(){return o(ie,{get children(){return o(ot,{event:n})}})}})})};let Y=0;const{setActiveSubscriptions:Wr}=xt();setInterval(()=>{Wr(Y)},1e3);const zr=({eose:e,limit:t,eoseLimit:n})=>{const[a,i]=x([]),r=[];let s;const c=()=>{i(m=>{const $=[...m];return r.forEach(f=>{be($,f)}),$.slice(0,n())}),r.splice(0,r.length)},u=()=>{s==null&&(s=setTimeout(()=>{s=void 0,c()},100))},h=()=>{s!=null&&clearTimeout(s)},v=m=>{const $=m.created_at-le();if(!($>300)){if($>0){setTimeout(()=>v(m),$*1e3);return}e()?i(f=>{const y=[...f];return be(y,m),y.slice(0,t())}):(r.push(m),u())}},b=()=>{i([]),h()};return B(()=>{e()&&c()}),q(()=>{h()}),{events:a,setEvents:i,addEvent:v,clearEvents:b}},no=e=>{const{config:t,shouldMuteEvent:n}=S(),l=Et(),[a,i]=x(!1),r=p(e),s=()=>e()?.eoseLimit??25,c=()=>e()?.limit??50,{events:u,addEvent:h,clearEvents:v,setEvents:b}=zr({eose:a,eoseLimit:s,limit:c});B($e(()=>[t().mutedPubkeys,t().mutedKeywords],()=>{b($=>$.filter(f=>!n(f)))},{defer:!0})),X(()=>{console.debug("subscription mounted",e()?.debugId,e()),q(()=>{console.debug("subscription unmount",e()?.debugId,e())})});const m=()=>{console.debug("startSubscription: start");const $=r();if($==null)return;const{relayUrls:f,filters:y,options:_,onEvent:C,onEOSE:D,clientEventFilter:U,continuous:G=!0}=$;let k=!0;Y+=1,v(),i(!1);const P=l().subscribeMany(f,y,_??{maxWait:12e3,onevent:F=>{C?.(F),!(U!=null&&!U(F))&&h(F)},oneose:()=>{a()||(D?.(),i(!0),G||(P.close(),k&&(k=!1,Y-=1)))}});q(()=>{console.debug("startSubscription: end"),P.close(),k&&(k=!1,Y-=1)})};return B($e(()=>[r()],()=>m())),{events:u,eose:a}},Nr=g("<div class=none>"),Qr=g('<button class="flex h-12 w-full flex-col items-center justify-center hover:text-fg-secondary"><span>'),Vr=g('<button class="flex h-12 w-full flex-col items-center justify-center hover:text-fg-secondary disabled:text-fg-secondary/30"><span>'),ro=e=>{const t=p(e),n=$=>{const{duration:f}=t();if(f!=null)return $-f},[l,a]=x([]),[i,r]=x(n(le())),[s,c]=x(),[u,h]=x();return{setEvents:a,since:i,until:s,continuous:()=>s()==null,loadLatest:()=>{ye(()=>{c(void 0),r(n(le()))}),u()?.scrollIntoView()},loadOld:()=>{const $=Rt(l());$!=null&&(ye(()=>{c($.created_at),r(n($.created_at))}),u()?.scrollIntoView())},setTopMarkerRef:h}},oo=e=>{const t=I();return[o(w,{get when(){return!e.loadMore.continuous()},get children(){return[(()=>{const n=Nr(),l=e.loadMore.setTopMarkerRef;return typeof l=="function"?A(l,n):e.loadMore.setTopMarkerRef=n,n})(),o(ie,{get children(){const n=Qr(),l=n.firstChild;return n.$$click=()=>e.loadMore.loadLatest(),d(l,()=>t.t("column.loadLatest")),n}})]}}),p(()=>e.children),o(ie,{get children(){const n=Vr(),l=n.firstChild;return n.$$click=()=>e.loadMore.loadOld(),d(l,()=>t.t("column.loadOld")),T(()=>n.disabled=!e.eose),n}})]};M(["click"]);const st=e=>{const t=()=>{const l=e();if(l==null)return[];const a=[];return je(l).pTags().forEach(r=>{const[,s,c,u]=r,h={pubkey:s,petname:u};c!=null&&c.length>0&&(h.mainRelayUrl=c),a.push(h)}),a};return{followings:t,followingPubkeys:()=>t().map(l=>l.pubkey),data:e}},so=async({pubkey:e},t)=>{const n=new V({type:"Followings",pubkey:e});Ae({task:n,signal:t});const l=await n.latestEventPromise();return st(()=>l)},lo=e=>{const t=Q(),n=p(e),l=()=>["useFollowings",n()],a=z(()=>({queryKey:l(),queryFn:Ct({taskProvider:([,r])=>{if(r==null)return null;const{pubkey:s}=r;return new V({type:"Followings",pubkey:s})},queryClient:t}),staleTime:5*60*1e3,gcTime:3*24*60*60*1e3,refetchOnMount:!0,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchInterval:0})),i=()=>t.invalidateQueries({queryKey:l()});return{...st(()=>a.data),invalidateFollowings:i,query:a}};export{Ke as A,Jt as B,gn as C,W as E,Qe as H,oo as L,Yt as R,to as T,eo as a,Lr as b,ie as c,lo as d,ro as e,Ne as f,Ft as g,dn as h,fe as i,ot as j,Kr as k,Ve as l,nn as m,Er as n,so as o,Xe as p,no as u};
//# sourceMappingURL=useFollowings-1tR13u4n.js.map
