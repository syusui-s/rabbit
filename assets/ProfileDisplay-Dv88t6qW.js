import{s as z,t as i,j as Y,v as k,W as ye,k as be,z as ve,u as $e,c as L,a8 as ke,r as _e,a as n,h as m,f as I,i as r,S as T,M as w,b as K,n as xe,d as Ce,a9 as Pe,ar as Me,w as Fe,ap as Se,am as Ee}from"./index-C8n46-1m.js";import{u as Z,d as J,k as Le,e as Te,l as Ue,m as qe,L as ze,T as Ne,n as je}from"./useFollowings-DkGe0QsP.js";import{a as Be,b as Ae,d as Qe,G as Re,f as De,n as He,e as O,t as Ve,m as Ge}from"./SideBar-BjEArcB_.js";import{B as Ie}from"./BasicModal-CSzWDb3X.js";import Ke from"./EventDebugModal-e8K-getm.js";import Je from"./UserList-g2nlj_Cx.js";import{S as Oe}from"./SafeLink-CFyBNCN7.js";import"./LazyLoad-CcKjS09w.js";import"./url-BOMIwtgZ.js";import"./resolveAsset-D7QEbXjP.js";import"./Copy-DQJ3aSVk.js";const We=i('<svg xmlns=http://www.w3.org/2000/svg fill=none stroke=currentColor stroke-width=1.5 aria-hidden=true data-slot=icon viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99">'),Xe=(l={})=>(()=>{const t=We();return z(t,l,!0),t})(),Ye=i('<svg xmlns=http://www.w3.org/2000/svg fill=currentColor aria-hidden=true data-slot=icon viewBox="0 0 24 24"><path fill-rule=evenodd d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12m13.36-1.814a.75.75 0 1 0-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 0 0-1.06 1.06l2.25 2.25a.75.75 0 0 0 1.14-.094z"clip-rule=evenodd>'),Ze=(l={})=>(()=>{const t=Ye();return z(t,l,!0),t})(),et=i('<svg xmlns=http://www.w3.org/2000/svg fill=currentColor aria-hidden=true data-slot=icon viewBox="0 0 24 24"><path fill-rule=evenodd d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12M12 8.25a.75.75 0 0 1 .75.75v3.75a.75.75 0 0 1-1.5 0V9a.75.75 0 0 1 .75-.75m0 8.25a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5"clip-rule=evenodd>'),tt=(l={})=>(()=>{const t=et();return z(t,l,!0),t})();var ee=/^(?:([\w.+-]+)@)?([\w_-]+(\.[\w_-]+)+)$/,te;try{te=fetch}catch{}async function nt(l){const t=l.match(ee);if(!t)return null;const[g,h="_",v]=t;try{const $=`https://${v}/.well-known/nostr.json?name=${h}`,y=await(await te($,{redirect:"error"})).json();let b=y.names[h];return b?{pubkey:b,relays:y.relays?.[b]}:null}catch{return null}}const lt=l=>{if(l==null||l.length===0)return null;const t=l.match(ee);if(t==null)return null;const[,g,h]=t;return g==null||g==="_"?{user:"_",domain:h,ident:h}:{user:g,domain:h,ident:l}};function rt(l){const{config:t}=Y(),g=k(l),{events:h}=Z(()=>({relayUrls:t().relayUrls,filters:[{kinds:[ye],"#p":[g().pubkey]}],limit:1e6,eoseLimit:1e6,continuous:!1})),v=()=>be(h()?.map(y=>y.pubkey));return{followersPubkeys:v,count:()=>v().length}}const ot=l=>{const t=k(l),g=()=>["useVerification",t()],h=ve(()=>({queryKey:g(),queryFn:({queryKey:$})=>{const[,y]=$;if(y==null)return Promise.resolve(null);const{nip05:b}=y;return nt(b)},staleTime:30*60*1e3,gcTime:24*60*60*1e3}));return{verification:()=>h?.data??null,query:h}},st=i('<button class="rounded-full border border-primary px-4 py-2 text-center font-bold text-primary hover:bg-primary hover:text-primary-fg sm:w-20">'),W=i('<span class="rounded-full border border-primary px-4 py-2 text-primary sm:text-base">'),it=i('<button class="rounded-full border border-primary bg-primary px-4 py-2 text-center font-bold text-primary-fg hover:bg-primary-hover sm:w-36">'),at=i('<button class="w-28 rounded-full border border-primary px-4 py-2 text-primary hover:border-primary-hover hover:text-primary-hover">'),X=i('<div class="shrink-0 text-xs">'),ct=i('<div class="flex shrink-0 flex-col items-center gap-1"><div class="flex flex-row justify-start gap-1"><button type=button class="w-10 rounded-full border border-primary p-2 text-primary hover:border-primary-hover hover:text-primary-hover">'),ut=i('<div class="mt-[-54px] flex items-end gap-4 px-4 pt-4"><div class="flex-1 shrink-0"><div class="size-28 overflow-hidden rounded-lg shadow-md">'),dt=i('<div class="truncate text-xl font-bold">'),ft=i('<div class="truncate text-xs">@'),pt=i('<span class="inline-block size-3">'),mt=i('<span class="inline-block size-4 text-link">'),ht=i('<div class="flex items-center text-xs">'),gt=i('<div class="flex items-start px-4 pt-2"><div class="h-16 shrink overflow-hidden"><div class="flex items-center gap-2"></div><div class="flex gap-1"><div class="truncate text-xs">'),wt=i('<div class="flex flex-1 flex-col items-start"><div class=text-sm></div><div class=text-xl>'),yt=i('<div class="flex border-t border-border px-4 py-2"><button class="flex flex-1 flex-col items-start"><div class=text-sm></div><div class=text-xl>'),bt=i('<ul class="border-t border-border px-5 py-2 text-xs">'),vt=i('<ul class="border-t border-border p-1">'),$t=i('<div class="h-12 shrink-0">'),kt=i('<div class="h-40 w-full shrink-0 sm:h-52"><img alt=header class="size-full object-cover">'),_t=i('<img alt="user icon"class="size-full object-cover">'),xt=i('<span class="inline-block size-4 text-danger">'),Ct=i('<div class="max-h-40 shrink-0 overflow-y-auto whitespace-pre-wrap px-4 py-2 text-sm">'),Pt=i("<span class=text-sm>"),Mt=i('<button class="text-sm hover:text-fg-secondary">'),Ft=i('<li class="flex items-center gap-1"><span class="inline-block size-4"area-label=website title=website>'),St=l=>{const{count:t}=rt(()=>({pubkey:l.pubkey}));return k(t)},Rt=l=>{const t=$e(),{config:g,addMutedPubkey:h,removeMutedPubkey:v,isPubkeyMuted:$,saveColumn:y}=Y(),b=Be(),ne=Ge(),_=Ae(),{showProfileEdit:le}=De(),x=k(()=>He(l.pubkey)),[re,N]=L(!1),[oe,j]=L(!1),[se,ie]=L(!1),[B,U]=L(null),A=()=>U(null),{profile:f,event:ae,query:C}=Qe(()=>({pubkey:l.pubkey})),{verification:ce,query:ue}=ot(()=>O([f()?.nip05])(([e])=>({nip05:e}))),de=()=>lt(f()?.nip05),fe=()=>ce()?.pubkey===l.pubkey,Q=()=>$(l.pubkey),pe=k(()=>{const e=ae(),o=f()?.about;if(e==null||o==null)return;const a=Pe(o);return Me(a,Fe(e))}),{followingPubkeys:me,invalidateFollowings:he,query:P}=J(()=>O([_()])(([e])=>({pubkey:e}))),M=()=>me().includes(l.pubkey),{followingPubkeys:q,query:R}=J(()=>({pubkey:l.pubkey})),ge=()=>{const e=_();return e!=null&&q().includes(e)},F=ke(()=>({mutationKey:["updateContacts"],mutationFn:(...e)=>ne.updateContacts(...e).then(o=>Promise.allSettled(o.map(Ve(5e3)))),onSuccess:e=>{const o=e.filter(u=>u.status==="fulfilled").length,a=e.length-o;o===e.length?console.log("succeeded to update contacts"):o>0?console.log(`succeeded to update contacts for ${o} relays but failed for ${a} relays`):console.error("failed to update contacts")},onError:e=>{console.error("failed to update contacts: ",e)},onSettled:()=>{he().then(()=>P.refetch()).catch(e=>console.error("failed to refetch contacts",e))}})),D=async(e,o)=>{try{const a=_();if(a==null)return;N(!0);const u=await je({pubkey:a});if((u.data()==null||u.followingPubkeys().length===0)&&!window.confirm(t.t("profile.confirmUpdateEvenIfEmpty")))return;if((u?.data()?.created_at??0)<(P.data?.created_at??0)){window.alert(t.t("profile.failedToFetchLatestFollowList"));return}const d=u.data()?.tags??[];let c;switch(e){case"follow":c=[...d,["p",o]];break;case"unfollow":c=d.filter(([p,s])=>!(p==="p"&&s===o));break;default:console.error("updateContacts: invalid operation",e);return}await F.mutateAsync({relayUrls:g().relayUrls,pubkey:a,updatedTags:c,content:u.data()?.content??""})}catch(a){console.error("failed to update contact list",a),window.alert(t.t("profile.failedToUpdateFollowList"))}finally{N(!1)}},H=()=>{D("follow",l.pubkey).catch(e=>{console.log("failed to follow",e)})},V=()=>{window.confirm(t.t("profile.confirmUnfollow"))&&D("unfollow",l.pubkey).catch(e=>{console.log("failed to unfollow",e)})},S=Le(()=>({menu:[{content:t.t("profile.copyPubkey"),onSelect:()=>{navigator.clipboard.writeText(x()).catch(e=>window.alert(e))}},{content:t.t("profile.showJSON"),onSelect:()=>{U("EventDebugModal")}},{content:t.t("profile.addColumn"),items:[{content:t.t("profile.addUserColumn"),onSelect:()=>{const e=f()?.name??x();y(Se({name:e,pubkey:l.pubkey})),b({command:"moveToLastColumn"}).catch(o=>console.error(o)),l.onClose?.()}},{content:t.t("profile.addUserHomeColumn"),onSelect:()=>{const e=`${t.t("column.home")} / ${f()?.name??x()}`;y(Ee({name:e,pubkey:l.pubkey})),b({command:"moveToLastColumn"}).catch(o=>console.error(o)),l.onClose?.()}}]},{content:Q()?t.t("profile.unmute"):t.t("profile.mute"),onSelect:()=>{Q()?v(l.pubkey):h(l.pubkey)}},{when:()=>l.pubkey===_(),content:M()?t.t("profile.unfollowMyself"):t.t("profile.followMyself"),onSelect:()=>{M()?V():H()}}]})),E=Te(()=>({duration:null})),{events:G,eose:we}=Z(()=>({relayUrls:g().relayUrls,filters:[{kinds:[1,6],authors:[l.pubkey],limit:10,since:E.since(),until:E.until()}],eoseLimit:10,continuous:!1}));return _e(()=>E.setEvents(G())),n(Ie,{onClose:()=>l.onClose?.(),get children(){return[n(m,{get when(){return k(()=>!!C.isFetched)()&&f()?.banner},get fallback(){return $t()},keyed:!0,children:e=>(()=>{const o=kt(),a=o.firstChild;return I(a,"src",e),o})()}),(()=>{const e=ut(),o=e.firstChild,a=o.firstChild;return r(a,n(m,{get when(){return k(()=>!!C.isFetched)()&&f()?.picture},keyed:!0,children:u=>(()=>{const d=_t();return I(d,"src",u),d})()})),r(e,n(m,{get when(){return _()!=null},get children(){const u=ct(),d=u.firstChild,c=d.firstChild;r(d,n(T,{get children(){return[n(w,{get when(){return l.pubkey===_()},get children(){const s=st();return s.$$click=()=>le(),r(s,()=>t.t("profile.editProfile")),s}}),n(w,{get when(){return F.isPending||re()},get children(){const s=W();return r(s,()=>t.t("general.updating")),s}}),n(w,{get when(){return P.isPending||P.isFetching},get children(){const s=W();return r(s,()=>t.t("general.loading")),s}}),n(w,{get when(){return M()},get children(){const s=it();return s.$$click=()=>V(),s.addEventListener("mouseleave",()=>j(!1)),s.addEventListener("mouseenter",()=>j(!0)),r(s,n(m,{get when(){return!oe()},get fallback(){return t.t("profile.unfollow")},get children(){return t.t("profile.followingCurrently")}})),K(()=>s.disabled=F.isPending),s}}),n(w,{get when(){return!M()},get children(){const s=at();return s.$$click=()=>H(),r(s,()=>t.t("profile.follow")),K(()=>s.disabled=F.isPending),s}})]}}),c),c.$$click=()=>S.open();const p=S.targetRef;return typeof p=="function"?xe(p,c):S.targetRef=c,r(c,n(Ue,{})),r(d,()=>S.popup(),null),r(u,n(T,{get children(){return[n(w,{get when(){return R.isPending},get children(){const s=X();return r(s,()=>t.t("general.loading")),s}}),n(w,{get when(){return ge()},get children(){const s=X();return r(s,()=>t.t("profile.followsYou")),s}})]}}),null),u}}),null),e})(),(()=>{const e=gt(),o=e.firstChild,a=o.firstChild,u=a.nextSibling,d=u.firstChild;return r(o,n(m,{get when(){return C.isPending},get children(){return t.t("general.loading")}}),a),r(o,n(m,{get when(){return(f()?.display_name?.length??0)>0},get children(){const c=dt();return r(c,()=>f()?.display_name),c}}),a),r(a,n(m,{get when(){return(f()?.name?.length??0)>0},get children(){const c=ft();return c.firstChild,r(c,()=>f()?.name,null),c}}),null),r(a,n(m,{get when(){return(f()?.nip05?.length??0)>0},get children(){const c=ht();return r(c,()=>de()?.ident,null),r(c,n(T,{get fallback(){return(()=>{const p=xt();return r(p,n(tt,{})),p})()},get children(){return[n(w,{get when(){return ue.isPending},get children(){const p=pt();return r(p,n(Xe,{})),p}}),n(w,{get when(){return fe()},get children(){const p=mt();return r(p,n(Ze,{})),p}})]}}),null),c}}),null),r(d,x),e})(),n(m,{get when(){return pe()},keyed:!0,children:e=>(()=>{const o=Ct();return r(o,n(qe,{parsed:e,embedding:!1,initialHidden:!0})),o})()}),(()=>{const e=yt(),o=e.firstChild,a=o.firstChild,u=a.nextSibling;return o.$$click=()=>U("Following"),r(a,()=>t.t("profile.following")),r(u,n(m,{get when(){return R.isFetched},get fallback(){return(()=>{const d=Pt();return r(d,()=>t.t("general.loading")),d})()},get children(){return q().length}})),r(e,n(m,{get when(){return!g().hideCount},get children(){const d=wt(),c=d.firstChild,p=c.nextSibling;return r(c,()=>t.t("profile.followers")),r(p,n(m,{get when(){return se()},get fallback(){return(()=>{const s=Mt();return s.$$click=()=>ie(!0),r(s,()=>t.t("profile.loadFollowers")),s})()},keyed:!0,get children(){return n(St,{get pubkey(){return l.pubkey}})}})),d}}),null),e})(),n(m,{get when(){return(f()?.website??"").length>0},get children(){const e=bt();return r(e,n(m,{get when(){return f()?.website},keyed:!0,children:o=>(()=>{const a=Ft(),u=a.firstChild;return r(u,n(Re,{})),r(a,n(Oe,{class:"text-link underline",href:o}),null),a})()})),e}}),n(T,{get children(){return[n(w,{get when(){return B()==="Following"},get children(){return n(Je,{get data(){return q()},pubkeyExtractor:e=>e,onClose:A})}}),n(w,{get when(){return B()==="EventDebugModal"&&C.data},keyed:!0,children:e=>n(Ke,{event:e,get extra(){return JSON.stringify(f(),null,2)},onClose:A})})]}}),(()=>{const e=vt();return r(e,n(ze,{loadMore:E,get eose(){return we()},get children(){return n(Ne,{get events(){return G()}})}})),e})()]}})};Ce(["click"]);export{Rt as default};
//# sourceMappingURL=ProfileDisplay-Dv88t6qW.js.map
