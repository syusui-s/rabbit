import{i as d,t as g,s as ee,a as o,S as _,at as Ee,au as tt,p as k,w as B,g as D,av as nt,u as S,M as E,aw as rt,b as K,c as C,o as G,z as Z,n as Ce,d as P,q as Se,l as R,F as N,v as z,A as J,aa as ie,ag as Ie,ah as Te,h as q,j as T,k as X,am as L,r as ce,ai as ot,ax as st,y as Me,ay as lt,az as it,Y as ct,f as at,I as ut,aA as ge}from"./index-0812911d.js";import{r as Pe,t as te,B as Q,f as ne,U as dt,g as ae,k as ht,l as De,j as ue,b as re,m as gt,P as ft,E as vt,d as Le,n as Ue,a as mt,h as $t,N as yt,o as bt,i as wt,e as _t,q as pt,s as kt,v as xt,w as Rt}from"./SideBar-e7f532c2.js";import{H as Et}from"./globe-alt-10a73e09.js";import{L as U}from"./LazyLoad-ff3bf7fe.js";const Ct=g('<div class="block shrink-0 overflow-hidden border-b border-border p-1">'),St=e=>(()=>{const t=Ct();return d(t,()=>e.children),t})(),It=g('<svg xmlns=http://www.w3.org/2000/svg fill=none stroke=currentColor stroke-width=1.5 aria-hidden=true data-slot=icon viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round d="M19.5 12c0-1.232-.046-2.453-.138-3.662a4.006 4.006 0 0 0-3.7-3.7 48.678 48.678 0 0 0-7.324 0 4.006 4.006 0 0 0-3.7 3.7c-.017.22-.032.441-.046.662M19.5 12l3-3m-3 3-3-3m-12 3c0 1.232.046 2.453.138 3.662a4.006 4.006 0 0 0 3.7 3.7 48.656 48.656 0 0 0 7.324 0 4.006 4.006 0 0 0 3.7-3.7c.017-.22.032-.441.046-.662M4.5 12l3 3m-3-3-3 3">'),Fe=(e={})=>(()=>{const t=It();return ee(t,e,!0,!0),t})(),Tt=g('<button class="text-link underline">'),Mt=e=>{try{return Ee(e)}catch(t){return console.error("failed to encode event id into Bech32 entity (NIP-19) but ignore",e,t),e}},Pt=e=>{try{return tt({id:e})}catch(t){return console.error("failed to encode event id into Bech32 entity (NIP-19) but ignore",e,t),e}},O=e=>(()=>{const t=Tt();return d(t,o(_,{get when(){return e.kind==null||e.kind===1},get fallback(){return Pt(e.eventId)},get children(){return Mt(e.eventId)}})),t})(),Dt=e=>{const t=k(e),n=B(()=>({queryKey:["useEvent",t()],queryFn:({queryKey:a,signal:s})=>{const[,r]=a;if(r==null)return null;const{eventId:l}=r,c=new Q({type:"Event",eventId:l}),u=c.firstEventPromise().catch(()=>{throw new Error(`event not found: ${l}`)});return Pe({task:c,signal:s}),te(15e3,`useEvent: ${l}`)(u)},staleTime:4*60*60*1e3,gcTime:4*60*60*1e3,refetchOnWindowFocus:!1,refetchOnMount:!1}));return{event:()=>n.data??null,query:n}},Lt=g("<span>"),Ut=g("<div class=truncate> "),W=e=>{const t=D(),[n,i]=nt(e,["eventId"]),{shouldMuteEvent:a}=S(),{event:s,query:r}=Dt(()=>ne([n.eventId])(([c])=>({eventId:c}))),l=()=>{const c=s();return c!=null&&a(c)};return o(K,{get fallback(){return(()=>{const c=Lt();return d(c,()=>t()("post.failedToFetchEvent"),null),d(c,()=>e.eventId,null),c})()},get children(){return[o(E,{get when(){return l()},children:null}),o(E,{get when(){return s()},keyed:!0,children:c=>o(Xe,rt({event:c},i))}),o(E,{get when(){return r.isLoading&&n.eventId},keyed:!0,children:c=>(()=>{const u=Ut(),h=u.firstChild;return d(u,()=>t()("general.loading"),h),d(u,o(O,{eventId:c}),null),u})()})]}})},je=e=>{const[t,n]=C(new Date);return G(()=>{const i=setInterval(()=>{n(new Date)},e().interval);Z(()=>clearInterval(i))}),t},Ft=e=>{switch(e.kind){case"now":return"now";case"seconds":return`${e.value}s`;case"minutes":return`${e.value}m`;case"hours":return`${e.value}h`;case"days":return`${e.value}d`;case"abs":default:return e.value.toLocaleDateString()}},fe=e=>`${e.getHours()}:${e.getMinutes().toString().padStart(2,"0")}`,jt=e=>{switch(e.kind){case"today":return e.value.toLocaleTimeString();case"yesterday":case"abs":default:return e.value.toLocaleString()}},At=e=>{switch(e.kind){case"today":return fe(e.value);case"yesterday":return`昨日 ${fe(e.value)}`;case"abs":default:return e.value.toLocaleString()}},qt=(e,t)=>Math.round(Number(t)-Number(e))/1e3,Ht=(e,t)=>{const n=qt(e,t);return n<10?{kind:"now"}:n<60?{kind:"seconds",value:Math.round(n)}:n<3600?{kind:"minutes",value:Math.round(n/60)}:n<86400?{kind:"hours",value:Math.round(n/3600)}:n<604800?{kind:"days",value:Math.round(n/86400)}:{kind:"abs",value:e}},ve=(e,t)=>e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate(),Ot=e=>new Date(+e-24*60*60*1e3),Ae=(e,t,n)=>ve(e,t)?n({kind:"today",value:e}):ve(e,Ot(t))?n({kind:"yesterday",value:e}):n({kind:"abs",value:e}),Wt=(e,t=new Date)=>Ae(e,t,jt),Bt=(e,t=new Date)=>Ae(e,t,At),me=(e,t=new Date,n=Ft)=>n(Ht(e,t)),$e=Ce(()=>je(()=>({interval:7e3}))),ye=Ce(()=>je(()=>({interval:60*1e3}))),qe=()=>{const{config:e}=S();return t=>{switch(e().dateFormat){case"absolute-long":return Wt(t,ye());case"absolute-short":return Bt(t,ye());case"relative":return me(t,$e());default:return me(t,$e())}}},Kt=g('<div><div class="flex items-center gap-1"><div class="flex shrink-0 place-items-center pl-[2px]"aria-hidden=true><span class="h-4 w-4 text-r-repost"></span></div><div class="notification-user flex min-w-0 flex-1 overflow-hidden text-xs"><button class="select-text truncate hover:text-link hover:underline"></button><span class=shrink-0></span></div><div class=text-xs></div></div><div class=pt-1>'),Nt=e=>{const t=D(),{showProfile:n}=ae(),i=qe(),a=k(()=>Se(e.event)),s=()=>a().lastTaggedEventId();return(()=>{const r=Kt(),l=r.firstChild,c=l.firstChild,u=c.firstChild,h=c.nextSibling,m=h.firstChild,b=m.nextSibling,v=h.nextSibling,y=l.nextSibling;return d(u,o(Fe,{})),m.$$click=()=>n(e.event.pubkey),d(m,o(dt,{get pubkey(){return e.event.pubkey}})),d(b,()=>t()("notification.reposted")),d(v,()=>i(a().createdAtAsDate())),d(y,o(W,{get eventId(){return s()}})),r})()};P(["click"]);const zt=g('<svg xmlns=http://www.w3.org/2000/svg fill=none stroke=currentColor stroke-width=1.5 aria-hidden=true data-slot=icon viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round d="M2.25 12.76c0 1.6 1.123 2.994 2.707 3.227 1.087.16 2.185.283 3.293.369V21l4.076-4.076a1.526 1.526 0 0 1 1.037-.443 48.282 48.282 0 0 0 5.68-.494c1.584-.233 2.707-1.626 2.707-3.228V6.741c0-1.602-1.123-2.995-2.707-3.228A48.394 48.394 0 0 0 12 3c-2.392 0-4.744.175-7.043.513C3.373 3.746 2.25 5.14 2.25 6.741z">'),Qt=(e={})=>(()=>{const t=zt();return ee(t,e,!0,!0),t})(),Vt=g('<svg xmlns=http://www.w3.org/2000/svg fill=none stroke=currentColor stroke-width=1.5 aria-hidden=true data-slot=icon viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round d="M6.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0m6 0a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0m6 0a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0">'),Yt=(e={})=>(()=>{const t=Vt();return ee(t,e,!0,!0),t})(),Gt=g('<svg xmlns=http://www.w3.org/2000/svg fill=currentColor aria-hidden=true data-slot=icon viewBox="0 0 24 24"><path d="m11.645 20.91-.007-.003-.022-.012a15.247 15.247 0 0 1-.383-.218 25.18 25.18 0 0 1-4.244-3.17C4.688 15.36 2.25 12.174 2.25 8.25 2.25 5.322 4.714 3 7.688 3A5.5 5.5 0 0 1 12 5.052 5.5 5.5 0 0 1 16.313 3c2.973 0 5.437 2.322 5.437 5.25 0 3.925-2.438 7.111-4.739 9.256a25.175 25.175 0 0 1-4.244 3.17 15.247 15.247 0 0 1-.383.219l-.022.012-.007.004-.003.001a.752.752 0 0 1-.704 0l-.003-.001Z">'),He=(e={})=>(()=>{const t=Gt();return ee(t,e,!0,!0),t})(),Zt=g('<span class="inline-block h-4 w-4 pt-[1px] text-r-reaction">'),be=g("<span class=truncate>"),Jt=g('<img class="h-4 max-w-[3rem]">'),Xt=e=>e.type==="LikeDislike"&&e.content==="+",Oe=e=>o(K,{get fallback(){return(()=>{const t=be();return d(t,()=>e.reactionTypes.content),t})()},get children(){return[o(E,{get when(){return Xt(e.reactionTypes)},get children(){const t=Zt();return d(t,o(He,{})),t}}),o(E,{get when(){return e.reactionTypes.type==="Emoji"&&e.reactionTypes},keyed:!0,children:({content:t})=>(()=>{const n=be();return d(n,t),n})()}),o(E,{get when(){return e.reactionTypes.type==="CustomEmoji"&&e.reactionTypes},keyed:!0,children:({shortcode:t,url:n})=>(()=>{const i=Jt();return R(i,"src",n),R(i,"alt",`:${t}:`),i})()})]}}),en=g('<li class="border-b border-border hover:bg-bg-tertiary"><button class="w-full px-4 py-1 text-start">'),tn=g('<ul class="min-w-[96px] rounded border border-border bg-bg shadow-md">'),nn=e=>{const t=()=>{e.item?.onSelect?.(),e.onClose()};return(()=>{const n=en(),i=n.firstChild;return i.$$click=t,d(i,()=>e.item.content),n})()},rn=e=>{const t=k(e),n=ht(()=>({...t(),popup:(()=>{const i=tn();return d(i,o(N,{get each(){return t().menu.filter(a=>a.when==null||a.when())},children:a=>o(nn,{item:a,onClose:()=>n.close()})})),i})()}));return n};P(["click"]);const on=/\p{Emoji_Presentation}/u,We=e=>["useReactions",e],de=e=>{const{shouldMuteEvent:t}=S(),n=z(),i=k(()=>We(e())),a=B(()=>({queryKey:i(),queryFn:De({taskProvider:([,u])=>{if(u==null)return null;const{eventId:h}=u;return new Q({type:"Reactions",mentionedEventId:h})},queryClient:n}),staleTime:1*60*1e3,gcTime:4*60*60*1e3,refetchInterval:1*60*1e3})),s=()=>(a.data??[]).filter(h=>!t(h));return{reactions:s,reactionsGrouped:()=>{const u=new Map;return s().forEach(h=>{const m=J(h).isCustomEmoji()?`${h.content}${J(h).getUrl()??""}`:h.content,b=u.get(m)??[];b.push(h),u.set(m,b)}),u},isReactedBy:u=>s().findIndex(h=>h.pubkey===u)!==-1,isReactedByWithEmoji:u=>s().findIndex(h=>h.pubkey===u&&on.test(h.content))!==-1,query:a}},Be=e=>{const t=z(),n=k(e),i=ue();return ie(()=>({mutationKey:["useReactionMutation",n().eventId],mutationFn:(...s)=>i.publishReaction(...s).then(r=>Promise.allSettled(r.map(te(5e3)))),onSuccess:s=>{const r=s.filter(c=>c.status==="fulfilled").length,l=s.length-r;r===s.length?console.log("Succeeded to publish a reaction"):r>0?console.warn(`failed to publish a reaction on ${l} relays`):console.error("failed to publish reaction on all relays")},onError:s=>{console.error("failed to publish reaction: ",s)},onSettled:()=>{const s=We({eventId:n().eventId});t.refetchQueries({queryKey:s}).then(()=>t.invalidateQueries({queryKey:s})).catch(r=>console.error("failed to refetch reactions",r))}}))},Ke=e=>["useReposts",e],Ne=e=>{const{shouldMuteEvent:t}=S(),n=z(),i=k(e),a=k(()=>Ke(i())),s=B(()=>({queryKey:a(),queryFn:De({taskProvider:([,c])=>{if(c==null)return null;const{eventId:u}=c;return new Q({type:"Reposts",mentionedEventId:u})},queryClient:n}),staleTime:1*60*1e3,gcTime:4*60*60*1e3,refetchInterval:1*60*1e3})),r=()=>(s.data??[]).filter(u=>!t(u));return{reposts:r,isRepostedBy:c=>r().findIndex(u=>u.pubkey===c)!==-1,query:s}},sn=e=>{const t=z(),n=k(e),i=ue();return ie(()=>({mutationKey:["useRepostMutation",n().eventId],mutationFn:(...s)=>i.publishRepost(...s).then(r=>Promise.allSettled(r.map(te(1e4)))),onSuccess:s=>{const r=s.filter(c=>c.status==="fulfilled").length,l=s.length-r;r===s.length?console.log("Succeeded to publish a repost"):r>0?console.warn(`Failed to publish a repost on ${l} relays`):console.error("Failed to publish a repost on all relays")},onError:s=>{console.error("failed to publish repost: ",s)},onSettled:()=>{const s=Ke({eventId:n().eventId});t.refetchQueries({queryKey:s}).then(()=>t.invalidateQueries({queryKey:s})).catch(r=>console.error("failed to refetch repost",r))}}))},we=["k","M","G","T","P"],ln=(e,t)=>{const n=t?.precision??3;if(n<=0)throw new Error(`precision is too small: ${n}`);const a=10**((t?.minDigits??4)-1);if(e<a)return{value:e,prefix:null};const s=10**(Math.floor(Math.log10(e)/3)*3),r=e/s;let l=Math.round(r*10**n)/10**n,c=Math.max(Math.floor(Math.log10(e)/3)-1,0);return l>=1e3&&(l/=1e3,c+=1),c>=we.length?{value:e,prefix:null}:{value:l,prefix:we[c]}},ze=(e,t)=>{const{value:n,prefix:i}=ln(e,{precision:2,minDigits:t?.minDigits??5});if(i==null)return`${e}`;const a=t?.digits??3,s=Math.floor(Math.log10(n))+1,r=Math.max(a-s,0);return`${Math.round(n*10**r)/10**r}${i}`},Qe=g('<div class="text-sm text-fg-tertiary">'),_e=g('<div class="flex shrink-0 items-center gap-1"><button class="h-4 w-4">'),cn=g('<div class="flex shrink-0 items-center gap-1"><button><span class="flex h-4 w-4">'),an=g("<div class=w-6>"),un=g('<div class="scrollbar flex gap-2 overflow-x-scroll py-1">'),dn=g('<span class="ml-1 text-sm">'),hn=g('<button class="flex h-6 max-w-[128px] items-center rounded border border-border px-1"type=button>'),gn=g("<span class=text-red-500>"),fn=g('<div class="actions flex w-52 items-center justify-between gap-8 pt-1"><button class="shrink-0 text-fg-tertiary hover:text-fg-tertiary/70"><span class="flex h-4 w-4"></span></button><button type=button class="h-4 w-4 shrink-0 text-fg-tertiary hover:text-fg-tertiary/70">'),vn=Ie(()=>Te(()=>import("./EventDebugModal-95f4cebb.js"),["assets/EventDebugModal-95f4cebb.js","assets/index-0812911d.js","assets/index-500f8a8f.css","assets/BasicModal-a9dafc07.js","assets/SideBar-e7f532c2.js","assets/usePersistStatus-8f0580a5.js"])),Ve=Ie(()=>Te(()=>import("./UserList-1711693a.js"),["assets/UserList-1711693a.js","assets/index-0812911d.js","assets/index-500f8a8f.css","assets/SideBar-e7f532c2.js","assets/usePersistStatus-8f0580a5.js","assets/BasicModal-a9dafc07.js","assets/LazyLoad-ff3bf7fe.js","assets/globe-alt-10a73e09.js"])),mn=e=>{if(e.native!=null)return{type:"Emoji",content:e.native};if(e.src!=null)return{type:"CustomEmoji",content:`:${e.id}:`,shortcode:e.id,url:e.src};throw new Error("unknown emoji")},$n=e=>{const{config:t}=S(),n=re(),[i,a]=C(!1),{reactions:s,isReactedByWithEmoji:r,isReactedBy:l}=de(()=>({eventId:e.event.id})),c=k(()=>{const f=n();return f!=null&&l(f)||i()}),u=k(()=>{const f=n();return f!=null&&r(f)}),h=Be(()=>({eventId:e.event.id})),m=f=>{c()||ne([n(),e.event.id])(([$,w])=>{h.mutate({relayUrls:t().relayUrls,pubkey:$,reactionTypes:f??{type:"LikeDislike",content:"+"},eventId:w,kind:e.event.kind,notifyPubkey:e.event.pubkey}),a(!0)})},b=f=>{f.stopPropagation(),m()},v=f=>{m(mn(f))},y=gt(()=>({onEmojiSelect:v}));return[(()=>{const f=_e(),$=f.firstChild;return $.$$click=b,d($,o(_,{get when(){return k(()=>!!c())()&&!u()},get fallback(){return o(Et,{})},get children(){return o(He,{})}})),d(f,o(_,{get when(){return k(()=>!t().hideCount&&!t().showEmojiReaction)()&&s().length>0},get children(){const w=Qe();return d(w,()=>ze(s().length,{minDigits:4})),w}}),null),T(w=>{const x={"text-fg-tertiary":!c()||u(),"hover:text-r-reaction":!c()||u(),"text-r-reaction":c()&&!u()||h.isPending},M=h.isPending;return w._v$=X(f,x,w._v$),M!==w._v$2&&($.disabled=w._v$2=M),w},{_v$:void 0,_v$2:void 0}),f})(),o(_,{get when(){return t().useEmojiReaction},get children(){const f=_e(),$=f.firstChild;$.$$click=()=>y.open();const w=y.targetRef;return typeof w=="function"?q(w,$):y.targetRef=$,d($,o(ft,{})),d(f,()=>y.popup(),null),T(x=>X(f,{"text-fg-tertiary":!c()||!u(),"hover:text-r-reaction":!c()||!u(),"text-r-reaction":c()&&u()||h.isPending},x)),f}})]},yn=e=>{const{config:t}=S(),n=re(),[i,a]=C(!1),{reposts:s,isRepostedBy:r}=Ne(()=>({eventId:e.event.id})),l=k(()=>{const h=n();return h!=null&&r(h)||i()}),c=sn(()=>({eventId:e.event.id})),u=h=>{h.stopPropagation(),!l()&&ne([n(),e.event.id])(([m,b])=>{c.mutate({relayUrls:t().relayUrls,pubkey:m,eventId:b,kind:e.event.kind,notifyPubkey:e.event.pubkey}),a(!0)})};return(()=>{const h=cn(),m=h.firstChild,b=m.firstChild;return m.$$click=u,d(b,o(Fe,{})),d(h,o(_,{get when(){return k(()=>!t().hideCount)()&&s().length>0},get children(){const v=Qe();return d(v,()=>ze(s().length,{minDigits:4})),v}}),null),T(v=>{const y={"text-fg-tertiary":!l(),"hover:text-r-repost":!l(),"text-r-repost":l()||c.isPending},f=c.isPending;return v._v$3=X(h,y,v._v$3),f!==v._v$4&&(m.disabled=v._v$4=f),v},{_v$3:void 0,_v$4:void 0}),h})()},bn=e=>{const{reactions:t}=de(()=>({eventId:e.event.id}));return o(Ve,{get data(){return t()},pubkeyExtractor:n=>n.pubkey,renderInfo:n=>(()=>{const i=an();return d(i,o(Oe,{get reactionTypes(){return J(n).toReactionTypes()}})),i})(),get onClose(){return e.onClose}})},wn=e=>{const{reposts:t}=Ne(()=>({eventId:e.event.id}));return o(Ve,{get data(){return t()},pubkeyExtractor:n=>n.pubkey,get onClose(){return e.onClose}})},_n=e=>{const{config:t}=S(),n=re(),[i,a]=C(!1),{reactions:s,reactionsGrouped:r,isReactedBy:l}=de(()=>({eventId:e.event.id})),c=Be(()=>({eventId:e.event.id})),u=()=>{const m=n();return m==null?i():i()||l(m)},h=m=>{u()||ne([n(),e.event.id])(([b,v])=>{c.mutate({relayUrls:t().relayUrls,pubkey:b,reactionTypes:m??{type:"LikeDislike",content:"+"},eventId:v,kind:e.event.kind,notifyPubkey:e.event.pubkey}),a(!0)})};return o(_,{get when(){return k(()=>!!t().showEmojiReaction)()&&s().length>0},get children(){const m=un();return d(m,o(N,{get each(){return[...r().entries()]},children:([,b])=>{const v=b.findIndex(f=>f.pubkey===n())>=0,y=J(b[0]).toReactionTypes();return(()=>{const f=hn();return f.$$click=$=>{$.stopPropagation(),h(y)},d(f,o(Oe,{reactionTypes:y}),null),d(f,o(_,{get when(){return!t().hideCount},get children(){const $=dn();return d($,()=>b.length),$}}),null),T($=>{const w={"text-fg-tertiary":!v,"hover:bg-r-reaction/10":!v,"hover:border-r-reaction/40":!v,"bg-r-reaction/10":v,"border-r-reaction/40":v,"text-r-reaction":v},x=u();return $._v$5=X(f,w,$._v$5),x!==$._v$6&&(f.disabled=$._v$6=x),$},{_v$5:void 0,_v$6:void 0}),f})()}})),m}})},pn=e=>{const t=D(),{config:n}=S(),i=re(),a=ue(),[s,r]=C(null),l=()=>r(null),c=ie(()=>({mutationKey:["deleteEvent",e.event.id],mutationFn:(...h)=>a.deleteEvent(...h).then(m=>Promise.allSettled(m.map(te(1e4)))),onSuccess:h=>{const m=h.filter(v=>v.status==="fulfilled").length,b=h.length-m;m===h.length?window.alert(t()("post.deletedSuccessfully")):m>0?window.alert(t()("post.failedToDeletePartially",{count:b})):window.alert(t()("post.failedToDelete"))},onError:h=>{console.error("failed to delete",h)}})),u=rn(()=>({menu:[{content:t()("post.copyEventId"),onSelect:()=>{navigator.clipboard.writeText(Ee(e.event.id)).catch(h=>window.alert(h))}},{content:t()("post.showJSON"),onSelect:()=>{r("EventDebugModal")}},{content:t()("post.showReposts"),onSelect:()=>{r("Reposts")}},{content:t()("post.showReactions"),onSelect:()=>{r("Reactions")}},{when:()=>e.event.pubkey===i(),content:(()=>{const h=gn();return d(h,()=>t()("post.deletePost")),h})(),onSelect:()=>{const h=i();h!=null&&window.confirm(t()("post.confirmDelete"))&&c.mutate({relayUrls:n().relayUrls,pubkey:h,eventId:e.event.id})}}]}));return[o(_n,{get event(){return e.event}}),(()=>{const h=fn(),m=h.firstChild,b=m.firstChild,v=m.nextSibling;m.$$click=f=>{f.stopPropagation(),e.onClickReply()},d(b,o(Qt,{})),d(h,o(yn,{get event(){return e.event}}),v),d(h,o($n,{get event(){return e.event}}),v),v.$$click=()=>u.open();const y=u.targetRef;return typeof y=="function"?q(y,v):u.targetRef=v,d(v,o(Yt,{})),d(h,()=>u.popup(),null),h})(),o(K,{get children(){return[o(E,{get when(){return s()==="EventDebugModal"},get children(){return o(vn,{get event(){return e.event},onClose:l})}}),o(E,{get when(){return s()==="Reactions"},get children(){return o(bn,{get event(){return e.event},onClose:l})}}),o(E,{get when(){return s()==="Reposts"},get children(){return o(wn,{get event(){return e.event},onClose:l})}})]}})]};P(["click"]);const kn=g("<div>"),xn=g('<button class="text-xs text-fg-secondary hover:text-fg-secondary/70">隠す'),Rn=g("<span>: "),En=g('<button class="mt-2 flex w-full flex-col items-center rounded border border-border p-2 text-center text-xs text-fg-secondary"><span class="inline-block h-4 w-4"></span><span>'),Cn=e=>{const t=D(),[n,i]=C(!1);return o(_,{get when(){return!e.contentWarning.contentWarning||n()},get fallback(){return(()=>{const a=En(),s=a.firstChild,r=s.nextSibling;return a.$$click=()=>i(!0),d(s,o(vt,{})),d(r,()=>t()("post.contentWarning.show")),d(a,o(_,{get when(){return e.contentWarning.reason!=null},get children(){const l=Rn(),c=l.firstChild;return d(l,()=>t()("post.contentWarning.reason"),c),d(l,()=>e.contentWarning.reason,null),l}}),null),a})()},get children(){return[(()=>{const a=kn();return d(a,()=>e.children),a})(),o(_,{get when(){return e.contentWarning.contentWarning},get children(){const a=xn();return a.$$click=()=>i(!1),a}})]}})};P(["click"]);const Ye=e=>{const{profile:t}=Le(()=>({pubkey:e.pubkey}));return o(_,{get when(){return(t()?.name?.length??0)>0},get fallback(){return`@${Ue(e.pubkey)}`},get children(){return["@",k(()=>t()?.name??e.pubkey)]}})},Sn=e=>{try{const t=new URL(e);return/\.(jpeg|jpg|png|gif|webp|avif|apng|svg)$/i.test(t.pathname)}catch{return!1}},In=e=>{try{const t=new URL(e);return/\.(mpg|mpeg|mp4|avi|mov|webm|ogv)$/i.test(t.pathname)}catch{return!1}},Tn=e=>{try{const t=new URL(e);return/^wss?:$/.test(t.protocol)}catch{return!1}},Ge=e=>{try{const t=new URL(e);if(t.host==="i.imgur.com"||t.host==="imgur.com"){const n=t.pathname.match(/^\/([a-zA-Z0-9]+)\.(jpeg|jpg|png|gif|webp|avif|apng)/);if(n!=null){const i=new URL(t),a=n[1];return i.host="i.imgur.com",i.pathname=`${a}l.webp`,i.toString()}return t.toString()}if(t.host==="i.gyazo.com"){const n=new URL(t);return n.host="thumb.gyazo.com",n.pathname=`/thumb/640${t.pathname}`,n.toString()}if(t.host==="nostr.build"||t.host==="image.nostr.build"){const n=new URL(t);if(n.host="nostr.build",t.pathname.startsWith("/i/p/"))return e;if(t.pathname.startsWith("/i/"))n.pathname=`/responsive/240p${t.pathname}`;else if(t.pathname.match(/^\/[0-9a-zA-Z]+\.(jpeg|jpg|png|gif|webp|avif|apng)$/))n.pathname=`/responsive/240p/i${t.pathname}`;else return e;return n.toString()}return t.toString()}catch{return e}},Ze=e=>{try{const t=new URL(e);return t.protocol==="https:"&&(t.host==="twitter.com"||t.host==="x.com")}catch{return!1}},Mn=["www.youtube.com","m.youtube.com","youtube.com"],Pn=e=>{try{const t=new URL(e);if(t.protocol!=="https:")return null;if(Mn.includes(t.host)){if(t.pathname==="/watch"){const n=t.searchParams.get("v");if(n!=null)return{videoId:n}}if(t.pathname.startsWith("/shorts/")){const n=t.pathname.match(/^\/shorts\/([0-9a-zA-Z_-]*)$/);if(n)return{videoId:n[1]}}}return t.host==="youtu.be"&&t.pathname.lastIndexOf("/")===0?{videoId:t.pathname}:null}catch{return null}},Dn=g('<button class="rounded bg-bg-tertiary p-3 text-xs text-fg-secondary hover:shadow">'),Ln=g('<div class="aspect-video max-w-full">'),Un=g('<img class="max-h-64 max-w-full rounded object-contain shadow hover:shadow-md">'),Fn=e=>{let t;const n=D(),[i,a]=C(e.initialHidden);return o(_,{get when(){return!i()},get fallback(){return(()=>{const s=Dn();return s.$$click=()=>a(!1),d(s,()=>n()("post.showImage")),s})()},get children(){return o(U,{get fallback(){return(()=>{const s=Ln();return d(s,o(L,{get href(){return e.url}})),s})()},children:()=>o(L,{class:"my-2 block",get href(){return e.url},get children(){const s=Un(),r=t;return typeof r=="function"?q(r,s):t=s,T(l=>{const c=Ge(e.url),u=e.url;return c!==l._v$&&R(s,"src",l._v$=c),u!==l._v$2&&R(s,"alt",l._v$2=u),l},{_v$:void 0,_v$2:void 0}),s}})})}})};P(["click"]);const jn=g('<div class="my-1 rounded border p-1">'),An=e=>o(_,{get when(){return e.mentionedEvent.marker!=null&&e.mentionedEvent.marker.length>0},get fallback(){return o(O,{get eventId(){return e.mentionedEvent.eventId}})},get children(){const t=jn();return d(t,o(U,{children:()=>o(W,{get eventId(){return e.mentionedEvent.eventId},embedding:!1,actions:!1,get ensureKinds(){return[ce]}})})),t}}),qn=g('<button class="inline select-text text-link underline">'),oe=e=>{const{showProfile:t}=ae(),n=()=>{t(e.pubkey)};return(()=>{const i=qn();return i.$$click=n,d(i,o(Ye,{get pubkey(){return e.pubkey}})),i})()};P(["click"]);const Hn=e=>{const t={};return Array.from(e.head.querySelectorAll("meta")).forEach(n=>{const i=n.getAttribute("property"),a=n.getAttribute("content");i!=null&&a!=null&&(t[i]=a)}),t["og:image"]!=null&&t["og:title"]!=null&&t["og:description"]!=null&&t["og:url"]?{title:t["og:title"],description:t["og:description"],image:t["og:image"],url:t["og:url"]}:null},On=e=>{const t=new DOMParser().parseFromString(e,"text/html");return Hn(t)},Je=e=>{const t=["www3.nhk.or.jp"],n=new URL(e);return t.includes(n.host)},Wn=async e=>{if(!Je(e))return null;const n=await(await fetch(e,{headers:{Accept:"text/html"}})).text();return On(n)},Bn=e=>{const t=()=>["useOgp",e().url],n=B(()=>({queryKey:t(),queryFn:({queryKey:[,a]})=>Wn(a),staleTime:144e5,gcTime:144e5,refetchOnWindowFocus:!1,refetchOnMount:!1}));return{query:n,ogp:()=>n.data}},Kn=g('<blockquote class=twitter-tweet><a class="text-link underline"target=_blank rel="noreferrer noopener">'),Nn=g('<div class="my-2 rounded-lg border border-border transition-colors hover:bg-bg-tertiary"><img class="max-w-full rounded-t-lg object-contain shadow"><div class="mb-1 p-1"><div class="text-xs text-fg-secondary"></div><div class=text-sm></div><div class="text-xs text-fg-secondary">'),zn=g('<div><button class="flex flex-col items-center rounded bg-bg-tertiary p-3 text-xs text-fg-secondary hover:shadow">'),Qn=g('<div class="aspect-video max-w-full">'),Vn=g('<div class="my-2 aspect-video w-full"><iframe loading=lazy title=YouTube class="my-2 h-full w-full"allowfullscreen>'),pe=e=>{try{const t=new URL(e);return t.host="twitter.com",t.href}catch{return e}},Yn=e=>{const t=new URL("https://www.youtube-nocookie.com/embed/");return t.pathname+=e,t.searchParams.set("origin",window.location.origin),t.href},Gn=e=>{let t;const{getColorTheme:n}=S();G(()=>{Ze(e.url)&&window.twttr?.widgets?.load(t)});const i=()=>n().brightness==="dark"?"dark":"light";return(()=>{const a=Kn(),s=a.firstChild,r=t;return typeof r=="function"?q(r,a):t=a,d(s,()=>pe(e.url)),T(l=>{const c=i(),u=pe(e.url);return c!==l._v$&&R(a,"data-theme",l._v$=c),u!==l._v$2&&R(s,"href",l._v$2=u),l},{_v$:void 0,_v$2:void 0}),a})()},Zn=e=>{const{ogp:t}=Bn(()=>({url:e.url}));return o(_,{get when(){return t()},get fallback(){return o(L,{class:"text-link underline",get href(){return e.url}})},keyed:!0,children:n=>o(L,{get href(){return e.url},get children(){const i=Nn(),a=i.firstChild,s=a.nextSibling,r=s.firstChild,l=r.nextSibling,c=l.nextSibling;return d(r,()=>new URL(n.url).host),d(l,()=>n.title),d(c,()=>n.description),T(u=>{const h=n.title,m=n.image;return h!==u._v$3&&R(a,"alt",u._v$3=h),m!==u._v$4&&R(a,"src",u._v$4=m),u},{_v$3:void 0,_v$4:void 0}),i}})})},se=e=>{const t=D(),[n,i]=C(e.initialHidden);return o(_,{get when(){return!n()},get fallback(){return(()=>{const a=zn(),s=a.firstChild;return s.$$click=()=>i(!1),d(s,()=>t()("post.showPreview")),d(a,o(L,{class:"text-link underline",get href(){return e.url}}),null),a})()},get children(){return e.children}})},Jn=e=>{const{config:t}=S();return o(K,{get fallback(){return o(L,{class:"text-link underline",get href(){return e.url}})},get children(){return[o(E,{get when(){return k(()=>!!t().embedding.twitter)()&&Ze(e.url)},get children(){return o(se,{get url(){return e.url},get initialHidden(){return e.initialHidden},get children(){return o(Gn,{get url(){return e.url}})}})}}),o(E,{get when(){return k(()=>!!t().embedding.youtube)()&&Pn(e.url)},keyed:!0,children:({videoId:n})=>o(se,{get url(){return e.url},get initialHidden(){return e.initialHidden},get children(){return o(U,{get fallback(){return(()=>{const i=Qn();return d(i,o(L,{get href(){return e.url}})),i})()},children:()=>(()=>{const i=Vn(),a=i.firstChild;return T(()=>R(a,"src",Yn(n))),i})()})}})}),o(E,{get when(){return k(()=>!!t().embedding.ogp)()&&Je(e.url)},get children(){return o(se,{get url(){return e.url},get initialHidden(){return e.initialHidden},get children(){return o(U,{children:()=>o(Zn,{get url(){return e.url}})})}})}})]}})};P(["click"]);const Xn=g('<button class="rounded bg-bg-tertiary p-3 text-xs text-fg-secondary hover:shadow">'),er=g('<div class="aspect-video max-w-full">'),tr=g('<video class="max-h-64 max-w-full rounded-sm object-contain shadow"controls><a>'),nr=e=>{let t;const n=D(),[i,a]=C(e.initialHidden);return o(_,{get when(){return!i()},get fallback(){return(()=>{const s=Xn();return s.$$click=()=>a(!1),d(s,()=>n()("post.showVideo")),s})()},get children(){return o(U,{get fallback(){return er()},children:()=>o(L,{class:"my-2 block",get href(){return e.url},get children(){const s=tr(),r=s.firstChild,l=t;return typeof l=="function"?q(l,s):t=s,d(r,()=>n()("post.download")),T(c=>{const u=e.url,h=e.url;return u!==c._v$&&R(s,"src",c._v$=u),h!==c._v$2&&R(r,"href",c._v$2=h),c},{_v$:void 0,_v$2:void 0}),s}})})}})};P(["click"]);const le=g("<span>"),ke=g('<button class="select-text text-link underline">'),xe=g('<div class="my-1 rounded border border-border p-1">'),rr=g('<button class="select-text text-link underline"> (<!>)'),or=g('<span class="text-link underline">'),sr=g('<img class="inline-block h-8 max-w-[128px] align-middle">'),lr=e=>{const{config:t,saveColumn:n}=S(),i=mt(),a=r=>{n(ot({query:r})),i({command:"moveToLastColumn"}).catch(l=>console.error(l))},s=r=>{n(st({name:r,relayUrls:[r]})),i({command:"moveToLastColumn"}).catch(l=>console.error(l))};return o(N,{get each(){return e.parsed},children:r=>{if(r.type==="PlainText")return(()=>{const l=le();return d(l,()=>r.content),l})();if(r.type==="URL"){const l=()=>!t().showMedia||!e.embedding||(e.initialHidden??!1);return Sn(r.content)?o(Fn,{get url(){return r.content},get initialHidden(){return l()}}):In(r.content)?o(nr,{get url(){return r.content},get initialHidden(){return l()}}):Tn(r.content)?(()=>{const c=ke();return c.$$click=()=>s(r.content),d(c,()=>r.content),c})():o(Jn,{get url(){return r.content},get initialHidden(){return l()}})}if(r.type==="TagReferenceResolved"){if(r.reference==null)return(()=>{const l=le();return d(l,()=>r.content),l})();if(r.reference.type==="MentionedUser")return o(oe,{get pubkey(){return r.reference.pubkey}});if(r.reference.type==="MentionedEvent")return e.embedding?o(An,{get mentionedEvent(){return r.reference}}):o(O,{get eventId(){return r.reference.eventId}})}if(r.type==="Bech32Entity"){if(r.data.type==="note"&&e.embedding)return(()=>{const l=xe();return d(l,o(W,{get eventId(){return r.data.data},actions:!1,embedding:!1,get ensureKinds(){return[ce]}})),l})();if(r.data.type==="nevent"&&e.embedding)return(()=>{const l=xe();return d(l,o(W,{get eventId(){return r.data.data.id},actions:!1,embedding:!1})),l})();if(r.data.type==="npub")return o(oe,{get pubkey(){return r.data.data}});if(r.data.type==="nprofile")return o(oe,{get pubkey(){return r.data.data.pubkey}});if(r.data.type==="nrelay"){const l=r.data.data;return(()=>{const c=rr(),u=c.firstChild,h=u.nextSibling;return h.nextSibling,c.$$click=()=>s(l),d(c,l,u),d(c,()=>r.content,h),c})()}return(()=>{const l=or();return d(l,()=>r.content),l})()}return r.type==="HashTag"?(()=>{const l=ke();return l.$$click=()=>a(r.content),d(l,()=>r.content),l})():r.type==="CustomEmojiResolved"?r.url==null?(()=>{const l=le();return d(l,()=>r.content),l})():(()=>{const l=sr();return T(c=>{const u=r.url,h=r.content,m=r.shortcode;return u!==c._v$&&R(l,"src",c._v$=u),h!==c._v$2&&R(l,"alt",c._v$2=h),m!==c._v$3&&R(l,"title",c._v$3=m),c},{_v$:void 0,_v$2:void 0,_v$3:void 0}),l})():(console.error("Not all ParsedTextNoteNodes are covered",r),null)}})};P(["click"]);const Re=2,ir=200,cr=()=>{let e;const[t,n]=C(!1),i=s=>{e=s},a=$t(()=>{e!=null&&n(e.scrollHeight>e.clientHeight+Re||e.scrollHeight>document.documentElement.clientHeight+Re)},ir);return Me(()=>{if(e!=null){a();const s=new IntersectionObserver(l=>{l.forEach(c=>{c.isIntersecting&&a()})},{threshold:[0,.25,.5,.75,1]});s.observe(e);const r=()=>a();window.addEventListener("resize",r),Z(()=>{s.disconnect(),window.removeEventListener("resize",r)})}}),{overflow:t,elementRef:i}},ar=g('<div class="author-name truncate pr-1 font-bold hover:underline">'),ur=g('<button class="mt-2 w-full rounded border border-border p-2 text-center text-xs text-fg-secondary shadow-sm hover:bg-bg-tertiary hover:shadow">'),dr=g('<div class="post flex flex-col"><div class="flex w-full gap-1"><button type=button class="author-icon h-10 w-10 shrink-0 overflow-hidden rounded"></button><div class="min-w-0 flex-auto"><div class="flex justify-between gap-1 text-xs"><button type=button class="author flex min-w-0 select-text truncate hover:text-link"><span class="author flex min-w-0 truncate hover:text-link"><div class="author-username truncate text-fg-secondary"></div></span></button><div class="created-at shrink-0"><button type=button class="select-text hover:underline"></button></div></div><div class=overflow-hidden></div><div class=actions>'),hr=g('<img alt=icon class="h-full w-full object-cover">'),gr=e=>{const t=D(),{overflow:n,elementRef:i}=cr(),a=qe(),[s,r]=C(!1),l=()=>a(e.createdAt),c=()=>e.createdAt.toLocaleString(),{profile:u}=Le(()=>({pubkey:e.authorPubkey}));return(()=>{const h=dr(),m=h.firstChild,b=m.firstChild,v=b.nextSibling,y=v.firstChild,f=y.firstChild,$=f.firstChild,w=$.firstChild,x=f.nextSibling,M=x.firstChild,F=y.nextSibling,j=F.nextSibling;return b.$$click=p=>{p.preventDefault(),e.onShowProfile?.()},d(b,o(_,{get when(){return u()?.picture},keyed:!0,children:p=>o(U,{children:()=>(()=>{const I=hr();return T(()=>R(I,"src",Ge(p))),I})()})})),f.$$click=p=>{p.preventDefault(),e?.onShowProfile?.()},d($,o(_,{get when(){return(u()?.display_name?.length??0)>0},get children(){const p=ar();return d(p,()=>u()?.display_name),p}}),w),d(w,o(_,{get when(){return u()?.name!=null},get fallback(){return`@${Ue(e.authorPubkey)}`},get children(){return["@",k(()=>u()?.name)]}})),M.$$click=p=>{p.preventDefault(),e.onShowEvent?.()},d(M,l),q(i,F),d(F,()=>e.content),d(v,o(_,{get when(){return n()},get children(){const p=ur();return p.$$click=I=>{I.stopPropagation(),r(A=>!A)},d(p,o(_,{get when(){return!s()},get fallback(){return t()("post.hideOverflow")},get children(){return t()("post.showOverflow")}})),p}}),j),d(j,()=>e.actions),d(h,o(_,{get when(){return e.footer},get children(){return e.footer}}),null),T(p=>{const I=c(),A=!s(),H=!!s();return I!==p._v$&&R(M,"title",p._v$=I),A!==p._v$2&&F.classList.toggle("max-h-screen",p._v$2=A),H!==p._v$3&&F.classList.toggle("max-h-none",p._v$3=H),p},{_v$:void 0,_v$2:void 0,_v$3:void 0}),h})()};P(["click"]);const fr=lt(),vr=()=>it(fr),Pr=()=>{const[e,t]=ct({});return{timelineState:e,setTimeline:n=>t("content",n),clearTimeline:()=>t("content",void 0)}},mr=g("<div class=nostr-textnote>"),$r=g("<div class=text-xs>"),yr=g('<div class="content whitespace-pre-wrap break-all">'),br=g("<div class=textnote-content>"),wr=g('<div class="mt-1 rounded border border-border p-1">'),_r=g("<div class=h-12>"),pr=g('<button class="select-text pr-1 text-link hover:underline">'),kr=g("<div class=h-5>"),xr=e=>{let t;const n=D(),{showProfile:i}=ae(),a=vr(),[s,r]=C(!1),l=()=>r(!1),c=()=>{r(v=>!v),s()&&t!=null&&t.focus()},u=k(()=>at(e.event)),h=()=>e.embedding??!0,m=()=>e.actions??!0,b=()=>{if(h()){const v=u().replyingToEvent();if(v!=null&&!u().containsEventMention(v.id))return v.id;const y=u().rootEvent();if(v==null&&y!=null&&!u().containsEventMention(y.id))return y.id}};return(()=>{const v=mr();return d(v,o(gr,{get authorPubkey(){return u().pubkey},get createdAt(){return u().createdAtAsDate()},get content(){return(()=>{const y=br();return d(y,o(_,{get when(){return b()},keyed:!0,children:f=>(()=>{const $=wr();return d($,o(U,{get fallback(){return _r()},children:()=>o(W,{eventId:f,actions:!1,embedding:!1})})),$})()}),null),d(y,o(_,{get when(){return u().taggedPubkeys().length>0},get children(){const f=$r();return d(f,()=>n()("post.replyToPre"),null),d(f,o(N,{get each(){return u().taggedPubkeys()},children:$=>(()=>{const w=pr();return w.$$click=x=>{x.stopPropagation(),i($)},d(w,o(Ye,{pubkey:$})),w})()}),null),d(f,()=>n()("post.replyToPost"),null),f}}),null),d(y,o(Cn,{get contentWarning(){return u().contentWarning()},get children(){const f=yr();return d(f,o(lr,{get parsed(){return u().parsed()},get embedding(){return h()},get initialHidden(){return u().contentWarning().contentWarning}})),f}}),null),y})()},get actions(){return o(_,{get when(){return m()},get children(){return o(U,{get fallback(){return kr()},children:()=>o(pn,{get event(){return e.event},onClickReply:c})})}})},get footer(){return o(_,{get when(){return s()},get children(){return o(yt,{textAreaRef:y=>{t=y},mode:"reply",get replyTo(){return e.event},onClose:l,onPost:l})}})},onShowProfile:()=>{i(u().pubkey)},onShowEvent:()=>{a?.setTimeline({type:"Replies",event:e.event})}})),v})()};P(["click"]);const Rr=g("<span>予期しないイベント種別（<!>）"),Er=g("<span><span>未対応のイベント種別（<!>）"),Xe=e=>{const t=()=>e.ensureKinds==null||e.ensureKinds.length===0||e.ensureKinds.includes(e.event.kind);return o(K,{get fallback(){return(()=>{const n=Er(),i=n.firstChild,a=i.firstChild,s=a.nextSibling;return s.nextSibling,d(i,()=>e.event.kind,s),d(n,o(O,{get eventId(){return e.event.id},get kind(){return e.event.kind}}),null),n})()},get children(){return[o(E,{get when(){return!t()},keyed:!0,get children(){const n=Rr(),i=n.firstChild,a=i.nextSibling;return a.nextSibling,d(n,()=>e.event.kind,a),d(n,o(O,{get eventId(){return e.event.id},get kind(){return e.event.kind}}),null),n}}),o(E,{get when(){return e.event.kind===ce},get children(){return o(xr,{get event(){return e.event},get embedding(){return e.actions},get actions(){return e.actions}})}}),o(E,{get when(){return e.event.kind===ut},get children(){return o(Nt,{get event(){return e.event}})}})]}})},Dr=e=>{const{shouldMuteEvent:t}=S();return o(N,{get each(){return e.events},children:n=>o(_,{get when(){return!t(n)},get children(){return o(St,{get children(){return o(Xe,{event:n})}})}})})};let Y=0;const{setActiveSubscriptions:Cr}=bt();setInterval(()=>{Cr(Y)},1e3);const Lr=e=>{const{config:t,shouldMuteEvent:n}=S(),i=wt(),[a,s]=C([]),[r,l]=C(!1),c=k(e),u=()=>e()?.eoseLimit??25,h=()=>e()?.limit??50;G(ge(()=>[t().mutedPubkeys,t().mutedKeywords],()=>{s(v=>v.filter(y=>!n(y)))},{defer:!0})),Me(()=>{console.debug("subscription mounted",e()?.debugId,e()),Z(()=>{console.debug("subscription unmount",e()?.debugId,e())})});const m=v=>{const f=v.created_at-_t();if(!(f>300)){if(f>0){setTimeout(()=>m(v),f*1e3);return}s($=>{const w=pt($,v).slice(0,h()),x=kt(w,M=>M.id);return x.length!==w.length&&console.warn("duplicated event",v),x})}},b=()=>{console.debug("startSubscription: start");const v=c();if(v==null)return;const{relayUrls:y,filters:f,options:$,onEvent:w,onEOSE:x,clientEventFilter:M,continuous:F=!0}=v;let j=!0;Y+=1;let p=!1;l(!1);const I=[],A=()=>s(xt(I).slice(0,u())),H=i().subscribeMany(y,f,$??{eoseTimeout:12e3,maxWait:6e3,onevent:V=>{w?.(V),!(M!=null&&!M(V))&&(r()?m(V):(p=!0,I.push(V)))},oneose:()=>{r()||(x?.(),l(!0),A(),I.splice(0,I.length),F||(H.close(),j&&(j=!1,Y-=1)))}}),he=setInterval(()=>{if(r()){clearInterval(he);return}p&&(p=!1,A())},100);Z(()=>{console.debug("startSubscription: end"),H.close(),j&&(j=!1,Y-=1),clearInterval(he)})};return G(ge(()=>[c()],()=>b())),{events:a,eose:r}},et=e=>{const t=()=>{const i=e();if(i==null)return[];const a=[];return Se(i).pTags().forEach(r=>{const[,l,c,u]=r,h={pubkey:l,petname:u};c!=null&&c.length>0&&(h.mainRelayUrl=c),a.push(h)}),a};return{followings:t,followingPubkeys:()=>t().map(i=>i.pubkey),data:e}},Ur=async({pubkey:e},t)=>{const n=new Q({type:"Followings",pubkey:e});Pe({task:n,signal:t});const i=await n.latestEventPromise();return et(()=>i)},Fr=e=>{const t=z(),n=k(e),i=()=>["useFollowings",n()],a=B(()=>({queryKey:i(),queryFn:Rt({taskProvider:([,r])=>{if(r==null)return null;const{pubkey:l}=r;return new Q({type:"Followings",pubkey:l})},queryClient:t}),staleTime:5*60*1e3,gcTime:3*24*60*60*1e3,refetchOnMount:!0,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchInterval:0})),s=()=>t.invalidateQueries({queryKey:i()});return{...et(()=>a.data),invalidateFollowings:s,query:a}};export{St as C,W as E,Nt as R,Dr as T,Pr as a,fr as b,Fr as c,qe as d,Dt as e,Oe as f,xr as g,ze as h,rn as i,Yt as j,lr as k,Ur as l,Ge as t,Lr as u};
//# sourceMappingURL=useFollowings-db1d2404.js.map
