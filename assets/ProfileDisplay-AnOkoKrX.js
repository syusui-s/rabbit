import{s as N,t as i,j as X,v as $,W as ge,k as ye,z as we,u as be,c as T,a7 as ve,a as r,h as g,f as O,i as l,S as U,M as y,b as V,m as $e,d as ke,a8 as _e,an as xe,w as Ce,al as Pe,ai as Fe}from"./index-_LyVaW3U.js";import{u as Y,d as G,j as Me,k as Se,l as Ee,T as Te,m as Ue}from"./useFollowings-_6dphl7v.js";import{a as qe,b as Le,f as Ne,G as ze,h as je,o as Ae,g as K,t as Be,e as Re,q as Qe}from"./SideBar-xaQ3SbkA.js";import{B as De}from"./BasicModal-6rH9uTpK.js";import He from"./EventDebugModal-fCkv2n00.js";import Ie from"./UserList-dQmeurWN.js";import{S as Oe}from"./SafeLink-ZhgX_I31.js";import"./LazyLoad-DoXaI5jS.js";import"./resolveAsset-bneaYz4U.js";const Ve=i('<svg xmlns=http://www.w3.org/2000/svg fill=none stroke=currentColor stroke-width=1.5 aria-hidden=true data-slot=icon viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99">'),Ge=(n={})=>(()=>{const t=Ve();return N(t,n,!0,!0),t})(),Ke=i('<svg xmlns=http://www.w3.org/2000/svg fill=currentColor aria-hidden=true data-slot=icon viewBox="0 0 24 24"><path fill-rule=evenodd d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12m13.36-1.814a.75.75 0 1 0-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 0 0-1.06 1.06l2.25 2.25a.75.75 0 0 0 1.14-.094z"clip-rule=evenodd>'),Je=(n={})=>(()=>{const t=Ke();return N(t,n,!0,!0),t})(),We=i('<svg xmlns=http://www.w3.org/2000/svg fill=currentColor aria-hidden=true data-slot=icon viewBox="0 0 24 24"><path fill-rule=evenodd d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12M12 8.25a.75.75 0 0 1 .75.75v3.75a.75.75 0 0 1-1.5 0V9a.75.75 0 0 1 .75-.75m0 8.25a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5"clip-rule=evenodd>'),Xe=(n={})=>(()=>{const t=We();return N(t,n,!0,!0),t})();var Z=/^(?:([\w.+-]+)@)?([\w.-]+)$/,ee;try{ee=fetch}catch{}async function Ye(n){const t=n.match(Z);if(!t)return null;const[f,d="_",w]=t;try{const v=await ee(`https://${w}/.well-known/nostr.json?name=${d}`),{names:b,relays:k}=Ze(await v.json()),x=b[d];return x?{pubkey:x,relays:k?.[x]}:null}catch{return null}}function Ze(n){const t={names:{}};for(const[f,d]of Object.entries(n.names))typeof f=="string"&&typeof d=="string"&&(t.names[f]=d);if(n.relays){t.relays={};for(const[f,d]of Object.entries(n.relays))typeof f=="string"&&Array.isArray(d)&&(t.relays[f]=d.filter(w=>typeof w=="string"))}return t}const et=n=>{if(n==null||n.length===0)return null;const t=n.match(Z);if(t==null)return null;const[,f,d]=t;return f==null||f==="_"?{user:"_",domain:d,ident:d}:{user:f,domain:d,ident:n}};function tt(n){const{config:t}=X(),f=$(n),{events:d}=Y(()=>({relayUrls:t().relayUrls,filters:[{kinds:[ge],"#p":[f().pubkey]}],limit:1e6,eoseLimit:1e6,continuous:!1})),w=()=>ye(d()?.map(b=>b.pubkey));return{followersPubkeys:w,count:()=>w().length}}const nt=n=>{const t=$(n),f=()=>["useVerification",t()],d=we(()=>({queryKey:f(),queryFn:({queryKey:v})=>{const[,b]=v;if(b==null)return Promise.resolve(null);const{nip05:k}=b;return Ye(k)},staleTime:30*60*1e3,gcTime:24*60*60*1e3}));return{verification:()=>d?.data??null,query:d}},rt=i('<button class="rounded-full border border-primary px-4 py-2 text-center font-bold text-primary hover:bg-primary hover:text-primary-fg sm:w-20">'),J=i('<span class="rounded-full border border-primary px-4 py-2 text-primary sm:text-base">'),lt=i('<button class="rounded-full border border-primary bg-primary px-4 py-2 text-center font-bold text-primary-fg hover:bg-primary-hover sm:w-36">'),ot=i('<button class="w-28 rounded-full border border-primary px-4 py-2 text-primary hover:border-primary-hover hover:text-primary-hover">'),W=i('<div class="shrink-0 text-xs">'),st=i('<div class="flex shrink-0 flex-col items-center gap-1"><div class="flex flex-row justify-start gap-1"><button type=button class="w-10 rounded-full border border-primary p-2 text-primary hover:border-primary-hover hover:text-primary-hover">'),it=i('<div class="mt-[-54px] flex items-end gap-4 px-4 pt-4"><div class="flex-1 shrink-0"><div class="size-28 overflow-hidden rounded-lg shadow-md">'),at=i('<div class="truncate text-xl font-bold">'),ct=i('<div class="truncate text-xs">@'),ut=i('<span class="inline-block size-3">'),dt=i('<span class="inline-block size-4 text-link">'),ft=i('<div class="flex items-center text-xs">'),pt=i('<div class="flex items-start px-4 pt-2"><div class="h-16 shrink overflow-hidden"><div class="flex items-center gap-2"></div><div class="flex gap-1"><div class="truncate text-xs">'),mt=i('<div class="flex flex-1 flex-col items-start"><div class=text-sm></div><div class=text-xl>'),ht=i('<div class="flex border-t border-border px-4 py-2"><button class="flex flex-1 flex-col items-start"><div class=text-sm></div><div class=text-xl>'),gt=i('<ul class="border-t border-border px-5 py-2 text-xs">'),yt=i('<ul class="border-t border-border p-1">'),wt=i('<div class="h-12 shrink-0">'),bt=i('<div class="h-40 w-full shrink-0 sm:h-52"><img alt=header class="size-full object-cover">'),vt=i('<img alt="user icon"class="size-full object-cover">'),$t=i('<span class="inline-block size-4 text-danger">'),kt=i('<div class="max-h-40 shrink-0 overflow-y-auto whitespace-pre-wrap px-4 py-2 text-sm">'),_t=i("<span class=text-sm>"),xt=i('<button class="text-sm hover:text-fg-secondary">'),Ct=i('<li class="flex items-center gap-1"><span class="inline-block size-4"area-label=website title=website>'),Pt=n=>{const{count:t}=tt(()=>({pubkey:n.pubkey}));return $(t)},zt=n=>{const t=be(),{config:f,addMutedPubkey:d,removeMutedPubkey:w,isPubkeyMuted:v,saveColumn:b}=X(),k=qe(),x=Qe(),_=Le(),{showProfileEdit:te}=je(),C=$(()=>Ae(n.pubkey)),[ne,z]=T(!1),[re,j]=T(!1),[le,oe]=T(!1),[A,q]=T(null),B=()=>q(null),{profile:m,event:se,query:P}=Ne(()=>({pubkey:n.pubkey})),{verification:ie,query:ae}=nt(()=>K([m()?.nip05])(([e])=>({nip05:e}))),ce=()=>et(m()?.nip05),ue=()=>ie()?.pubkey===n.pubkey,R=()=>v(n.pubkey),de=$(()=>{const e=se(),o=m()?.about;if(e==null||o==null)return;const a=_e(o);return xe(a,Ce(e))}),{followingPubkeys:fe,invalidateFollowings:pe,query:F}=G(()=>K([_()])(([e])=>({pubkey:e}))),M=()=>fe().includes(n.pubkey),{followingPubkeys:L,query:Q}=G(()=>({pubkey:n.pubkey})),me=()=>{const e=_();return e!=null&&L().includes(e)},S=ve(()=>({mutationKey:["updateContacts"],mutationFn:(...e)=>x.updateContacts(...e).then(o=>Promise.allSettled(o.map(Be(5e3)))),onSuccess:e=>{const o=e.filter(u=>u.status==="fulfilled").length,a=e.length-o;o===e.length?console.log("succeeded to update contacts"):o>0?console.log(`succeeded to update contacts for ${o} relays but failed for ${a} relays`):console.error("failed to update contacts")},onError:e=>{console.error("failed to update contacts: ",e)},onSettled:()=>{pe().then(()=>F.refetch()).catch(e=>console.error("failed to refetch contacts",e))}})),D=async(e,o)=>{try{const a=_();if(a==null)return;z(!0);const u=await Ue({pubkey:a});if((u.data()==null||u.followingPubkeys().length===0)&&!window.confirm(t.t("profile.confirmUpdateEvenIfEmpty")))return;if((u?.data()?.created_at??0)<(F.data?.created_at??0)){window.alert(t.t("profile.failedToFetchLatestFollowList"));return}const p=u.data()?.tags??[];let c;switch(e){case"follow":c=[...p,["p",o]];break;case"unfollow":c=p.filter(([h,s])=>!(h==="p"&&s===o));break;default:console.error("updateContacts: invalid operation",e);return}await S.mutateAsync({relayUrls:f().relayUrls,pubkey:a,updatedTags:c,content:u.data()?.content??""})}catch(a){console.error("failed to update contact list",a),window.alert(t.t("profile.failedToUpdateFollowList"))}finally{z(!1)}},H=()=>{D("follow",n.pubkey).catch(e=>{console.log("failed to follow",e)})},I=()=>{window.confirm(t.t("profile.confirmUnfollow"))&&D("unfollow",n.pubkey).catch(e=>{console.log("failed to unfollow",e)})},E=Me(()=>({menu:[{content:t.t("profile.copyPubkey"),onSelect:()=>{navigator.clipboard.writeText(C()).catch(e=>window.alert(e))}},{content:t.t("profile.showJSON"),onSelect:()=>{q("EventDebugModal")}},{content:t.t("profile.addColumn"),items:[{content:t.t("profile.addUserColumn"),onSelect:()=>{const e=m()?.name??C();b(Pe({name:e,pubkey:n.pubkey})),k({command:"moveToLastColumn"}).catch(o=>console.error(o)),n.onClose?.()}},{content:t.t("profile.addUserHomeColumn"),onSelect:()=>{const e=`${t.t("column.home")} / ${m()?.name??C()}`;b(Fe({name:e,pubkey:n.pubkey})),k({command:"moveToLastColumn"}).catch(o=>console.error(o)),n.onClose?.()}}]},{content:R()?t.t("profile.unmute"):t.t("profile.mute"),onSelect:()=>{R()?w(n.pubkey):d(n.pubkey)}},{when:()=>n.pubkey===_(),content:M()?t.t("profile.unfollowMyself"):t.t("profile.followMyself"),onSelect:()=>{M()?I():H()}}]})),{events:he}=Y(()=>({relayUrls:f().relayUrls,filters:[{kinds:[1,6],authors:[n.pubkey],limit:10,until:Re()}],continuous:!1}));return r(De,{onClose:()=>n.onClose?.(),get children(){return[r(g,{get when(){return $(()=>!!P.isFetched)()&&m()?.banner},get fallback(){return wt()},keyed:!0,children:e=>(()=>{const o=bt(),a=o.firstChild;return O(a,"src",e),o})()}),(()=>{const e=it(),o=e.firstChild,a=o.firstChild;return l(a,r(g,{get when(){return $(()=>!!P.isFetched)()&&m()?.picture},keyed:!0,children:u=>(()=>{const p=vt();return O(p,"src",u),p})()})),l(e,r(g,{get when(){return _()!=null},get children(){const u=st(),p=u.firstChild,c=p.firstChild;l(p,r(U,{get children(){return[r(y,{get when(){return n.pubkey===_()},get children(){const s=rt();return s.$$click=()=>te(),l(s,()=>t.t("profile.editProfile")),s}}),r(y,{get when(){return S.isPending||ne()},get children(){const s=J();return l(s,()=>t.t("general.updating")),s}}),r(y,{get when(){return F.isPending||F.isFetching},get children(){const s=J();return l(s,()=>t.t("general.loading")),s}}),r(y,{get when(){return M()},get children(){const s=lt();return s.$$click=()=>I(),s.addEventListener("mouseleave",()=>j(!1)),s.addEventListener("mouseenter",()=>j(!0)),l(s,r(g,{get when(){return!re()},get fallback(){return t.t("profile.unfollow")},get children(){return t.t("profile.followingCurrently")}})),V(()=>s.disabled=S.isPending),s}}),r(y,{get when(){return!M()},get children(){const s=ot();return s.$$click=()=>H(),l(s,()=>t.t("profile.follow")),V(()=>s.disabled=S.isPending),s}})]}}),c),c.$$click=()=>E.open();const h=E.targetRef;return typeof h=="function"?$e(h,c):E.targetRef=c,l(c,r(Se,{})),l(p,()=>E.popup(),null),l(u,r(U,{get children(){return[r(y,{get when(){return Q.isPending},get children(){const s=W();return l(s,()=>t.t("general.loading")),s}}),r(y,{get when(){return me()},get children(){const s=W();return l(s,()=>t.t("profile.followsYou")),s}})]}}),null),u}}),null),e})(),(()=>{const e=pt(),o=e.firstChild,a=o.firstChild,u=a.nextSibling,p=u.firstChild;return l(o,r(g,{get when(){return P.isPending},get children(){return t.t("general.loading")}}),a),l(o,r(g,{get when(){return(m()?.display_name?.length??0)>0},get children(){const c=at();return l(c,()=>m()?.display_name),c}}),a),l(a,r(g,{get when(){return(m()?.name?.length??0)>0},get children(){const c=ct();return c.firstChild,l(c,()=>m()?.name,null),c}}),null),l(a,r(g,{get when(){return(m()?.nip05?.length??0)>0},get children(){const c=ft();return l(c,()=>ce()?.ident,null),l(c,r(U,{get fallback(){return(()=>{const h=$t();return l(h,r(Xe,{})),h})()},get children(){return[r(y,{get when(){return ae.isPending},get children(){const h=ut();return l(h,r(Ge,{})),h}}),r(y,{get when(){return ue()},get children(){const h=dt();return l(h,r(Je,{})),h}})]}}),null),c}}),null),l(p,C),e})(),r(g,{get when(){return de()},keyed:!0,children:e=>(()=>{const o=kt();return l(o,r(Ee,{parsed:e,embedding:!1,initialHidden:!0})),o})()}),(()=>{const e=ht(),o=e.firstChild,a=o.firstChild,u=a.nextSibling;return o.$$click=()=>q("Following"),l(a,()=>t.t("profile.following")),l(u,r(g,{get when(){return Q.isFetched},get fallback(){return(()=>{const p=_t();return l(p,()=>t.t("general.loading")),p})()},get children(){return L().length}})),l(e,r(g,{get when(){return!f().hideCount},get children(){const p=mt(),c=p.firstChild,h=c.nextSibling;return l(c,()=>t.t("profile.followers")),l(h,r(g,{get when(){return le()},get fallback(){return(()=>{const s=xt();return s.$$click=()=>oe(!0),l(s,()=>t.t("profile.loadFollowers")),s})()},keyed:!0,get children(){return r(Pt,{get pubkey(){return n.pubkey}})}})),p}}),null),e})(),r(g,{get when(){return(m()?.website??"").length>0},get children(){const e=gt();return l(e,r(g,{get when(){return m()?.website},keyed:!0,children:o=>(()=>{const a=Ct(),u=a.firstChild;return l(u,r(ze,{})),l(a,r(Oe,{class:"text-link underline",href:o}),null),a})()})),e}}),r(U,{get children(){return[r(y,{get when(){return A()==="Following"},get children(){return r(Ie,{get data(){return L()},pubkeyExtractor:e=>e,onClose:B})}}),r(y,{get when(){return A()==="EventDebugModal"&&P.data},keyed:!0,children:e=>r(He,{event:e,get extra(){return JSON.stringify(m(),null,2)},onClose:B})})]}}),(()=>{const e=yt();return l(e,r(Te,{get events(){return he()}})),e})()]}})};ke(["click"]);export{zt as default};
//# sourceMappingURL=ProfileDisplay-AnOkoKrX.js.map
