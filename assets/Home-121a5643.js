import{s as q,t as d,d as B,c as M,i as u,a as n,S as b,M as _,b as K,u as I,e as z,f as me,g as de,h as L,j as J,k as H,l as D,F as V,m as ge,n as X,o as O,p as Y,q as he,r as ve}from"./index-05e17baf.js";import{u as k,a as P,T as j,b as fe,t as ye,c as we,d as Z,A as xe,e as ke,f as ee,g as $e,h as be,i as ne,j as Ce,C as U,E as te,S as re,p as _e,r as pe,k as Ie,B as Te,l as Se,H as Ee,m as Pe,n as le,o as Q,q as oe,s as Re,U as ce,v as se,w as ue,x as Fe,y as A,z as Le,D as Me,F as qe,G as Be,R as Ne,I as Ue,J as De,Z as ze,K as je,L as He,M as Oe,N as Qe,O as Ae,P as Ke,Q as Ve,V as Ge,W as Ze,X as We}from"./SideBar-26781ce1.js";import{u as Je}from"./usePersistStatus-ea4b87ef.js";const Xe=d('<svg xmlns=http://www.w3.org/2000/svg fill=none stroke=currentColor stroke-width=1.5 aria-hidden=true data-slot=icon viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round d="M17.593 3.322c1.1.128 1.907 1.077 1.907 2.185V21L12 17.25 4.5 21V5.507c0-1.108.806-2.057 1.907-2.185a48.507 48.507 0 0 1 11.186 0">'),Ye=(e={})=>(()=>{const t=Xe();return q(t,e,!0,!0),t})(),en=d('<svg xmlns=http://www.w3.org/2000/svg fill=none stroke=currentColor stroke-width=1.5 aria-hidden=true data-slot=icon viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round d="M12 6.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5m0 6a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5m0 6a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5">'),ie=(e={})=>(()=>{const t=en();return q(t,e,!0,!0),t})(),nn=d('<div class="flex flex-col"><div class="flex h-8 items-center gap-1 px-2"><h2 class="flex min-w-0 flex-1 items-center gap-1"><span class="column-name truncate"></span></h2><button class="h-4 w-4">'),tn=d('<span class="inline-block h-4 w-4 shrink-0 text-gray-700">'),N=e=>{const[t,r]=M(!1),s=()=>r(l=>!l);return(()=>{const l=nn(),o=l.firstChild,c=o.firstChild,i=c.firstChild,a=c.nextSibling;return u(c,n(b,{get when(){return e.icon},keyed:!0,children:y=>(()=>{const h=tn();return u(h,y),h})()}),i),u(i,()=>e.name),a.$$click=()=>s(),u(a,n(ie,{})),u(l,n(b,{get when(){return t()},get children(){return e.settings()}}),null),l})()};B(["click"]);const rn=e=>{const t=[e.id],r=e.rootEvent()?.id;r!=null&&t.push(r);const s=e.replyingToEvent()?.id;return s!=null&&t.push(s),fe(t)},ln=e=>{const{config:t}=k(),r=()=>ye(e.event),{events:s}=P(()=>({relayUrls:t().relayUrls,filters:[{kinds:[1],ids:rn(r()),limit:25},{kinds:[1],"#e":[e.event.id],limit:25}],limit:200}));return n(j,{get events(){return[...s()].reverse()}})},on=e=>n(K,{get children(){return n(_,{get when(){return e.timelineContent.type==="Replies"&&e.timelineContent},keyed:!0,children:t=>n(ln,{get event(){return t.event}})})}}),cn=d('<div class="flex w-[80vw] shrink-0 snap-center snap-always flex-col border-r sm:snap-align-none">'),sn=d('<div class="shrink-0 border-b">'),un=d('<div class="scrollbar flex flex-col overflow-y-scroll scroll-smooth pb-16">'),an=d('<div class="flex shrink-0 items-center border-b bg-white px-2"><button class="flex w-full items-center gap-1"><div class="inline-block h-4 w-4"></div><div>'),mn=d('<div class="scrollbar flex max-h-full flex-col overflow-y-scroll scroll-smooth pb-16">'),R=e=>{let t;const r=we(),s=I(),l=()=>e.width??"medium";return Z(()=>({commandType:"moveToColumn",handler:o=>{o.command==="moveToColumn"&&o.columnIndex===e.columnIndex&&t?.scrollIntoView({behavior:"smooth",inline:"center"})}})),Z(()=>({commandType:"moveToLastColumn",handler:()=>{e.lastColumn&&t?.scrollIntoView({behavior:"smooth"})}})),n(ke.Provider,{value:r,get children(){const o=cn(),c=t;return typeof c=="function"?de(c,o):t=o,u(o,n(b,{get when(){return r.timelineState.content},keyed:!0,get fallback(){return[(()=>{const i=sn();return u(i,()=>e.header),i})(),(()=>{const i=un();return u(i,()=>e.children),i})()]},children:i=>[(()=>{const a=an(),y=a.firstChild,h=y.firstChild,m=h.nextSibling;return y.$$click=()=>r?.clearTimeline(),u(h,n(xe,{})),u(m,()=>s()("column.back")),a})(),(()=>{const a=mn();return u(a,n(on,{timelineContent:i})),a})()]})),z(i=>me(o,{"sm:w-[500px]":l()==="widest","sm:w-[360px]":l()==="wide","sm:w-[320px]":l()==="medium","sm:w-[280px]":l()==="narrow"},i)),o}})};B(["click"]);const dn=d('<svg xmlns=http://www.w3.org/2000/svg fill=none stroke=currentColor stroke-width=1.5 aria-hidden=true data-slot=icon viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round d="M15.75 19.5 8.25 12l7.5-7.5">'),gn=(e={})=>(()=>{const t=dn();return q(t,e,!0,!0),t})(),hn=d('<svg xmlns=http://www.w3.org/2000/svg fill=none stroke=currentColor stroke-width=1.5 aria-hidden=true data-slot=icon viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round d="m8.25 4.5 7.5 7.5-7.5 7.5">'),vn=(e={})=>(()=>{const t=hn();return q(t,e,!0,!0),t})(),fn=d('<svg xmlns=http://www.w3.org/2000/svg fill=none stroke=currentColor stroke-width=1.5 aria-hidden=true data-slot=icon viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0">'),yn=(e={})=>(()=>{const t=fn();return q(t,e,!0,!0),t})(),wn=d('<div class="flex flex-col gap-2 border-b p-2"><div></div><div>'),xn=d('<div class="scrollbar flex h-9 gap-2 overflow-x-scroll"><button class="rounded-md border px-4 hover:bg-stone-100"></button><button class="rounded-md border px-4 hover:bg-stone-100"></button><button class="rounded-md border px-4 hover:bg-stone-100"></button><button class="rounded-md border px-4 hover:bg-stone-100">'),kn=d('<div class="flex flex-col border-t"><div class="flex h-10 items-center gap-2"><button class="py-4 pl-2"><span class="inline-block h-4 w-4"></span></button><button class="py-4 pr-2"><span class="inline-block h-4 w-4"></span></button><div class=flex-1></div><button class="px-2 py-4 text-rose-500 hover:text-rose-600"><span class="inline-block h-4 w-4">'),$n=e=>(()=>{const t=wn(),r=t.firstChild,s=r.nextSibling;return u(r,()=>e.title),u(s,()=>e.children),t})(),F=e=>{const t=I(),{saveColumn:r,removeColumn:s,moveColumn:l}=k(),o=ee(),c=a=>{r({...e.column,width:a})},i=a=>{l(e.column.id,a),o({command:"moveToColumn",columnIndex:a}).catch(y=>console.error(y))};return(()=>{const a=kn(),y=a.firstChild,h=y.firstChild,m=h.firstChild,x=h.nextSibling,g=x.firstChild,w=x.nextSibling,f=w.nextSibling,$=f.firstChild;return u(a,n($n,{get title(){return t()("column.config.columnWidth")},get children(){const v=xn(),C=v.firstChild,S=C.nextSibling,p=S.nextSibling,E=p.nextSibling;return C.$$click=()=>c("widest"),u(C,()=>t()("column.config.widest")),S.$$click=()=>c("wide"),u(S,()=>t()("column.config.wide")),p.$$click=()=>c("medium"),u(p,()=>t()("column.config.medium")),E.$$click=()=>c("narrow"),u(E,()=>t()("column.config.narrow")),v}}),y),h.$$click=()=>i(e.columnIndex-1),u(m,n(gn,{})),x.$$click=()=>i(e.columnIndex+1),u(g,n(vn,{})),f.$$click=()=>s(e.column.id),u($,n(yn,{})),z(v=>{const C=t()("column.config.moveLeft"),S=t()("column.config.moveRight"),p=t()("column.config.removeColumn"),E=t()("column.config.removeColumn");return C!==v._v$&&L(h,"title",v._v$=C),S!==v._v$2&&L(x,"title",v._v$2=S),p!==v._v$3&&L(f,"title",v._v$3=p),E!==v._v$4&&L($,"aria-label",v._v$4=E),v},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0}),a})()};B(["click"]);class bn extends be{constructor(t){super(),this.tags=t}}const Cn=e=>{try{const t=$e.parse(JSON.parse(e));return new bn(t)}catch(t){throw new TypeError("failed to parse tags schema: ",{cause:t})}},[W,_n]=J(()=>M({})),[pn,In]=J(()=>M({})),Tn=e=>{const t=ne(),[r,s]=M(null);return H(()=>{const l=e();if(l==null)return;const{encrypted:o}=l;if(o in W()){s(W()[o]);return}const c=t();c!=null&&(pn()[o]||(In(i=>({...i,[o]:!0})),window.nostr?.nip04?.decrypt?.(c,o)?.then(i=>{_n(a=>({...a,[o]:i})),s(i)}).catch(i=>{console.error(`failed to decrypt "${o}"`,i)})))}),r},Sn=e=>{const t=D(()=>Ce(e.event)),r=Tn(()=>{const{content:o}=t();return o==null||o.length===0?null:{id:t().id,encrypted:o}}),s=()=>{const o=r();if(o==null)return[];console.log(o);try{return Cn(o).taggedEventIds()}catch(c){return console.warn(c),[]}},l=()=>t().taggedEventIds();return n(V,{get each(){return[...l(),...s()]},children:o=>n(U,{get children(){return n(te,{eventId:o,get ensureKinds(){return[re]}})}})})},En=e=>{const t=ge(),r=D(e),s=()=>["useFollowings",r()],l=X(()=>({queryKey:s(),queryFn:({queryKey:c,signal:i})=>{console.debug("useFollowings");const[,a]=c;if(a==null)return Promise.resolve(null);const{kind:y,author:h,identifier:m}=a,x=new Te({type:"ParameterizedReplaceableEvent",kind:y,author:h,identifier:m}),g=x.firstEventPromise().catch(()=>{throw new Error(`parameterized replaceable event not found: ${y}:${h}:${m}`)});return x.onUpdate(w=>{const f=_e(w);t.setQueryData(c,f)}),pe({task:x,signal:i}),Ie(15e3,`useParameterizedReplaceableEvent: ${y}:${h}:${m}`)(g)},staleTime:5*60*1e3,gcTime:4*60*60*1e3}));return{event:()=>l.data??null,query:l}},Pn=e=>{const t=I(),{removeColumn:r}=k(),{event:s}=En(()=>({kind:30001,author:e.column.pubkey,identifier:e.column.identifier}));return n(R,{get header(){return n(N,{get name(){return e.column.name??t()("column.bookmark")},get icon(){return n(Ye,{})},settings:()=>n(F,{get column(){return e.column},get columnIndex(){return e.columnIndex}}),onClose:()=>r(e.column.id)})},get width(){return e.column.width},get columnIndex(){return e.columnIndex},get lastColumn(){return e.lastColumn},get children(){return n(b,{get when(){return s()},keyed:!0,children:l=>n(Sn,{event:l})})}})},T=e=>t=>{switch(e.filterType){case"AND":return e.children.every(r=>T(r)(t));case"OR":return e.children.some(r=>T(r)(t));case"NOT":return!T(e.child)(t);case"Text":return t.includes(e.text);case"Regex":return new RegExp(e.regex,e.flag).test(t);default:console.error("unsupported content filter type");break}return!1},Rn=e=>{const t=I(),{config:r,removeColumn:s}=k(),{followingPubkeys:l}=Se(()=>({pubkey:e.column.pubkey})),{events:o}=P(()=>{const c=Pe.uniq([...l()]);return c.length===0?null:{debugId:"following",relayUrls:r().relayUrls,filters:[{kinds:[1,6],authors:c,limit:10,since:le()-4*60*60}],clientEventFilter:i=>e.column.contentFilter==null?!0:T(e.column.contentFilter)(i.content)}});return H(()=>{console.log("home",o())}),O(()=>console.log("home timeline mounted")),Y(()=>console.log("home timeline unmounted")),n(R,{get header(){return n(N,{get name(){return e.column.name??t()("column.home")},get icon(){return n(Ee,{})},settings:()=>n(F,{get column(){return e.column},get columnIndex(){return e.columnIndex}}),onClose:()=>s(e.column.id)})},get width(){return e.column.width},get columnIndex(){return e.columnIndex},get lastColumn(){return e.lastColumn},get children(){return n(j,{get events(){return o()}})}})},Fn=d('<img alt=icon class="h-full w-full object-cover">'),Ln=d('<div class="flex gap-1 px-1 text-sm"><div class="notification-icon flex max-w-[64px] place-items-center"></div><div class="notification-user flex gap-1 overflow-hidden"><div class="author-icon h-5 w-5 shrink-0 overflow-hidden rounded"></div><div class="flex min-w-0 flex-1 overflow-hidden"><button class="select-text truncate font-bold hover:text-blue-500 hover:underline"></button><span class=shrink-0>'),Mn=d('<div class="notification-event py-1">'),qn=d("<div class=truncate> "),Bn=e=>{const t=I(),{shouldMuteEvent:r}=k(),{showProfile:s}=ue(),l=()=>Fe(e.event),o=()=>l().lastTaggedEventId(),{profile:c}=Q(()=>({pubkey:e.event.pubkey})),{event:i,query:a}=oe(()=>A([o()])(([h])=>({eventId:h}))),y=()=>a.isSuccess&&i()==null;return n(b,{get when(){return D(()=>!y())()&&!r(e.event)},get children(){return[(()=>{const h=Ln(),m=h.firstChild,x=m.nextSibling,g=x.firstChild,w=g.nextSibling,f=w.firstChild,$=f.nextSibling;return u(m,n(Re,{get reactionTypes(){return l().toReactionTypes()}})),u(g,n(b,{get when(){return c()?.picture!=null},get children(){const v=Fn();return z(()=>L(v,"src",c()?.picture)),v}})),f.$$click=()=>s(e.event.pubkey),u(f,n(ce,{get pubkey(){return e.event.pubkey}})),u($,()=>t()("notification.reacted")),h})(),(()=>{const h=Mn();return u(h,n(b,{get when(){return i()},get fallback(){return(()=>{const m=qn(),x=m.firstChild;return u(m,()=>t()("general.loading"),x),u(m,o,null),m})()},keyed:!0,children:m=>n(se,{event:m})})),h})()]}})};B(["click"]);const Nn=d('<svg xmlns=http://www.w3.org/2000/svg fill=currentColor aria-hidden=true data-slot=icon viewBox="0 0 24 24"><path fill-rule=evenodd d="M14.615 1.595a.75.75 0 0 1 .359.852L12.982 9.75h7.268a.75.75 0 0 1 .548 1.262l-10.5 11.25a.75.75 0 0 1-1.272-.71l1.992-7.302H3.75a.75.75 0 0 1-.548-1.262l10.5-11.25a.75.75 0 0 1 .913-.143"clip-rule=evenodd>'),Un=(e={})=>(()=>{const t=Nn();return q(t,e,!0,!0),t})(),Dn=d('<img alt=icon class="h-full w-full object-cover">'),zn=d('<div class="flex items-center gap-1 text-sm"><div class="flex w-6 flex-col items-center"><div class="h-4 w-4 shrink-0 text-amber-500"aria-hidden=true></div><div class="mt-[-2px] shrink-0 text-xs"></div></div><div class="notification-user flex gap-1 overflow-hidden"><div class="author-icon h-5 w-5 shrink-0 overflow-hidden rounded"></div><div class="flex min-w-0 flex-1 overflow-hidden"><button class="select-text truncate font-bold hover:text-blue-500 hover:underline"></button><span class=shrink-0>'),jn=d('<div class="ml-7 whitespace-pre-wrap break-all rounded border border-zinc-300 px-1 text-sm">'),Hn=d('<div class="notification-event py-1">'),On=d("<div class=truncate>"),Qn=e=>{const t=I(),{shouldMuteEvent:r}=k(),{showProfile:s}=ue(),l=D(()=>Le(e.event)),{profile:o}=Q(()=>({pubkey:l().senderPubkey()})),{profile:c,query:i}=Q(()=>A([l().zappedPubkey()])(([g])=>({pubkey:g}))),{event:a,query:y}=oe(()=>A([l().zappedEventId()])(([g])=>({eventId:g}))),h=X(()=>({queryKey:["fetchLnurlPayRequestMetadata",c()],queryFn:({queryKey:g})=>{const[,w]=g;if(w!=null)return Me(w)},staleTime:5*60*1e3,gcTime:3*24*60*60*1e3})),m=()=>{const g=c(),w=i.data,f=h.data;if(g==null||w==null||f==null||!(f.allowsNostr&&f.nostrPubkey!=null))return!1;const $=qe(g);if($==null)return null;const v=f.nostrPubkey,C=Be({zapReceipt:l().rawEvent,lnurlPayUrl:$,lnurlProviderPubkey:v});return console.log("result",C),C.success},x=()=>y.isSuccess&&a()==null;return n(b,{get when(){return D(()=>!x()&&!r(e.event))()&&m()},get children(){return[(()=>{const g=zn(),w=g.firstChild,f=w.firstChild,$=f.nextSibling,v=w.nextSibling,C=v.firstChild,S=C.nextSibling,p=S.firstChild,E=p.nextSibling;return u(f,n(Un,{})),u($,()=>l().amountSats()),u(C,n(b,{get when(){return o()?.picture!=null},get children(){const G=Dn();return z(()=>L(G,"src",o()?.picture)),G}})),p.$$click=()=>s(l().senderPubkey()),u(p,n(ce,{get pubkey(){return l().senderPubkey()}})),u(E,()=>t()("notification.zapped")),g})(),n(b,{get when(){return l().description().content.length>0},get children(){const g=jn();return u(g,()=>l().description().content),g}}),(()=>{const g=Hn();return u(g,n(b,{get when(){return a()},get fallback(){return(()=>{const w=On();return u(w,()=>t()("general.loading")),w})()},get children(){return n(te,{get eventId(){return l().zappedEventId()}})}})),g})()]}})};B(["click"]);const An=d("<div>unknown event"),ae=e=>{const{shouldMuteEvent:t}=k();return n(V,{get each(){return e.events},children:r=>n(b,{get when(){return!t(r)},get children(){return n(K,{get fallback(){return An()},get children(){return[n(_,{get when(){return r.kind===re},get children(){return n(U,{get children(){return n(se,{event:r})}})}}),n(_,{get when(){return r.kind===Ne},get children(){return n(U,{get children(){return n(Bn,{event:r})}})}}),n(_,{get when(){return r.kind===Ue},get children(){return n(U,{get children(){return n(De,{event:r})}})}}),n(_,{get when(){return r.kind===ze},get children(){return n(U,{get children(){return n(Qn,{event:r})}})}})]}})}})})},Kn=e=>{const t=I(),{config:r,removeColumn:s}=k(),{events:l}=P(()=>({relayUrls:r().relayUrls,filters:[{kinds:[1,6,7,9735],"#p":[e.column.pubkey],limit:10}],clientEventFilter:o=>e.column.contentFilter==null?!0:T(e.column.contentFilter)(o.content)}));return n(R,{get header(){return n(N,{get name(){return e.column.name??t()("column.notification")},get icon(){return n(je,{})},settings:()=>n(F,{get column(){return e.column},get columnIndex(){return e.columnIndex}}),onClose:()=>s(e.column.id)})},get width(){return e.column.width},get columnIndex(){return e.columnIndex},get lastColumn(){return e.lastColumn},get children(){return n(ae,{get events(){return l()}})}})},Vn=e=>{const t=I(),{config:r,removeColumn:s}=k(),{events:l}=P(()=>({relayUrls:r().relayUrls,filters:[{kinds:[1,6],authors:[e.column.pubkey],limit:10}],clientEventFilter:o=>e.column.contentFilter==null?!0:T(e.column.contentFilter)(o.content)}));return n(R,{get header(){return n(N,{get name(){return e.column.name??t()("column.posts")},get icon(){return n(He,{})},settings:()=>n(F,{get column(){return e.column},get columnIndex(){return e.columnIndex}}),onClose:()=>s(e.column.id)})},get width(){return e.column.width},get columnIndex(){return e.columnIndex},get lastColumn(){return e.lastColumn},get children(){return n(j,{get events(){return l()}})}})},Gn=e=>{const t=I(),{config:r,removeColumn:s}=k(),{events:l}=P(()=>({relayUrls:r().relayUrls,filters:[{kinds:[7],authors:[e.column.pubkey],limit:10}],clientEventFilter:o=>e.column.contentFilter==null?!0:T(e.column.contentFilter)(o.content)}));return n(R,{get header(){return n(N,{get name(){return e.column.name??t()("column.reactions")},get icon(){return n(Oe,{})},settings:()=>n(F,{get column(){return e.column},get columnIndex(){return e.columnIndex}}),onClose:()=>s(e.column.id)})},get width(){return e.column.width},get columnIndex(){return e.columnIndex},get lastColumn(){return e.lastColumn},get children(){return n(ae,{get events(){return l()}})}})},Zn=e=>{const t=I(),{removeColumn:r}=k(),{events:s}=P(()=>({relayUrls:e.column.relayUrls,filters:[{kinds:[1],limit:25,since:le()-4*60*60}],clientEventFilter:l=>e.column.contentFilter==null?!0:T(e.column.contentFilter)(l.content)}));return n(R,{get header(){return n(N,{get name(){return e.column.name??t()("column.relay")},get icon(){return n(Qe,{})},settings:()=>n(F,{get column(){return e.column},get columnIndex(){return e.columnIndex}}),onClose:()=>r(e.column.id)})},get width(){return e.column.width},get columnIndex(){return e.columnIndex},get lastColumn(){return e.lastColumn},get children(){return n(j,{get events(){return s()}})}})},Wn=d('<div class="flex flex-col"><div class="flex h-8 items-center gap-1 px-2"><h2 class="flex items-center gap-1"><span class="inline-block h-4 w-4 text-gray-700"></span></h2><form class=flex-1><input class="w-full rounded border border-stone-300 px-1 py-0 focus:border-rose-100 focus:ring-rose-300"type=text name=query></form><button class="h-4 w-4">'),Jn=e=>{const[t,r]=M(!1),[s,l]=M(""),{saveColumn:o}=k(),c=()=>r(m=>!m),i=()=>{s()!==e.column.query&&o({...e.column,query:s()})},a=()=>{i()},y=m=>{l(m.currentTarget.value)},h=m=>{m.preventDefault(),i()};return O(()=>{l(e.column.query)}),(()=>{const m=Wn(),x=m.firstChild,g=x.firstChild,w=g.firstChild,f=g.nextSibling,$=f.firstChild,v=f.nextSibling;return u(w,n(Ae,{})),f.addEventListener("submit",h),$.addEventListener("blur",a),$.addEventListener("change",y),v.$$click=()=>c(),u(v,n(ie,{})),u(m,n(b,{get when(){return t()},get children(){return e.settings()}}),null),z(()=>$.value=s()),m})()},Xn=e=>{const{removeColumn:t}=k(),{events:r}=P(()=>{const{query:s}=e.column;return s.length===0?null:{relayUrls:Ke,filters:[{kinds:[1,6],search:s,limit:25}],clientEventFilter:l=>l.tags.findIndex(([o])=>o==="mostr"||o==="proxy")>=0?!1:e.column.contentFilter==null?!0:T(e.column.contentFilter)(l.content)}});return n(R,{get header(){return n(Jn,{get column(){return e.column},settings:()=>n(F,{get column(){return e.column},get columnIndex(){return e.columnIndex}}),onClose:()=>t(e.column.id)})},get width(){return e.column.width},get columnIndex(){return e.columnIndex},get lastColumn(){return e.lastColumn},get children(){return n(j,{get events(){return r()}})}})};B(["click"]);const Yn=d('<div class="scrollbar flex h-full snap-x snap-mandatory flex-row overflow-x-scroll scroll-smooth">'),et=()=>{const{config:e}=k();return(()=>{const t=Yn();return u(t,n(V,{get each(){return e().columns},children:(r,s)=>{const l=()=>s()+1,o=()=>l()===e().columns.length;return n(K,{get children(){return[n(_,{get when(){return r.columnType==="Following"&&r},keyed:!0,children:c=>n(Rn,{column:c,get columnIndex(){return l()},get lastColumn(){return o()}})}),n(_,{get when(){return r.columnType==="Notification"&&r},keyed:!0,children:c=>n(Kn,{column:c,get columnIndex(){return l()},get lastColumn(){return o()}})}),n(_,{get when(){return r.columnType==="Posts"&&r},keyed:!0,children:c=>n(Vn,{column:c,get columnIndex(){return l()},get lastColumn(){return o()}})}),n(_,{get when(){return r.columnType==="Reactions"&&r},keyed:!0,children:c=>n(Gn,{column:c,get columnIndex(){return l()},get lastColumn(){return o()}})}),n(_,{get when(){return r.columnType==="Relays"&&r},keyed:!0,children:c=>n(Zn,{column:c,get columnIndex(){return l()},get lastColumn(){return o()}})}),n(_,{get when(){return r.columnType==="Bookmark"&&r},keyed:!0,children:c=>n(Pn,{column:c,get columnIndex(){return l()},get lastColumn(){return o()}})}),n(_,{get when(){return r.columnType==="Search"&&r},keyed:!0,children:c=>n(Xn,{column:c,get columnIndex(){return l()},get lastColumn(){return o()}})})]}})}})),t})()},nt=[{key:"n",command:{command:"openPostForm"}},{key:"h",command:{command:"moveToPrevColumn"}},{key:"j",command:{command:"moveToNextItem"}},{key:"k",command:{command:"moveToPrevItem"}},{key:"l",command:{command:"moveToNextColumn"}},{key:"1",command:{command:"moveToColumn",columnIndex:1}},{key:"2",command:{command:"moveToColumn",columnIndex:2}},{key:"3",command:{command:"moveToColumn",columnIndex:3}},{key:"4",command:{command:"moveToColumn",columnIndex:4}},{key:"5",command:{command:"moveToColumn",columnIndex:5}},{key:"6",command:{command:"moveToColumn",columnIndex:6}},{key:"7",command:{command:"moveToColumn",columnIndex:7}},{key:"8",command:{command:"moveToColumn",columnIndex:8}},{key:"9",command:{command:"moveToColumn",columnIndex:9}},{key:"0",command:{command:"moveToLastColumn"}},{key:"ArrowLeft",command:{command:"moveToPrevColumn"}},{key:"ArrowDown",command:{command:"moveToNextItem"}},{key:"ArrowUp",command:{command:"moveToPrevItem"}},{key:"ArrowRight",command:{command:"moveToNextColumn"}},{key:"f",command:{command:"like"}},{key:"t",command:{command:"repost"}},{key:"r",command:{command:"openReplyForm"}},{key:"?",command:{command:"openHelp"}},{key:"Enter",command:{command:"openItemDetail"}},{key:"Backspace",command:{command:"closeItemDetail"}}],tt=e=>{const t=new Map;return e.forEach(r=>{t.set(r.key,r)}),t},rt=({shortcuts:e=nt,onShortcut:t})=>{const r=tt(e);O(()=>{const s=Ve(l=>{if(l.type!=="keydown"||l.ctrlKey||l.altKey||l.metaKey||l.target instanceof HTMLTextAreaElement||l.target instanceof HTMLInputElement)return;const o=r.get(l.key);o!=null&&t(o)},50);window.addEventListener("keydown",s),Y(()=>{window.removeEventListener("keydown",s)})})},lt=()=>{const e=ee();rt({onShortcut:t=>{e(t.command).then(()=>console.debug(`shortcut key '${t.key}' was processed successfully`),r=>console.error(r))}})},ot=d('<div class="absolute inset-0 flex w-screen touch-manipulation flex-row overflow-hidden">'),it=()=>{lt();const e=he(),{persistStatus:t}=Je(),r=We(),{config:s,initializeColumns:l}=k(),o=ne();return H(()=>{s().relayUrls.map(async c=>{try{const i=await r().ensureRelay(c);i.onnotice=a=>{console.error(`NOTICE: ${c}: ${a}`)},i.onclose=()=>{console.warn(`CLOSE: ${c}`)}}catch(i){console.error("ensureRelay failed",i)}})}),H(()=>{const c=o();c!=null&&l({pubkey:c})}),O(()=>{t().loggedIn||e("/hello")}),ve(c=>{console.error("uncaught error: ",c)}),(()=>{const c=ot();return u(c,n(Ge,{}),null),u(c,n(et,{}),null),u(c,n(Ze,{}),null),c})()};export{it as default};
//# sourceMappingURL=Home-121a5643.js.map
