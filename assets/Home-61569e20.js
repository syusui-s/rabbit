import{s as O,t as g,d as U,c as E,i as d,a as n,S as b,M as I,b as G,u as k,e as oe,f as $e,g as T,h as Y,j as F,k as xe,F as K,l as q,T as ke,m as we,n as se,o as S,p as P,q as be,r as ce,v as Ce,w as ie,x as ee,y as Z,z as ue,A as _e,B as pe,C as Ie,D as Te,E as Ee,G as Re,H as Se,R as Le,I as Pe,Z as Me,J as Fe,K as Ue,L as Be}from"./index-0812911d.js";import{A as De}from"./arrow-left-4d90b126.js";import{u as B,T as z,a as Ne,b as qe,C as M,E as ae,c as Oe,d as He,e as je,f as Ae,t as ze,g as de,h as Ve,R as Ke}from"./useFollowings-db1d2404.js";import{u as ne,a as me,b as ge,p as Ze,r as Qe,t as Ge,B as Je,e as te,c as We,d as Q,f as V,U as he,g as fe,h as Xe,S as Ye,G as en,i as nn}from"./SideBar-e7f532c2.js";import{H as tn,B as rn,M as ln}from"./magnifying-glass-3d77722b.js";import{U as on}from"./user-c3a4cc80.js";import{H as sn,G as cn}from"./globe-alt-10a73e09.js";import{u as un}from"./usePersistStatus-8f0580a5.js";import"./LazyLoad-ff3bf7fe.js";const an=g('<svg xmlns=http://www.w3.org/2000/svg fill=none stroke=currentColor stroke-width=1.5 aria-hidden=true data-slot=icon viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round d="M17.593 3.322c1.1.128 1.907 1.077 1.907 2.185V21L12 17.25 4.5 21V5.507c0-1.108.806-2.057 1.907-2.185a48.507 48.507 0 0 1 11.186 0">'),dn=(e={})=>(()=>{const t=an();return O(t,e,!0,!0),t})(),mn=g('<svg xmlns=http://www.w3.org/2000/svg fill=none stroke=currentColor stroke-width=1.5 aria-hidden=true data-slot=icon viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round d="M12 6.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5m0 6a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5m0 6a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5">'),ve=(e={})=>(()=>{const t=mn();return O(t,e,!0,!0),t})(),gn=g('<div class="flex flex-col"><div class="flex h-8 items-center gap-1"><h2 class="flex min-w-0 flex-1 items-center gap-1 ps-2"><span class=truncate></span></h2><button class="flex h-full place-items-center px-2"><span class="inline-block h-4 w-4">'),hn=g('<span class="inline-block h-4 w-4 shrink-0 text-fg-secondary">'),H=e=>{const[t,r]=E(!1),i=()=>r(l=>!l);return(()=>{const l=gn(),o=l.firstChild,s=o.firstChild,c=s.firstChild,u=s.nextSibling,h=u.firstChild;return d(s,n(b,{get when(){return e.icon},keyed:!0,children:f=>(()=>{const m=hn();return d(m,f),m})()}),c),d(c,()=>e.name),u.$$click=()=>i(),d(h,n(ve,{})),d(l,n(b,{get when(){return t()},get children(){return e.settings()}}),null),l})()};U(["click"]);const fn=e=>{const t=[e.id],r=e.rootEvent()?.id;r!=null&&t.push(r);const i=e.replyingToEvent()?.id;return i!=null&&t.push(i),oe(t)},vn=e=>{const{config:t}=k(),r=()=>$e(e.event),{events:i}=B(()=>({relayUrls:t().relayUrls,filters:[{kinds:[1],ids:fn(r()),limit:25},{kinds:[1],"#e":[e.event.id],limit:25}],limit:200}));return n(z,{get events(){return[...i()].reverse()}})},yn=e=>n(G,{get children(){return n(I,{get when(){return e.timelineContent.type==="Replies"&&e.timelineContent},keyed:!0,children:t=>n(vn,{get event(){return t.event}})})}}),$n=g('<div class="flex w-[80vw] shrink-0 snap-center snap-always flex-col border-r border-border sm:snap-align-none">'),xn=g('<div class="shrink-0 border-b border-border">'),kn=g('<div class="scrollbar flex flex-col overflow-y-scroll pb-16">'),wn=g('<div class="flex shrink-0 items-center border-b border-border px-2"><button class="flex w-full items-center gap-1"><div class="inline-block h-4 w-4"></div><div>'),bn=g('<div class="scrollbar flex max-h-full flex-col overflow-y-scroll scroll-smooth pb-16">'),D=e=>{let t;const r=Ne(),i=T(),l=()=>e.width??"medium";return ne(()=>({commandType:"moveToColumn",handler:o=>{o.command==="moveToColumn"&&o.columnIndex===e.columnIndex&&t?.scrollIntoView({behavior:"smooth",inline:"center"})}})),ne(()=>({commandType:"moveToLastColumn",handler:()=>{e.lastColumn&&t?.scrollIntoView({behavior:"smooth"})}})),n(qe.Provider,{value:r,get children(){const o=$n(),s=t;return typeof s=="function"?Y(s,o):t=o,d(o,n(b,{get when(){return r.timelineState.content},keyed:!0,get fallback(){return[(()=>{const c=xn();return d(c,()=>e.header),c})(),(()=>{const c=kn(),u=e.timelineRef;return typeof u=="function"?Y(u,c):e.timelineRef=c,d(c,()=>e.children),c})()]},children:c=>[(()=>{const u=wn(),h=u.firstChild,f=h.firstChild,m=f.nextSibling;return h.$$click=()=>r?.clearTimeline(),d(f,n(De,{})),d(m,()=>i()("column.back")),u})(),(()=>{const u=bn();return d(u,n(yn,{timelineContent:c})),u})()]})),F(c=>xe(o,{"sm:w-[500px]":l()==="widest","sm:w-[360px]":l()==="wide","sm:w-[320px]":l()==="medium","sm:w-[280px]":l()==="narrow"},c)),o}})};U(["click"]);const Cn=g('<svg xmlns=http://www.w3.org/2000/svg fill=none stroke=currentColor stroke-width=1.5 aria-hidden=true data-slot=icon viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round d="M15.75 19.5 8.25 12l7.5-7.5">'),_n=(e={})=>(()=>{const t=Cn();return O(t,e,!0,!0),t})(),pn=g('<svg xmlns=http://www.w3.org/2000/svg fill=none stroke=currentColor stroke-width=1.5 aria-hidden=true data-slot=icon viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round d="m8.25 4.5 7.5 7.5-7.5 7.5">'),In=(e={})=>(()=>{const t=pn();return O(t,e,!0,!0),t})(),Tn=g('<svg xmlns=http://www.w3.org/2000/svg fill=none stroke=currentColor stroke-width=1.5 aria-hidden=true data-slot=icon viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0">'),En=(e={})=>(()=>{const t=Tn();return O(t,e,!0,!0),t})(),Rn=g('<div class="flex flex-col gap-2 border-b border-border p-2"><div></div><div>'),Sn=g('<div class="scrollbar flex h-9 gap-2 overflow-x-scroll">'),Ln=g('<div class="flex flex-col border-t border-border"><div class="flex h-10 items-center gap-2"><button class="py-4 pl-2"><span class="inline-block h-4 w-4"></span></button><button class="py-4 pr-2"><span class="inline-block h-4 w-4"></span></button><div class=flex-1></div><button class="px-2 py-4 text-danger hover:text-rose-600"><span class="inline-block h-4 w-4">'),Pn=g('<button class="rounded-md border px-4 text-fg-secondary">'),Mn=e=>(()=>{const t=Rn(),r=t.firstChild,i=r.nextSibling;return d(r,()=>e.title),d(i,()=>e.children),t})(),N=e=>{const t=T(),{saveColumn:r,removeColumn:i,moveColumn:l}=k(),o=me(),s=u=>{r({...e.column,width:u})},c=u=>{l(e.column.id,u),o({command:"moveToColumn",columnIndex:u}).catch(h=>console.error(h))};return(()=>{const u=Ln(),h=u.firstChild,f=h.firstChild,m=f.firstChild,a=f.nextSibling,v=a.firstChild,w=a.nextSibling,C=w.nextSibling,p=C.firstChild;return d(u,n(Mn,{get title(){return t()("column.config.columnWidth")},get children(){const y=Sn();return d(y,n(K,{each:["widest","wide","medium","narrow"],children:_=>(()=>{const x=Pn();return x.$$click=()=>s(_),d(x,()=>t()(`column.config.${_}`)),F($=>{const L=e.column.width===_,J=e.column.width===_,W=e.column.width!==_,X=e.column.width!==_;return L!==$._v$5&&x.classList.toggle("border-fg-secondary",$._v$5=L),J!==$._v$6&&x.classList.toggle("font-bold",$._v$6=J),W!==$._v$7&&x.classList.toggle("border-border",$._v$7=W),X!==$._v$8&&x.classList.toggle("font-normal",$._v$8=X),$},{_v$5:void 0,_v$6:void 0,_v$7:void 0,_v$8:void 0}),x})()})),y}}),h),f.$$click=()=>c(e.columnIndex-1),d(m,n(_n,{})),a.$$click=()=>c(e.columnIndex+1),d(v,n(In,{})),C.$$click=()=>i(e.column.id),d(p,n(En,{})),F(y=>{const _=t()("column.config.moveLeft"),x=t()("column.config.moveRight"),$=t()("column.config.removeColumn"),L=t()("column.config.removeColumn");return _!==y._v$&&q(f,"title",y._v$=_),x!==y._v$2&&q(a,"title",y._v$2=x),$!==y._v$3&&q(C,"title",y._v$3=$),L!==y._v$4&&q(p,"aria-label",y._v$4=L),y},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0}),u})()};U(["click"]);class Fn extends we{constructor(t){super(),this.tags=t}}const Un=e=>{try{const t=ke.parse(JSON.parse(e));return new Fn(t)}catch(t){throw new TypeError("failed to parse tags schema: ",{cause:t})}},[re,Bn]=se(()=>E({})),[Dn,Nn]=se(()=>E({})),qn=e=>{const t=ge(),[r,i]=E(null);return S(()=>{const l=e();if(l==null)return;const{encrypted:o}=l;if(o in re()){i(re()[o]);return}const s=t();s!=null&&(Dn()[o]||(Nn(c=>({...c,[o]:!0})),window.nostr?.nip04?.decrypt?.(s,o)?.then(c=>{Bn(u=>({...u,[o]:c})),i(c)}).catch(c=>{console.error(`failed to decrypt "${o}"`,c)})))}),r},On=e=>{const t=P(()=>be(e.event)),r=qn(()=>{const{content:o}=t();return o==null||o.length===0?null:{id:t().id,encrypted:o}}),i=()=>{const o=r();if(o==null)return[];console.log(o);try{return Un(o).taggedEventIds()}catch(s){return console.warn(s),[]}},l=()=>t().taggedEventIds();return n(K,{get each(){return[...l(),...i()]},children:o=>n(M,{get children(){return n(ae,{eventId:o,get ensureKinds(){return[ce]}})}})})},Hn=e=>{const t=Ce(),r=P(e),i=()=>["useFollowings",r()],l=ie(()=>({queryKey:i(),queryFn:({queryKey:s,signal:c})=>{console.debug("useFollowings");const[,u]=s;if(u==null)return Promise.resolve(null);const{kind:h,author:f,identifier:m}=u,a=new Je({type:"ParameterizedReplaceableEvent",kind:h,author:f,identifier:m}),v=a.firstEventPromise().catch(()=>{throw new Error(`parameterized replaceable event not found: ${h}:${f}:${m}`)});return a.onUpdate(w=>{const C=Ze(w);t.setQueryData(s,C)}),Qe({task:a,signal:c}),Ge(15e3,`useParameterizedReplaceableEvent: ${h}:${f}:${m}`)(v)},staleTime:5*60*1e3,gcTime:4*60*60*1e3}));return{event:()=>l.data??null,query:l}},jn=e=>{const t=T(),{removeColumn:r}=k(),{event:i}=Hn(()=>({kind:30001,author:e.column.pubkey,identifier:e.column.identifier}));return n(D,{get header(){return n(H,{get name(){return e.column.name??t()("column.bookmark")},get icon(){return n(dn,{})},settings:()=>n(N,{get column(){return e.column},get columnIndex(){return e.columnIndex}}),onClose:()=>r(e.column.id)})},get width(){return e.column.width},get columnIndex(){return e.columnIndex},get lastColumn(){return e.lastColumn},get children(){return n(b,{get when(){return i()},keyed:!0,children:l=>n(On,{event:l})})}})},An=()=>{const[e,t]=E();return{targetRef:t,currentPosition:()=>e()?.scrollTop??0,scrollToTop:()=>{const o=e();o?.scrollTo(0,0)},scrollToBottom:()=>{const o=e();o?.scrollTo(0,o.scrollHeight)}}},zn=g('<button class="flex h-12 w-full flex-col items-center justify-center hover:text-fg-secondary"><span>'),Vn=g('<button class="flex h-12 w-full flex-col items-center justify-center hover:text-fg-secondary disabled:text-fg-secondary/30"><span>'),j=e=>{const t=P(e),r=v=>{const{duration:w}=t();if(w!=null)return v-w},[i,l]=E([]),[o,s]=E(r(te())),[c,u]=E(),h=()=>c()==null,f=An(),m=()=>{ee(()=>{u(void 0),s(r(te()))}),f.scrollToTop()},a=()=>{const v=We(i());v!=null&&(ee(()=>{u(v.created_at),s(r(v.created_at))}),f.scrollToTop())};return{timelineRef:f.targetRef,setEvents:l,since:o,until:c,continuous:h,loadLatest:m,loadOld:a}},A=e=>{const t=T();return[n(b,{get when(){return!e.loadMore.continuous()},get children(){return n(M,{get children(){const r=zn(),i=r.firstChild;return r.$$click=()=>e.loadMore.loadLatest(),d(i,()=>t()("column.loadLatest")),r}})}}),P(()=>e.children),n(M,{get children(){const r=Vn(),i=r.firstChild;return r.$$click=()=>e.loadMore.loadOld(),d(i,()=>t()("column.loadOld")),F(()=>r.disabled=!e.eose),r}})]};U(["click"]);const R=e=>t=>{switch(e.filterType){case"AND":return e.children.every(r=>R(r)(t));case"OR":return e.children.some(r=>R(r)(t));case"NOT":return!R(e.child)(t);case"Text":return t.includes(e.text);case"Regex":return new RegExp(e.regex,e.flag).test(t);default:console.error("unsupported content filter type");break}return!1},Kn=e=>{const t=T(),{config:r,removeColumn:i}=k(),{followingPubkeys:l}=Oe(()=>({pubkey:e.column.pubkey})),o=j(()=>({duration:4*60*60})),{events:s,eose:c}=B(()=>{const u=oe([...l()]);return u.length===0?null:{debugId:"following",relayUrls:r().relayUrls,filters:[{kinds:[1,6],authors:u,limit:20,since:o.since(),until:o.until()}],eoseLimit:20,continuous:o.continuous(),onEOSE:()=>{console.log("home: eose")},clientEventFilter:h=>e.column.contentFilter==null?!0:R(e.column.contentFilter)(h.content)}});return S(()=>{console.log("home",s()),o.setEvents(s())}),Z(()=>console.log("home timeline mounted")),ue(()=>console.log("home timeline unmounted")),n(D,{get header(){return n(H,{get name(){return e.column.name??t()("column.home")},get icon(){return n(tn,{})},settings:()=>n(N,{get column(){return e.column},get columnIndex(){return e.columnIndex}}),onClose:()=>i(e.column.id)})},get width(){return e.column.width},get columnIndex(){return e.columnIndex},get lastColumn(){return e.lastColumn},get timelineRef(){return o.timelineRef},get children(){return n(A,{loadMore:o,get eose(){return c()},get children(){return n(z,{get events(){return s()}})}})}})},Zn=g('<div class="flex items-center gap-1 pl-[2px] text-sm"><div class="notification-icon flex max-w-[64px] place-items-center"></div><div class="notification-user flex flex-1 gap-1 overflow-hidden"><div class="author-icon h-5 w-5 shrink-0 overflow-hidden rounded"></div><div class="flex min-w-0 flex-1 overflow-hidden"><button class="select-text truncate font-bold hover:text-link hover:underline"></button><span class=shrink-0></span></div></div><div class=text-xs>'),Qn=g('<div class="notification-event py-1">'),Gn=g('<img alt=icon class="h-full w-full object-cover">'),Jn=g("<div class=truncate> "),Wn=e=>{const t=T(),r=He(),{shouldMuteEvent:i}=k(),{showProfile:l}=fe(),o=()=>_e(e.event),s=()=>o().lastTaggedEventId(),{profile:c}=Q(()=>({pubkey:e.event.pubkey})),{event:u,query:h}=je(()=>V([s()])(([m])=>({eventId:m}))),f=()=>h.isSuccess&&u()==null;return n(b,{get when(){return P(()=>!f())()&&!i(e.event)},get children(){return[(()=>{const m=Zn(),a=m.firstChild,v=a.nextSibling,w=v.firstChild,C=w.nextSibling,p=C.firstChild,y=p.nextSibling,_=v.nextSibling;return d(a,n(Ae,{get reactionTypes(){return o().toReactionTypes()}})),d(w,n(b,{get when(){return c()?.picture},keyed:!0,children:x=>(()=>{const $=Gn();return F(()=>q($,"src",ze(x))),$})()})),p.$$click=()=>l(e.event.pubkey),d(p,n(he,{get pubkey(){return e.event.pubkey}})),d(y,()=>t()("notification.reacted")),d(_,()=>r(o().createdAtAsDate())),m})(),(()=>{const m=Qn();return d(m,n(b,{get when(){return u()},get fallback(){return(()=>{const a=Jn(),v=a.firstChild;return d(a,()=>t()("general.loading"),v),d(a,s,null),a})()},keyed:!0,children:a=>n(de,{event:a})})),m})()]}})};U(["click"]);const Xn=g('<svg xmlns=http://www.w3.org/2000/svg fill=currentColor aria-hidden=true data-slot=icon viewBox="0 0 24 24"><path fill-rule=evenodd d="M14.615 1.595a.75.75 0 0 1 .359.852L12.982 9.75h7.268a.75.75 0 0 1 .548 1.262l-10.5 11.25a.75.75 0 0 1-1.272-.71l1.992-7.302H3.75a.75.75 0 0 1-.548-1.262l10.5-11.25a.75.75 0 0 1 .913-.143"clip-rule=evenodd>'),Yn=(e={})=>(()=>{const t=Xn();return O(t,e,!0,!0),t})(),le=e=>{const t=P(e),r=ie(()=>({queryKey:["useLnurlEndpoint",t()],queryFn:({queryKey:c})=>{const[,u]=c;if(u!=null)return pe(u.lnurlPayUrl)},staleTime:5*60*1e3,gcTime:3*24*60*60*1e3})),i=()=>{const{data:c}=r;return c==null||"status"in c&&c.status==="ERROR"?null:c},l=()=>{const c=i();return c==null?!1:!!c.allowsNostr&&c.nostrPubkey!=null&&Ie(c.nostrPubkey)},o=c=>{const u=t()?.lnurlPayUrl;if(u==null)return{success:!1,reason:"lnurlPayUrl is null"};const h=i();if(h==null)return{success:!1,reason:"metadata is not fetched"};if(!l())return{success:!1,reason:"nostr is not allowed"};const f=h.nostrPubkey;return f==null?{success:!1,reason:"nostrPubkey is null"}:Te({zapReceipt:c,lnurlPayUrl:u,lnurlProviderPubkey:f})};return{endpoint:i,allowsNostr:l,isZapReceiptVerified:c=>o(c).success,query:r}},et=g('<img alt=icon class="h-full w-full object-cover">'),nt=g('<div class="flex items-center gap-1 text-sm"><div class="flex w-6 flex-col items-center"><div class="h-4 w-4 shrink-0 text-amber-500"aria-hidden=true></div><div class="mt-[-2px] shrink-0 text-xs"></div></div><div class="notification-user flex gap-1 overflow-hidden"><div class="author-icon h-5 w-5 shrink-0 overflow-hidden rounded"></div><div class="flex min-w-0 flex-1 overflow-hidden"><button class="select-text truncate font-bold hover:text-link hover:underline"></button><span class=shrink-0>'),tt=g('<div class="ml-7 whitespace-pre-wrap break-all rounded border border-border px-1 text-sm">'),rt=g('<div class="notification-event py-1">'),lt=e=>{const t=T(),{shouldMuteEvent:r}=k(),{showProfile:i}=fe(),l=P(()=>Ee(e.event)),{profile:o}=Q(()=>({pubkey:l().senderPubkey()})),{profile:s}=Q(()=>V([l().zappedPubkey()])(([a])=>({pubkey:a}))),c=()=>{const a=s()?.lud06;return a==null?null:Re(a)},u=()=>{const a=s()?.lud16;return a==null?null:Se(a)},h=le(()=>V([c()])(([a])=>({lnurlPayUrl:a}))),f=le(()=>V([u()])(([a])=>({lnurlPayUrl:a}))),m=()=>h.isZapReceiptVerified(e.event)||f.isZapReceiptVerified(e.event);return n(b,{get when(){return P(()=>!r(e.event))()&&m()},get children(){return[(()=>{const a=nt(),v=a.firstChild,w=v.firstChild,C=w.nextSibling,p=v.nextSibling,y=p.firstChild,_=y.nextSibling,x=_.firstChild,$=x.nextSibling;return d(w,n(Yn,{})),d(C,()=>Ve(l().amountSats())),d(y,n(b,{get when(){return o()?.picture!=null},get children(){const L=et();return F(()=>q(L,"src",o()?.picture)),L}})),x.$$click=()=>i(l().senderPubkey()),d(x,n(he,{get pubkey(){return l().senderPubkey()}})),d($,()=>t()("notification.zapped")),a})(),n(b,{get when(){return l().description().content.length>0},get children(){const a=tt();return d(a,()=>l().description().content),a}}),n(b,{get when(){return l().zappedEventId()!=null},get children(){const a=rt();return d(a,n(ae,{get eventId(){return l().zappedEventId()}})),a}})]}})};U(["click"]);const ot=g("<div>unknown event"),ye=e=>{const{shouldMuteEvent:t}=k();return n(K,{get each(){return e.events},children:r=>n(b,{get when(){return!t(r)},get children(){return n(G,{get fallback(){return ot()},get children(){return[n(I,{get when(){return r.kind===ce},get children(){return n(M,{get children(){return n(de,{event:r})}})}}),n(I,{get when(){return r.kind===Le},get children(){return n(M,{get children(){return n(Wn,{event:r})}})}}),n(I,{get when(){return r.kind===Pe},get children(){return n(M,{get children(){return n(Ke,{event:r})}})}}),n(I,{get when(){return r.kind===Me},get children(){return n(M,{get children(){return n(lt,{event:r})}})}})]}})}})})},st=e=>{const t=T(),{config:r,removeColumn:i}=k(),l=j(()=>({duration:null})),{events:o,eose:s}=B(()=>({relayUrls:r().relayUrls,filters:[{kinds:[1,6,7,9735],"#p":[e.column.pubkey],limit:20,since:l.since(),until:l.until()}],eoseLimit:20,clientEventFilter:c=>e.column.contentFilter==null?!0:R(e.column.contentFilter)(c.content)}));return S(()=>l.setEvents(o())),n(D,{get header(){return n(H,{get name(){return e.column.name??t()("column.notification")},get icon(){return n(rn,{})},settings:()=>n(N,{get column(){return e.column},get columnIndex(){return e.columnIndex}}),onClose:()=>i(e.column.id)})},get width(){return e.column.width},get columnIndex(){return e.columnIndex},get lastColumn(){return e.lastColumn},get timelineRef(){return l.timelineRef},get children(){return n(A,{loadMore:l,get eose(){return s()},get children(){return n(ye,{get events(){return o()}})}})}})},ct=e=>{const t=T(),{config:r,removeColumn:i}=k(),l=j(()=>({duration:null})),{events:o,eose:s}=B(()=>({relayUrls:r().relayUrls,filters:[{kinds:[1,6],authors:[e.column.pubkey],limit:10,since:l.since(),until:l.until()}],eoseLimit:10,clientEventFilter:c=>e.column.contentFilter==null?!0:R(e.column.contentFilter)(c.content)}));return S(()=>l.setEvents(o())),n(D,{get header(){return n(H,{get name(){return e.column.name??t()("column.posts")},get icon(){return n(on,{})},settings:()=>n(N,{get column(){return e.column},get columnIndex(){return e.columnIndex}}),onClose:()=>i(e.column.id)})},get width(){return e.column.width},get columnIndex(){return e.columnIndex},get lastColumn(){return e.lastColumn},get timelineRef(){return l.timelineRef},get children(){return n(A,{loadMore:l,get eose(){return s()},get children(){return n(z,{get events(){return o()}})}})}})},it=e=>{const t=T(),{config:r,removeColumn:i}=k(),l=j(()=>({duration:null})),{events:o,eose:s}=B(()=>({relayUrls:r().relayUrls,filters:[{kinds:[7],authors:[e.column.pubkey],limit:10,since:l.since(),until:l.until()}],eoseLimit:10,clientEventFilter:c=>e.column.contentFilter==null?!0:R(e.column.contentFilter)(c.content)}));return S(()=>l.setEvents(o())),n(D,{get header(){return n(H,{get name(){return e.column.name??t()("column.reactions")},get icon(){return n(sn,{})},settings:()=>n(N,{get column(){return e.column},get columnIndex(){return e.columnIndex}}),onClose:()=>i(e.column.id)})},get width(){return e.column.width},get columnIndex(){return e.columnIndex},get lastColumn(){return e.lastColumn},get timelineRef(){return l.timelineRef},get children(){return n(A,{loadMore:l,get eose(){return s()},get children(){return n(ye,{get events(){return o()}})}})}})},ut=e=>{const t=T(),{removeColumn:r}=k(),i=j(()=>({duration:4*60*60})),{events:l,eose:o}=B(()=>({relayUrls:e.column.relayUrls,filters:[{kinds:[1],limit:20,since:i.since(),until:i.until()}],eoseLimit:20,clientEventFilter:s=>e.column.contentFilter==null?!0:R(e.column.contentFilter)(s.content)}));return S(()=>i.setEvents(l())),n(D,{get header(){return n(H,{get name(){return e.column.name??t()("column.relay")},get icon(){return n(cn,{})},settings:()=>n(N,{get column(){return e.column},get columnIndex(){return e.columnIndex}}),onClose:()=>r(e.column.id)})},get width(){return e.column.width},get columnIndex(){return e.columnIndex},get lastColumn(){return e.lastColumn},get timelineRef(){return i.timelineRef},get children(){return n(A,{loadMore:i,get eose(){return o()},get children(){return n(z,{get events(){return l()}})}})}})},at=g('<div class="flex flex-col"><div class="flex h-8 items-center gap-1 px-2"><h2 class="flex items-center gap-1"><span class="inline-block h-4 w-4 text-fg-secondary"></span></h2><form class=flex-1><input class="w-full rounded border border-border bg-bg px-1 py-0 ring-border focus:border-border focus:ring-primary"type=text name=query></form><button class="h-4 w-4">'),dt=e=>{const[t,r]=E(!1),[i,l]=E(""),{saveColumn:o}=k(),s=()=>r(m=>!m),c=()=>{i()!==e.column.query&&o({...e.column,query:i()})},u=()=>{c()},h=m=>{l(m.currentTarget.value)},f=m=>{m.preventDefault(),c()};return Z(()=>{l(e.column.query)}),(()=>{const m=at(),a=m.firstChild,v=a.firstChild,w=v.firstChild,C=v.nextSibling,p=C.firstChild,y=C.nextSibling;return d(w,n(ln,{})),C.addEventListener("submit",f),p.addEventListener("blur",u),p.addEventListener("change",h),y.$$click=()=>s(),d(y,n(ve,{})),d(m,n(b,{get when(){return t()},get children(){return e.settings()}}),null),F(()=>p.value=i()),m})()},mt=e=>{const{removeColumn:t}=k(),r=j(()=>({duration:null})),{events:i,eose:l}=B(()=>{const{query:o}=e.column;return o.length===0?null:{relayUrls:Fe,filters:[{kinds:[1],search:o,limit:20,since:r.since(),until:r.until()}],eoseLimit:20,clientEventFilter:s=>s.tags.findIndex(([c])=>c==="mostr"||c==="proxy")>=0?!1:e.column.contentFilter==null?!0:R(e.column.contentFilter)(s.content)}});return S(()=>{r.setEvents(i())}),n(D,{get header(){return n(dt,{get column(){return e.column},settings:()=>n(N,{get column(){return e.column},get columnIndex(){return e.columnIndex}}),onClose:()=>t(e.column.id)})},get width(){return e.column.width},get columnIndex(){return e.columnIndex},get lastColumn(){return e.lastColumn},get timelineRef(){return r.timelineRef},get children(){return n(A,{loadMore:r,get eose(){return l()},get children(){return n(z,{get events(){return i()}})}})}})};U(["click"]);const gt=g('<div class="scrollbar flex h-full snap-x snap-mandatory flex-row overflow-x-scroll scroll-smooth">'),ht=()=>{const{config:e}=k();return(()=>{const t=gt();return d(t,n(K,{get each(){return e().columns},children:(r,i)=>{const l=()=>i()+1,o=()=>l()===e().columns.length;return n(G,{get children(){return[n(I,{get when(){return r.columnType==="Following"&&r},keyed:!0,children:s=>n(Kn,{column:s,get columnIndex(){return l()},get lastColumn(){return o()}})}),n(I,{get when(){return r.columnType==="Notification"&&r},keyed:!0,children:s=>n(st,{column:s,get columnIndex(){return l()},get lastColumn(){return o()}})}),n(I,{get when(){return r.columnType==="Posts"&&r},keyed:!0,children:s=>n(ct,{column:s,get columnIndex(){return l()},get lastColumn(){return o()}})}),n(I,{get when(){return r.columnType==="Reactions"&&r},keyed:!0,children:s=>n(it,{column:s,get columnIndex(){return l()},get lastColumn(){return o()}})}),n(I,{get when(){return r.columnType==="Relays"&&r},keyed:!0,children:s=>n(ut,{column:s,get columnIndex(){return l()},get lastColumn(){return o()}})}),n(I,{get when(){return r.columnType==="Bookmark"&&r},keyed:!0,children:s=>n(jn,{column:s,get columnIndex(){return l()},get lastColumn(){return o()}})}),n(I,{get when(){return r.columnType==="Search"&&r},keyed:!0,children:s=>n(mt,{column:s,get columnIndex(){return l()},get lastColumn(){return o()}})})]}})}})),t})()},ft=[{key:"n",command:{command:"openPostForm"}},{key:"h",command:{command:"moveToPrevColumn"}},{key:"j",command:{command:"moveToNextItem"}},{key:"k",command:{command:"moveToPrevItem"}},{key:"l",command:{command:"moveToNextColumn"}},{key:"1",command:{command:"moveToColumn",columnIndex:1}},{key:"2",command:{command:"moveToColumn",columnIndex:2}},{key:"3",command:{command:"moveToColumn",columnIndex:3}},{key:"4",command:{command:"moveToColumn",columnIndex:4}},{key:"5",command:{command:"moveToColumn",columnIndex:5}},{key:"6",command:{command:"moveToColumn",columnIndex:6}},{key:"7",command:{command:"moveToColumn",columnIndex:7}},{key:"8",command:{command:"moveToColumn",columnIndex:8}},{key:"9",command:{command:"moveToColumn",columnIndex:9}},{key:"0",command:{command:"moveToLastColumn"}},{key:"ArrowLeft",command:{command:"moveToPrevColumn"}},{key:"ArrowDown",command:{command:"moveToNextItem"}},{key:"ArrowUp",command:{command:"moveToPrevItem"}},{key:"ArrowRight",command:{command:"moveToNextColumn"}},{key:"f",command:{command:"like"}},{key:"t",command:{command:"repost"}},{key:"r",command:{command:"openReplyForm"}},{key:"?",command:{command:"openHelp"}},{key:"Enter",command:{command:"openItemDetail"}},{key:"Backspace",command:{command:"closeItemDetail"}}],vt=e=>{const t=new Map;return e.forEach(r=>{t.set(r.key,r)}),t},yt=({shortcuts:e=ft,onShortcut:t})=>{const r=vt(e);Z(()=>{const i=Xe(l=>{if(l.type!=="keydown"||l.ctrlKey||l.altKey||l.metaKey||l.target instanceof HTMLTextAreaElement||l.target instanceof HTMLInputElement)return;const o=r.get(l.key);o!=null&&t(o)},50);window.addEventListener("keydown",i),ue(()=>{window.removeEventListener("keydown",i)})})},$t=()=>{const e=me();yt({onShortcut:t=>{e(t.command).then(()=>console.debug(`shortcut key '${t.key}' was processed successfully`),r=>console.error(r))}})},xt=g('<div class="absolute inset-0 flex h-svh w-screen touch-manipulation flex-row overflow-hidden">'),Rt=()=>{$t();const e=Ue(),{persistStatus:t}=un(),r=nn(),{config:i,initializeColumns:l}=k(),o=ge();return S(()=>{i().relayUrls.map(async s=>{try{const c=await r().ensureRelay(s);c.onnotice=u=>{console.error(`NOTICE: ${s}: ${u}`)},c.onclose=()=>{console.warn(`CLOSE: ${s}`)}}catch(c){console.error("ensureRelay failed",c)}})}),S(()=>{const s=o();s!=null&&l({pubkey:s})}),Z(()=>{t().loggedIn||e("/hello")}),Be(s=>{console.error("uncaught error: ",s)}),(()=>{const s=xt();return d(s,n(Ye,{}),null),d(s,n(ht,{}),null),d(s,n(en,{}),null),s})()};export{Rt as default};
//# sourceMappingURL=Home-61569e20.js.map
