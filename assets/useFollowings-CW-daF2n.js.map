{"version":3,"mappings":"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","names":["ColumnItem","_el$","_tmpl$","props","children","ArrowPathRoundedSquare","_$spread","tryEncodeNote","eventId","noteEncode","err","error","tryEncodeNevent","kind","neventEncode","id","EventLink","nip19","createMemo","url","_$createComponent","Show","when","fallback","keyed","_el$2","_tmpl$2","href","_$insert","useEvent","propsProvider","query","createQuery","queryKey","signal","currentProps","task","BatchedEventsTask","promise","registerTask","timeout","EventDisplayById","i18n","useTranslation","localProps","restProps","splitProps","shouldMuteEvent","useConfig","event","fetchedEvent","eventQuery","ensureNonNull","eventIdNonNull","hidden","ev","Switch","t","Match","EventDisplay","_$mergeProps","isLoading","_el$3","firstChild","useDatePulser","currentDate","setCurrentDate","createSignal","createEffect","onCleanup","defaultRelativeDateFormatter","parsedDate","formatTime","date","defaultAbsoluteDateLongFormatter","defaultAbsoluteDateShortFormatter","calcDiffSec","parseDateDiff","diffSec","isSameDate","lhs","rhs","yesterdayOf","formatAbsolute","formatter","formatAbsoluteLong","formatAbsoluteShort","formatRelative","currentDateHigh","createRoot","currentDateLow","useFormatDate","config","Repost","showProfile","useModalState","formatDate","genericEvent","lastTaggedEventId","_el$4","_el$5","nextSibling","_el$6","_el$7","_el$8","_el$9","$$click","pubkey","UserDisplayName","createdAtAsDate","_$delegateEvents","Bolt","ChatBubbleLeft","EllipsisHorizontal","HeartSolid","EmojiDisplay","emoji","type","content","shortcode","_$setAttribute","isPlus","r","length","reactionTypesToEmojiTypes","ReactionEmojiDisplay","reactionTypes","DefaultDelay","useLongPress","ref","longPressed","onMount","onLongPress","onClick","delay","timer","startTimer","clearTimer","handlePressStart","handlePressEnd","handleClick","el","useEmojiPopup","emojiRef","popupHover","setPopupHover","popup","close","setTimeout","open","usePopup","addEventListener","position","x","y","longPress","targetRef","ChevronRight","SelectableItemDisplay","item","onSelect","onClose","SubMenuDisplay","contextMenuPopup","useContextMenu","menu","submenu","items","_ref$","_$use","ensureSelectableItem","ensureSubMenu","ensureWidth","_tmpl$3","For","each","filter","e","v","EmojiRegex","queryKeyUseReactions","useReactions","queryClient","useQueryClient","genQueryKey","eventsQuery","mentionedEventId","reactions","result","key","reaction","events","useReactionMutation","commands","useCommands","createMutation","params","promises","results","succeeded","res","failed","queryKeyUseReposts","useReposts","reposts","useRepostMutation","Prefixes","siPrefix","value","options","precision","minValue","divider","divided","rounded","index","formatSiPrefix","inputValue","prefix","digits","wholeNumberDigits","EventDebugModal","lazy","__vitePreload","UserList","ZapRequestModal","emojiDataToReactionTypes","native","src","Error","ReactionAction","usePubkey","reacted","setReacted","isReactedByWithEmoji","isReactedBy","isReactedByMe","p","isReactedByMeWithEmoji","publishReactionMutation","doReaction","pubkeyNonNull","mutate","relayUrls","notifyPubkey","handleReaction","stopPropagation","handleEmojiSelect","emojiPickerPopup","useEmojiPicker","onEmojiSelect","_$memo","HeartOutlined","hideCount","showEmojiReaction","minDigits","_$effect","_p$","_v$","isPending","_v$2","_$classList","disabled","undefined","useEmojiReaction","Plus","_$p","RepostAction","reposted","setReposted","isRepostedBy","isRepostedByMe","publishRepostMutation","handleRepost","_v$3","_v$4","ReactionsModal","data","pubkeyExtractor","renderInfo","_el$10","_tmpl$4","toReactionTypes","RepostsModal","EmojiReactions","reactionsGrouped","mutation","_el$11","_tmpl$5","entries","isReactedByMeWithThisContent","findIndex","emojiTypes","emojiPopup","_el$12","_tmpl$7","_el$13","_el$14","_tmpl$6","Actions","modal","setModal","closeModal","deleteMutation","mutationKey","mutationFn","deleteEvent","then","Promise","allSettled","promeses","map","onSuccess","status","window","alert","count","onError","otherActionsPopup","navigator","clipboard","writeText","catch","_el$15","_tmpl$8","confirm","_el$16","_tmpl$9","_el$17","_el$18","_el$19","_el$20","_el$21","onClickReply","_ref$2","zapTo","ContentWarningDisplay","showContentWarning","setShowContentWarning","contentWarning","ExclamationTriangle","reason","GeneralUserMentionDisplay","profile","useProfile","name","npubEncodeFallback","AudioDisplay","setHidden","initialHidden","LazyLoad","SafeLink","ImageDisplay","imageRef","isError","setIsError","thumbnailUrl","MentionedEventDisplay","mentionedEvent","marker","embedding","actions","ensureKinds","Kind","MentionedUserDisplay","directAccessHosts","getCharset","source","metaCharsetMatch","metaContentTypeMatch","supportedEncodings","fixEncoding","charset","parseOgpFromDOM","doc","urlString","m","property","image","title","description","parseOgp","text","isOgpUrl","shouldAccessDirectly","buildUrl","fetchOgpContent","arrayBuffer","encodedContent","useOgp","twitterUrl","URL","host","youtubeUrl","videoId","iframeUrl","pathname","searchParams","set","location","origin","TwitterEmbed","twitterRef","getColorTheme","isTwitterUrl","twttr","widgets","load","dataTheme","brightness","OgpEmbed","ogp","ogpProps","ClickToShow","PreviewedLink","twitter","youtube","parseYouTubeVideoUrl","VideoDisplay","videoRef","TextNoteContentDisplay","saveColumn","request","useRequestCommand","addHashTagColumn","createSearchColumn","command","console","addRelayColumn","createRelaysColumn","parsed","showMedia","isImageUrl","isVideoUrl","isAudioUrl","isWebSocketUrl","reference","Offset","ThrottleWaitMs","useDetectOverflow","elementRef","overflow","setOverflow","setElementRef","detectOverflow","throttle","observer","entry","handleResize","Post","showOverflow","setShowOverflow","createdAt","createdAtFull","toLocaleString","author","authorPubkey","preventDefault","onShowProfile","picture","display_name","onShowEvent","current","footer","classList","toggle","TimelineContext","createContext","useTimelineContext","useContext","useTimelineState","timelineState","setTimelineState","createStore","setTimeline","clearTimeline","TextNote","textAreaRef","timelineContext","showReplyForm","setShowReplyForm","closeReplyForm","toggleReplyForm","focus","textNote","showReplyEvent","replyingToEvent","containsEventMention","rootEvent","taggedPubkeys","replyToPubkey","NotePostForm","mode","replyTo","onPost","isAllowedKind","includes","Timeline","setActiveSubscriptions","useStats","useThrottledEvents","eose","limit","eoseLimit","setEvents","delayedEvents","timeoutId","reflectDelayedEvents","currentEvents","newEvents","insertEventIntoDescendingList","startTimerIfNotStarted","stopTimer","addEvent","epoch","clearEvents","useSubscription","pool","usePool","setEose","on","startSubscription","filters","onEvent","onEOSE","clientEventFilter","continuous","subscribing","sub","useLoadMore","calcSince","base","duration","since","setSince","until","setUntil","topMarkerRef","setTopMarkerRef","loadLatest","batch","scrollIntoView","loadOld","oldest","pickOldestEvent","created_at","LoadMore","loadMore","buildMethods","dataProvider","followings","tag","followingPubkey","mainRelayUrl","petname","following","follow","fetchLatestFollowings","latestFollowings","useFollowings","latestEventQuery","invalidateFollowings"],"ignoreList":[1,9,10,11,12,17],"sources":["../../src/components/ColumnItem.tsx","../../node_modules/heroicons/24/outline/arrow-path-rounded-square.svg","../../src/components/EventLink.tsx","../../src/nostr/useEvent.ts","../../src/components/event/EventDisplayById.tsx","../../src/hooks/useDatePulser.ts","../../src/utils/formatDate.ts","../../src/hooks/useFormatDate.ts","../../src/components/event/Repost.tsx","../../node_modules/heroicons/24/outline/bolt.svg","../../node_modules/heroicons/24/outline/chat-bubble-left.svg","../../node_modules/heroicons/24/outline/ellipsis-horizontal.svg","../../node_modules/heroicons/24/solid/heart.svg","../../src/components/EmojiDisplay.tsx","../../src/components/ReactionEmojiDisplay.tsx","../../src/hooks/useLongPress.ts","../../src/components/useEmojiPopup.tsx","../../node_modules/heroicons/24/outline/chevron-right.svg","../../src/components/utils/useContextMenu.tsx","../../src/nostr/useReactions.ts","../../src/nostr/mutation/useReactionMutation.ts","../../src/nostr/useReposts.ts","../../src/nostr/mutation/useRepostMutation.ts","../../src/utils/siPrefix.ts","../../src/components/Actions.tsx","../../src/components/event/textNote/ContentWarningDisplay.tsx","../../src/components/event/textNote/GeneralUserMentionDisplay.tsx","../../src/components/event/textNote/AudioDisplay.tsx","../../src/components/event/textNote/ImageDisplay.tsx","../../src/components/event/textNote/MentionedEventDisplay.tsx","../../src/components/event/textNote/MentionedUserDisplay.tsx","../../src/utils/ogp.ts","../../src/components/event/textNote/PreviewedLink.tsx","../../src/components/event/textNote/VideoDisplay.tsx","../../src/components/event/textNote/TextNoteContentDisplay.tsx","../../src/hooks/useDetectOverflow.ts","../../src/components/Post.tsx","../../src/components/timeline/TimelineContext.tsx","../../src/components/event/TextNote.tsx","../../src/components/event/EventDisplay.tsx","../../src/components/timeline/Timeline.tsx","../../src/nostr/useSubscription.ts","../../src/components/column/LoadMore.tsx","../../src/nostr/useFollowings.ts"],"sourcesContent":["import { type Component, type JSX } from 'solid-js';\n\ntype ColumnItemProps = {\n  children: JSX.Element;\n};\n\nconst ColumnItem: Component<ColumnItemProps> = (props) => (\n  <div class=\"block shrink-0 overflow-hidden border-b border-border p-1\">{props.children}</div>\n);\n\nexport default ColumnItem;\n","export default (props = {}) => <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\" aria-hidden=\"true\" data-slot=\"icon\" viewBox=\"0 0 24 24\"{...props}><path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M19.5 12c0-1.232-.046-2.453-.138-3.662a4.006 4.006 0 0 0-3.7-3.7 48.678 48.678 0 0 0-7.324 0 4.006 4.006 0 0 0-3.7 3.7c-.017.22-.032.441-.046.662M19.5 12l3-3m-3 3-3-3m-12 3c0 1.232.046 2.453.138 3.662a4.006 4.006 0 0 0 3.7 3.7 48.656 48.656 0 0 0 7.324 0 4.006 4.006 0 0 0 3.7-3.7c.017-.22.032-.441.046-.662M4.5 12l3 3m-3-3-3 3\"/></svg>","import { createMemo, Show, type Component } from 'solid-js';\n\nimport { noteEncode, neventEncode } from 'nostr-tools/nip19';\n\ntype EventLinkProps = {\n  eventId: string;\n  kind?: number;\n};\n\nconst tryEncodeNote = (eventId: string) => {\n  try {\n    return noteEncode(eventId);\n  } catch (err) {\n    console.error('failed to encode event id into Bech32 entity (NIP-19) but ignore', eventId, err);\n    return eventId;\n  }\n};\n\nconst tryEncodeNevent = (eventId: string, kind: number) => {\n  try {\n    return neventEncode({ id: eventId, kind });\n  } catch (err) {\n    console.error('failed to encode event id into Bech32 entity (NIP-19) but ignore', eventId, err);\n    return eventId;\n  }\n};\n\nconst EventLink: Component<EventLinkProps> = (props) => {\n  const nip19 = createMemo(() =>\n    props.kind == null || props.kind === 1\n      ? tryEncodeNote(props.eventId)\n      : tryEncodeNevent(props.eventId, props.kind),\n  );\n\n  const url = () => (nip19() !== props.eventId ? `nostr:${nip19()}` : null);\n\n  return (\n    <Show when={url()} fallback={<span>{props.eventId}</span>} keyed>\n      {(href) => (\n        <a class=\"text-link underline\" href={href}>\n          {nip19()}\n        </a>\n      )}\n    </Show>\n  );\n};\n\nexport default EventLink;\n","import { createMemo } from 'solid-js';\n\nimport { createQuery, type CreateQueryResult } from '@tanstack/solid-query';\nimport { type Event as NostrEvent } from 'nostr-tools/pure';\n\nimport { registerTask, BatchedEventsTask, EventTask } from '@/nostr/useBatchedEvents';\nimport timeout from '@/utils/timeout';\n\nexport type UseEventProps = {\n  eventId: string;\n};\n\nexport type UseEvent = {\n  event: () => NostrEvent | null;\n  query: CreateQueryResult<NostrEvent | null>;\n};\n\nconst useEvent = (propsProvider: () => UseEventProps | null): UseEvent => {\n  const props = createMemo(propsProvider);\n\n  const query = createQuery(() => ({\n    queryKey: ['useEvent', props()] as const,\n    queryFn: ({ queryKey, signal }) => {\n      const [, currentProps] = queryKey;\n      if (currentProps == null) return null;\n      const { eventId } = currentProps;\n      const task = new BatchedEventsTask<EventTask>({ type: 'Event', eventId });\n      const promise = task.firstEventPromise().catch(() => {\n        throw new Error(`event not found: ${eventId}`);\n      });\n      console.log('useEvent', props());\n      registerTask({ task, signal });\n      return timeout(15000, `useEvent: ${eventId}`)(promise);\n    },\n    // Text notes never change, so they can be stored for a long time.\n    // However, events tend to be unreferenced as time passes.\n    staleTime: 4 * 60 * 60 * 1000, // 4 hour\n    gcTime: 4 * 60 * 60 * 1000, // 4 hour\n    refetchOnWindowFocus: false,\n    refetchOnMount: false,\n  }));\n\n  const event = () => query.data ?? null;\n\n  return { event, query };\n};\n\nexport default useEvent;\n","import { Switch, Match, type Component, splitProps } from 'solid-js';\n\n// eslint-disable-next-line import/no-cycle\nimport EventDisplay from '@/components/event/EventDisplay';\nimport { type EventDisplayProps } from '@/components/event/EventDisplay';\nimport EventLink from '@/components/EventLink';\nimport useConfig from '@/core/useConfig';\nimport { useTranslation } from '@/i18n/useTranslation';\nimport useEvent from '@/nostr/useEvent';\nimport ensureNonNull from '@/utils/ensureNonNull';\n\ntype EventDisplayByIdProps = Omit<EventDisplayProps, 'event'> & {\n  eventId: string | undefined;\n};\n\nconst EventDisplayById: Component<EventDisplayByIdProps> = (props) => {\n  const i18n = useTranslation();\n  const [localProps, restProps] = splitProps(props, ['eventId']);\n  const { shouldMuteEvent } = useConfig();\n\n  const { event: fetchedEvent, query: eventQuery } = useEvent(() =>\n    ensureNonNull([localProps.eventId] as const)(([eventIdNonNull]) => ({\n      eventId: eventIdNonNull,\n    })),\n  );\n\n  const hidden = (): boolean => {\n    const ev = fetchedEvent();\n    return ev != null && shouldMuteEvent(ev);\n  };\n\n  return (\n    <Switch\n      fallback={\n        <span>\n          {i18n.t('post.failedToFetchEvent')}\n          {props.eventId}\n        </span>\n      }\n    >\n      <Match when={hidden()}>{null}</Match>\n      <Match when={fetchedEvent()} keyed>\n        {(event) => <EventDisplay event={event} {...restProps} />}\n      </Match>\n      <Match when={eventQuery.isLoading && localProps.eventId} keyed>\n        {(id) => (\n          <div class=\"truncate\">\n            {i18n.t('general.loading')} <EventLink eventId={id} />\n          </div>\n        )}\n      </Match>\n    </Switch>\n  );\n};\n\nexport default EventDisplayById;\n","import { createSignal, createEffect, onCleanup, type Accessor } from 'solid-js';\n\ntype DatePulserProps = {\n  interval: number;\n};\n\nconst useDatePulser = (propsProvider: () => DatePulserProps): Accessor<Date> => {\n  const [currentDate, setCurrentDate] = createSignal(new Date());\n\n  createEffect(() => {\n    const id = setInterval(() => {\n      setCurrentDate(new Date());\n    }, propsProvider().interval);\n\n    onCleanup(() => clearInterval(id));\n  });\n\n  return currentDate;\n};\n\nexport default useDatePulser;\n","export type RelativeDate =\n  | { kind: 'now' }\n  | { kind: 'seconds'; value: number }\n  | { kind: 'minutes'; value: number }\n  | { kind: 'hours'; value: number }\n  | { kind: 'days'; value: number }\n  | { kind: 'abs'; value: Date };\n\nexport type AbsoluteDate =\n  | { kind: 'today'; value: Date }\n  | { kind: 'yesterday'; value: Date }\n  | { kind: 'abs'; value: Date };\n\nexport type RelativeDateFormatter = (parsedDate: RelativeDate) => string;\nexport type AbsoluteDateFormatter = (parsedDate: AbsoluteDate) => string;\n\nconst defaultRelativeDateFormatter = (parsedDate: RelativeDate): string => {\n  switch (parsedDate.kind) {\n    case 'now':\n      return 'now';\n    case 'seconds':\n      return `${parsedDate.value}s`;\n    case 'minutes':\n      return `${parsedDate.value}m`;\n    case 'hours':\n      return `${parsedDate.value}h`;\n    case 'days':\n      return `${parsedDate.value}d`;\n    case 'abs':\n    default:\n      return parsedDate.value.toLocaleDateString();\n  }\n};\n\nconst formatTime = (date: Date): string =>\n  `${date.getHours()}:${date.getMinutes().toString().padStart(2, '0')}`;\n\nconst defaultAbsoluteDateLongFormatter = (parsedDate: AbsoluteDate): string => {\n  switch (parsedDate.kind) {\n    case 'today':\n      return parsedDate.value.toLocaleTimeString();\n    case 'yesterday':\n    case 'abs':\n    default:\n      return parsedDate.value.toLocaleString();\n  }\n};\n\nconst defaultAbsoluteDateShortFormatter = (parsedDate: AbsoluteDate): string => {\n  switch (parsedDate.kind) {\n    case 'today':\n      return formatTime(parsedDate.value);\n    case 'yesterday':\n      return `昨日 ${formatTime(parsedDate.value)}`;\n    case 'abs':\n    default:\n      return parsedDate.value.toLocaleString();\n  }\n};\n\nconst calcDiffSec = (date: Date, currentDate: Date): number =>\n  Math.round(Number(currentDate) - Number(date)) / 1000;\n\nconst parseDateDiff = (date: Date, currentDate: Date): RelativeDate => {\n  const diffSec = calcDiffSec(date, currentDate);\n\n  if (diffSec < 10) {\n    return { kind: 'now' };\n  }\n  if (diffSec < 60) {\n    return { kind: 'seconds', value: Math.round(diffSec) };\n  }\n  if (diffSec < 3600) {\n    return { kind: 'minutes', value: Math.round(diffSec / 60) };\n  }\n  if (diffSec < 86400) {\n    // 1 days\n    return { kind: 'hours', value: Math.round(diffSec / 3600) };\n  }\n  if (diffSec < 604800) {\n    // 1 week\n    return { kind: 'days', value: Math.round(diffSec / 86400) };\n  }\n  return { kind: 'abs', value: date };\n};\n\nconst isSameDate = (lhs: Date, rhs: Date): boolean =>\n  lhs.getFullYear() === rhs.getFullYear() &&\n  lhs.getMonth() === rhs.getMonth() &&\n  lhs.getDate() === rhs.getDate();\n\nconst yesterdayOf = (date: Date): Date => new Date(+date - 24 * 60 * 60 * 1000);\n\nconst formatAbsolute = (\n  date: Date,\n  currentDate: Date,\n  formatter: AbsoluteDateFormatter,\n): string => {\n  if (isSameDate(date, currentDate)) {\n    return formatter({ kind: 'today', value: date });\n  }\n  if (isSameDate(date, yesterdayOf(currentDate))) {\n    return formatter({ kind: 'yesterday', value: date });\n  }\n  return formatter({ kind: 'abs', value: date });\n};\n\nexport const formatAbsoluteLong = (date: Date, currentDate: Date = new Date()) =>\n  formatAbsolute(date, currentDate, defaultAbsoluteDateLongFormatter);\n\nexport const formatAbsoluteShort = (date: Date, currentDate: Date = new Date()) =>\n  formatAbsolute(date, currentDate, defaultAbsoluteDateShortFormatter);\n\nexport const formatRelative = (\n  date: Date,\n  currentDate: Date = new Date(),\n  formatter: RelativeDateFormatter = defaultRelativeDateFormatter,\n): string => formatter(parseDateDiff(date, currentDate));\n","import { createRoot } from 'solid-js';\n\nimport useConfig from '@/core/useConfig';\nimport useDatePulser from '@/hooks/useDatePulser';\nimport { formatRelative, formatAbsoluteLong, formatAbsoluteShort } from '@/utils/formatDate';\n\n// 7 seconds is used here so that the last digit of relative time is changed.\nconst currentDateHigh = createRoot(() => useDatePulser(() => ({ interval: 7000 })));\nconst currentDateLow = createRoot(() => useDatePulser(() => ({ interval: 60 * 1000 })));\n\nconst useFormatDate = () => {\n  const { config } = useConfig();\n\n  return (date: Date) => {\n    switch (config().dateFormat) {\n      case 'absolute-long':\n        return formatAbsoluteLong(date, currentDateLow());\n      case 'absolute-short':\n        return formatAbsoluteShort(date, currentDateLow());\n      case 'relative':\n        return formatRelative(date, currentDateHigh());\n      default:\n        return formatRelative(date, currentDateHigh());\n    }\n  };\n};\n\nexport default useFormatDate;\n","// NIP-18\nimport { type Component, createMemo } from 'solid-js';\n\nimport ArrowPathRoundedSquare from 'heroicons/24/outline/arrow-path-rounded-square.svg';\nimport { type Event as NostrEvent } from 'nostr-tools/pure';\n\n// eslint-disable-next-line import/no-cycle\nimport EventDisplayById from '@/components/event/EventDisplayById';\nimport UserDisplayName from '@/components/UserDisplayName';\nimport useFormatDate from '@/hooks/useFormatDate';\nimport useModalState from '@/hooks/useModalState';\nimport { useTranslation } from '@/i18n/useTranslation';\nimport { genericEvent } from '@/nostr/event';\n\nexport type RepostProps = {\n  event: NostrEvent;\n};\n\nconst Repost: Component<RepostProps> = (props) => {\n  const i18n = useTranslation();\n  const { showProfile } = useModalState();\n  const formatDate = useFormatDate();\n  const event = createMemo(() => genericEvent(props.event));\n  const eventId = () => event().lastTaggedEventId();\n\n  return (\n    <div>\n      <div class=\"flex items-center gap-1\">\n        <div class=\"flex shrink-0 place-items-center pl-[2px]\" aria-hidden=\"true\">\n          <span class=\"size-4 text-r-repost\">\n            <ArrowPathRoundedSquare />\n          </span>\n        </div>\n        <div class=\"notification-user flex min-w-0 flex-1 overflow-hidden text-xs\">\n          <button\n            class=\"select-text truncate hover:text-link hover:underline\"\n            onClick={() => showProfile(props.event.pubkey)}\n          >\n            <UserDisplayName pubkey={props.event.pubkey} />\n          </button>\n          <span class=\"shrink-0 whitespace-pre\">{i18n.t('notification.reposted')}</span>\n        </div>\n        <div class=\"text-xs\">{formatDate(event().createdAtAsDate())}</div>\n      </div>\n      <div class=\"pt-1\">\n        <EventDisplayById eventId={eventId()} />\n      </div>\n    </div>\n  );\n};\n\nexport default Repost;\n","export default (props = {}) => <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\" aria-hidden=\"true\" data-slot=\"icon\" viewBox=\"0 0 24 24\"{...props}><path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"m3.75 13.5 10.5-11.25L12 10.5h8.25L9.75 21.75 12 13.5z\"/></svg>","export default (props = {}) => <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\" aria-hidden=\"true\" data-slot=\"icon\" viewBox=\"0 0 24 24\"{...props}><path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M2.25 12.76c0 1.6 1.123 2.994 2.707 3.227 1.087.16 2.185.283 3.293.369V21l4.076-4.076a1.526 1.526 0 0 1 1.037-.443 48.282 48.282 0 0 0 5.68-.494c1.584-.233 2.707-1.626 2.707-3.228V6.741c0-1.602-1.123-2.995-2.707-3.228A48.394 48.394 0 0 0 12 3c-2.392 0-4.744.175-7.043.513C3.373 3.746 2.25 5.14 2.25 6.741z\"/></svg>","export default (props = {}) => <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\" aria-hidden=\"true\" data-slot=\"icon\" viewBox=\"0 0 24 24\"{...props}><path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M6.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0m6 0a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0m6 0a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0\"/></svg>","export default (props = {}) => <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"currentColor\" aria-hidden=\"true\" data-slot=\"icon\" viewBox=\"0 0 24 24\"{...props}><path d=\"m11.645 20.91-.007-.003-.022-.012a15.247 15.247 0 0 1-.383-.218 25.18 25.18 0 0 1-4.244-3.17C4.688 15.36 2.25 12.174 2.25 8.25 2.25 5.322 4.714 3 7.688 3A5.5 5.5 0 0 1 12 5.052 5.5 5.5 0 0 1 16.313 3c2.973 0 5.437 2.322 5.437 5.25 0 3.925-2.438 7.111-4.739 9.256a25.175 25.175 0 0 1-4.244 3.17 15.247 15.247 0 0 1-.383.219l-.022.012-.007.004-.003.001a.752.752 0 0 1-.704 0l-.003-.001Z\"/></svg>","import { Component, Match, Switch } from 'solid-js';\n\nexport type EmojiTypes =\n  | { type: 'Emoji'; content: string }\n  | { type: 'CustomEmoji'; shortcode: string; url: string };\n\nexport type EmojiDisplayProps = {\n  emoji: EmojiTypes;\n};\n\nconst EmojiDisplay: Component<EmojiDisplayProps> = (props) => (\n  <Switch>\n    <Match when={props.emoji.type === 'Emoji' && props.emoji.content} keyed>\n      {(content) => <span class=\"truncate\">{content}</span>}\n    </Match>\n    <Match when={props.emoji.type === 'CustomEmoji' && props.emoji} keyed>\n      {({ shortcode, url }) => (\n        <img\n          class=\"pointer-events-none h-full w-auto object-contain\"\n          src={url}\n          alt={`:${shortcode}:`}\n        />\n      )}\n    </Match>\n  </Switch>\n);\n\nexport default EmojiDisplay;\n","import { Component, Match, Switch } from 'solid-js';\n\nimport HeartSolid from 'heroicons/24/solid/heart.svg';\n\nimport EmojiDisplay, { type EmojiTypes } from '@/components/EmojiDisplay';\nimport { ReactionTypes } from '@/nostr/event/Reaction';\n\nexport type ReactionEmojiDisplayProps = {\n  reactionTypes: ReactionTypes;\n};\n\nexport const isPlus = (r: ReactionTypes) =>\n  r.type === 'LikeDislike' && (r.content === '+' || r.content.length === 0);\n\nexport const reactionTypesToEmojiTypes = (r: ReactionTypes): EmojiTypes | undefined => {\n  if (r.type === 'Emoji') return r;\n  if (r.type === 'CustomEmoji') return r;\n  return undefined;\n};\n\nconst ReactionEmojiDisplay: Component<ReactionEmojiDisplayProps> = (props) => (\n  <Switch fallback={<span class=\"truncate\">{props.reactionTypes.content}</span>}>\n    <Match when={isPlus(props.reactionTypes)}>\n      <span class=\"inline-block size-full pt-px text-r-reaction\">\n        <HeartSolid />\n      </span>\n    </Match>\n    <Match when={reactionTypesToEmojiTypes(props.reactionTypes)} keyed>\n      {(emoji) => <EmojiDisplay emoji={emoji} />}\n    </Match>\n  </Switch>\n);\n\nexport default ReactionEmojiDisplay;\n","import { onMount, onCleanup } from 'solid-js';\n\ntype UseLongPressProps = {\n  delay?: number;\n  onLongPress: () => void;\n  onClick: () => void;\n};\n\nconst DefaultDelay = 300;\n\nconst useLongPress = (propsProvider: () => UseLongPressProps) => {\n  let ref: HTMLElement | undefined;\n  let longPressed = false;\n\n  onMount(() => {\n    if (ref == null) return;\n    const { onLongPress, onClick, delay = DefaultDelay } = propsProvider();\n\n    let timer: ReturnType<typeof setTimeout> | undefined;\n\n    const startTimer = () => {\n      longPressed = false;\n      timer = setTimeout(() => {\n        longPressed = true;\n        onLongPress();\n      }, delay);\n    };\n\n    const clearTimer = () => {\n      if (timer != null) {\n        clearTimeout(timer);\n      }\n    };\n\n    const handlePressStart = (ev: Event) => {\n      // Calling preventDefault prevents 'mousedown' event from firing if the event was triggered by a touch event\n      ev.preventDefault();\n      startTimer();\n    };\n\n    const handlePressEnd = (ev: Event) => {\n      // Calling preventDefault prevents 'mouseup' event from firing if the event was triggered by a touch event\n      ev.preventDefault();\n      clearTimer();\n    };\n\n    const handleClick = () => {\n      if (longPressed) return;\n      clearTimer();\n      onClick();\n    };\n\n    ref.addEventListener('mousedown', handlePressStart);\n    ref.addEventListener('mouseup', handlePressEnd);\n\n    ref.addEventListener('touchstart', handlePressStart);\n    ref.addEventListener('touchend', handlePressEnd);\n\n    ref.addEventListener('click', handleClick);\n\n    onCleanup(() => {\n      clearTimer();\n      ref?.removeEventListener('mouseddown', handlePressStart);\n      ref?.removeEventListener('mouseup', handlePressEnd);\n\n      ref?.removeEventListener('touchstart', handlePressStart);\n      ref?.removeEventListener('touchend', handlePressEnd);\n\n      ref?.removeEventListener('click', handleClick);\n    });\n  });\n\n  return {\n    ref: (el: HTMLElement) => {\n      ref = el;\n    },\n  };\n};\n\nexport default useLongPress;\n","import { type JSX, Show, createMemo, createSignal, onMount } from 'solid-js';\n\nimport EmojiDisplay, { type EmojiTypes } from '@/components/EmojiDisplay';\nimport usePopup from '@/components/utils/usePopup';\nimport useLongPress from '@/hooks/useLongPress';\n\nexport type UseEmojiPopupProps = {\n  emoji: EmojiTypes;\n  onClick?: () => void;\n};\n\ntype UseEmojiPopup = {\n  emojiRef: (el: HTMLElement) => void;\n  popup: () => JSX.Element;\n};\n\nconst useEmojiPopup = (propsProvider: () => UseEmojiPopupProps | null): UseEmojiPopup => {\n  let emojiRef: HTMLElement | undefined;\n\n  const props = createMemo(propsProvider);\n\n  const [popupHover, setPopupHover] = createSignal(false);\n\n  let popup: ReturnType<typeof usePopup>;\n\n  const close = () => {\n    setTimeout(() => {\n      if (popupHover()) return;\n      popup.close();\n    }, 100);\n  };\n\n  const open = () => {\n    popup.open();\n  };\n\n  popup = usePopup(() => ({\n    popup: () => (\n      <Show when={props()?.emoji} keyed>\n        {(emoji) => (\n          <div\n            onMouseEnter={() => {\n              setPopupHover(true);\n            }}\n            onMouseLeave={() => {\n              setPopupHover(false);\n              close();\n            }}\n          >\n            <div class=\"flex h-24 min-w-24 max-w-screen-lg items-center justify-center rounded border border-border bg-bg text-5xl shadow\">\n              <EmojiDisplay emoji={emoji} />\n            </div>\n          </div>\n        )}\n      </Show>\n    ),\n    position: { x: 'center', y: 'top' },\n  }));\n\n  const longPress = useLongPress(() => ({\n    onLongPress: () => open(),\n    onClick: () => props()?.onClick?.(),\n  }));\n\n  onMount(() => {\n    emojiRef?.addEventListener('mouseenter', open);\n    emojiRef?.addEventListener('mouseleave', close);\n  });\n\n  return {\n    emojiRef: (el) => {\n      emojiRef = el;\n      popup.targetRef(el);\n      longPress.ref(el);\n    },\n    popup: popup.popup,\n  };\n};\n\nexport default useEmojiPopup;\n","export default (props = {}) => <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\" aria-hidden=\"true\" data-slot=\"icon\" viewBox=\"0 0 24 24\"{...props}><path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"m8.25 4.5 7.5 7.5-7.5 7.5\"/></svg>","import { createMemo, For, Switch, Match, type Component, type JSX } from 'solid-js';\n\nimport ChevronRight from 'heroicons/24/outline/chevron-right.svg';\n\nimport usePopup, { type UsePopupProps } from '@/components/utils/usePopup';\n\nexport type SelectableItem = {\n  content: JSX.Element;\n  when?: () => boolean;\n  onSelect: () => void;\n};\n\nexport type SubMenu = Omit<SelectableItem, 'type' | 'onSelect'> & {\n  content: JSX.Element;\n  items: (SelectableItem | SubMenu)[];\n};\n\nexport type MenuItem = SelectableItem | SubMenu;\n\nexport type UseContextMenuProps = Omit<UsePopupProps, 'popup'> & {\n  menu: (MenuItem | SubMenu)[];\n};\n\nexport type SelectableItemDisplayProps = {\n  item: SelectableItem;\n  onClose: () => void;\n};\n\nexport type SubMenuDisplayProps = {\n  submenu: SubMenu;\n  onClose: () => void;\n};\n\nconst SelectableItemDisplay: Component<SelectableItemDisplayProps> = (props) => {\n  const handleClick = () => {\n    props.item?.onSelect?.();\n    props.onClose();\n  };\n\n  return (\n    <li class=\"border-b border-border hover:bg-bg-tertiary\">\n      <button class=\"w-full px-4 py-1 text-start\" onClick={handleClick}>\n        {props.item.content}\n      </button>\n    </li>\n  );\n};\n\nconst SubMenuDisplay: Component<SubMenuDisplayProps> = (props) => {\n  // eslint-disable-next-line @typescript-eslint/no-use-before-define\n  const contextMenuPopup = useContextMenu(() => ({\n    menu: props.submenu.items,\n    position: { x: 'right', y: 'bottom' },\n  }));\n\n  const handleClick = () => {\n    contextMenuPopup.open();\n  };\n\n  return (\n    <li ref={contextMenuPopup.targetRef} class=\"border-b border-border hover:bg-bg-tertiary\">\n      <button class=\"flex w-full items-center py-1 pe-2 ps-4 text-start\" onClick={handleClick}>\n        <span class=\"flex-1\">{props.submenu.content}</span>\n        <span class=\"inline-block size-4 shrink-0\">\n          <ChevronRight />\n        </span>\n      </button>\n      {contextMenuPopup.popup()}\n    </li>\n  );\n};\n\nconst ensureSelectableItem = (item: MenuItem): SelectableItem | null => {\n  if ('onSelect' in item) return item;\n  return null;\n};\n\nconst ensureSubMenu = (item: MenuItem): SubMenu | null => {\n  if ('items' in item) return item;\n  return null;\n};\n\nconst useContextMenu = (propsProvider: () => UseContextMenuProps) => {\n  const props = createMemo(propsProvider);\n\n  const popup = usePopup(() => ({\n    ensureWidth: 300,\n    position: { x: 'right', y: 'bottom' },\n    ...props(),\n    popup: (\n      <ul class=\"min-w-[96px] rounded border border-border bg-bg shadow-md\">\n        <For each={props().menu.filter((e) => e.when == null || e.when())}>\n          {(item) => (\n            <Switch>\n              <Match when={ensureSelectableItem(item)} keyed>\n                {(v) => <SelectableItemDisplay item={v} onClose={() => popup.close()} />}\n              </Match>\n              <Match when={ensureSubMenu(item)} keyed>\n                {(v) => <SubMenuDisplay submenu={v} onClose={() => popup.close()} />}\n              </Match>\n            </Switch>\n          )}\n        </For>\n      </ul>\n    ),\n  }));\n\n  return popup;\n};\n\nexport default useContextMenu;\n","import { createMemo } from 'solid-js';\n\nimport { createQuery, useQueryClient, type CreateQueryResult } from '@tanstack/solid-query';\nimport { type Event as NostrEvent } from 'nostr-tools/pure';\n\nimport useConfig from '@/core/useConfig';\nimport { reaction } from '@/nostr/event';\nimport { eventsQuery } from '@/nostr/query';\nimport { BatchedEventsTask } from '@/nostr/useBatchedEvents';\n\nexport type UseReactionsProps = {\n  eventId: string;\n};\n\nexport type UseReactions = {\n  reactions: () => NostrEvent[];\n  reactionsGrouped: () => Map<string, NostrEvent[]>;\n  isReactedBy: (pubkey: string) => boolean;\n  isReactedByWithEmoji: (pubkey: string) => boolean;\n  query: CreateQueryResult<NostrEvent[]>;\n};\n\nconst EmojiRegex = /\\p{Emoji_Presentation}/u;\n\nexport const queryKeyUseReactions = (props: UseReactionsProps | null) =>\n  ['useReactions', props] as const;\n\nconst useReactions = (propsProvider: () => UseReactionsProps | null): UseReactions => {\n  const { shouldMuteEvent } = useConfig();\n  const queryClient = useQueryClient();\n  const genQueryKey = createMemo(() => queryKeyUseReactions(propsProvider()));\n\n  const query = createQuery(() => ({\n    queryKey: genQueryKey(),\n    queryFn: eventsQuery<ReturnType<typeof queryKeyUseReactions>>({\n      taskProvider: ([, currentProps]) => {\n        if (currentProps == null) return null;\n        const { eventId: mentionedEventId } = currentProps;\n        return new BatchedEventsTask({ type: 'Reactions', mentionedEventId });\n      },\n      queryClient,\n    }),\n    staleTime: 1 * 60 * 1000, // 1 min\n    gcTime: 4 * 60 * 60 * 1000, // 4 hour\n    refetchInterval: 1 * 60 * 1000, // 1 min\n  }));\n\n  const reactions = () => {\n    const data = query.data ?? [];\n    return data.filter((ev) => !shouldMuteEvent(ev));\n  };\n\n  const reactionsGrouped = () => {\n    const result = new Map<string, NostrEvent[]>();\n    reactions().forEach((event) => {\n      const key = reaction(event).isCustomEmoji()\n        ? `${event.content}${reaction(event).getUrl() ?? ''}`\n        : event.content;\n      const events = result.get(key) ?? [];\n      events.push(event);\n      result.set(key, events);\n    });\n    return result;\n  };\n\n  const isReactedBy = (pubkey: string): boolean =>\n    reactions().findIndex((event) => event.pubkey === pubkey) !== -1;\n\n  const isReactedByWithEmoji = (pubkey: string): boolean =>\n    reactions().findIndex((event) => event.pubkey === pubkey && EmojiRegex.test(event.content)) !==\n    -1;\n\n  return {\n    reactions,\n    reactionsGrouped,\n    isReactedBy,\n    isReactedByWithEmoji,\n    query,\n  };\n};\n\nexport default useReactions;\n","import { createMemo } from 'solid-js';\n\nimport { createMutation, useQueryClient } from '@tanstack/solid-query';\n\nimport useCommands from '@/nostr/useCommands';\nimport { queryKeyUseReactions } from '@/nostr/useReactions';\nimport timeout from '@/utils/timeout';\n\ntype UseReactionMutationProps = {\n  eventId: string;\n};\n\nconst useReactionMutation = (propsProvider: () => UseReactionMutationProps) => {\n  const queryClient = useQueryClient();\n  const props = createMemo(propsProvider);\n\n  const commands = useCommands();\n\n  const mutation = createMutation(() => ({\n    mutationKey: ['useReactionMutation', props().eventId] as const,\n    mutationFn: (...params: Parameters<typeof commands.publishReaction>) =>\n      commands\n        .publishReaction(...params)\n        .then((promises) => Promise.allSettled(promises.map(timeout(5000)))),\n    onSuccess: (results) => {\n      const succeeded = results.filter((res) => res.status === 'fulfilled').length;\n      const failed = results.length - succeeded;\n      if (succeeded === results.length) {\n        console.log('Succeeded to publish a reaction');\n      } else if (succeeded > 0) {\n        console.warn(`failed to publish a reaction on ${failed} relays`);\n      } else {\n        console.error('failed to publish reaction on all relays');\n      }\n    },\n    onError: (err) => {\n      console.error('failed to publish reaction: ', err);\n    },\n    onSettled: () => {\n      const queryKey = queryKeyUseReactions({ eventId: props().eventId });\n      queryClient\n        .refetchQueries({ queryKey })\n        .then(() => queryClient.invalidateQueries({ queryKey }))\n        .catch((err) => console.error('failed to refetch reactions', err));\n    },\n  }));\n\n  return mutation;\n};\n\nexport default useReactionMutation;\n","import { createMemo } from 'solid-js';\n\nimport { createQuery, useQueryClient, type CreateQueryResult } from '@tanstack/solid-query';\nimport { Event as NostrEvent } from 'nostr-tools/pure';\n\nimport useConfig from '@/core/useConfig';\nimport { eventsQuery } from '@/nostr/query';\nimport { BatchedEventsTask } from '@/nostr/useBatchedEvents';\n\nexport type UseRepostsProps = {\n  eventId: string;\n};\n\nexport type UseReposts = {\n  reposts: () => NostrEvent[];\n  isRepostedBy: (pubkey: string) => boolean;\n  query: CreateQueryResult<NostrEvent[]>;\n};\n\nexport const queryKeyUseReposts = (props: UseRepostsProps) => ['useReposts', props] as const;\n\nconst useReposts = (propsProvider: () => UseRepostsProps): UseReposts => {\n  const { shouldMuteEvent } = useConfig();\n  const queryClient = useQueryClient();\n  const props = createMemo(propsProvider);\n  const genQueryKey = createMemo(() => queryKeyUseReposts(props()));\n\n  const query = createQuery(() => ({\n    queryKey: genQueryKey(),\n    queryFn: eventsQuery<ReturnType<typeof genQueryKey>>({\n      taskProvider: ([, currentProps]) => {\n        if (currentProps == null) return null;\n        const { eventId: mentionedEventId } = currentProps;\n        return new BatchedEventsTask({ type: 'Reposts', mentionedEventId });\n      },\n      queryClient,\n    }),\n    staleTime: 1 * 60 * 1000, // 1 min\n    gcTime: 4 * 60 * 60 * 1000, // 4 hour\n    refetchInterval: 1 * 60 * 1000, // 1 min\n  }));\n\n  const reposts = () => {\n    const data = query.data ?? [];\n    return data.filter((ev) => !shouldMuteEvent(ev));\n  };\n\n  const isRepostedBy = (pubkey: string): boolean =>\n    reposts().findIndex((event) => event.pubkey === pubkey) !== -1;\n\n  return { reposts, isRepostedBy, query };\n};\n\nexport default useReposts;\n","import { createMemo } from 'solid-js';\n\nimport { createMutation, useQueryClient } from '@tanstack/solid-query';\n\nimport useCommands from '@/nostr/useCommands';\nimport { queryKeyUseReposts } from '@/nostr/useReposts';\nimport timeout from '@/utils/timeout';\n\ntype UseRepostMutationProps = {\n  eventId: string;\n};\n\nconst useRepostMutation = (propsProvider: () => UseRepostMutationProps) => {\n  const queryClient = useQueryClient();\n  const props = createMemo(propsProvider);\n\n  const commands = useCommands();\n\n  const mutation = createMutation(() => ({\n    mutationKey: ['useRepostMutation', props().eventId] as const,\n    mutationFn: (...params: Parameters<typeof commands.publishRepost>) =>\n      commands\n        .publishRepost(...params)\n        .then((promises) => Promise.allSettled(promises.map(timeout(10000)))),\n    onSuccess: (results) => {\n      const succeeded = results.filter((res) => res.status === 'fulfilled').length;\n      const failed = results.length - succeeded;\n      if (succeeded === results.length) {\n        console.log('Succeeded to publish a repost');\n      } else if (succeeded > 0) {\n        console.warn(`Failed to publish a repost on ${failed} relays`);\n      } else {\n        console.error('Failed to publish a repost on all relays');\n      }\n    },\n    onError: (err) => {\n      console.error('failed to publish repost: ', err);\n    },\n    onSettled: () => {\n      const queryKey = queryKeyUseReposts({ eventId: props().eventId });\n      queryClient\n        .refetchQueries({ queryKey })\n        .then(() => queryClient.invalidateQueries({ queryKey }))\n        .catch((err) => console.error('failed to refetch repost', err));\n    },\n  }));\n\n  return mutation;\n};\n\nexport default useRepostMutation;\n","const Prefixes = ['k', 'M', 'G', 'T', 'P'] as const;\n\nexport type SIPrefix = {\n  value: number;\n  prefix: (typeof Prefixes)[number] | null;\n};\n\nconst siPrefix = (\n  value: number,\n  options?: { precision?: number; minDigits?: number },\n): SIPrefix => {\n  const precision = options?.precision ?? 3;\n  if (precision <= 0) throw new Error(`precision is too small: ${precision}`);\n\n  const minDigits = options?.minDigits ?? 4;\n  const minValue = 10 ** (minDigits - 1);\n  if (value < minValue) return { value, prefix: null };\n\n  const divider = 10 ** (Math.floor(Math.log10(value) / 3) * 3);\n  const divided = value / divider;\n  let rounded = Math.round(divided * 10 ** precision) / 10 ** precision;\n  let index = Math.max(Math.floor(Math.log10(value) / 3) - 1, 0);\n  if (rounded >= 1000) {\n    rounded /= 1000;\n    index += 1;\n  }\n  if (index >= Prefixes.length) return { value, prefix: null };\n\n  return { value: rounded, prefix: Prefixes[index] };\n};\n\nexport const formatSiPrefix = (\n  inputValue: number,\n  options?: { digits?: number; minDigits?: number },\n): string => {\n  const { value, prefix } = siPrefix(inputValue, {\n    precision: 2,\n    minDigits: options?.minDigits ?? 5,\n  });\n  if (prefix == null) return `${inputValue}`;\n\n  const digits = options?.digits ?? 3;\n  const wholeNumberDigits = Math.floor(Math.log10(value)) + 1;\n  const precision = Math.max(digits - wholeNumberDigits, 0);\n  const rounded = Math.round(value * 10 ** precision) / 10 ** precision;\n\n  return `${rounded}${prefix}`;\n};\n\nexport default siPrefix;\n","import {\n  type JSX,\n  type Component,\n  Switch,\n  Match,\n  Show,\n  lazy,\n  createSignal,\n  createMemo,\n  For,\n} from 'solid-js';\n\nimport { createMutation } from '@tanstack/solid-query';\nimport ArrowPathRoundedSquare from 'heroicons/24/outline/arrow-path-rounded-square.svg';\nimport Bolt from 'heroicons/24/outline/bolt.svg';\nimport ChatBubbleLeft from 'heroicons/24/outline/chat-bubble-left.svg';\nimport EllipsisHorizontal from 'heroicons/24/outline/ellipsis-horizontal.svg';\nimport HeartOutlined from 'heroicons/24/outline/heart.svg';\nimport Plus from 'heroicons/24/outline/plus.svg';\nimport HeartSolid from 'heroicons/24/solid/heart.svg';\nimport { noteEncode } from 'nostr-tools/nip19';\nimport { type Event as NostrEvent } from 'nostr-tools/pure';\n\nimport ReactionEmojiDisplay, { reactionTypesToEmojiTypes } from '@/components/ReactionEmojiDisplay';\nimport useEmojiPicker, { EmojiData } from '@/components/useEmojiPicker';\nimport useEmojiPopup from '@/components/useEmojiPopup';\nimport useContextMenu from '@/components/utils/useContextMenu';\nimport useConfig from '@/core/useConfig';\nimport { useTranslation } from '@/i18n/useTranslation';\nimport { reaction } from '@/nostr/event';\nimport { ReactionTypes } from '@/nostr/event/Reaction';\nimport useReactionMutation from '@/nostr/mutation/useReactionMutation';\nimport useRepostMutation from '@/nostr/mutation/useRepostMutation';\nimport useCommands from '@/nostr/useCommands';\nimport usePubkey from '@/nostr/usePubkey';\nimport useReactions from '@/nostr/useReactions';\nimport useReposts from '@/nostr/useReposts';\nimport ensureNonNull from '@/utils/ensureNonNull';\nimport { formatSiPrefix } from '@/utils/siPrefix';\nimport timeout from '@/utils/timeout';\n\nconst EventDebugModal = lazy(() => import('@/components/modal/EventDebugModal'));\nconst UserList = lazy(() => import('@/components/modal/UserList'));\n// eslint-disable-next-line import/no-cycle\nconst ZapRequestModal = lazy(() => import('@/components/modal/ZapRequestModal'));\n\nexport type ActionProps = {\n  event: NostrEvent;\n  onClickReply: () => void;\n};\n\nconst emojiDataToReactionTypes = (emoji: EmojiData): ReactionTypes => {\n  if (emoji.native != null) {\n    return { type: 'Emoji', content: emoji.native };\n  }\n  if (emoji.src != null) {\n    return {\n      type: 'CustomEmoji',\n      content: `:${emoji.id}:`,\n      shortcode: emoji.id,\n      url: emoji.src,\n    };\n  }\n  throw new Error('unknown emoji');\n};\n\nconst ReactionAction = (props: { event: NostrEvent }) => {\n  const { config } = useConfig();\n  const pubkey = usePubkey();\n\n  const [reacted, setReacted] = createSignal(false);\n\n  const { reactions, isReactedByWithEmoji, isReactedBy } = useReactions(() => ({\n    eventId: props.event.id,\n  }));\n\n  const isReactedByMe = createMemo(() => {\n    const p = pubkey();\n    return (p != null && isReactedBy(p)) || reacted();\n  });\n  const isReactedByMeWithEmoji = createMemo(() => {\n    const p = pubkey();\n    return p != null && isReactedByWithEmoji(p);\n  });\n\n  const publishReactionMutation = useReactionMutation(() => ({\n    eventId: props.event.id,\n  }));\n\n  const doReaction = (reactionTypes?: ReactionTypes) => {\n    if (isReactedByMe()) {\n      // TODO remove reaction\n      return;\n    }\n\n    ensureNonNull([pubkey(), props.event.id] as const)(([pubkeyNonNull, eventIdNonNull]) => {\n      publishReactionMutation.mutate({\n        relayUrls: config().relayUrls,\n        pubkey: pubkeyNonNull,\n        reactionTypes: reactionTypes ?? { type: 'LikeDislike', content: '+' },\n        eventId: eventIdNonNull,\n        kind: props.event.kind,\n        notifyPubkey: props.event.pubkey,\n      });\n      setReacted(true);\n    });\n  };\n\n  const handleReaction: JSX.EventHandler<HTMLButtonElement, MouseEvent> = (ev) => {\n    ev.stopPropagation();\n    doReaction();\n  };\n\n  const handleEmojiSelect = (emoji: EmojiData) => {\n    doReaction(emojiDataToReactionTypes(emoji));\n  };\n\n  const emojiPickerPopup = useEmojiPicker(() => ({\n    onEmojiSelect: handleEmojiSelect,\n  }));\n\n  return (\n    <>\n      <div\n        class=\"flex shrink-0 items-center gap-1\"\n        classList={{\n          'text-fg-tertiary': !isReactedByMe() || isReactedByMeWithEmoji(),\n          'hover:text-r-reaction': !isReactedByMe() || isReactedByMeWithEmoji(),\n          'text-r-reaction':\n            (isReactedByMe() && !isReactedByMeWithEmoji()) || publishReactionMutation.isPending,\n        }}\n      >\n        <button\n          class=\"size-4\"\n          onClick={handleReaction}\n          disabled={publishReactionMutation.isPending}\n        >\n          <Show when={isReactedByMe() && !isReactedByMeWithEmoji()} fallback={<HeartOutlined />}>\n            <HeartSolid />\n          </Show>\n        </button>\n        <Show when={!config().hideCount && !config().showEmojiReaction && reactions().length > 0}>\n          <div class=\"text-sm text-fg-tertiary\">\n            {formatSiPrefix(reactions().length, { minDigits: 4 })}\n          </div>\n        </Show>\n      </div>\n      <Show when={config().useEmojiReaction}>\n        <div\n          class=\"flex shrink-0 items-center gap-1\"\n          classList={{\n            'text-fg-tertiary': !isReactedByMe() || !isReactedByMeWithEmoji(),\n            'hover:text-r-reaction': !isReactedByMe() || !isReactedByMeWithEmoji(),\n            'text-r-reaction':\n              (isReactedByMe() && isReactedByMeWithEmoji()) || publishReactionMutation.isPending,\n          }}\n        >\n          <button\n            ref={emojiPickerPopup.targetRef}\n            class=\"size-4\"\n            onClick={() => emojiPickerPopup.open()}\n          >\n            <Plus />\n          </button>\n          {emojiPickerPopup.popup()}\n        </div>\n      </Show>\n    </>\n  );\n};\n\nconst RepostAction = (props: { event: NostrEvent }) => {\n  const { config } = useConfig();\n  const pubkey = usePubkey();\n\n  const [reposted, setReposted] = createSignal(false);\n\n  const { reposts, isRepostedBy } = useReposts(() => ({\n    eventId: props.event.id,\n  }));\n\n  const isRepostedByMe = createMemo(() => {\n    const p = pubkey();\n    return (p != null && isRepostedBy(p)) || reposted();\n  });\n\n  const publishRepostMutation = useRepostMutation(() => ({\n    eventId: props.event.id,\n  }));\n\n  const handleRepost: JSX.EventHandler<HTMLButtonElement, MouseEvent> = (ev) => {\n    ev.stopPropagation();\n\n    if (isRepostedByMe()) {\n      // TODO remove reaction\n      return;\n    }\n\n    ensureNonNull([pubkey(), props.event.id] as const)(([pubkeyNonNull, eventIdNonNull]) => {\n      publishRepostMutation.mutate({\n        relayUrls: config().relayUrls,\n        pubkey: pubkeyNonNull,\n        eventId: eventIdNonNull,\n        kind: props.event.kind,\n        notifyPubkey: props.event.pubkey,\n      });\n      setReposted(true);\n    });\n  };\n\n  return (\n    <div\n      class=\"flex shrink-0 items-center gap-1\"\n      classList={{\n        'text-fg-tertiary': !isRepostedByMe(),\n        'hover:text-r-repost': !isRepostedByMe(),\n        'text-r-repost': isRepostedByMe() || publishRepostMutation.isPending,\n      }}\n    >\n      <button onClick={handleRepost} disabled={publishRepostMutation.isPending}>\n        <span class=\"flex size-4\">\n          <ArrowPathRoundedSquare />\n        </span>\n      </button>\n      <Show when={!config().hideCount && reposts().length > 0}>\n        <div class=\"text-sm text-fg-tertiary\">\n          {formatSiPrefix(reposts().length, { minDigits: 4 })}\n        </div>\n      </Show>\n    </div>\n  );\n};\n\nconst ReactionsModal: Component<{ event: NostrEvent; onClose: () => void }> = (props) => {\n  const { reactions } = useReactions(() => ({\n    eventId: props.event.id,\n  }));\n\n  return (\n    <UserList\n      data={reactions()}\n      pubkeyExtractor={(ev) => ev.pubkey}\n      renderInfo={(ev) => (\n        <div class=\"h-4 min-w-4 max-w-8\">\n          <ReactionEmojiDisplay reactionTypes={reaction(ev).toReactionTypes()} />\n        </div>\n      )}\n      onClose={props.onClose}\n    />\n  );\n};\n\nconst RepostsModal: Component<{ event: NostrEvent; onClose: () => void }> = (props) => {\n  const { reposts } = useReposts(() => ({\n    eventId: props.event.id,\n  }));\n\n  return <UserList data={reposts()} pubkeyExtractor={(ev) => ev.pubkey} onClose={props.onClose} />;\n};\n\nconst EmojiReactions: Component<{ event: NostrEvent }> = (props) => {\n  const { config } = useConfig();\n  const pubkey = usePubkey();\n\n  const [reacted, setReacted] = createSignal(false);\n\n  const { reactions, reactionsGrouped, isReactedBy } = useReactions(() => ({\n    eventId: props.event.id,\n  }));\n\n  const mutation = useReactionMutation(() => ({\n    eventId: props.event.id,\n  }));\n\n  const isReactedByMe = () => {\n    const p = pubkey();\n    if (p == null) return reacted();\n    return reacted() || isReactedBy(p);\n  };\n\n  const doReaction = (reactionTypes?: ReactionTypes) => {\n    if (isReactedByMe()) {\n      // TODO remove reaction\n      return;\n    }\n\n    ensureNonNull([pubkey(), props.event.id] as const)(([pubkeyNonNull, eventIdNonNull]) => {\n      mutation.mutate({\n        relayUrls: config().relayUrls,\n        pubkey: pubkeyNonNull,\n        reactionTypes: reactionTypes ?? { type: 'LikeDislike', content: '+' },\n        eventId: eventIdNonNull,\n        kind: props.event.kind,\n        notifyPubkey: props.event.pubkey,\n      });\n      setReacted(true);\n    });\n  };\n\n  return (\n    <Show when={config().showEmojiReaction && reactions().length > 0}>\n      <div class=\"scrollbar flex gap-2 overflow-x-auto py-1\">\n        <For each={[...reactionsGrouped().entries()]}>\n          {([, events]) => {\n            const isReactedByMeWithThisContent =\n              events.findIndex((ev) => ev.pubkey === pubkey()) >= 0;\n            const reactionTypes = reaction(events[0]).toReactionTypes();\n            const emojiTypes = reactionTypesToEmojiTypes(reactionTypes);\n\n            const emojiPopup = useEmojiPopup(() =>\n              ensureNonNull([emojiTypes] as const)(([emoji]) => ({\n                emoji,\n                onClick: () => {\n                  if (isReactedByMe()) return;\n                  if (mutation.isPending) return;\n                  doReaction(reactionTypes);\n                },\n              })),\n            );\n\n            return (\n              <button\n                ref={(el) => emojiPopup.emojiRef(el)}\n                class=\"webkit-touch-callout-none flex h-6 touch-none select-none items-center rounded border border-border px-1\"\n                classList={{\n                  'text-fg-tertiary': !isReactedByMeWithThisContent,\n                  'hover:bg-r-reaction/10': !isReactedByMeWithThisContent,\n                  'hover:border-r-reaction/40': !isReactedByMeWithThisContent,\n                  'bg-r-reaction/10': isReactedByMeWithThisContent,\n                  'border-r-reaction/40': isReactedByMeWithThisContent,\n                  'text-r-reaction': isReactedByMeWithThisContent,\n                }}\n                type=\"button\"\n              >\n                <span class=\"flex h-5 min-w-5 max-w-[128px] items-center justify-center\">\n                  <ReactionEmojiDisplay reactionTypes={reactionTypes} />\n                </span>\n                <Show when={!config().hideCount}>\n                  <span class=\"ml-1 text-sm\">{events.length}</span>\n                </Show>\n                {emojiPopup.popup()}\n              </button>\n            );\n          }}\n        </For>\n      </div>\n    </Show>\n  );\n};\n\nconst Actions: Component<ActionProps> = (props) => {\n  const i18n = useTranslation();\n  const { config } = useConfig();\n  const pubkey = usePubkey();\n  const commands = useCommands();\n\n  const [modal, setModal] = createSignal<\n    'EventDebugModal' | 'Reactions' | 'Reposts' | 'ZapRequest' | null\n  >(null);\n\n  const closeModal = () => setModal(null);\n\n  const deleteMutation = createMutation(() => ({\n    mutationKey: ['deleteEvent', props.event.id],\n    mutationFn: (...params: Parameters<typeof commands.deleteEvent>) =>\n      commands\n        .deleteEvent(...params)\n        .then((promeses) => Promise.allSettled(promeses.map(timeout(10000)))),\n    onSuccess: (results) => {\n      // TODO タイムラインから削除する\n      const succeeded = results.filter((res) => res.status === 'fulfilled').length;\n      const failed = results.length - succeeded;\n      if (succeeded === results.length) {\n        window.alert(i18n.t('post.deletedSuccessfully'));\n      } else if (succeeded > 0) {\n        window.alert(i18n.t('post.failedToDeletePartially', { count: failed }));\n      } else {\n        window.alert(i18n.t('post.failedToDelete'));\n      }\n    },\n    onError: (err) => {\n      console.error('failed to delete', err);\n    },\n  }));\n\n  const otherActionsPopup = useContextMenu(() => ({\n    menu: [\n      {\n        content: i18n.t('post.copyEventId'),\n        onSelect: () => {\n          navigator.clipboard\n            .writeText(noteEncode(props.event.id))\n            .catch((err) => window.alert(err));\n        },\n      },\n      {\n        content: i18n.t('post.showJSON'),\n        onSelect: () => {\n          setModal('EventDebugModal');\n        },\n      },\n      {\n        content: i18n.t('post.showReposts'),\n        onSelect: () => {\n          setModal('Reposts');\n        },\n      },\n      {\n        content: i18n.t('post.showReactions'),\n        onSelect: () => {\n          setModal('Reactions');\n        },\n      },\n      {\n        when: () => props.event.pubkey === pubkey(),\n        content: <span class=\"text-red-500\">{i18n.t('post.deletePost')}</span>,\n        onSelect: () => {\n          const p = pubkey();\n          if (p == null) return;\n\n          if (!window.confirm(i18n.t('post.confirmDelete'))) return;\n          deleteMutation.mutate({\n            relayUrls: config().relayUrls,\n            pubkey: p,\n            eventId: props.event.id,\n            kind: props.event.kind,\n          });\n        },\n      },\n    ],\n  }));\n\n  return (\n    <>\n      <EmojiReactions event={props.event} />\n      <div class=\"actions flex w-64 max-w-full items-center justify-between pt-1\">\n        <button\n          class=\"shrink-0 text-fg-tertiary hover:text-fg-tertiary/70\"\n          onClick={(ev) => {\n            ev.stopPropagation();\n            props.onClickReply();\n          }}\n        >\n          <span class=\"flex size-4\">\n            <ChatBubbleLeft />\n          </span>\n        </button>\n        <RepostAction event={props.event} />\n        <ReactionAction event={props.event} />\n        <button type=\"button\" onClick={() => setModal('ZapRequest')}>\n          <span class=\"flex size-4 text-fg-tertiary hover:text-r-zap\">\n            <Bolt />\n          </span>\n        </button>\n        <button\n          ref={otherActionsPopup.targetRef}\n          type=\"button\"\n          class=\"size-4 shrink-0 text-fg-tertiary hover:text-fg-tertiary/70\"\n          onClick={() => otherActionsPopup.open()}\n        >\n          <EllipsisHorizontal />\n        </button>\n        {otherActionsPopup.popup()}\n      </div>\n      <Switch>\n        <Match when={modal() === 'EventDebugModal'}>\n          <EventDebugModal event={props.event} onClose={closeModal} />\n        </Match>\n        <Match when={modal() === 'Reactions'}>\n          <ReactionsModal event={props.event} onClose={closeModal} />\n        </Match>\n        <Match when={modal() === 'Reposts'}>\n          <RepostsModal event={props.event} onClose={closeModal} />\n        </Match>\n        <Match when={modal() === 'ZapRequest'}>\n          <ZapRequestModal zapTo={{ event: props.event }} onClose={closeModal} />\n        </Match>\n      </Switch>\n    </>\n  );\n};\n\nexport default Actions;\n","import { createSignal, type Component, type JSX, Show } from 'solid-js';\n\nimport ExclamationTriangle from 'heroicons/24/outline/exclamation-triangle.svg';\n\nimport { useTranslation } from '@/i18n/useTranslation';\nimport { ContentWarning } from '@/nostr/event/TextNoteLike';\n\nexport type ContentWarningDisplayProps = {\n  contentWarning: ContentWarning;\n  children: JSX.Element;\n};\n\nconst ContentWarningDisplay: Component<ContentWarningDisplayProps> = (props) => {\n  const i18n = useTranslation();\n  const [showContentWarning, setShowContentWarning] = createSignal(false);\n\n  return (\n    <Show\n      when={!props.contentWarning.contentWarning || showContentWarning()}\n      fallback={\n        <button\n          class=\"mt-2 flex w-full flex-col items-center rounded border border-border p-2 text-center text-xs text-fg-secondary\"\n          onClick={() => setShowContentWarning(true)}\n        >\n          <span class=\"inline-block size-4\">\n            <ExclamationTriangle />\n          </span>\n          <span>{i18n.t('post.contentWarning.show')}</span>\n          <Show when={props.contentWarning.reason != null}>\n            <span>\n              {i18n.t('post.contentWarning.reason')}: {props.contentWarning.reason}\n            </span>\n          </Show>\n        </button>\n      }\n    >\n      <div>{props.children}</div>\n      <Show when={props.contentWarning.contentWarning}>\n        <button\n          class=\"text-xs text-fg-secondary hover:text-fg-secondary/70\"\n          onClick={() => setShowContentWarning(false)}\n        >\n          {i18n.t('post.contentWarning.hide')}\n        </button>\n      </Show>\n    </Show>\n  );\n};\n\nexport default ContentWarningDisplay;\n","import { Show } from 'solid-js';\n\nimport useProfile from '@/nostr/useProfile';\nimport npubEncodeFallback from '@/utils/npubEncodeFallback';\n\nexport type GeneralUserMentionDisplayProps = {\n  pubkey: string;\n};\n\nconst GeneralUserMentionDisplay = (props: GeneralUserMentionDisplayProps) => {\n  const { profile } = useProfile(() => ({\n    pubkey: props.pubkey,\n  }));\n\n  return (\n    <Show\n      when={(profile()?.name?.length ?? 0) > 0}\n      fallback={`@${npubEncodeFallback(props.pubkey)}`}\n    >\n      @{profile()?.name ?? props.pubkey}\n    </Show>\n  );\n};\n\nexport default GeneralUserMentionDisplay;\n","import { Component, createSignal, Show } from 'solid-js';\n\nimport LazyLoad from '@/components/utils/LazyLoad';\nimport SafeLink from '@/components/utils/SafeLink';\nimport { useTranslation } from '@/i18n/useTranslation';\n\ntype AudioDisplayProps = {\n  url: string;\n  initialHidden: boolean;\n};\n\nconst AudioDisplay: Component<AudioDisplayProps> = (props) => {\n  const i18n = useTranslation();\n  const [hidden, setHidden] = createSignal(props.initialHidden);\n\n  return (\n    <Show\n      when={!hidden()}\n      fallback={\n        <button\n          class=\"rounded bg-bg-tertiary p-3 text-xs text-fg-secondary hover:shadow\"\n          onClick={() => setHidden(false)}\n        >\n          {i18n.t('post.showAudio')}\n        </button>\n      }\n    >\n      <LazyLoad fallback={<div class=\"max-w-full\" />}>\n        {() => (\n          <SafeLink class=\"my-2 block\" href={props.url}>\n            {/* eslint-disable-next-line jsx-a11y/media-has-caption */}\n            <audio src={props.url} controls>\n              <a href={props.url}>{i18n.t('post.download')}</a>\n            </audio>\n          </SafeLink>\n        )}\n      </LazyLoad>\n    </Show>\n  );\n};\n\nexport default AudioDisplay;\n","import { Component, createSignal, Show } from 'solid-js';\n\nimport LazyLoad from '@/components/utils/LazyLoad';\nimport SafeLink from '@/components/utils/SafeLink';\nimport { useTranslation } from '@/i18n/useTranslation';\nimport { thumbnailUrl } from '@/utils/url';\n\ntype ImageDisplayProps = {\n  url: string;\n  initialHidden: boolean;\n};\n\nconst ImageDisplay: Component<ImageDisplayProps> = (props) => {\n  let imageRef: HTMLImageElement | undefined;\n  const i18n = useTranslation();\n  const [hidden, setHidden] = createSignal(props.initialHidden);\n  const [isError, setIsError] = createSignal(false);\n\n  return (\n    <Show\n      when={!hidden()}\n      fallback={\n        <button\n          class=\"rounded bg-bg-tertiary p-3 text-xs text-fg-secondary hover:shadow\"\n          onClick={() => setHidden(false)}\n        >\n          {i18n.t('post.showImage')}\n        </button>\n      }\n    >\n      <LazyLoad\n        fallback={\n          <div class=\"aspect-video max-w-full\">\n            <SafeLink class=\"text-link underline\" href={props.url} />\n          </div>\n        }\n      >\n        {() => (\n          <Show\n            when={!isError()}\n            fallback={<SafeLink class=\"text-link underline\" href={props.url} />}\n          >\n            <SafeLink class=\"my-2 block\" href={props.url}>\n              <img\n                ref={imageRef}\n                class=\"max-h-64 max-w-full rounded object-contain shadow hover:shadow-md\"\n                src={thumbnailUrl(props.url)}\n                alt={props.url}\n                onError={() => setIsError(true)}\n              />\n            </SafeLink>\n          </Show>\n        )}\n      </LazyLoad>\n    </Show>\n  );\n};\n\nexport default ImageDisplay;\n","import { Show } from 'solid-js';\n\nimport * as Kind from 'nostr-tools/kinds';\n\n// eslint-disable-next-line import/no-cycle\nimport EventDisplayById from '@/components/event/EventDisplayById';\nimport EventLink from '@/components/EventLink';\nimport LazyLoad from '@/components/utils/LazyLoad';\nimport { type MentionedEvent } from '@/nostr/parseTextNote';\n\nexport type MentionedEventDisplayProps = {\n  mentionedEvent: MentionedEvent;\n};\n\nconst MentionedEventDisplay = (props: MentionedEventDisplayProps) => (\n  <Show\n    when={props.mentionedEvent.marker != null && props.mentionedEvent.marker.length > 0}\n    fallback={<EventLink eventId={props.mentionedEvent.eventId} />}\n  >\n    <div class=\"my-1 rounded border p-1\">\n      <LazyLoad>\n        {() => (\n          <EventDisplayById\n            eventId={props.mentionedEvent.eventId}\n            embedding={false}\n            actions={false}\n            ensureKinds={[Kind.ShortTextNote]}\n          />\n        )}\n      </LazyLoad>\n    </div>\n  </Show>\n);\n\nexport default MentionedEventDisplay;\n","import GeneralUserMentionDisplay from '@/components/event/textNote/GeneralUserMentionDisplay';\nimport useModalState from '@/hooks/useModalState';\n\nexport type MentionedUserDisplayProps = {\n  pubkey: string;\n};\n\nconst MentionedUserDisplay = (props: MentionedUserDisplayProps) => {\n  const { showProfile } = useModalState();\n\n  const handleClick = () => {\n    showProfile(props.pubkey);\n  };\n  return (\n    <button class=\"inline select-text text-link underline\" onClick={handleClick}>\n      <GeneralUserMentionDisplay pubkey={props.pubkey} />\n    </button>\n  );\n};\n\nexport default MentionedUserDisplay;\n","import { createQuery } from '@tanstack/solid-query';\n\nconst directAccessHosts = ['www3.nhk.or.jp'];\n\nexport type OgpContent = {\n  url: string;\n  title: string;\n  description: string;\n  image: string;\n};\n\nexport const getCharset = (source: ArrayBuffer): string | null => {\n  // https://www.w3.org/International/questions/qa-html-encoding-declarations.ja\n  const content = new TextDecoder('US-ASCII').decode(source.slice(0, 1024));\n\n  const metaCharsetMatch = content.match(/<meta\\s+charset=\"([-A-Za-z0-9]+)\"/i);\n  if (metaCharsetMatch != null) {\n    return metaCharsetMatch[1].toLowerCase();\n  }\n\n  const metaContentTypeMatch = content.match(\n    /<meta\\s+http-equiv=\"Content-Type\"\\s*content=\"text\\/html;\\s*charset=([-A-Za-z0-9_]+)\"/i,\n  );\n  if (metaContentTypeMatch != null) {\n    return metaContentTypeMatch[1].toLowerCase();\n  }\n\n  return null;\n};\n\n// https://developer.mozilla.org/en-US/docs/Web/API/TextDecoder/decode\nconst supportedEncodings = new Set(['utf-8', 'shift_jis', 'shift-jis', 'euc-jp', 'iso-2022-jp']);\n\nexport const fixEncoding = (source: ArrayBuffer): string => {\n  try {\n    const charset = getCharset(source) ?? 'utf-8';\n    if (!supportedEncodings.has(charset)) {\n      throw new Error(`Unsupported encodings: ${charset}`);\n    }\n    const decoder = new TextDecoder(charset);\n    return decoder.decode(source);\n  } catch (e) {\n    throw new Error('Failed to convert charset', { cause: e });\n  }\n};\n\nexport const parseOgpFromDOM = (doc: Document, urlString: string): OgpContent | null => {\n  const props: { [property: string]: string } = {};\n\n  Array.from(doc.head.querySelectorAll('meta')).forEach((m) => {\n    const property = m.getAttribute('property') || m.getAttribute('name');\n    const content = m.getAttribute('content');\n    if (property != null && content != null) {\n      props[property] = content;\n    }\n  });\n\n  // Required\n  const image = props['og:image'] || props['twitter:image'];\n  const title = props['og:title'] || props['twitter:title'];\n  const url = props['og:url'] || urlString;\n  // Optional\n  const description = props['og:description'] || props['twitter:description'] || '';\n\n  if (image && title && url) {\n    return { title, description, image, url } satisfies OgpContent;\n  }\n  return null;\n};\n\nexport const parseOgp = (text: string, urlString: string): OgpContent | null => {\n  const doc = new DOMParser().parseFromString(text, 'text/html');\n  return parseOgpFromDOM(doc, urlString);\n};\n\nexport const isOgpUrl = (urlString: string): boolean => {\n  const url = new URL(urlString);\n  return url.protocol === 'https:';\n};\n\nexport const shouldAccessDirectly = (urlString: string): boolean => {\n  const url = new URL(urlString);\n  return directAccessHosts.includes(url.hostname);\n};\n\nexport const buildUrl = (urlString: string): string => {\n  if (shouldAccessDirectly(urlString)) return urlString;\n  return `https://corsproxy.io/?${encodeURIComponent(urlString)}`;\n};\n\nexport const fetchOgpContent = async (urlString: string): Promise<OgpContent | null> => {\n  try {\n    if (!isOgpUrl(urlString)) return null;\n\n    const url = buildUrl(urlString);\n\n    const res = await fetch(url, {\n      mode: 'cors',\n      headers: { Accept: 'text/html' },\n      credentials: 'omit',\n    });\n    const arrayBuffer = await res.arrayBuffer();\n    const encodedContent = fixEncoding(arrayBuffer);\n    return parseOgp(encodedContent, urlString);\n  } catch (err) {\n    console.error(`failed to fetch ogp for ${urlString}`, err);\n    return null;\n  }\n};\n\nexport type UseOgpProps = {\n  url: string;\n};\n\nexport const useOgp = (propsProvider: () => UseOgpProps) => {\n  const genQueryKey = () => ['useOgp', propsProvider().url] as const;\n\n  const query = createQuery(() => ({\n    queryKey: genQueryKey(),\n    queryFn: ({ queryKey: [, url] }) => fetchOgpContent(url),\n    staleTime: 4 * 60 * 60 * 1000, // 4 hour\n    gcTime: 4 * 60 * 60 * 1000, // 4 hour\n    refetchOnWindowFocus: false,\n    refetchOnMount: false,\n  }));\n\n  const ogp = () => query.data;\n\n  return { query, ogp };\n};\n","import { Component, JSX, Switch, Match, createSignal, createEffect, Show } from 'solid-js';\n\nimport LazyLoad from '@/components/utils/LazyLoad';\nimport SafeLink from '@/components/utils/SafeLink';\nimport useConfig from '@/core/useConfig';\nimport { useTranslation } from '@/i18n/useTranslation';\nimport { useOgp, isOgpUrl } from '@/utils/ogp';\nimport { isTwitterUrl, parseYouTubeVideoUrl } from '@/utils/url';\n\ntype PreviewedLinkProps = {\n  url: string;\n  initialHidden: boolean;\n  children?: JSX.Element;\n};\n\nconst twitterUrl = (urlString: string): string => {\n  try {\n    const url = new URL(urlString);\n    url.host = 'twitter.com';\n    return url.href;\n  } catch {\n    return urlString;\n  }\n};\n\nconst youtubeUrl = (videoId: string): string => {\n  const iframeUrl = new URL(`https://www.youtube-nocookie.com/embed/`);\n  iframeUrl.pathname += videoId;\n  iframeUrl.searchParams.set('origin', window.location.origin);\n  return iframeUrl.href;\n};\n\nconst TwitterEmbed: Component<{ url: string }> = (props) => {\n  let twitterRef: HTMLQuoteElement | undefined;\n\n  const { getColorTheme } = useConfig();\n\n  createEffect(() => {\n    if (isTwitterUrl(props.url)) {\n      window.twttr?.widgets?.load(twitterRef);\n    }\n  });\n\n  const dataTheme = () => {\n    const colorTheme = getColorTheme();\n    if (colorTheme.brightness === 'dark') {\n      return 'dark';\n    }\n    return 'light';\n  };\n\n  return (\n    <>\n      <SafeLink class=\"text-link underline\" href={props.url} />\n      <blockquote ref={twitterRef} class=\"twitter-tweet\" data-theme={dataTheme()}>\n        <a\n          class=\"text-link underline\"\n          href={twitterUrl(props.url)}\n          target=\"_blank\"\n          rel=\"noreferrer noopener\"\n        >\n          {twitterUrl(props.url)}\n        </a>\n      </blockquote>\n    </>\n  );\n};\n\nconst OgpEmbed: Component<{ class?: string; url: string }> = (props) => {\n  const { ogp } = useOgp(() => ({\n    url: props.url,\n  }));\n\n  return (\n    <Show when={ogp()} fallback={<SafeLink class=\"text-link underline\" href={props.url} />} keyed>\n      {(ogpProps) => (\n        <>\n          <SafeLink class=\"text-link underline\" href={props.url} />\n          <SafeLink href={props.url}>\n            <div class=\"my-2 rounded-lg border border-border transition-colors hover:bg-bg-tertiary\">\n              <img\n                alt={ogpProps.title}\n                class=\"max-w-full rounded-t-lg object-contain shadow\"\n                src={ogpProps.image}\n              />\n              <div class=\"mb-1 p-1\">\n                <div class=\"text-xs text-fg-secondary\">{new URL(ogpProps.url).host}</div>\n                <div class=\"text-sm\">{ogpProps.title}</div>\n                <div class=\"text-xs text-fg-secondary\">{ogpProps.description}</div>\n              </div>\n            </div>\n          </SafeLink>\n        </>\n      )}\n    </Show>\n  );\n};\n\ntype ClickToShowProps = {\n  initialHidden: boolean;\n  url: string;\n  children: JSX.Element;\n};\n\nconst ClickToShow: Component<ClickToShowProps> = (props) => {\n  const i18n = useTranslation();\n  const [hidden, setHidden] = createSignal(props.initialHidden);\n\n  return (\n    <Show\n      when={!hidden()}\n      fallback={\n        <>\n          <SafeLink class=\"text-link underline\" href={props.url} />\n          <div>\n            <button\n              class=\"flex flex-col items-center rounded bg-bg-tertiary p-3 text-xs text-fg-secondary hover:shadow\"\n              onClick={() => setHidden(false)}\n            >\n              {i18n.t('post.showPreview')}\n            </button>\n          </div>\n        </>\n      }\n    >\n      {props.children}\n    </Show>\n  );\n};\n\nconst PreviewedLink: Component<PreviewedLinkProps> = (props) => {\n  const { config } = useConfig();\n\n  return (\n    <Switch fallback={<SafeLink class=\"text-link underline\" href={props.url} />}>\n      <Match when={config().embedding.twitter && isTwitterUrl(props.url)}>\n        <ClickToShow url={props.url} initialHidden={props.initialHidden}>\n          <TwitterEmbed url={props.url} />\n        </ClickToShow>\n      </Match>\n      <Match when={config().embedding.youtube && parseYouTubeVideoUrl(props.url)} keyed>\n        {({ videoId }) => (\n          <ClickToShow url={props.url} initialHidden={props.initialHidden}>\n            <LazyLoad fallback={<SafeLink class=\"text-link underline\" href={props.url} />}>\n              {() => (\n                <>\n                  <SafeLink class=\"text-link underline\" href={props.url} />\n                  <div class=\"my-2 aspect-video w-full\">\n                    <iframe\n                      loading=\"lazy\"\n                      title=\"YouTube\"\n                      class=\"my-2 size-full\"\n                      src={youtubeUrl(videoId)}\n                      allowfullscreen\n                    />\n                  </div>\n                </>\n              )}\n            </LazyLoad>\n          </ClickToShow>\n        )}\n      </Match>\n      <Match when={config().embedding.ogp && isOgpUrl(props.url)}>\n        <ClickToShow url={props.url} initialHidden={props.initialHidden}>\n          <LazyLoad>{() => <OgpEmbed url={props.url} />}</LazyLoad>\n        </ClickToShow>\n      </Match>\n    </Switch>\n  );\n};\n\nexport default PreviewedLink;\n","import { Component, createSignal, Show } from 'solid-js';\n\nimport LazyLoad from '@/components/utils/LazyLoad';\nimport SafeLink from '@/components/utils/SafeLink';\nimport { useTranslation } from '@/i18n/useTranslation';\n\ntype VideoDisplayProps = {\n  url: string;\n  initialHidden: boolean;\n};\n\nconst VideoDisplay: Component<VideoDisplayProps> = (props) => {\n  let videoRef: HTMLVideoElement | undefined;\n  const i18n = useTranslation();\n  const [hidden, setHidden] = createSignal(props.initialHidden);\n\n  return (\n    <Show\n      when={!hidden()}\n      fallback={\n        <button\n          class=\"rounded bg-bg-tertiary p-3 text-xs text-fg-secondary hover:shadow\"\n          onClick={() => setHidden(false)}\n        >\n          {i18n.t('post.showVideo')}\n        </button>\n      }\n    >\n      <LazyLoad fallback={<div class=\"aspect-video max-w-full\" />}>\n        {() => (\n          <SafeLink class=\"my-2 block\" href={props.url}>\n            {/* eslint-disable-next-line jsx-a11y/media-has-caption */}\n            <video\n              ref={videoRef}\n              class=\"max-h-64 max-w-full rounded-sm object-contain shadow\"\n              src={props.url}\n              controls\n            >\n              <a href={props.url}>{i18n.t('post.download')}</a>\n            </video>\n          </SafeLink>\n        )}\n      </LazyLoad>\n    </Show>\n  );\n};\n\nexport default VideoDisplay;\n","import { For } from 'solid-js';\n\nimport * as Kind from 'nostr-tools/kinds';\n\n// eslint-disable-next-line import/no-cycle\nimport EventDisplayById from '@/components/event/EventDisplayById';\n// import ParameterizedReplaceableEventDisplayById from '@/components/event/ParameterizedReplaceableEventDisplayById';\nimport AudioDisplay from '@/components/event/textNote/AudioDisplay';\nimport ImageDisplay from '@/components/event/textNote/ImageDisplay';\nimport MentionedEventDisplay from '@/components/event/textNote/MentionedEventDisplay';\nimport MentionedUserDisplay from '@/components/event/textNote/MentionedUserDisplay';\nimport PreviewedLink from '@/components/event/textNote/PreviewedLink';\nimport VideoDisplay from '@/components/event/textNote/VideoDisplay';\nimport EventLink from '@/components/EventLink';\nimport useEmojiPopup from '@/components/useEmojiPopup';\nimport { createRelaysColumn, createSearchColumn } from '@/core/column';\nimport useConfig from '@/core/useConfig';\nimport { useRequestCommand } from '@/hooks/useCommandBus';\nimport { ParsedTextNoteResolvedNode, type ParsedTextNoteResolved } from '@/nostr/parseTextNote';\nimport { isImageUrl, isVideoUrl, isAudioUrl, isWebSocketUrl } from '@/utils/url';\n\nexport type TextNoteContentDisplayProps = {\n  parsed: ParsedTextNoteResolved;\n  embedding: boolean;\n  initialHidden?: boolean;\n};\n\nconst TextNoteContentDisplay = (props: TextNoteContentDisplayProps) => {\n  const { config, saveColumn } = useConfig();\n\n  const request = useRequestCommand();\n\n  const addHashTagColumn = (query: string) => {\n    saveColumn(createSearchColumn({ query }));\n    request({ command: 'moveToLastColumn' }).catch((err) => console.error(err));\n  };\n\n  const addRelayColumn = (url: string) => {\n    saveColumn(createRelaysColumn({ name: url, relayUrls: [url] }));\n    request({ command: 'moveToLastColumn' }).catch((err) => console.error(err));\n  };\n\n  return (\n    <For each={props.parsed}>\n      {(item: ParsedTextNoteResolvedNode) => {\n        if (item.type === 'PlainText') {\n          return <span>{item.content}</span>;\n        }\n        if (item.type === 'URL') {\n          const initialHidden = () =>\n            !config().showMedia || !props.embedding || (props.initialHidden ?? false);\n\n          if (isImageUrl(item.content)) {\n            return <ImageDisplay url={item.content} initialHidden={initialHidden()} />;\n          }\n          if (isVideoUrl(item.content)) {\n            return <VideoDisplay url={item.content} initialHidden={initialHidden()} />;\n          }\n          if (isAudioUrl(item.content)) {\n            return <AudioDisplay url={item.content} initialHidden={initialHidden()} />;\n          }\n          if (isWebSocketUrl(item.content)) {\n            return (\n              <button\n                class=\"select-text text-link underline\"\n                onClick={() => addRelayColumn(item.content)}\n              >\n                {item.content}\n              </button>\n            );\n          }\n          return <PreviewedLink url={item.content} initialHidden={initialHidden()} />;\n        }\n        if (item.type === 'TagReferenceResolved') {\n          if (item.reference == null) {\n            return <span>{item.content}</span>;\n          }\n          if (item.reference.type === 'MentionedUser') {\n            return <MentionedUserDisplay pubkey={item.reference.pubkey} />;\n          }\n          if (item.reference.type === 'MentionedEvent') {\n            if (props.embedding) {\n              return <MentionedEventDisplay mentionedEvent={item.reference} />;\n            }\n            return <EventLink eventId={item.reference.eventId} />;\n          }\n        }\n        if (item.type === 'Bech32Entity') {\n          if (item.data.type === 'note' && props.embedding) {\n            return (\n              <div class=\"my-1 rounded border border-border p-1\">\n                <EventDisplayById\n                  eventId={item.data.data}\n                  actions={false}\n                  embedding={false}\n                  ensureKinds={[Kind.ShortTextNote]}\n                />\n              </div>\n            );\n          }\n          if (item.data.type === 'nevent' && props.embedding) {\n            return (\n              <div class=\"my-1 rounded border border-border p-1\">\n                <EventDisplayById eventId={item.data.data.id} actions={false} embedding={false} />\n              </div>\n            );\n          }\n          if (item.data.type === 'npub') {\n            return <MentionedUserDisplay pubkey={item.data.data} />;\n          }\n          if (item.data.type === 'nprofile') {\n            return <MentionedUserDisplay pubkey={item.data.data.pubkey} />;\n          }\n          return <span class=\"text-link underline\">{item.content}</span>;\n        }\n        if (item.type === 'HashTag') {\n          return (\n            <button\n              class=\"select-text text-link underline\"\n              onClick={() => addHashTagColumn(item.content)}\n            >\n              {item.content}\n            </button>\n          );\n        }\n        if (item.type === 'CustomEmojiResolved') {\n          const { url, shortcode, content } = item;\n          if (url == null) return <span>{item.content}</span>;\n          // const { imageRef, canvas } = useImageAnimation({ initialPlaying: false });\n          const { emojiRef, popup } = useEmojiPopup(() => ({\n            emoji: { type: 'CustomEmoji', url, shortcode },\n          }));\n\n          return (\n            <>\n              {popup()}\n              <img\n                ref={emojiRef}\n                class=\"inline-block h-8 max-w-32\"\n                src={url}\n                alt={content}\n                title={shortcode}\n              />\n            </>\n          );\n        }\n        console.error('Not all ParsedTextNoteNodes are covered', item);\n        return null;\n      }}\n    </For>\n  );\n};\n\nexport default TextNoteContentDisplay;\n","import { createSignal, onMount, onCleanup } from 'solid-js';\n\nimport throttle from 'lodash/throttle';\n\n// TODO Find a better way to solve this. Firefox on Windows can cause 2px gap.\nconst Offset = 2;\n\nconst ThrottleWaitMs = 200;\n\n/**\n * Detect overflow if the height of the target element content is bigger than\n * actual displayed height or window height.\n */\nconst useDetectOverflow = () => {\n  let elementRef: HTMLElement | undefined;\n  const [overflow, setOverflow] = createSignal(false);\n\n  const setElementRef = (el: HTMLElement) => {\n    elementRef = el;\n  };\n\n  const detectOverflow = throttle(() => {\n    if (elementRef != null) {\n      setOverflow(\n        elementRef.scrollHeight > elementRef.clientHeight + Offset ||\n          elementRef.scrollHeight > document.documentElement.clientHeight + Offset,\n      );\n    }\n  }, ThrottleWaitMs);\n\n  onMount(() => {\n    if (elementRef != null) {\n      detectOverflow();\n\n      const observer = new IntersectionObserver(\n        (entries) => {\n          entries.forEach((entry) => {\n            if (entry.isIntersecting) {\n              detectOverflow();\n            }\n          });\n        },\n        {\n          threshold: [0, 0.25, 0.5, 0.75, 1],\n        },\n      );\n      observer.observe(elementRef);\n\n      const handleResize = () => detectOverflow();\n      window.addEventListener('resize', handleResize);\n\n      onCleanup(() => {\n        observer.disconnect();\n        window.removeEventListener('resize', handleResize);\n      });\n    }\n  });\n\n  return { overflow, elementRef: setElementRef };\n};\n\nexport default useDetectOverflow;\n","import { Component, JSX, Show, createSignal } from 'solid-js';\n\nimport LazyLoad from '@/components/utils/LazyLoad';\nimport useDetectOverflow from '@/hooks/useDetectOverflow';\nimport useFormatDate from '@/hooks/useFormatDate';\nimport { useTranslation } from '@/i18n/useTranslation';\nimport useProfile from '@/nostr/useProfile';\nimport npubEncodeFallback from '@/utils/npubEncodeFallback';\nimport { thumbnailUrl } from '@/utils/url';\n\nexport type PostProps = {\n  authorPubkey: string;\n  createdAt: Date;\n  content: JSX.Element;\n  actions?: JSX.Element;\n  footer?: JSX.Element;\n  onShowProfile?: () => void;\n  onShowEvent?: () => void;\n};\n\nconst Post: Component<PostProps> = (props) => {\n  const i18n = useTranslation();\n  const { overflow, elementRef } = useDetectOverflow();\n  const formatDate = useFormatDate();\n\n  const [showOverflow, setShowOverflow] = createSignal(false);\n  const createdAt = () => formatDate(props.createdAt);\n  const createdAtFull = () => props.createdAt.toLocaleString();\n\n  const { profile: author } = useProfile(() => ({\n    pubkey: props.authorPubkey,\n  }));\n\n  return (\n    <div class=\"post flex flex-col\">\n      <div class=\"flex w-full gap-1\">\n        <button\n          type=\"button\"\n          class=\"author-icon size-10 shrink-0 overflow-hidden rounded\"\n          onClick={(ev) => {\n            ev.preventDefault();\n            props.onShowProfile?.();\n          }}\n        >\n          <Show when={author()?.picture} keyed>\n            {(url) => (\n              <LazyLoad>\n                {() => (\n                  <img\n                    src={thumbnailUrl(url, 'icon')}\n                    alt=\"icon\"\n                    referrerpolicy=\"no-referrer\"\n                    class=\"size-full object-cover\"\n                  />\n                )}\n              </LazyLoad>\n            )}\n          </Show>\n        </button>\n        <div class=\"min-w-0 flex-auto\">\n          <div class=\"flex justify-between gap-1 text-xs\">\n            <button\n              type=\"button\"\n              class=\"author flex min-w-0 select-text truncate hover:text-link\"\n              onClick={(ev) => {\n                ev.preventDefault();\n                props?.onShowProfile?.();\n              }}\n            >\n              <span class=\"author flex min-w-0 truncate hover:text-link\">\n                <Show when={(author()?.display_name?.length ?? 0) > 0}>\n                  <div class=\"author-name truncate pr-1 font-bold hover:underline\">\n                    {author()?.display_name}\n                  </div>\n                </Show>\n                <div class=\"author-username truncate text-fg-secondary\">\n                  <Show\n                    when={author()?.name != null}\n                    fallback={`@${npubEncodeFallback(props.authorPubkey)}`}\n                  >\n                    @{author()?.name}\n                  </Show>\n                  {/* TODO <Match when={author()?.nip05 != null}>@{author()?.nip05}</Match> */}\n                </div>\n              </span>\n            </button>\n            <div class=\"created-at shrink-0\">\n              <button\n                type=\"button\"\n                class=\"select-text hover:underline\"\n                onClick={(ev) => {\n                  ev.preventDefault();\n                  props.onShowEvent?.();\n                }}\n                title={createdAtFull()}\n              >\n                {createdAt()}\n              </button>\n            </div>\n          </div>\n          <div\n            ref={elementRef}\n            class=\"overflow-hidden\"\n            classList={{ 'max-h-screen': !showOverflow(), 'max-h-none': showOverflow() }}\n          >\n            {props.content}\n          </div>\n          <Show when={overflow()}>\n            <button\n              class=\"mt-2 w-full rounded border border-border p-2 text-center text-xs text-fg-secondary shadow-sm hover:bg-bg-tertiary hover:shadow\"\n              onClick={(ev) => {\n                ev.stopPropagation();\n                setShowOverflow((current) => !current);\n              }}\n            >\n              <Show when={!showOverflow()} fallback={i18n.t('post.hideOverflow')}>\n                {i18n.t('post.showOverflow')}\n              </Show>\n            </button>\n          </Show>\n          <div class=\"actions\">{props.actions}</div>\n        </div>\n      </div>\n      <Show when={props.footer}>{props.footer}</Show>\n    </div>\n  );\n};\n\nexport default Post;\n","import { createContext, useContext } from 'solid-js';\n\nimport { type Event as NostrEvent } from 'nostr-tools/pure';\nimport { createStore } from 'solid-js/store';\n\nexport type TimelineContent = {\n  type: 'Replies';\n  event: NostrEvent;\n};\n\nexport type TimelineState = {\n  content?: TimelineContent;\n};\n\nexport type UseTimelineState = {\n  timelineState: TimelineState;\n  setTimeline: (content: TimelineContent) => void;\n  clearTimeline: () => void;\n};\n\nexport const TimelineContext = createContext<UseTimelineState>();\n\nexport const useTimelineContext = () => useContext(TimelineContext);\n\nexport const useTimelineState = (): UseTimelineState => {\n  const [timelineState, setTimelineState] = createStore<TimelineState>({});\n\n  return {\n    timelineState,\n    setTimeline: (content: TimelineContent) => setTimelineState('content', content),\n    clearTimeline: () => setTimelineState('content', undefined),\n  };\n};\n","import { Show, For, createSignal, createMemo, type Component } from 'solid-js';\n\nimport { type Event as NostrEvent } from 'nostr-tools/pure';\n\n// eslint-disable-next-line import/no-cycle\nimport Actions from '@/components/Actions';\n// eslint-disable-next-line import/no-cycle\nimport EventDisplayById from '@/components/event/EventDisplayById';\nimport ContentWarningDisplay from '@/components/event/textNote/ContentWarningDisplay';\nimport GeneralUserMentionDisplay from '@/components/event/textNote/GeneralUserMentionDisplay';\nimport TextNoteContentDisplay from '@/components/event/textNote/TextNoteContentDisplay';\nimport NotePostForm from '@/components/NotePostForm';\nimport Post from '@/components/Post';\nimport { useTimelineContext } from '@/components/timeline/TimelineContext';\nimport LazyLoad from '@/components/utils/LazyLoad';\nimport useModalState from '@/hooks/useModalState';\nimport { useTranslation } from '@/i18n/useTranslation';\nimport { textNote } from '@/nostr/event';\n\nexport type TextNoteProps = {\n  event: NostrEvent;\n  embedding?: boolean;\n  actions?: boolean;\n};\n\nconst TextNote: Component<TextNoteProps> = (props) => {\n  let textAreaRef: HTMLTextAreaElement | undefined;\n\n  const i18n = useTranslation();\n  const { showProfile } = useModalState();\n  const timelineContext = useTimelineContext();\n\n  const [showReplyForm, setShowReplyForm] = createSignal(false);\n  const closeReplyForm = () => setShowReplyForm(false);\n  const toggleReplyForm = () => {\n    setShowReplyForm((current) => !current);\n    if (showReplyForm() && textAreaRef != null) {\n      textAreaRef.focus();\n    }\n  };\n\n  const event = createMemo(() => textNote(props.event));\n\n  const embedding = () => props.embedding ?? true;\n  const actions = () => props.actions ?? true;\n\n  const showReplyEvent = (): string | undefined => {\n    if (embedding()) {\n      const replyingToEvent = event().replyingToEvent();\n\n      if (replyingToEvent != null && !event().containsEventMention(replyingToEvent.id)) {\n        return replyingToEvent.id;\n      }\n\n      const rootEvent = event().rootEvent();\n\n      if (\n        replyingToEvent == null &&\n        rootEvent != null &&\n        !event().containsEventMention(rootEvent.id)\n      ) {\n        return rootEvent.id;\n      }\n    }\n    return undefined;\n  };\n\n  return (\n    <div class=\"nostr-textnote\">\n      <Post\n        authorPubkey={event().pubkey}\n        createdAt={event().createdAtAsDate()}\n        content={\n          <div class=\"textnote-content\">\n            <Show when={showReplyEvent()} keyed>\n              {(id) => (\n                <div class=\"mt-1 rounded border border-border p-1\">\n                  <LazyLoad fallback={<div class=\"h-12\" />}>\n                    {() => <EventDisplayById eventId={id} actions={false} embedding={false} />}\n                  </LazyLoad>\n                </div>\n              )}\n            </Show>\n            <Show when={event().taggedPubkeys().length > 0}>\n              <div class=\"text-xs\">\n                {i18n.t('post.replyToPre')}\n                <For each={event().taggedPubkeys()}>\n                  {(replyToPubkey: string) => (\n                    <button\n                      class=\"select-text pr-1 text-link hover:underline\"\n                      onClick={(ev) => {\n                        ev.stopPropagation();\n                        showProfile(replyToPubkey);\n                      }}\n                    >\n                      <GeneralUserMentionDisplay pubkey={replyToPubkey} />\n                    </button>\n                  )}\n                </For>\n                {i18n.t('post.replyToPost')}\n              </div>\n            </Show>\n            <ContentWarningDisplay contentWarning={event().contentWarning()}>\n              <div class=\"content whitespace-pre-wrap break-words\">\n                <TextNoteContentDisplay\n                  parsed={event().parsed()}\n                  embedding={embedding()}\n                  initialHidden={event().contentWarning().contentWarning}\n                />\n              </div>\n            </ContentWarningDisplay>\n          </div>\n        }\n        actions={\n          <Show when={actions()}>\n            <LazyLoad fallback={<div class=\"h-5\" />}>\n              {() => <Actions event={props.event} onClickReply={toggleReplyForm} />}\n            </LazyLoad>\n          </Show>\n        }\n        footer={\n          <Show when={showReplyForm()}>\n            <NotePostForm\n              textAreaRef={(el) => {\n                textAreaRef = el;\n              }}\n              mode=\"reply\"\n              replyTo={props.event}\n              onClose={closeReplyForm}\n              onPost={closeReplyForm}\n            />\n          </Show>\n        }\n        onShowProfile={() => {\n          showProfile(event().pubkey);\n        }}\n        onShowEvent={() => {\n          timelineContext?.setTimeline({ type: 'Replies', event: props.event });\n        }}\n      />\n    </div>\n  );\n};\n\nexport default TextNote;\n","import { Switch, Match, Component } from 'solid-js';\n\nimport * as Kind from 'nostr-tools/kinds';\nimport { type Event as NostrEvent } from 'nostr-tools/pure';\n\n// import ChannelInfo from '@/components/event/ChannelInfo';\n// eslint-disable-next-line import/no-cycle\nimport Repost from '@/components/event/Repost';\n// eslint-disable-next-line import/no-cycle\nimport TextNote from '@/components/event/TextNote';\nimport EventLink from '@/components/EventLink';\nimport { useTranslation } from '@/i18n/useTranslation';\n\nexport type EventDisplayProps = {\n  event: NostrEvent;\n  embedding?: boolean;\n  actions?: boolean;\n  ensureKinds?: number[];\n};\n\nconst EventDisplay: Component<EventDisplayProps> = (props) => {\n  const i18n = useTranslation();\n\n  const isAllowedKind = () =>\n    props.ensureKinds == null ||\n    props.ensureKinds.length === 0 ||\n    props.ensureKinds.includes(props.event.kind);\n\n  return (\n    <Switch\n      fallback={\n        <div>\n          <span>{i18n.t('post.unsupportedKind', { kind: props.event.kind })}</span>\n          <EventLink eventId={props.event.id} kind={props.event.kind} />\n        </div>\n      }\n    >\n      <Match when={!isAllowedKind()} keyed>\n        <div>\n          <span>{i18n.t('post.unexpectedKind', { kind: props.event.kind })}</span>\n          <EventLink eventId={props.event.id} kind={props.event.kind} />\n        </div>\n      </Match>\n      <Match when={props.event.kind === Kind.ShortTextNote}>\n        <TextNote event={props.event} embedding={props.actions} actions={props.actions} />\n      </Match>\n      <Match when={props.event.kind === Kind.Repost}>\n        <Repost event={props.event} />\n      </Match>\n    </Switch>\n  );\n  /*\n      <Match when={props.event.kind === Kind.ChannelCreation}>\n        <ChannelInfo event={props.event} />\n      </Match>\n   */\n};\n\nexport default EventDisplay;\n","import { For, type Component, Show } from 'solid-js';\n\nimport { type Event as NostrEvent } from 'nostr-tools/pure';\n\nimport ColumnItem from '@/components/ColumnItem';\nimport EventDisplay from '@/components/event/EventDisplay';\nimport useConfig from '@/core/useConfig';\n\nexport type TimelineProps = {\n  events: NostrEvent[];\n};\n\nconst Timeline: Component<TimelineProps> = (props) => {\n  const { shouldMuteEvent } = useConfig();\n\n  return (\n    <For each={props.events}>\n      {(event) => (\n        <Show when={!shouldMuteEvent(event)}>\n          <ColumnItem>\n            <EventDisplay event={event} />\n          </ColumnItem>\n        </Show>\n      )}\n    </For>\n  );\n};\n\nexport default Timeline;\n","import { createSignal, createEffect, createMemo, onMount, onCleanup, on } from 'solid-js';\n\nimport { type Filter } from 'nostr-tools/filter';\nimport { type SubscribeManyParams } from 'nostr-tools/pool';\nimport { type Event as NostrEvent } from 'nostr-tools/pure';\nimport { insertEventIntoDescendingList } from 'nostr-tools/utils';\n\nimport useConfig from '@/core/useConfig';\nimport usePool from '@/nostr/usePool';\nimport useStats from '@/nostr/useStats';\nimport epoch from '@/utils/epoch';\n\nexport type UseSubscriptionProps = {\n  relayUrls: string[];\n  filters: Filter[];\n  options?: SubscribeManyParams;\n  /**\n   * subscribe not only stored events but also new events published after the subscription\n   * default is true\n   */\n  continuous?: boolean;\n  /**\n   * limit the number of events\n   */\n  limit?: number;\n  /**\n   * limit the number of events until EOSE\n   * This should be same to `limit` of REQ\n   */\n  eoseLimit?: number;\n  clientEventFilter?: (event: NostrEvent) => boolean;\n  onEvent?: (event: NostrEvent & { id: string }) => void;\n  onEOSE?: () => void;\n  signal?: AbortSignal;\n  debugId?: string;\n};\n\nlet count = 0;\n\nconst { setActiveSubscriptions } = useStats();\nsetInterval(() => {\n  setActiveSubscriptions(count);\n}, 1000);\n\n// avoid updating an array rapidly while this is fetching stored events\nconst useThrottledEvents = ({\n  eose,\n  limit,\n  eoseLimit,\n}: {\n  eose: () => boolean;\n  limit: () => number;\n  eoseLimit: () => number;\n}) => {\n  const SecondsToIgnore = 300; // 5 min\n  const [events, setEvents] = createSignal<NostrEvent[]>([]);\n\n  const delayedEvents: NostrEvent[] = [];\n  let timeoutId: ReturnType<typeof setTimeout> | undefined;\n\n  const reflectDelayedEvents = () => {\n    setEvents((currentEvents) => {\n      const newEvents = [...currentEvents];\n      delayedEvents.forEach((event) => {\n        insertEventIntoDescendingList(newEvents, event);\n      });\n      return newEvents.slice(0, eoseLimit());\n    });\n    // clear delayed events\n    delayedEvents.splice(0, delayedEvents.length);\n  };\n\n  const startTimerIfNotStarted = () => {\n    if (timeoutId != null) return;\n    timeoutId = setTimeout(() => {\n      timeoutId = undefined;\n      reflectDelayedEvents();\n    }, 100);\n  };\n\n  const stopTimer = () => {\n    if (timeoutId != null) {\n      clearTimeout(timeoutId);\n    }\n  };\n\n  const addEvent = (event: NostrEvent) => {\n    const diffSec = event.created_at - epoch();\n    if (diffSec > SecondsToIgnore) return;\n    if (diffSec > 0) {\n      setTimeout(() => addEvent(event), diffSec * 1000);\n      return;\n    }\n\n    if (!eose()) {\n      delayedEvents.push(event);\n      startTimerIfNotStarted();\n    } else {\n      // SimplePool de-duplicates events but sometimes onEvent is called for duplicated events.\n      // insertEventIntoDescendingList de-duplicates events.\n      // https://github.com/syusui-s/rabbit/issues/5\n      setEvents((currentEvents) => {\n        const newEvents = [...currentEvents];\n        insertEventIntoDescendingList(newEvents, event);\n        return newEvents.slice(0, limit());\n      });\n    }\n  };\n\n  const clearEvents = () => {\n    setEvents([]);\n    stopTimer();\n  };\n\n  createEffect(() => {\n    if (eose()) {\n      reflectDelayedEvents();\n    }\n  });\n\n  onCleanup(() => {\n    stopTimer();\n  });\n\n  return { events, setEvents, addEvent, clearEvents };\n};\n\nconst useSubscription = (propsProvider: () => UseSubscriptionProps | null) => {\n  const { config, shouldMuteEvent } = useConfig();\n  const pool = usePool();\n  const [eose, setEose] = createSignal<boolean>(false);\n  const props = createMemo(propsProvider);\n\n  const eoseLimit = () => propsProvider()?.eoseLimit ?? 25;\n  const limit = () => propsProvider()?.limit ?? 50;\n\n  const { events, addEvent, clearEvents, setEvents } = useThrottledEvents({\n    eose,\n    eoseLimit,\n    limit,\n  });\n\n  createEffect(\n    on(\n      () => [config().mutedPubkeys, config().mutedKeywords],\n      () => {\n        setEvents((currentEvents) => currentEvents.filter((event) => !shouldMuteEvent(event)));\n      },\n      { defer: true },\n    ),\n  );\n\n  onMount(() => {\n    console.debug('subscription mounted', propsProvider()?.debugId, propsProvider());\n    onCleanup(() => {\n      console.debug('subscription unmount', propsProvider()?.debugId, propsProvider());\n    });\n  });\n\n  const startSubscription = () => {\n    console.debug('startSubscription: start');\n\n    const currentProps = props();\n    if (currentProps == null) return;\n    const {\n      relayUrls,\n      filters,\n      options,\n      onEvent,\n      onEOSE,\n      clientEventFilter,\n      continuous = true,\n    } = currentProps;\n    let subscribing = true;\n    count += 1;\n\n    clearEvents();\n    setEose(false);\n\n    const sub = pool().subscribeMany(\n      relayUrls,\n      filters,\n      options ?? {\n        maxWait: 12000,\n        onevent: (event: NostrEvent) => {\n          if (onEvent != null) {\n            onEvent(event as NostrEvent & { id: string });\n          }\n          if (clientEventFilter != null && !clientEventFilter(event)) {\n            return;\n          }\n\n          addEvent(event);\n        },\n        oneose: () => {\n          // sometimes `oneose` called twice\n          if (eose()) return;\n\n          if (onEOSE != null) {\n            onEOSE();\n          }\n          setEose(true);\n\n          if (!continuous) {\n            sub.close();\n            if (subscribing) {\n              subscribing = false;\n              count -= 1;\n            }\n          }\n        },\n      },\n    );\n\n    onCleanup(() => {\n      console.debug('startSubscription: end');\n      sub.close();\n      if (subscribing) {\n        subscribing = false;\n        count -= 1;\n      }\n    });\n  };\n\n  createEffect(\n    on(\n      () => [props()],\n      () => startSubscription(),\n    ),\n  );\n\n  return { events, eose };\n};\n\nexport default useSubscription;\n","import {\n  createSignal,\n  createMemo,\n  batch,\n  Show,\n  type JSX,\n  type Accessor,\n  type Component,\n} from 'solid-js';\n\nimport { type Event as NostrEvent } from 'nostr-tools/pure';\n\nimport ColumnItem from '@/components/ColumnItem';\nimport { useTranslation } from '@/i18n/useTranslation';\nimport { pickOldestEvent } from '@/nostr/event/comparator';\nimport epoch from '@/utils/epoch';\n\nexport type UseLoadMoreProps = {\n  duration: number | null;\n};\n\nexport type UseLoadMore = {\n  setEvents: (event: NostrEvent[]) => void;\n  since: Accessor<number | undefined>;\n  until: Accessor<number | undefined>;\n  continuous: Accessor<boolean>;\n  loadLatest: () => void;\n  loadOld: () => void;\n  setTopMarkerRef: (el: HTMLElement) => void;\n};\n\nexport type LoadMoreProps = {\n  loadMore: UseLoadMore;\n  children: JSX.Element;\n  eose: boolean;\n};\n\nexport const useLoadMore = (propsProvider: () => UseLoadMoreProps): UseLoadMore => {\n  const props = createMemo(propsProvider);\n  const calcSince = (base: number): number | undefined => {\n    const { duration } = props();\n    if (duration == null) return undefined;\n    return base - duration;\n  };\n\n  const [events, setEvents] = createSignal<NostrEvent[]>([]);\n  const [since, setSince] = createSignal<number | undefined>(calcSince(epoch()));\n  const [until, setUntil] = createSignal<number | undefined>();\n  const [topMarkerRef, setTopMarkerRef] = createSignal<HTMLElement | undefined>();\n  const continuous = () => until() == null;\n\n  const loadLatest = () => {\n    batch(() => {\n      setUntil(undefined);\n      setSince(calcSince(epoch()));\n    });\n    topMarkerRef()?.scrollIntoView();\n  };\n\n  const loadOld = () => {\n    const oldest = pickOldestEvent(events());\n    if (oldest == null) return;\n    batch(() => {\n      setUntil(oldest.created_at);\n      setSince(calcSince(oldest.created_at));\n    });\n    topMarkerRef()?.scrollIntoView();\n  };\n\n  return {\n    setEvents,\n    since,\n    until,\n    continuous,\n    loadLatest,\n    loadOld,\n    setTopMarkerRef,\n  };\n};\n\nconst LoadMore: Component<LoadMoreProps> = (props) => {\n  const i18n = useTranslation();\n\n  return (\n    <>\n      <Show when={!props.loadMore.continuous()}>\n        <div class=\"none\" ref={props.loadMore.setTopMarkerRef} />\n        <ColumnItem>\n          <button\n            class=\"flex h-12 w-full flex-col items-center justify-center hover:text-fg-secondary\"\n            onClick={() => props.loadMore.loadLatest()}\n          >\n            <span>{i18n.t('column.loadLatest')}</span>\n          </button>\n        </ColumnItem>\n      </Show>\n      {props.children}\n      <ColumnItem>\n        <button\n          class=\"flex h-12 w-full flex-col items-center justify-center hover:text-fg-secondary disabled:text-fg-secondary/30\"\n          disabled={!props.eose}\n          onClick={() => props.loadMore.loadOld()}\n        >\n          <span>{i18n.t('column.loadOld')}</span>\n        </button>\n      </ColumnItem>\n    </>\n  );\n};\n\nexport default LoadMore;\n","import { createMemo } from 'solid-js';\n\nimport { createQuery, useQueryClient, type CreateQueryResult } from '@tanstack/solid-query';\nimport { Event as NostrEvent } from 'nostr-tools/pure';\n\nimport { genericEvent } from '@/nostr/event';\nimport { latestEventQuery } from '@/nostr/query';\nimport { BatchedEventsTask, FollowingsTask, registerTask } from '@/nostr/useBatchedEvents';\n\ntype Following = {\n  pubkey: string;\n  mainRelayUrl?: string;\n  petname?: string;\n};\n\ntype UseFollowingsProps = {\n  pubkey: string;\n};\n\nexport type UseFollowings = {\n  followings: () => Following[];\n  followingPubkeys: () => string[];\n  invalidateFollowings: () => Promise<void>;\n  query: CreateQueryResult<NostrEvent | null>;\n};\n\nconst buildMethods = (dataProvider: () => NostrEvent | undefined | null) => {\n  const followings = () => {\n    const data = dataProvider();\n    if (data == null) return [];\n\n    const result: Following[] = [];\n\n    // TODO zodにする\n    const event = genericEvent(data);\n    event.pTags().forEach((tag) => {\n      const [, followingPubkey, mainRelayUrl, petname] = tag;\n\n      const following: Following = { pubkey: followingPubkey, petname };\n      if (mainRelayUrl != null && mainRelayUrl.length > 0) {\n        following.mainRelayUrl = mainRelayUrl;\n      }\n\n      result.push(following);\n    });\n\n    return result;\n  };\n\n  const followingPubkeys = (): string[] => followings().map((follow) => follow.pubkey);\n\n  return { followings, followingPubkeys, data: dataProvider };\n};\n\nexport const fetchLatestFollowings = async (\n  { pubkey }: UseFollowingsProps,\n  signal?: AbortSignal,\n) => {\n  const task = new BatchedEventsTask<FollowingsTask>({ type: 'Followings', pubkey });\n  registerTask({ task, signal });\n\n  const latestFollowings = await task.latestEventPromise();\n  return buildMethods(() => latestFollowings);\n};\n\nconst useFollowings = (propsProvider: () => UseFollowingsProps | null): UseFollowings => {\n  const queryClient = useQueryClient();\n  const props = createMemo(propsProvider);\n  const genQueryKey = () => ['useFollowings', props()] as const;\n\n  const query = createQuery(() => ({\n    queryKey: genQueryKey(),\n    queryFn: latestEventQuery<ReturnType<typeof genQueryKey>>({\n      taskProvider: ([, currentProps]) => {\n        if (currentProps == null) return null;\n        const { pubkey } = currentProps;\n        return new BatchedEventsTask<FollowingsTask>({ type: 'Followings', pubkey });\n      },\n      queryClient,\n    }),\n    staleTime: 5 * 60 * 1000, // 5 min\n    gcTime: 3 * 24 * 60 * 60 * 1000, // 3 days\n    refetchOnMount: true,\n    refetchOnWindowFocus: false,\n    refetchOnReconnect: false,\n    refetchInterval: 0,\n  }));\n\n  const invalidateFollowings = (): Promise<void> =>\n    queryClient.invalidateQueries({ queryKey: genQueryKey() });\n\n  return { ...buildMethods(() => query.data), invalidateFollowings, query };\n};\n\nexport default useFollowings;\n"],"file":"assets/useFollowings-CW-daF2n.js"}