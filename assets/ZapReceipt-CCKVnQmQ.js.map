{"version":3,"file":"ZapReceipt-CCKVnQmQ.js","sources":["../../src/components/event/ZapReceipt.tsx"],"sourcesContent":["import { Component, Show, createMemo } from 'solid-js';\n\nimport Bolt from 'heroicons/24/solid/bolt.svg';\nimport { type Event as NostrEvent } from 'nostr-tools/pure';\n\nimport EventDisplayById from '@/components/event/EventDisplayById';\nimport UserDisplayName from '@/components/UserDisplayName';\nimport useConfig from '@/core/useConfig';\nimport useModalState from '@/hooks/useModalState';\nimport { useTranslation } from '@/i18n/useTranslation';\nimport ZapReceipt from '@/nostr/event/ZapReceipt';\nimport useLnurlEndpoint from '@/nostr/useLnurlEndpoint';\nimport useProfile from '@/nostr/useProfile';\nimport lud06ToLnurlPayUrl from '@/nostr/zap/lud06ToLnurlPayUrl';\nimport lud16ToLnurlPayUrl from '@/nostr/zap/lud16ToLnurlPayUrl';\nimport ensureNonNull from '@/utils/ensureNonNull';\nimport { formatSiPrefix } from '@/utils/siPrefix';\nimport { thumbnailUrl } from '@/utils/url';\n\nexport type ZapReceiptProps = {\n  event: NostrEvent;\n};\n\nconst ZapReceiptDisplay: Component<ZapReceiptProps> = (props) => {\n  const i18n = useTranslation();\n  const { shouldMuteEvent } = useConfig();\n  const { showProfile } = useModalState();\n\n  const event = createMemo(() => new ZapReceipt(props.event));\n\n  const { profile: senderProfile } = useProfile(() => ({\n    pubkey: event().senderPubkey(),\n  }));\n\n  const { profile: recipientProfile } = useProfile(() =>\n    ensureNonNull([event().zappedPubkey()])(([pubkey]) => ({ pubkey })),\n  );\n\n  const lnurlPayUrlLud06 = () => {\n    const lud06 = recipientProfile()?.lud06;\n    if (lud06 == null) return null;\n    return lud06ToLnurlPayUrl(lud06);\n  };\n\n  const lnurlPayUrlLud16 = () => {\n    const lud16 = recipientProfile()?.lud16;\n    if (lud16 == null) return null;\n    return lud16ToLnurlPayUrl(lud16);\n  };\n\n  const lnurlEndpointLud06 = useLnurlEndpoint(() =>\n    ensureNonNull([lnurlPayUrlLud06()] as const)(([lnurlPayUrl]) => ({\n      lnurlPayUrl,\n    })),\n  );\n\n  const lnurlEndpointLud16 = useLnurlEndpoint(() =>\n    ensureNonNull([lnurlPayUrlLud16()] as const)(([lnurlPayUrl]) => ({\n      lnurlPayUrl,\n    })),\n  );\n\n  const amountSi = () => {\n    const amountSats = event().amountSats();\n    if (amountSats == null) return null;\n    return formatSiPrefix(amountSats);\n  };\n\n  const isZapReceiptVerified = () =>\n    lnurlEndpointLud06.isZapReceiptVerified(props.event) ||\n    lnurlEndpointLud16.isZapReceiptVerified(props.event);\n\n  return (\n    <Show when={!shouldMuteEvent(props.event) && isZapReceiptVerified()}>\n      <div class=\"flex items-center gap-1 text-sm\">\n        <div class=\"flex w-6 flex-col items-center\">\n          <div class=\"size-4 shrink-0 text-amber-500\" aria-hidden=\"true\">\n            <Bolt />\n          </div>\n          <div class=\"mt-[-2px] shrink-0 text-xs\">{amountSi()}</div>\n        </div>\n        <div class=\"notification-user flex gap-1 overflow-hidden\">\n          <div class=\"author-icon size-5 shrink-0 overflow-hidden rounded\">\n            <Show when={senderProfile()?.picture} keyed>\n              {(url) => (\n                <img\n                  src={thumbnailUrl(url, 'icon')}\n                  alt=\"icon\"\n                  // TODO autofit\n                  class=\"size-full object-cover\"\n                />\n              )}\n            </Show>\n          </div>\n          <div class=\"flex min-w-0 flex-1 overflow-hidden\">\n            <button\n              class=\"select-text truncate font-bold hover:text-link hover:underline\"\n              onClick={() => showProfile(event().senderPubkey())}\n            >\n              <UserDisplayName pubkey={event().senderPubkey()} />\n            </button>\n            <span class=\"shrink-0\">{i18n.t('notification.zapped')}</span>\n          </div>\n        </div>\n      </div>\n      <Show when={event().description().content.length > 0}>\n        <div class=\"ml-7 whitespace-pre-wrap break-words rounded border border-border px-1 text-sm\">\n          {event().description().content}\n        </div>\n      </Show>\n      <Show when={event().zappedEventId() != null}>\n        <div class=\"notification-event py-1\">\n          <EventDisplayById eventId={event().zappedEventId()} />\n        </div>\n      </Show>\n    </Show>\n  );\n};\n\nexport default ZapReceiptDisplay;\n"],"names":["ZapReceiptDisplay","props","i18n","useTranslation","shouldMuteEvent","useConfig","showProfile","useModalState","event","createMemo","ZapReceipt","profile","senderProfile","useProfile","pubkey","senderPubkey","recipientProfile","ensureNonNull","zappedPubkey","lnurlPayUrlLud06","lud06","lud06ToLnurlPayUrl","lnurlPayUrlLud16","lud16","lud16ToLnurlPayUrl","lnurlEndpointLud06","useLnurlEndpoint","lnurlPayUrl","lnurlEndpointLud16","amountSi","amountSats","formatSiPrefix","isZapReceiptVerified","_$createComponent","Show","when","_$memo","children","_el$","_tmpl$","_el$2","firstChild","_el$3","_el$4","nextSibling","_el$5","_el$6","_el$7","_el$8","_el$9","_$insert","Bolt","picture","keyed","_el$12","_tmpl$4","_$effect","_$setAttribute","thumbnailUrl","url","$$click","UserDisplayName","t","description","content","length","_el$10","_tmpl$2","zappedEventId","_el$11","_tmpl$3","EventDisplayById","eventId","_$delegateEvents"],"mappings":"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"}