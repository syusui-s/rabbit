import{s as L,t as a,u as X,p as v,V as me,e as ge,w as ye,g as we,c as E,a6 as be,a as n,S as g,l as I,i as r,b as T,M as y,j as G,h as $e,ag as ve,d as ke,a8 as _e,am as xe,q as Ce,ak as Pe,ah as Fe}from"./index-zvLRhu4m.js";import{u as Y,c as K,h as Me,i as Se,j as Ee,T as Te,k as Ue}from"./useFollowings-jaanltVe.js";import{G as qe}from"./globe-alt-i-P4Kjh4.js";import{B as Le}from"./BasicModal-kyctg86w.js";import je from"./UserList-7mOk3Euz.js";import{a as Ne,b as Ae,d as Be,g as Re,n as Qe,f as z,t as Ve,e as He,j as Ie}from"./SideBar-75Ix0E9j.js";import"./LazyLoad-JyrVcy8r.js";import"./usePersistStatus-qBV_5jJY.js";const Ge=a('<svg xmlns=http://www.w3.org/2000/svg fill=none stroke=currentColor stroke-width=1.5 aria-hidden=true data-slot=icon viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99">'),Ke=(l={})=>(()=>{const t=Ge();return L(t,l,!0,!0),t})(),ze=a('<svg xmlns=http://www.w3.org/2000/svg fill=currentColor aria-hidden=true data-slot=icon viewBox="0 0 24 24"><path fill-rule=evenodd d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12m13.36-1.814a.75.75 0 1 0-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 0 0-1.06 1.06l2.25 2.25a.75.75 0 0 0 1.14-.094z"clip-rule=evenodd>'),De=(l={})=>(()=>{const t=ze();return L(t,l,!0,!0),t})(),Oe=a('<svg xmlns=http://www.w3.org/2000/svg fill=currentColor aria-hidden=true data-slot=icon viewBox="0 0 24 24"><path fill-rule=evenodd d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12M12 8.25a.75.75 0 0 1 .75.75v3.75a.75.75 0 0 1-1.5 0V9a.75.75 0 0 1 .75-.75m0 8.25a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5"clip-rule=evenodd>'),Xe=(l={})=>(()=>{const t=Oe();return L(t,l,!0,!0),t})();function Ye(l){const{config:t}=X(),h=v(l),{events:f}=Y(()=>({relayUrls:t().relayUrls,filters:[{kinds:[me],"#p":[h().pubkey]}],limit:1e6,continuous:!1})),w=()=>ge(f()?.map(b=>b.pubkey));return{followersPubkeys:w,count:()=>w().length}}var Je=/^(?:([\w.+-]+)@)?([\w.-]+)$/,J;try{J=fetch}catch{}async function We(l){const t=l.match(Je);if(!t)return null;const[h,f="_",w]=t;try{const $=await J(`https://${w}/.well-known/nostr.json?name=${f}`),{names:b,relays:k}=Ze(await $.json()),x=b[f];return x?{pubkey:x,relays:k?.[x]}:null}catch{return null}}function Ze(l){const t={names:{}};for(const[h,f]of Object.entries(l.names))typeof h=="string"&&typeof f=="string"&&(t.names[h]=f);if(l.relays){t.relays={};for(const[h,f]of Object.entries(l.relays))typeof h=="string"&&Array.isArray(f)&&(t.relays[h]=f.filter(w=>typeof w=="string"))}return t}const et=l=>{const t=v(l),h=()=>["useVerification",t()],f=ye(()=>({queryKey:h(),queryFn:({queryKey:$})=>{const[,b]=$;if(b==null)return Promise.resolve(null);const{nip05:k}=b;return We(k)},staleTime:30*60*1e3,gcTime:24*60*60*1e3}));return{verification:()=>f?.data??null,query:f}},tt=a('<button class="rounded-full border border-primary px-4 py-2 text-center font-bold text-primary hover:bg-primary hover:text-primary-fg sm:w-20">'),D=a('<span class="rounded-full border border-primary px-4 py-2 text-primary sm:text-base">'),nt=a('<button class="rounded-full border border-primary bg-primary px-4 py-2 text-center font-bold text-primary-fg hover:bg-primary-hover sm:w-36">'),lt=a('<button class="w-28 rounded-full border border-primary px-4 py-2 text-primary hover:border-primary-hover hover:text-primary-hover">'),O=a('<div class="shrink-0 text-xs">'),rt=a('<div class="flex shrink-0 flex-col items-center gap-1"><div class="flex flex-row justify-start gap-1"><button type=button class="w-10 rounded-full border border-primary p-2 text-primary hover:border-primary-hover hover:text-primary-hover">'),ot=a('<div class="mt-[-54px] flex items-end gap-4 px-4 pt-4"><div class="flex-1 shrink-0"><div class="h-28 w-28 overflow-hidden rounded-lg shadow-md">'),st=a('<div class="truncate text-xl font-bold">'),it=a('<div class="truncate text-xs">@'),at=a('<span class="inline-block h-3 w-3">'),ct=a('<span class="inline-block h-4 w-4 text-link">'),ut=a('<div class="flex items-center text-xs">'),dt=a('<div class="flex items-start px-4 pt-2"><div class="h-16 shrink overflow-hidden"><div class="flex items-center gap-2"></div><div class="flex gap-1"><div class="truncate text-xs">'),ft=a('<div class="flex flex-1 flex-col items-start"><div class=text-sm></div><div class=text-xl>'),pt=a('<div class="flex border-t border-border px-4 py-2"><button class="flex flex-1 flex-col items-start"><div class=text-sm></div><div class=text-xl>'),ht=a('<ul class="border-t border-border px-5 py-2 text-xs">'),mt=a('<ul class="border-t border-border p-1">'),gt=a('<div class="h-12 shrink-0">'),yt=a('<div class="h-40 w-full shrink-0 sm:h-52"><img alt=header class="h-full w-full object-cover">'),wt=a('<img alt="user icon"class="h-full w-full object-cover">'),bt=a('<span class="inline-block h-4 w-4 text-danger">'),$t=a('<div class="max-h-40 shrink-0 overflow-y-auto whitespace-pre-wrap px-4 py-2 text-sm">'),vt=a("<span class=text-sm>"),kt=a('<button class="text-sm hover:text-fg-secondary">'),_t=a('<li class="flex items-center gap-1"><span class="inline-block h-4 w-4"area-label=website title=website>'),xt=l=>{const{count:t}=Ye(()=>({pubkey:l.pubkey}));return v(t)},qt=l=>{const t=we(),{config:h,addMutedPubkey:f,removeMutedPubkey:w,isPubkeyMuted:$,saveColumn:b}=X(),k=Ne(),x=Ie(),_=Ae(),{showProfileEdit:W}=Re(),C=v(()=>Qe(l.pubkey)),[Z,j]=E(!1),[ee,N]=E(!1),[te,ne]=E(!1),[le,A]=E(null),re=()=>A(null),{profile:m,event:oe,query:U}=Be(()=>({pubkey:l.pubkey})),{verification:se,query:ie}=et(()=>z([m()?.nip05])(([e])=>({nip05:e}))),ae=()=>{const e=m()?.nip05;if(e==null)return null;const[o,i]=e.split("@");return i==null?null:o==="_"?{domain:i,ident:i}:{user:o,domain:i,ident:e}},ce=()=>se()?.pubkey===l.pubkey,B=()=>$(l.pubkey),ue=v(()=>{const e=oe(),o=m()?.about;if(e==null||o==null)return;const i=_e(o);return xe(i,Ce(e))}),{followingPubkeys:de,invalidateFollowings:fe,query:P}=K(()=>z([_()])(([e])=>({pubkey:e}))),F=()=>de().includes(l.pubkey),{followingPubkeys:q,query:R}=K(()=>({pubkey:l.pubkey})),pe=()=>{const e=_();return e!=null&&q().includes(e)},M=be(()=>({mutationKey:["updateContacts"],mutationFn:(...e)=>x.updateContacts(...e).then(o=>Promise.allSettled(o.map(Ve(5e3)))),onSuccess:e=>{const o=e.filter(u=>u.status==="fulfilled").length,i=e.length-o;o===e.length?console.log("succeeded to update contacts"):o>0?console.log(`succeeded to update contacts for ${o} relays but failed for ${i} relays`):console.error("failed to update contacts")},onError:e=>{console.error("failed to update contacts: ",e)},onSettled:()=>{fe().then(()=>P.refetch()).catch(e=>console.error("failed to refetch contacts",e))}})),Q=async(e,o)=>{try{const i=_();if(i==null)return;j(!0);const u=await Ue({pubkey:i});if((u.data()==null||u.followingPubkeys().length===0)&&!window.confirm(t()("profile.confirmUpdateEvenIfEmpty")))return;if((u?.data()?.created_at??0)<(P.data?.created_at??0)){window.alert(t()("profile.failedToFetchLatestFollowList"));return}const d=u.data()?.tags??[];let c;switch(e){case"follow":c=[...d,["p",o]];break;case"unfollow":c=d.filter(([p,s])=>!(p==="p"&&s===o));break;default:console.error("updateContacts: invalid operation",e);return}await M.mutateAsync({relayUrls:h().relayUrls,pubkey:i,updatedTags:c,content:u.data()?.content??""})}catch(i){console.error("failed to update contact list",i),window.alert(t()("profile.failedToUpdateFollowList"))}finally{j(!1)}},V=()=>{Q("follow",l.pubkey).catch(e=>{console.log("failed to follow",e)})},H=()=>{window.confirm(t()("profile.confirmUnfollow"))&&Q("unfollow",l.pubkey).catch(e=>{console.log("failed to unfollow",e)})},S=Me(()=>({menu:[{content:t()("profile.copyPubkey"),onSelect:()=>{navigator.clipboard.writeText(C()).catch(e=>window.alert(e))}},{content:t()("profile.addUserColumn"),onSelect:()=>{const e=m()?.name??C();b(Pe({name:e,pubkey:l.pubkey})),k({command:"moveToLastColumn"}).catch(o=>console.error(o)),l.onClose?.()}},{content:t()("profile.addUserHomeColumn"),onSelect:()=>{const e=`${t()("column.home")} / ${m()?.name??C()}`;b(Fe({name:e,pubkey:l.pubkey})),k({command:"moveToLastColumn"}).catch(o=>console.error(o)),l.onClose?.()}},{content:B()?t()("profile.unmute"):t()("profile.mute"),onSelect:()=>{B()?w(l.pubkey):f(l.pubkey)}},{when:()=>l.pubkey===_(),content:F()?t()("profile.unfollowMyself"):t()("profile.followMyself"),onSelect:()=>{F()?H():V()}}]})),{events:he}=Y(()=>({relayUrls:h().relayUrls,filters:[{kinds:[1,6],authors:[l.pubkey],limit:10,until:He()}],continuous:!1}));return n(Le,{onClose:()=>l.onClose?.(),get children(){return[n(g,{get when(){return v(()=>!!U.isFetched)()&&m()?.banner},get fallback(){return gt()},keyed:!0,children:e=>(()=>{const o=yt(),i=o.firstChild;return I(i,"src",e),o})()}),(()=>{const e=ot(),o=e.firstChild,i=o.firstChild;return r(i,n(g,{get when(){return v(()=>!!U.isFetched)()&&m()?.picture},keyed:!0,children:u=>(()=>{const d=wt();return I(d,"src",u),d})()})),r(e,n(g,{get when(){return _()!=null},get children(){const u=rt(),d=u.firstChild,c=d.firstChild;r(d,n(T,{get children(){return[n(y,{get when(){return l.pubkey===_()},get children(){const s=tt();return s.$$click=()=>W(),r(s,()=>t()("profile.editProfile")),s}}),n(y,{get when(){return M.isPending||Z()},get children(){const s=D();return r(s,()=>t()("general.updating")),s}}),n(y,{get when(){return P.isPending||P.isFetching},get children(){const s=D();return r(s,()=>t()("general.loading")),s}}),n(y,{get when(){return F()},get children(){const s=nt();return s.$$click=()=>H(),s.addEventListener("mouseleave",()=>N(!1)),s.addEventListener("mouseenter",()=>N(!0)),r(s,n(g,{get when(){return!ee()},get fallback(){return t()("profile.unfollow")},get children(){return t()("profile.followingCurrently")}})),G(()=>s.disabled=M.isPending),s}}),n(y,{get when(){return!F()},get children(){const s=lt();return s.$$click=()=>V(),r(s,()=>t()("profile.follow")),G(()=>s.disabled=M.isPending),s}})]}}),c),c.$$click=()=>S.open();const p=S.targetRef;return typeof p=="function"?$e(p,c):S.targetRef=c,r(c,n(Se,{})),r(d,()=>S.popup(),null),r(u,n(T,{get children(){return[n(y,{get when(){return R.isPending},get children(){const s=O();return r(s,()=>t()("general.loading")),s}}),n(y,{get when(){return pe()},get children(){const s=O();return r(s,()=>t()("profile.followsYou")),s}})]}}),null),u}}),null),e})(),(()=>{const e=dt(),o=e.firstChild,i=o.firstChild,u=i.nextSibling,d=u.firstChild;return r(o,n(g,{get when(){return U.isPending},get children(){return t()("general.loading")}}),i),r(o,n(g,{get when(){return(m()?.display_name?.length??0)>0},get children(){const c=st();return r(c,()=>m()?.display_name),c}}),i),r(i,n(g,{get when(){return(m()?.name?.length??0)>0},get children(){const c=it();return c.firstChild,r(c,()=>m()?.name,null),c}}),null),r(i,n(g,{get when(){return(m()?.nip05?.length??0)>0},get children(){const c=ut();return r(c,()=>ae()?.ident,null),r(c,n(T,{get fallback(){return(()=>{const p=bt();return r(p,n(Xe,{})),p})()},get children(){return[n(y,{get when(){return ie.isPending},get children(){const p=at();return r(p,n(Ke,{})),p}}),n(y,{get when(){return ce()},get children(){const p=ct();return r(p,n(De,{})),p}})]}}),null),c}}),null),r(d,C),e})(),n(g,{get when(){return ue()},keyed:!0,children:e=>(()=>{const o=$t();return r(o,n(Ee,{parsed:e,embedding:!1,initialHidden:!0})),o})()}),(()=>{const e=pt(),o=e.firstChild,i=o.firstChild,u=i.nextSibling;return o.$$click=()=>A("Following"),r(i,()=>t()("profile.following")),r(u,n(g,{get when(){return R.isFetched},get fallback(){return(()=>{const d=vt();return r(d,()=>t()("general.loading")),d})()},get children(){return q().length}})),r(e,n(g,{get when(){return!h().hideCount},get children(){const d=ft(),c=d.firstChild,p=c.nextSibling;return r(c,()=>t()("profile.followers")),r(p,n(g,{get when(){return te()},get fallback(){return(()=>{const s=kt();return s.$$click=()=>ne(!0),r(s,()=>t()("profile.loadFollowers")),s})()},keyed:!0,get children(){return n(xt,{get pubkey(){return l.pubkey}})}})),d}}),null),e})(),n(g,{get when(){return(m()?.website??"").length>0},get children(){const e=ht();return r(e,n(g,{get when(){return m()?.website},keyed:!0,children:o=>(()=>{const i=_t(),u=i.firstChild;return r(u,n(qe,{})),r(i,n(ve,{class:"text-link underline",href:o}),null),i})()})),e}}),n(T,{get children(){return n(y,{get when(){return le()==="Following"},get children(){return n(je,{get data(){return q()},pubkeyExtractor:e=>e,onClose:re})}})}}),(()=>{const e=mt();return r(e,n(Te,{get events(){return he()}})),e})()]}})};ke(["click"]);export{qt as default};
//# sourceMappingURL=ProfileDisplay-KVDLOJnv.js.map
