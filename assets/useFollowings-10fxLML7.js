import{i as d,t as g,s as A,a as s,h as w,ap as Se,aq as nt,v as k,z,u as P,ar as rt,j as S,M as x,ad as st,S as W,c as R,r as O,B,q as Te,d as I,w as Ie,f as E,F as N,m as q,y as Q,C as Y,a8 as oe,D as le,_ as ie,b as T,n as J,x as ce,ah as ot,as as lt,o as Me,ag as it,af as ct,U as at,l as ut,E as dt,at as ge}from"./index-WKg6uwxW.js";import{r as Pe,t as X,B as V,g as ee,U as ht,h as ae,s as gt,v as De,q as ue,b as te,w as ft,k as vt,P as mt,E as $t,f as Le,o as Ue,a as yt,l as bt,N as wt,x as pt,y as fe,e as _t,n as kt,z as xt}from"./SideBar-kOu-0lWG.js";import{L as F}from"./LazyLoad-vk1PFxt8.js";import{S as L}from"./SafeLink-TgC8fukl.js";const Et=g('<div class="block shrink-0 overflow-hidden border-b border-border p-1">'),Rt=e=>(()=>{const t=Et();return d(t,()=>e.children),t})(),Ct=g('<svg xmlns=http://www.w3.org/2000/svg fill=none stroke=currentColor stroke-width=1.5 aria-hidden=true data-slot=icon viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round d="M19.5 12c0-1.232-.046-2.453-.138-3.662a4.006 4.006 0 0 0-3.7-3.7 48.678 48.678 0 0 0-7.324 0 4.006 4.006 0 0 0-3.7 3.7c-.017.22-.032.441-.046.662M19.5 12l3-3m-3 3-3-3m-12 3c0 1.232.046 2.453.138 3.662a4.006 4.006 0 0 0 3.7 3.7 48.656 48.656 0 0 0 7.324 0 4.006 4.006 0 0 0 3.7-3.7c.017-.22.032-.441.046-.662M4.5 12l3 3m-3-3-3 3">'),je=(e={})=>(()=>{const t=Ct();return A(t,e,!0,!0),t})(),St=g('<button class="text-link underline">'),Tt=e=>{try{return Se(e)}catch(t){return console.error("failed to encode event id into Bech32 entity (NIP-19) but ignore",e,t),e}},It=e=>{try{return nt({id:e})}catch(t){return console.error("failed to encode event id into Bech32 entity (NIP-19) but ignore",e,t),e}},H=e=>(()=>{const t=St();return d(t,s(w,{get when(){return e.kind==null||e.kind===1},get fallback(){return It(e.eventId)},get children(){return Tt(e.eventId)}})),t})(),Mt=e=>{const t=k(e),n=z(()=>({queryKey:["useEvent",t()],queryFn:({queryKey:c,signal:i})=>{const[,o]=c;if(o==null)return null;const{eventId:l}=o,a=new V({type:"Event",eventId:l}),u=a.firstEventPromise().catch(()=>{throw new Error(`event not found: ${l}`)});return Pe({task:a,signal:i}),X(15e3,`useEvent: ${l}`)(u)},staleTime:4*60*60*1e3,gcTime:4*60*60*1e3,refetchOnWindowFocus:!1,refetchOnMount:!1}));return{event:()=>n.data??null,query:n}},Pt=g("<span>"),Dt=g("<div class=truncate> "),K=e=>{const t=P(),[n,r]=rt(e,["eventId"]),{shouldMuteEvent:c}=S(),{event:i,query:o}=Mt(()=>ee([n.eventId])(([a])=>({eventId:a}))),l=()=>{const a=i();return a!=null&&c(a)};return s(W,{get fallback(){return(()=>{const a=Pt();return d(a,()=>t.t("post.failedToFetchEvent"),null),d(a,()=>e.eventId,null),a})()},get children(){return[s(x,{get when(){return l()},children:null}),s(x,{get when(){return i()},keyed:!0,children:a=>s(et,st({event:a},r))}),s(x,{get when(){return o.isLoading&&n.eventId},keyed:!0,children:a=>(()=>{const u=Dt(),h=u.firstChild;return d(u,()=>t.t("general.loading"),h),d(u,s(H,{eventId:a}),null),u})()})]}})},Fe=e=>{const[t,n]=R(new Date);return O(()=>{const r=setInterval(()=>{n(new Date)},e().interval);B(()=>clearInterval(r))}),t},Lt=e=>{switch(e.kind){case"now":return"now";case"seconds":return`${e.value}s`;case"minutes":return`${e.value}m`;case"hours":return`${e.value}h`;case"days":return`${e.value}d`;case"abs":default:return e.value.toLocaleDateString()}},ve=e=>`${e.getHours()}:${e.getMinutes().toString().padStart(2,"0")}`,Ut=e=>{switch(e.kind){case"today":return e.value.toLocaleTimeString();case"yesterday":case"abs":default:return e.value.toLocaleString()}},jt=e=>{switch(e.kind){case"today":return ve(e.value);case"yesterday":return`昨日 ${ve(e.value)}`;case"abs":default:return e.value.toLocaleString()}},Ft=(e,t)=>Math.round(Number(t)-Number(e))/1e3,qt=(e,t)=>{const n=Ft(e,t);return n<10?{kind:"now"}:n<60?{kind:"seconds",value:Math.round(n)}:n<3600?{kind:"minutes",value:Math.round(n/60)}:n<86400?{kind:"hours",value:Math.round(n/3600)}:n<604800?{kind:"days",value:Math.round(n/86400)}:{kind:"abs",value:e}},me=(e,t)=>e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate(),At=e=>new Date(+e-24*60*60*1e3),qe=(e,t,n)=>me(e,t)?n({kind:"today",value:e}):me(e,At(t))?n({kind:"yesterday",value:e}):n({kind:"abs",value:e}),Wt=(e,t=new Date)=>qe(e,t,Ut),Ot=(e,t=new Date)=>qe(e,t,jt),$e=(e,t=new Date,n=Lt)=>n(qt(e,t)),ye=Te(()=>Fe(()=>({interval:7e3}))),be=Te(()=>Fe(()=>({interval:60*1e3}))),Ae=()=>{const{config:e}=S();return t=>{switch(e().dateFormat){case"absolute-long":return Wt(t,be());case"absolute-short":return Ot(t,be());case"relative":return $e(t,ye());default:return $e(t,ye())}}},Bt=g('<div><div class="flex items-center gap-1"><div class="flex shrink-0 place-items-center pl-[2px]"aria-hidden=true><span class="size-4 text-r-repost"></span></div><div class="notification-user flex min-w-0 flex-1 overflow-hidden text-xs"><button class="select-text truncate hover:text-link hover:underline"></button><span class=shrink-0></span></div><div class=text-xs></div></div><div class=pt-1>'),Ht=e=>{const t=P(),{showProfile:n}=ae(),r=Ae(),c=k(()=>Ie(e.event)),i=()=>c().lastTaggedEventId();return(()=>{const o=Bt(),l=o.firstChild,a=l.firstChild,u=a.firstChild,h=a.nextSibling,v=h.firstChild,b=v.nextSibling,m=h.nextSibling,$=l.nextSibling;return d(u,s(je,{})),v.$$click=()=>n(e.event.pubkey),d(v,s(ht,{get pubkey(){return e.event.pubkey}})),d(b,()=>t.t("notification.reposted")),d(m,()=>r(c().createdAtAsDate())),d($,s(K,{get eventId(){return i()}})),o})()};I(["click"]);const Kt=g('<svg xmlns=http://www.w3.org/2000/svg fill=none stroke=currentColor stroke-width=1.5 aria-hidden=true data-slot=icon viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round d="m3.75 13.5 10.5-11.25L12 10.5h8.25L9.75 21.75 12 13.5z">'),zt=(e={})=>(()=>{const t=Kt();return A(t,e,!0,!0),t})(),Nt=g('<svg xmlns=http://www.w3.org/2000/svg fill=none stroke=currentColor stroke-width=1.5 aria-hidden=true data-slot=icon viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round d="M2.25 12.76c0 1.6 1.123 2.994 2.707 3.227 1.087.16 2.185.283 3.293.369V21l4.076-4.076a1.526 1.526 0 0 1 1.037-.443 48.282 48.282 0 0 0 5.68-.494c1.584-.233 2.707-1.626 2.707-3.228V6.741c0-1.602-1.123-2.995-2.707-3.228A48.394 48.394 0 0 0 12 3c-2.392 0-4.744.175-7.043.513C3.373 3.746 2.25 5.14 2.25 6.741z">'),Qt=(e={})=>(()=>{const t=Nt();return A(t,e,!0,!0),t})(),Vt=g('<svg xmlns=http://www.w3.org/2000/svg fill=none stroke=currentColor stroke-width=1.5 aria-hidden=true data-slot=icon viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round d="M6.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0m6 0a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0m6 0a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0">'),Zt=(e={})=>(()=>{const t=Vt();return A(t,e,!0,!0),t})(),Gt=g('<svg xmlns=http://www.w3.org/2000/svg fill=currentColor aria-hidden=true data-slot=icon viewBox="0 0 24 24"><path d="m11.645 20.91-.007-.003-.022-.012a15.247 15.247 0 0 1-.383-.218 25.18 25.18 0 0 1-4.244-3.17C4.688 15.36 2.25 12.174 2.25 8.25 2.25 5.322 4.714 3 7.688 3A5.5 5.5 0 0 1 12 5.052 5.5 5.5 0 0 1 16.313 3c2.973 0 5.437 2.322 5.437 5.25 0 3.925-2.438 7.111-4.739 9.256a25.175 25.175 0 0 1-4.244 3.17 15.247 15.247 0 0 1-.383.219l-.022.012-.007.004-.003.001a.752.752 0 0 1-.704 0l-.003-.001Z">'),We=(e={})=>(()=>{const t=Gt();return A(t,e,!0,!0),t})(),Yt=g('<span class="inline-block size-4 pt-[1px] text-r-reaction">'),we=g("<span class=truncate>"),Jt=g('<img class="h-4 max-w-[6rem]">'),Xt=e=>e.type==="LikeDislike"&&e.content==="+",Oe=e=>s(W,{get fallback(){return(()=>{const t=we();return d(t,()=>e.reactionTypes.content),t})()},get children(){return[s(x,{get when(){return Xt(e.reactionTypes)},get children(){const t=Yt();return d(t,s(We,{})),t}}),s(x,{get when(){return e.reactionTypes.type==="Emoji"&&e.reactionTypes},keyed:!0,children:({content:t})=>(()=>{const n=we();return d(n,t),n})()}),s(x,{get when(){return e.reactionTypes.type==="CustomEmoji"&&e.reactionTypes},keyed:!0,children:({shortcode:t,url:n})=>(()=>{const r=Jt();return E(r,"src",n),E(r,"alt",`:${t}:`),r})()})]}}),en=g('<svg xmlns=http://www.w3.org/2000/svg fill=none stroke=currentColor stroke-width=1.5 aria-hidden=true data-slot=icon viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round d="m8.25 4.5 7.5 7.5-7.5 7.5">'),tn=(e={})=>(()=>{const t=en();return A(t,e,!0,!0),t})(),nn=g('<li class="border-b border-border hover:bg-bg-tertiary"><button class="w-full px-4 py-1 text-start">'),rn=g('<li class="border-b border-border hover:bg-bg-tertiary"><button class="flex w-full items-center py-1 pe-2 ps-4 text-start"><span class=flex-1></span><span class="inline-block size-4 shrink-0">'),sn=g('<ul class="min-w-[96px] rounded border border-border bg-bg shadow-md">'),on=e=>{const t=()=>{e.item?.onSelect?.(),e.onClose()};return(()=>{const n=nn(),r=n.firstChild;return r.$$click=t,d(r,()=>e.item.content),n})()},ln=e=>{const t=Be(()=>({menu:e.submenu.items,position:"right"})),n=()=>{t.open()};return(()=>{const r=rn(),c=r.firstChild,i=c.firstChild,o=i.nextSibling,l=t.targetRef;return typeof l=="function"?q(l,r):t.targetRef=r,c.$$click=n,d(i,()=>e.submenu.content),d(o,s(tn,{})),d(r,()=>t.popup(),null),r})()},cn=e=>"onSelect"in e?e:null,an=e=>"items"in e?e:null,Be=e=>{const t=k(e),n=gt(()=>({ensureWidth:300,...t(),popup:(()=>{const r=sn();return d(r,s(N,{get each(){return t().menu.filter(c=>c.when==null||c.when())},children:c=>s(W,{get children(){return[s(x,{get when(){return cn(c)},keyed:!0,children:i=>s(on,{item:i,onClose:()=>n.close()})}),s(x,{get when(){return an(c)},keyed:!0,children:i=>s(ln,{submenu:i,onClose:()=>n.close()})})]}})})),r})()}));return n};I(["click"]);const un=/\p{Emoji_Presentation}/u,He=e=>["useReactions",e],de=e=>{const{shouldMuteEvent:t}=S(),n=Q(),r=k(()=>He(e())),c=z(()=>({queryKey:r(),queryFn:De({taskProvider:([,u])=>{if(u==null)return null;const{eventId:h}=u;return new V({type:"Reactions",mentionedEventId:h})},queryClient:n}),staleTime:1*60*1e3,gcTime:4*60*60*1e3,refetchInterval:1*60*1e3})),i=()=>(c.data??[]).filter(h=>!t(h));return{reactions:i,reactionsGrouped:()=>{const u=new Map;return i().forEach(h=>{const v=Y(h).isCustomEmoji()?`${h.content}${Y(h).getUrl()??""}`:h.content,b=u.get(v)??[];b.push(h),u.set(v,b)}),u},isReactedBy:u=>i().findIndex(h=>h.pubkey===u)!==-1,isReactedByWithEmoji:u=>i().findIndex(h=>h.pubkey===u&&un.test(h.content))!==-1,query:c}},Ke=e=>{const t=Q(),n=k(e),r=ue();return oe(()=>({mutationKey:["useReactionMutation",n().eventId],mutationFn:(...i)=>r.publishReaction(...i).then(o=>Promise.allSettled(o.map(X(5e3)))),onSuccess:i=>{const o=i.filter(a=>a.status==="fulfilled").length,l=i.length-o;o===i.length?console.log("Succeeded to publish a reaction"):o>0?console.warn(`failed to publish a reaction on ${l} relays`):console.error("failed to publish reaction on all relays")},onError:i=>{console.error("failed to publish reaction: ",i)},onSettled:()=>{const i=He({eventId:n().eventId});t.refetchQueries({queryKey:i}).then(()=>t.invalidateQueries({queryKey:i})).catch(o=>console.error("failed to refetch reactions",o))}}))},ze=e=>["useReposts",e],Ne=e=>{const{shouldMuteEvent:t}=S(),n=Q(),r=k(e),c=k(()=>ze(r())),i=z(()=>({queryKey:c(),queryFn:De({taskProvider:([,a])=>{if(a==null)return null;const{eventId:u}=a;return new V({type:"Reposts",mentionedEventId:u})},queryClient:n}),staleTime:1*60*1e3,gcTime:4*60*60*1e3,refetchInterval:1*60*1e3})),o=()=>(i.data??[]).filter(u=>!t(u));return{reposts:o,isRepostedBy:a=>o().findIndex(u=>u.pubkey===a)!==-1,query:i}},dn=e=>{const t=Q(),n=k(e),r=ue();return oe(()=>({mutationKey:["useRepostMutation",n().eventId],mutationFn:(...i)=>r.publishRepost(...i).then(o=>Promise.allSettled(o.map(X(1e4)))),onSuccess:i=>{const o=i.filter(a=>a.status==="fulfilled").length,l=i.length-o;o===i.length?console.log("Succeeded to publish a repost"):o>0?console.warn(`Failed to publish a repost on ${l} relays`):console.error("Failed to publish a repost on all relays")},onError:i=>{console.error("failed to publish repost: ",i)},onSettled:()=>{const i=ze({eventId:n().eventId});t.refetchQueries({queryKey:i}).then(()=>t.invalidateQueries({queryKey:i})).catch(o=>console.error("failed to refetch repost",o))}}))},pe=["k","M","G","T","P"],hn=(e,t)=>{const n=t?.precision??3;if(n<=0)throw new Error(`precision is too small: ${n}`);const c=10**((t?.minDigits??4)-1);if(e<c)return{value:e,prefix:null};const i=10**(Math.floor(Math.log10(e)/3)*3),o=e/i;let l=Math.round(o*10**n)/10**n,a=Math.max(Math.floor(Math.log10(e)/3)-1,0);return l>=1e3&&(l/=1e3,a+=1),a>=pe.length?{value:e,prefix:null}:{value:l,prefix:pe[a]}},Qe=(e,t)=>{const{value:n,prefix:r}=hn(e,{precision:2,minDigits:t?.minDigits??5});if(r==null)return`${e}`;const c=t?.digits??3,i=Math.floor(Math.log10(n))+1,o=Math.max(c-i,0);return`${Math.round(n*10**o)/10**o}${r}`},Ve=g('<div class="text-sm text-fg-tertiary">'),_e=g('<div class="flex shrink-0 items-center gap-1"><button class=size-4>'),gn=g('<div class="flex shrink-0 items-center gap-1"><button><span class="flex size-4">'),fn=g("<div class=w-6>"),vn=g('<div class="scrollbar flex gap-2 overflow-x-auto py-1">'),mn=g('<span class="ml-1 text-sm">'),$n=g('<button class="flex h-6 max-w-[128px] items-center rounded border border-border px-1"type=button>'),yn=g("<span class=text-red-500>"),bn=g('<div class="actions flex w-64 max-w-full items-center justify-between pt-1"><button class="shrink-0 text-fg-tertiary hover:text-fg-tertiary/70"><span class="flex size-4"></span></button><button type=button><span class="flex size-4 text-fg-tertiary hover:text-r-zap"></span></button><button type=button class="size-4 shrink-0 text-fg-tertiary hover:text-fg-tertiary/70">'),wn=le(()=>ie(()=>import("./EventDebugModal-OtBKkWWJ.js"),__vite__mapDeps([0,1,2,3,4,5,6]))),Ze=le(()=>ie(()=>import("./UserList-sfPHZ5lM.js"),__vite__mapDeps([7,1,2,4,5,3,8,9]))),pn=le(()=>ie(()=>import("./ZapRequestModal-PY9tbG_1.js"),__vite__mapDeps([10,1,2,3,4,5,6,11,12,8,9]))),_n=e=>{if(e.native!=null)return{type:"Emoji",content:e.native};if(e.src!=null)return{type:"CustomEmoji",content:`:${e.id}:`,shortcode:e.id,url:e.src};throw new Error("unknown emoji")},kn=e=>{const{config:t}=S(),n=te(),[r,c]=R(!1),{reactions:i,isReactedByWithEmoji:o,isReactedBy:l}=de(()=>({eventId:e.event.id})),a=k(()=>{const f=n();return f!=null&&l(f)||r()}),u=k(()=>{const f=n();return f!=null&&o(f)}),h=Ke(()=>({eventId:e.event.id})),v=f=>{a()||ee([n(),e.event.id])(([y,_])=>{h.mutate({relayUrls:t().relayUrls,pubkey:y,reactionTypes:f??{type:"LikeDislike",content:"+"},eventId:_,kind:e.event.kind,notifyPubkey:e.event.pubkey}),c(!0)})},b=f=>{f.stopPropagation(),v()},m=f=>{v(_n(f))},$=ft(()=>({onEmojiSelect:m}));return[(()=>{const f=_e(),y=f.firstChild;return y.$$click=b,d(y,s(w,{get when(){return k(()=>!!a())()&&!u()},get fallback(){return s(vt,{})},get children(){return s(We,{})}})),d(f,s(w,{get when(){return k(()=>!t().hideCount&&!t().showEmojiReaction)()&&i().length>0},get children(){const _=Ve();return d(_,()=>Qe(i().length,{minDigits:4})),_}}),null),T(_=>{const C={"text-fg-tertiary":!a()||u(),"hover:text-r-reaction":!a()||u(),"text-r-reaction":a()&&!u()||h.isPending},D=h.isPending;return _._v$=J(f,C,_._v$),D!==_._v$2&&(y.disabled=_._v$2=D),_},{_v$:void 0,_v$2:void 0}),f})(),s(w,{get when(){return t().useEmojiReaction},get children(){const f=_e(),y=f.firstChild;y.$$click=()=>$.open();const _=$.targetRef;return typeof _=="function"?q(_,y):$.targetRef=y,d(y,s(mt,{})),d(f,()=>$.popup(),null),T(C=>J(f,{"text-fg-tertiary":!a()||!u(),"hover:text-r-reaction":!a()||!u(),"text-r-reaction":a()&&u()||h.isPending},C)),f}})]},xn=e=>{const{config:t}=S(),n=te(),[r,c]=R(!1),{reposts:i,isRepostedBy:o}=Ne(()=>({eventId:e.event.id})),l=k(()=>{const h=n();return h!=null&&o(h)||r()}),a=dn(()=>({eventId:e.event.id})),u=h=>{h.stopPropagation(),!l()&&ee([n(),e.event.id])(([v,b])=>{a.mutate({relayUrls:t().relayUrls,pubkey:v,eventId:b,kind:e.event.kind,notifyPubkey:e.event.pubkey}),c(!0)})};return(()=>{const h=gn(),v=h.firstChild,b=v.firstChild;return v.$$click=u,d(b,s(je,{})),d(h,s(w,{get when(){return k(()=>!t().hideCount)()&&i().length>0},get children(){const m=Ve();return d(m,()=>Qe(i().length,{minDigits:4})),m}}),null),T(m=>{const $={"text-fg-tertiary":!l(),"hover:text-r-repost":!l(),"text-r-repost":l()||a.isPending},f=a.isPending;return m._v$3=J(h,$,m._v$3),f!==m._v$4&&(v.disabled=m._v$4=f),m},{_v$3:void 0,_v$4:void 0}),h})()},En=e=>{const{reactions:t}=de(()=>({eventId:e.event.id}));return s(Ze,{get data(){return t()},pubkeyExtractor:n=>n.pubkey,renderInfo:n=>(()=>{const r=fn();return d(r,s(Oe,{get reactionTypes(){return Y(n).toReactionTypes()}})),r})(),get onClose(){return e.onClose}})},Rn=e=>{const{reposts:t}=Ne(()=>({eventId:e.event.id}));return s(Ze,{get data(){return t()},pubkeyExtractor:n=>n.pubkey,get onClose(){return e.onClose}})},Cn=e=>{const{config:t}=S(),n=te(),[r,c]=R(!1),{reactions:i,reactionsGrouped:o,isReactedBy:l}=de(()=>({eventId:e.event.id})),a=Ke(()=>({eventId:e.event.id})),u=()=>{const v=n();return v==null?r():r()||l(v)},h=v=>{u()||ee([n(),e.event.id])(([b,m])=>{a.mutate({relayUrls:t().relayUrls,pubkey:b,reactionTypes:v??{type:"LikeDislike",content:"+"},eventId:m,kind:e.event.kind,notifyPubkey:e.event.pubkey}),c(!0)})};return s(w,{get when(){return k(()=>!!t().showEmojiReaction)()&&i().length>0},get children(){const v=vn();return d(v,s(N,{get each(){return[...o().entries()]},children:([,b])=>{const m=b.findIndex(f=>f.pubkey===n())>=0,$=Y(b[0]).toReactionTypes();return(()=>{const f=$n();return f.$$click=y=>{y.stopPropagation(),h($)},d(f,s(Oe,{reactionTypes:$}),null),d(f,s(w,{get when(){return!t().hideCount},get children(){const y=mn();return d(y,()=>b.length),y}}),null),T(y=>{const _={"text-fg-tertiary":!m,"hover:bg-r-reaction/10":!m,"hover:border-r-reaction/40":!m,"bg-r-reaction/10":m,"border-r-reaction/40":m,"text-r-reaction":m},C=u();return y._v$5=J(f,_,y._v$5),C!==y._v$6&&(f.disabled=y._v$6=C),y},{_v$5:void 0,_v$6:void 0}),f})()}})),v}})},Sn=e=>{const t=P(),{config:n}=S(),r=te(),c=ue(),[i,o]=R(null),l=()=>o(null),a=oe(()=>({mutationKey:["deleteEvent",e.event.id],mutationFn:(...h)=>c.deleteEvent(...h).then(v=>Promise.allSettled(v.map(X(1e4)))),onSuccess:h=>{const v=h.filter(m=>m.status==="fulfilled").length,b=h.length-v;v===h.length?window.alert(t.t("post.deletedSuccessfully")):v>0?window.alert(t.t("post.failedToDeletePartially",{count:b})):window.alert(t.t("post.failedToDelete"))},onError:h=>{console.error("failed to delete",h)}})),u=Be(()=>({menu:[{content:t.t("post.copyEventId"),onSelect:()=>{navigator.clipboard.writeText(Se(e.event.id)).catch(h=>window.alert(h))}},{content:t.t("post.showJSON"),onSelect:()=>{o("EventDebugModal")}},{content:t.t("post.showReposts"),onSelect:()=>{o("Reposts")}},{content:t.t("post.showReactions"),onSelect:()=>{o("Reactions")}},{when:()=>e.event.pubkey===r(),content:(()=>{const h=yn();return d(h,()=>t.t("post.deletePost")),h})(),onSelect:()=>{const h=r();h!=null&&window.confirm(t.t("post.confirmDelete"))&&a.mutate({relayUrls:n().relayUrls,pubkey:h,eventId:e.event.id})}}]}));return[s(Cn,{get event(){return e.event}}),(()=>{const h=bn(),v=h.firstChild,b=v.firstChild,m=v.nextSibling,$=m.firstChild,f=m.nextSibling;v.$$click=_=>{_.stopPropagation(),e.onClickReply()},d(b,s(Qt,{})),d(h,s(xn,{get event(){return e.event}}),m),d(h,s(kn,{get event(){return e.event}}),m),m.$$click=()=>o("ZapRequest"),d($,s(zt,{})),f.$$click=()=>u.open();const y=u.targetRef;return typeof y=="function"?q(y,f):u.targetRef=f,d(f,s(Zt,{})),d(h,()=>u.popup(),null),h})(),s(W,{get children(){return[s(x,{get when(){return i()==="EventDebugModal"},get children(){return s(wn,{get event(){return e.event},onClose:l})}}),s(x,{get when(){return i()==="Reactions"},get children(){return s(En,{get event(){return e.event},onClose:l})}}),s(x,{get when(){return i()==="Reposts"},get children(){return s(Rn,{get event(){return e.event},onClose:l})}}),s(x,{get when(){return i()==="ZapRequest"},get children(){return s(pn,{get event(){return e.event},onClose:l})}})]}})]};I(["click"]);const Tn=g("<div>"),In=g('<button class="text-xs text-fg-secondary hover:text-fg-secondary/70">'),Mn=g("<span>: "),Pn=g('<button class="mt-2 flex w-full flex-col items-center rounded border border-border p-2 text-center text-xs text-fg-secondary"><span class="inline-block size-4"></span><span>'),Dn=e=>{const t=P(),[n,r]=R(!1);return s(w,{get when(){return!e.contentWarning.contentWarning||n()},get fallback(){return(()=>{const c=Pn(),i=c.firstChild,o=i.nextSibling;return c.$$click=()=>r(!0),d(i,s($t,{})),d(o,()=>t.t("post.contentWarning.show")),d(c,s(w,{get when(){return e.contentWarning.reason!=null},get children(){const l=Mn(),a=l.firstChild;return d(l,()=>t.t("post.contentWarning.reason"),a),d(l,()=>e.contentWarning.reason,null),l}}),null),c})()},get children(){return[(()=>{const c=Tn();return d(c,()=>e.children),c})(),s(w,{get when(){return e.contentWarning.contentWarning},get children(){const c=In();return c.$$click=()=>r(!1),d(c,()=>t.t("post.contentWarning.hide")),c}})]}})};I(["click"]);const Ge=e=>{const{profile:t}=Le(()=>({pubkey:e.pubkey}));return s(w,{get when(){return(t()?.name?.length??0)>0},get fallback(){return`@${Ue(e.pubkey)}`},get children(){return["@",k(()=>t()?.name??e.pubkey)]}})},Ln=e=>{try{const t=new URL(e);return/\.(jpeg|jpg|png|gif|webp|avif|apng|svg)$/i.test(t.pathname)}catch{return!1}},Un=e=>{try{const t=new URL(e);return/\.(mpg|mpeg|mp4|avi|mov|webm|ogv)$/i.test(t.pathname)}catch{return!1}},jn=e=>{try{const t=new URL(e);return/^wss?:$/.test(t.protocol)}catch{return!1}},Ye=(e,t="thumbnail")=>{try{const n=new URL(e);if(n.host==="i.imgur.com"||n.host==="imgur.com"){const r=n.pathname.match(/^\/([a-zA-Z0-9]+)\.(jpeg|jpg|png|gif|webp|avif|apng)/);if(r!=null){const c=new URL(n),i=r[1],o=r[2];if(c.host="i.imgur.com",t==="icon")c.pathname=`${i}s.${o}`;else if(t==="thumbnail")c.pathname=`${i}l.${o}`;else return e;return c.toString()}return n.toString()}if(n.host==="i.gyazo.com"){const r=new URL(n);if(r.host="thumb.gyazo.com",t==="icon")r.pathname=`/thumb/160${n.pathname}`;else if(t==="thumbnail")r.pathname=`/thumb/640${n.pathname}`;else return e;return r.toString()}if(n.host==="nostr.build"||n.host==="i.nostr.build"||n.host==="image.nostr.build"||n.host==="cdn.nostr.build"){if(n.pathname.startsWith("/i/p/"))return e;const r=new URL(n);if(n.pathname.startsWith("/i/")){const c=n.pathname.replace(/^\/i/,"");r.hostname="image.nostr.build",r.pathname=`/resp/240p${c}`}else if(n.pathname.match(/^\/[0-9a-zA-Z]+\.(jpeg|jpg|png|gif|webp|avif|apng)$/))r.pathname=`/resp/240p${n.pathname}`;else return e;return r.toString()}if(n.host==="pbs.twimg.com"){if(n.pathname.startsWith("/profile_images/")){const r=new URL(n);return r.pathname=n.pathname.replace(/(?:_(?:mini|normal|bigger|200x200|400x400))?\.(jpg|png)$/,"_normal.$1"),r.toString()}if(n.pathname.startsWith("/media/")){const r=new URL(n);return r.searchParams.set("format","jpg"),r.searchParams.set("name","small"),r.toString()}return e}if(n.hostname==="media.discordapp.net"&&n.pathname.match(/^\/attachments\/\d+\/\d+\/[a-z0-9]+\.(png|jpg|gif)/)){const r=new URL(n);if(r.searchParams.set("format","webp"),t==="icon")r.searchParams.set("width","100"),r.searchParams.set("height","100");else if(t==="thumbnail")r.searchParams.set("width","320"),r.searchParams.set("height","320");else return e}return n.toString()}catch{return e}},Je=e=>{try{const t=new URL(e);return t.protocol==="https:"&&(t.host==="twitter.com"||t.host==="x.com")}catch{return!1}},Fn=["www.youtube.com","m.youtube.com","youtube.com"],qn=e=>{try{const t=new URL(e);if(t.protocol!=="https:")return null;if(Fn.includes(t.host)){if(t.pathname==="/watch"){const n=t.searchParams.get("v");if(n!=null)return{videoId:n}}if(t.pathname.startsWith("/shorts/")){const n=t.pathname.match(/^\/shorts\/([0-9a-zA-Z_-]*)$/);if(n)return{videoId:n[1]}}}return t.host==="youtu.be"&&t.pathname.lastIndexOf("/")===0?{videoId:t.pathname}:null}catch{return null}},An=g('<button class="rounded bg-bg-tertiary p-3 text-xs text-fg-secondary hover:shadow">'),Wn=g('<div class="aspect-video max-w-full">'),On=g('<img class="max-h-64 max-w-full rounded object-contain shadow hover:shadow-md">'),Bn=e=>{let t;const n=P(),[r,c]=R(e.initialHidden),[i,o]=R(!1);return s(w,{get when(){return!r()},get fallback(){return(()=>{const l=An();return l.$$click=()=>c(!1),d(l,()=>n.t("post.showImage")),l})()},get children(){return s(F,{get fallback(){return(()=>{const l=Wn();return d(l,s(L,{class:"text-link underline",get href(){return e.url}})),l})()},children:()=>s(w,{get when(){return!i()},get fallback(){return s(L,{class:"text-link underline",get href(){return e.url}})},get children(){return s(L,{class:"my-2 block",get href(){return e.url},get children(){const l=On();l.addEventListener("error",()=>o(!0));const a=t;return typeof a=="function"?q(a,l):t=l,T(u=>{const h=Ye(e.url),v=e.url;return h!==u._v$&&E(l,"src",u._v$=h),v!==u._v$2&&E(l,"alt",u._v$2=v),u},{_v$:void 0,_v$2:void 0}),l}})}})})}})};I(["click"]);const Hn=g('<div class="my-1 rounded border p-1">'),Kn=e=>s(w,{get when(){return e.mentionedEvent.marker!=null&&e.mentionedEvent.marker.length>0},get fallback(){return s(H,{get eventId(){return e.mentionedEvent.eventId}})},get children(){const t=Hn();return d(t,s(F,{children:()=>s(K,{get eventId(){return e.mentionedEvent.eventId},embedding:!1,actions:!1,get ensureKinds(){return[ce]}})})),t}}),zn=g('<button class="inline select-text text-link underline">'),ne=e=>{const{showProfile:t}=ae(),n=()=>{t(e.pubkey)};return(()=>{const r=zn();return r.$$click=n,d(r,s(Ge,{get pubkey(){return e.pubkey}})),r})()};I(["click"]);const Nn=e=>{const t={};return Array.from(e.head.querySelectorAll("meta")).forEach(n=>{const r=n.getAttribute("property"),c=n.getAttribute("content");r!=null&&c!=null&&(t[r]=c)}),t["og:image"]!=null&&t["og:title"]!=null&&t["og:description"]!=null&&t["og:url"]?{title:t["og:title"],description:t["og:description"],image:t["og:image"],url:t["og:url"]}:null},Qn=e=>{const t=new DOMParser().parseFromString(e,"text/html");return Nn(t)},Xe=e=>{const t=["www3.nhk.or.jp"],n=new URL(e);return t.includes(n.host)},Vn=async e=>{if(!Xe(e))return null;const n=await(await fetch(e,{headers:{Accept:"text/html"}})).text();return Qn(n)},Zn=e=>{const t=()=>["useOgp",e().url],n=z(()=>({queryKey:t(),queryFn:({queryKey:[,c]})=>Vn(c),staleTime:144e5,gcTime:144e5,refetchOnWindowFocus:!1,refetchOnMount:!1}));return{query:n,ogp:()=>n.data}},Gn=g('<blockquote class=twitter-tweet><a class="text-link underline"target=_blank rel="noreferrer noopener">'),Yn=g('<div class="my-2 rounded-lg border border-border transition-colors hover:bg-bg-tertiary"><img class="max-w-full rounded-t-lg object-contain shadow"><div class="mb-1 p-1"><div class="text-xs text-fg-secondary"></div><div class=text-sm></div><div class="text-xs text-fg-secondary">'),Jn=g('<div><button class="flex flex-col items-center rounded bg-bg-tertiary p-3 text-xs text-fg-secondary hover:shadow">'),Xn=g('<div class="aspect-video max-w-full">'),er=g('<div class="my-2 aspect-video w-full"><iframe loading=lazy title=YouTube class="my-2 size-full"allowfullscreen>'),ke=e=>{try{const t=new URL(e);return t.host="twitter.com",t.href}catch{return e}},tr=e=>{const t=new URL("https://www.youtube-nocookie.com/embed/");return t.pathname+=e,t.searchParams.set("origin",window.location.origin),t.href},nr=e=>{let t;const{getColorTheme:n}=S();O(()=>{Je(e.url)&&window.twttr?.widgets?.load(t)});const r=()=>n().brightness==="dark"?"dark":"light";return(()=>{const c=Gn(),i=c.firstChild,o=t;return typeof o=="function"?q(o,c):t=c,d(i,()=>ke(e.url)),T(l=>{const a=r(),u=ke(e.url);return a!==l._v$&&E(c,"data-theme",l._v$=a),u!==l._v$2&&E(i,"href",l._v$2=u),l},{_v$:void 0,_v$2:void 0}),c})()},rr=e=>{const{ogp:t}=Zn(()=>({url:e.url}));return s(w,{get when(){return t()},get fallback(){return s(L,{class:"text-link underline",get href(){return e.url}})},keyed:!0,children:n=>s(L,{get href(){return e.url},get children(){const r=Yn(),c=r.firstChild,i=c.nextSibling,o=i.firstChild,l=o.nextSibling,a=l.nextSibling;return d(o,()=>new URL(n.url).host),d(l,()=>n.title),d(a,()=>n.description),T(u=>{const h=n.title,v=n.image;return h!==u._v$3&&E(c,"alt",u._v$3=h),v!==u._v$4&&E(c,"src",u._v$4=v),u},{_v$3:void 0,_v$4:void 0}),r}})})},re=e=>{const t=P(),[n,r]=R(e.initialHidden);return s(w,{get when(){return!n()},get fallback(){return(()=>{const c=Jn(),i=c.firstChild;return i.$$click=()=>r(!1),d(i,()=>t.t("post.showPreview")),d(c,s(L,{class:"text-link underline",get href(){return e.url}}),null),c})()},get children(){return e.children}})},sr=e=>{const{config:t}=S();return s(W,{get fallback(){return s(L,{class:"text-link underline",get href(){return e.url}})},get children(){return[s(x,{get when(){return k(()=>!!t().embedding.twitter)()&&Je(e.url)},get children(){return s(re,{get url(){return e.url},get initialHidden(){return e.initialHidden},get children(){return s(nr,{get url(){return e.url}})}})}}),s(x,{get when(){return k(()=>!!t().embedding.youtube)()&&qn(e.url)},keyed:!0,children:({videoId:n})=>s(re,{get url(){return e.url},get initialHidden(){return e.initialHidden},get children(){return s(F,{get fallback(){return(()=>{const r=Xn();return d(r,s(L,{get href(){return e.url}})),r})()},children:()=>(()=>{const r=er(),c=r.firstChild;return T(()=>E(c,"src",tr(n))),r})()})}})}),s(x,{get when(){return k(()=>!!t().embedding.ogp)()&&Xe(e.url)},get children(){return s(re,{get url(){return e.url},get initialHidden(){return e.initialHidden},get children(){return s(F,{children:()=>s(rr,{get url(){return e.url}})})}})}})]}})};I(["click"]);const or=g('<button class="rounded bg-bg-tertiary p-3 text-xs text-fg-secondary hover:shadow">'),lr=g('<div class="aspect-video max-w-full">'),ir=g('<video class="max-h-64 max-w-full rounded-sm object-contain shadow"controls><a>'),cr=e=>{let t;const n=P(),[r,c]=R(e.initialHidden);return s(w,{get when(){return!r()},get fallback(){return(()=>{const i=or();return i.$$click=()=>c(!1),d(i,()=>n.t("post.showVideo")),i})()},get children(){return s(F,{get fallback(){return lr()},children:()=>s(L,{class:"my-2 block",get href(){return e.url},get children(){const i=ir(),o=i.firstChild,l=t;return typeof l=="function"?q(l,i):t=i,d(o,()=>n.t("post.download")),T(a=>{const u=e.url,h=e.url;return u!==a._v$&&E(i,"src",a._v$=u),h!==a._v$2&&E(o,"href",a._v$2=h),a},{_v$:void 0,_v$2:void 0}),i}})})}})};I(["click"]);const se=g("<span>"),xe=g('<button class="select-text text-link underline">'),Ee=g('<div class="my-1 rounded border border-border p-1">'),ar=g('<button class="select-text text-link underline"> (<!>)'),ur=g('<span class="text-link underline">'),dr=g('<img class="inline-block h-8 max-w-[8rem]">'),hr=e=>{const{config:t,saveColumn:n}=S(),r=yt(),c=o=>{n(ot({query:o})),r({command:"moveToLastColumn"}).catch(l=>console.error(l))},i=o=>{n(lt({name:o,relayUrls:[o]})),r({command:"moveToLastColumn"}).catch(l=>console.error(l))};return s(N,{get each(){return e.parsed},children:o=>{if(o.type==="PlainText")return(()=>{const l=se();return d(l,()=>o.content),l})();if(o.type==="URL"){const l=()=>!t().showMedia||!e.embedding||(e.initialHidden??!1);return Ln(o.content)?s(Bn,{get url(){return o.content},get initialHidden(){return l()}}):Un(o.content)?s(cr,{get url(){return o.content},get initialHidden(){return l()}}):jn(o.content)?(()=>{const a=xe();return a.$$click=()=>i(o.content),d(a,()=>o.content),a})():s(sr,{get url(){return o.content},get initialHidden(){return l()}})}if(o.type==="TagReferenceResolved"){if(o.reference==null)return(()=>{const l=se();return d(l,()=>o.content),l})();if(o.reference.type==="MentionedUser")return s(ne,{get pubkey(){return o.reference.pubkey}});if(o.reference.type==="MentionedEvent")return e.embedding?s(Kn,{get mentionedEvent(){return o.reference}}):s(H,{get eventId(){return o.reference.eventId}})}if(o.type==="Bech32Entity"){if(o.data.type==="note"&&e.embedding)return(()=>{const l=Ee();return d(l,s(K,{get eventId(){return o.data.data},actions:!1,embedding:!1,get ensureKinds(){return[ce]}})),l})();if(o.data.type==="nevent"&&e.embedding)return(()=>{const l=Ee();return d(l,s(K,{get eventId(){return o.data.data.id},actions:!1,embedding:!1})),l})();if(o.data.type==="npub")return s(ne,{get pubkey(){return o.data.data}});if(o.data.type==="nprofile")return s(ne,{get pubkey(){return o.data.data.pubkey}});if(o.data.type==="nrelay"){const l=o.data.data;return(()=>{const a=ar(),u=a.firstChild,h=u.nextSibling;return h.nextSibling,a.$$click=()=>i(l),d(a,l,u),d(a,()=>o.content,h),a})()}return(()=>{const l=ur();return d(l,()=>o.content),l})()}return o.type==="HashTag"?(()=>{const l=xe();return l.$$click=()=>c(o.content),d(l,()=>o.content),l})():o.type==="CustomEmojiResolved"?o.url==null?(()=>{const l=se();return d(l,()=>o.content),l})():(()=>{const l=dr();return T(a=>{const u=o.url,h=o.content,v=o.shortcode;return u!==a._v$&&E(l,"src",a._v$=u),h!==a._v$2&&E(l,"alt",a._v$2=h),v!==a._v$3&&E(l,"title",a._v$3=v),a},{_v$:void 0,_v$2:void 0,_v$3:void 0}),l})():(console.error("Not all ParsedTextNoteNodes are covered",o),null)}})};I(["click"]);const Re=2,gr=200,fr=()=>{let e;const[t,n]=R(!1),r=i=>{e=i},c=bt(()=>{e!=null&&n(e.scrollHeight>e.clientHeight+Re||e.scrollHeight>document.documentElement.clientHeight+Re)},gr);return Me(()=>{if(e!=null){c();const i=new IntersectionObserver(l=>{l.forEach(a=>{a.isIntersecting&&c()})},{threshold:[0,.25,.5,.75,1]});i.observe(e);const o=()=>c();window.addEventListener("resize",o),B(()=>{i.disconnect(),window.removeEventListener("resize",o)})}}),{overflow:t,elementRef:r}},vr=g('<div class="author-name truncate pr-1 font-bold hover:underline">'),mr=g('<button class="mt-2 w-full rounded border border-border p-2 text-center text-xs text-fg-secondary shadow-sm hover:bg-bg-tertiary hover:shadow">'),$r=g('<div class="post flex flex-col"><div class="flex w-full gap-1"><button type=button class="author-icon size-10 shrink-0 overflow-hidden rounded"></button><div class="min-w-0 flex-auto"><div class="flex justify-between gap-1 text-xs"><button type=button class="author flex min-w-0 select-text truncate hover:text-link"><span class="author flex min-w-0 truncate hover:text-link"><div class="author-username truncate text-fg-secondary"></div></span></button><div class="created-at shrink-0"><button type=button class="select-text hover:underline"></button></div></div><div class=overflow-hidden></div><div class=actions>'),yr=g('<img alt=icon referrerpolicy=no-referrer class="size-full object-cover">'),br=e=>{const t=P(),{overflow:n,elementRef:r}=fr(),c=Ae(),[i,o]=R(!1),l=()=>c(e.createdAt),a=()=>e.createdAt.toLocaleString(),{profile:u}=Le(()=>({pubkey:e.authorPubkey}));return(()=>{const h=$r(),v=h.firstChild,b=v.firstChild,m=b.nextSibling,$=m.firstChild,f=$.firstChild,y=f.firstChild,_=y.firstChild,C=f.nextSibling,D=C.firstChild,U=$.nextSibling,Z=U.nextSibling;return b.$$click=p=>{p.preventDefault(),e.onShowProfile?.()},d(b,s(w,{get when(){return u()?.picture},keyed:!0,children:p=>s(F,{children:()=>(()=>{const M=yr();return T(()=>E(M,"src",Ye(p,"icon"))),M})()})})),f.$$click=p=>{p.preventDefault(),e?.onShowProfile?.()},d(y,s(w,{get when(){return(u()?.display_name?.length??0)>0},get children(){const p=vr();return d(p,()=>u()?.display_name),p}}),_),d(_,s(w,{get when(){return u()?.name!=null},get fallback(){return`@${Ue(e.authorPubkey)}`},get children(){return["@",k(()=>u()?.name)]}})),D.$$click=p=>{p.preventDefault(),e.onShowEvent?.()},d(D,l),q(r,U),d(U,()=>e.content),d(m,s(w,{get when(){return n()},get children(){const p=mr();return p.$$click=M=>{M.stopPropagation(),o(j=>!j)},d(p,s(w,{get when(){return!i()},get fallback(){return t.t("post.hideOverflow")},get children(){return t.t("post.showOverflow")}})),p}}),Z),d(Z,()=>e.actions),d(h,s(w,{get when(){return e.footer},get children(){return e.footer}}),null),T(p=>{const M=a(),j=!i(),he=!!i();return M!==p._v$&&E(D,"title",p._v$=M),j!==p._v$2&&U.classList.toggle("max-h-screen",p._v$2=j),he!==p._v$3&&U.classList.toggle("max-h-none",p._v$3=he),p},{_v$:void 0,_v$2:void 0,_v$3:void 0}),h})()};I(["click"]);const wr=ct(),pr=()=>it(wr),Fr=()=>{const[e,t]=at({});return{timelineState:e,setTimeline:n=>t("content",n),clearTimeline:()=>t("content",void 0)}},_r=g("<div class=nostr-textnote>"),kr=g("<div class=text-xs>"),xr=g('<div class="content whitespace-pre-wrap break-all">'),Er=g("<div class=textnote-content>"),Rr=g('<div class="mt-1 rounded border border-border p-1">'),Cr=g("<div class=h-12>"),Sr=g('<button class="select-text pr-1 text-link hover:underline">'),Tr=g("<div class=h-5>"),Ir=e=>{let t;const n=P(),{showProfile:r}=ae(),c=pr(),[i,o]=R(!1),l=()=>o(!1),a=()=>{o(m=>!m),i()&&t!=null&&t.focus()},u=k(()=>ut(e.event)),h=()=>e.embedding??!0,v=()=>e.actions??!0,b=()=>{if(h()){const m=u().replyingToEvent();if(m!=null&&!u().containsEventMention(m.id))return m.id;const $=u().rootEvent();if(m==null&&$!=null&&!u().containsEventMention($.id))return $.id}};return(()=>{const m=_r();return d(m,s(br,{get authorPubkey(){return u().pubkey},get createdAt(){return u().createdAtAsDate()},get content(){return(()=>{const $=Er();return d($,s(w,{get when(){return b()},keyed:!0,children:f=>(()=>{const y=Rr();return d(y,s(F,{get fallback(){return Cr()},children:()=>s(K,{eventId:f,actions:!1,embedding:!1})})),y})()}),null),d($,s(w,{get when(){return u().taggedPubkeys().length>0},get children(){const f=kr();return d(f,()=>n.t("post.replyToPre"),null),d(f,s(N,{get each(){return u().taggedPubkeys()},children:y=>(()=>{const _=Sr();return _.$$click=C=>{C.stopPropagation(),r(y)},d(_,s(Ge,{pubkey:y})),_})()}),null),d(f,()=>n.t("post.replyToPost"),null),f}}),null),d($,s(Dn,{get contentWarning(){return u().contentWarning()},get children(){const f=xr();return d(f,s(hr,{get parsed(){return u().parsed()},get embedding(){return h()},get initialHidden(){return u().contentWarning().contentWarning}})),f}}),null),$})()},get actions(){return s(w,{get when(){return v()},get children(){return s(F,{get fallback(){return Tr()},children:()=>s(Sn,{get event(){return e.event},onClickReply:a})})}})},get footer(){return s(w,{get when(){return i()},get children(){return s(wt,{textAreaRef:$=>{t=$},mode:"reply",get replyTo(){return e.event},onClose:l,onPost:l})}})},onShowProfile:()=>{r(u().pubkey)},onShowEvent:()=>{c?.setTimeline({type:"Replies",event:e.event})}})),m})()};I(["click"]);const Ce=g("<div><span>"),et=e=>{const t=P(),n=()=>e.ensureKinds==null||e.ensureKinds.length===0||e.ensureKinds.includes(e.event.kind);return s(W,{get fallback(){return(()=>{const r=Ce(),c=r.firstChild;return d(c,()=>t.t("post.unsupportedKind",{kind:e.event.kind})),d(r,s(H,{get eventId(){return e.event.id},get kind(){return e.event.kind}}),null),r})()},get children(){return[s(x,{get when(){return!n()},keyed:!0,get children(){const r=Ce(),c=r.firstChild;return d(c,()=>t.t("post.unexpectedKind",{kind:e.event.kind})),d(r,s(H,{get eventId(){return e.event.id},get kind(){return e.event.kind}}),null),r}}),s(x,{get when(){return e.event.kind===ce},get children(){return s(Ir,{get event(){return e.event},get embedding(){return e.actions},get actions(){return e.actions}})}}),s(x,{get when(){return e.event.kind===dt},get children(){return s(Ht,{get event(){return e.event}})}})]}})},qr=e=>{const{shouldMuteEvent:t}=S();return s(N,{get each(){return e.events},children:n=>s(w,{get when(){return!t(n)},get children(){return s(Rt,{get children(){return s(et,{event:n})}})}})})};let G=0;const{setActiveSubscriptions:Mr}=pt();setInterval(()=>{Mr(G)},1e3);const Pr=({eose:e,limit:t,eoseLimit:n})=>{const[c,i]=R([]),o=[];let l;const a=()=>{i(m=>{const $=[...m];return o.forEach(f=>{fe($,f)}),$.slice(0,n())}),o.splice(0,o.length)},u=()=>{l==null&&(l=setTimeout(()=>{l=void 0,a()},100))},h=()=>{l!=null&&clearTimeout(l)},v=m=>{const $=m.created_at-_t();if(!($>300)){if($>0){setTimeout(()=>v(m),$*1e3);return}e()?i(f=>{const y=[...f];return fe(y,m),y.slice(0,t())}):(o.push(m),u())}},b=()=>{i([]),h()};return O(()=>{e()&&a()}),B(()=>{h()}),{events:c,setEvents:i,addEvent:v,clearEvents:b}},Ar=e=>{const{config:t,shouldMuteEvent:n}=S(),r=kt(),[c,i]=R(!1),o=k(e),l=()=>e()?.eoseLimit??25,a=()=>e()?.limit??50,{events:u,addEvent:h,clearEvents:v,setEvents:b}=Pr({eose:c,eoseLimit:l,limit:a});O(ge(()=>[t().mutedPubkeys,t().mutedKeywords],()=>{b($=>$.filter(f=>!n(f)))},{defer:!0})),Me(()=>{console.debug("subscription mounted",e()?.debugId,e()),B(()=>{console.debug("subscription unmount",e()?.debugId,e())})});const m=()=>{console.debug("startSubscription: start");const $=o();if($==null)return;const{relayUrls:f,filters:y,options:_,onEvent:C,onEOSE:D,clientEventFilter:U,continuous:Z=!0}=$;let p=!0;G+=1,v(),i(!1);const M=r().subscribeMany(f,y,_??{maxWait:12e3,onevent:j=>{C?.(j),!(U!=null&&!U(j))&&h(j)},oneose:()=>{c()||(D?.(),i(!0),Z||(M.close(),p&&(p=!1,G-=1)))}});B(()=>{console.debug("startSubscription: end"),M.close(),p&&(p=!1,G-=1)})};return O(ge(()=>[o()],()=>m())),{events:u,eose:c}},tt=e=>{const t=()=>{const r=e();if(r==null)return[];const c=[];return Ie(r).pTags().forEach(o=>{const[,l,a,u]=o,h={pubkey:l,petname:u};a!=null&&a.length>0&&(h.mainRelayUrl=a),c.push(h)}),c};return{followings:t,followingPubkeys:()=>t().map(r=>r.pubkey),data:e}},Wr=async({pubkey:e},t)=>{const n=new V({type:"Followings",pubkey:e});Pe({task:n,signal:t});const r=await n.latestEventPromise();return tt(()=>r)},Or=e=>{const t=Q(),n=k(e),r=()=>["useFollowings",n()],c=z(()=>({queryKey:r(),queryFn:xt({taskProvider:([,o])=>{if(o==null)return null;const{pubkey:l}=o;return new V({type:"Followings",pubkey:l})},queryClient:t}),staleTime:5*60*1e3,gcTime:3*24*60*60*1e3,refetchOnMount:!0,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchInterval:0})),i=()=>t.invalidateQueries({queryKey:r()});return{...tt(()=>c.data),invalidateFollowings:i,query:c}};export{zt as B,tn as C,K as E,Ht as R,qr as T,Fr as a,wr as b,Rt as c,Or as d,Ae as e,Mt as f,Oe as g,et as h,Ir as i,Be as j,Zt as k,hr as l,Wr as m,Qe as n,Ye as t,Ar as u};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/EventDebugModal-OtBKkWWJ.js","assets/index-WKg6uwxW.js","assets/index-xjSADeDu.css","assets/BasicModal-Cnp2wqhi.js","assets/SideBar-kOu-0lWG.js","assets/resolveAsset-1T29-dSX.js","assets/Copy-eYOSGix_.js","assets/UserList-sfPHZ5lM.js","assets/LazyLoad-vk1PFxt8.js","assets/SafeLink-TgC8fukl.js","assets/ZapRequestModal-PY9tbG_1.js","assets/lud16ToLnurlPayUrl-XLrcBndl.js","assets/_baseClone-yDXUaB90.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
//# sourceMappingURL=useFollowings-10fxLML7.js.map
