import{s as U,t as h,d as P,c as T,i as u,a as n,S as k,M as _,b as G,u as w,e as ge,f as he,g as p,h as Z,j as N,k as fe,l as D,T as ve,m as ye,n as ee,o as S,p as M,q as xe,r as ne,F as V,v as $e,w as te,x as J,y as K,z as re,A as we,B as ke,C as be,D as Ce,E as _e,G as pe,R as Ie,H as Te,Z as Ee,I as Se,J as Re,K as Me}from"./index-7c573153.js";import{u as L,T as A,a as Pe,b as W,A as Le,c as Fe,d as le,e as oe,C as R,E as se,p as qe,r as Be,t as De,B as Ue,f as X,g as Ne,h as Oe,H as je,i as He,j as Q,k as ze,l as Ae,U as ce,m as ie,n as ue,o as ae,q as Ke,R as Qe,s as Ge,v as Ve,w as Ze,G as Je,M as We,x as Xe,S as Ye,y as en,z as nn}from"./SideBar-bc24f5ed.js";import{u as tn}from"./usePersistStatus-6aee39f8.js";const rn=h('<svg xmlns=http://www.w3.org/2000/svg fill=none stroke=currentColor stroke-width=1.5 aria-hidden=true data-slot=icon viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round d="M17.593 3.322c1.1.128 1.907 1.077 1.907 2.185V21L12 17.25 4.5 21V5.507c0-1.108.806-2.057 1.907-2.185a48.507 48.507 0 0 1 11.186 0">'),ln=(e={})=>(()=>{const t=rn();return U(t,e,!0,!0),t})(),on=h('<svg xmlns=http://www.w3.org/2000/svg fill=none stroke=currentColor stroke-width=1.5 aria-hidden=true data-slot=icon viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round d="M12 6.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5m0 6a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5m0 6a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5">'),de=(e={})=>(()=>{const t=on();return U(t,e,!0,!0),t})(),sn=h('<div class="flex flex-col"><div class="flex h-8 items-center gap-1 px-2"><h2 class="flex min-w-0 flex-1 items-center gap-1"><span class=truncate></span></h2><button class="flex h-full place-items-center"><span class="inline-block h-4 w-4">'),cn=h('<span class="inline-block h-4 w-4 shrink-0 text-fg-secondary">'),O=e=>{const[t,r]=T(!1),c=()=>r(l=>!l);return(()=>{const l=sn(),o=l.firstChild,s=o.firstChild,i=s.firstChild,a=s.nextSibling,f=a.firstChild;return u(s,n(k,{get when(){return e.icon},keyed:!0,children:m=>(()=>{const d=cn();return u(d,m),d})()}),i),u(i,()=>e.name),a.$$click=()=>c(),u(f,n(de,{})),u(l,n(k,{get when(){return t()},get children(){return e.settings()}}),null),l})()};P(["click"]);const un=e=>{const t=[e.id],r=e.rootEvent()?.id;r!=null&&t.push(r);const c=e.replyingToEvent()?.id;return c!=null&&t.push(c),ge(t)},an=e=>{const{config:t}=w(),r=()=>he(e.event),{events:c}=L(()=>({relayUrls:t().relayUrls,filters:[{kinds:[1],ids:un(r()),limit:25},{kinds:[1],"#e":[e.event.id],limit:25}],limit:200}));return n(A,{get events(){return[...c()].reverse()}})},dn=e=>n(G,{get children(){return n(_,{get when(){return e.timelineContent.type==="Replies"&&e.timelineContent},keyed:!0,children:t=>n(an,{get event(){return t.event}})})}}),mn=h('<div class="flex w-[80vw] shrink-0 snap-center snap-always flex-col border-r border-border sm:snap-align-none">'),gn=h('<div class="shrink-0 border-b border-border">'),hn=h('<div class="scrollbar flex flex-col overflow-y-scroll pb-16">'),fn=h('<div class="flex shrink-0 items-center border-b border-border px-2"><button class="flex w-full items-center gap-1"><div class="inline-block h-4 w-4"></div><div>'),vn=h('<div class="scrollbar flex max-h-full flex-col overflow-y-scroll scroll-smooth pb-16">'),F=e=>{let t;const r=Pe(),c=p(),l=()=>e.width??"medium";return W(()=>({commandType:"moveToColumn",handler:o=>{o.command==="moveToColumn"&&o.columnIndex===e.columnIndex&&t?.scrollIntoView({behavior:"smooth",inline:"center"})}})),W(()=>({commandType:"moveToLastColumn",handler:()=>{e.lastColumn&&t?.scrollIntoView({behavior:"smooth"})}})),n(Fe.Provider,{value:r,get children(){const o=mn(),s=t;return typeof s=="function"?Z(s,o):t=o,u(o,n(k,{get when(){return r.timelineState.content},keyed:!0,get fallback(){return[(()=>{const i=gn();return u(i,()=>e.header),i})(),(()=>{const i=hn(),a=e.timelineRef;return typeof a=="function"?Z(a,i):e.timelineRef=i,u(i,()=>e.children),i})()]},children:i=>[(()=>{const a=fn(),f=a.firstChild,m=f.firstChild,d=m.nextSibling;return f.$$click=()=>r?.clearTimeline(),u(m,n(Le,{})),u(d,()=>c()("column.back")),a})(),(()=>{const a=vn();return u(a,n(dn,{timelineContent:i})),a})()]})),N(i=>fe(o,{"sm:w-[500px]":l()==="widest","sm:w-[360px]":l()==="wide","sm:w-[320px]":l()==="medium","sm:w-[280px]":l()==="narrow"},i)),o}})};P(["click"]);const yn=h('<svg xmlns=http://www.w3.org/2000/svg fill=none stroke=currentColor stroke-width=1.5 aria-hidden=true data-slot=icon viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round d="M15.75 19.5 8.25 12l7.5-7.5">'),xn=(e={})=>(()=>{const t=yn();return U(t,e,!0,!0),t})(),$n=h('<svg xmlns=http://www.w3.org/2000/svg fill=none stroke=currentColor stroke-width=1.5 aria-hidden=true data-slot=icon viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round d="m8.25 4.5 7.5 7.5-7.5 7.5">'),wn=(e={})=>(()=>{const t=$n();return U(t,e,!0,!0),t})(),kn=h('<svg xmlns=http://www.w3.org/2000/svg fill=none stroke=currentColor stroke-width=1.5 aria-hidden=true data-slot=icon viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0">'),bn=(e={})=>(()=>{const t=kn();return U(t,e,!0,!0),t})(),Cn=h('<div class="flex flex-col gap-2 border-b border-border p-2"><div></div><div>'),_n=h('<div class="scrollbar flex h-9 gap-2 overflow-x-scroll"><button class="rounded-md border border-border px-4"></button><button class="rounded-md border border-border px-4"></button><button class="rounded-md border border-border px-4"></button><button class="rounded-md border border-border px-4">'),pn=h('<div class="flex flex-col border-t border-border"><div class="flex h-10 items-center gap-2"><button class="py-4 pl-2"><span class="inline-block h-4 w-4"></span></button><button class="py-4 pr-2"><span class="inline-block h-4 w-4"></span></button><div class=flex-1></div><button class="px-2 py-4 text-danger hover:text-rose-600"><span class="inline-block h-4 w-4">'),In=e=>(()=>{const t=Cn(),r=t.firstChild,c=r.nextSibling;return u(r,()=>e.title),u(c,()=>e.children),t})(),q=e=>{const t=p(),{saveColumn:r,removeColumn:c,moveColumn:l}=w(),o=le(),s=a=>{r({...e.column,width:a})},i=a=>{l(e.column.id,a),o({command:"moveToColumn",columnIndex:a}).catch(f=>console.error(f))};return(()=>{const a=pn(),f=a.firstChild,m=f.firstChild,d=m.firstChild,g=m.nextSibling,v=g.firstChild,$=g.nextSibling,x=$.nextSibling,b=x.firstChild;return u(a,n(In,{get title(){return t()("column.config.columnWidth")},get children(){const y=_n(),I=y.firstChild,C=I.nextSibling,B=C.nextSibling,z=B.nextSibling;return I.$$click=()=>s("widest"),u(I,()=>t()("column.config.widest")),C.$$click=()=>s("wide"),u(C,()=>t()("column.config.wide")),B.$$click=()=>s("medium"),u(B,()=>t()("column.config.medium")),z.$$click=()=>s("narrow"),u(z,()=>t()("column.config.narrow")),y}}),f),m.$$click=()=>i(e.columnIndex-1),u(d,n(xn,{})),g.$$click=()=>i(e.columnIndex+1),u(v,n(wn,{})),x.$$click=()=>c(e.column.id),u(b,n(bn,{})),N(y=>{const I=t()("column.config.moveLeft"),C=t()("column.config.moveRight"),B=t()("column.config.removeColumn"),z=t()("column.config.removeColumn");return I!==y._v$&&D(m,"title",y._v$=I),C!==y._v$2&&D(g,"title",y._v$2=C),B!==y._v$3&&D(x,"title",y._v$3=B),z!==y._v$4&&D(b,"aria-label",y._v$4=z),y},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0}),a})()};P(["click"]);class Tn extends ye{constructor(t){super(),this.tags=t}}const En=e=>{try{const t=ve.parse(JSON.parse(e));return new Tn(t)}catch(t){throw new TypeError("failed to parse tags schema: ",{cause:t})}},[Y,Sn]=ee(()=>T({})),[Rn,Mn]=ee(()=>T({})),Pn=e=>{const t=oe(),[r,c]=T(null);return S(()=>{const l=e();if(l==null)return;const{encrypted:o}=l;if(o in Y()){c(Y()[o]);return}const s=t();s!=null&&(Rn()[o]||(Mn(i=>({...i,[o]:!0})),window.nostr?.nip04?.decrypt?.(s,o)?.then(i=>{Sn(a=>({...a,[o]:i})),c(i)}).catch(i=>{console.error(`failed to decrypt "${o}"`,i)})))}),r},Ln=e=>{const t=M(()=>xe(e.event)),r=Pn(()=>{const{content:o}=t();return o==null||o.length===0?null:{id:t().id,encrypted:o}}),c=()=>{const o=r();if(o==null)return[];console.log(o);try{return En(o).taggedEventIds()}catch(s){return console.warn(s),[]}},l=()=>t().taggedEventIds();return n(V,{get each(){return[...l(),...c()]},children:o=>n(R,{get children(){return n(se,{eventId:o,get ensureKinds(){return[ne]}})}})})},Fn=e=>{const t=$e(),r=M(e),c=()=>["useFollowings",r()],l=te(()=>({queryKey:c(),queryFn:({queryKey:s,signal:i})=>{console.debug("useFollowings");const[,a]=s;if(a==null)return Promise.resolve(null);const{kind:f,author:m,identifier:d}=a,g=new Ue({type:"ParameterizedReplaceableEvent",kind:f,author:m,identifier:d}),v=g.firstEventPromise().catch(()=>{throw new Error(`parameterized replaceable event not found: ${f}:${m}:${d}`)});return g.onUpdate($=>{const x=qe($);t.setQueryData(s,x)}),Be({task:g,signal:i}),De(15e3,`useParameterizedReplaceableEvent: ${f}:${m}:${d}`)(v)},staleTime:5*60*1e3,gcTime:4*60*60*1e3}));return{event:()=>l.data??null,query:l}},qn=e=>{const t=p(),{removeColumn:r}=w(),{event:c}=Fn(()=>({kind:30001,author:e.column.pubkey,identifier:e.column.identifier}));return n(F,{get header(){return n(O,{get name(){return e.column.name??t()("column.bookmark")},get icon(){return n(ln,{})},settings:()=>n(q,{get column(){return e.column},get columnIndex(){return e.columnIndex}}),onClose:()=>r(e.column.id)})},get width(){return e.column.width},get columnIndex(){return e.columnIndex},get lastColumn(){return e.lastColumn},get children(){return n(k,{get when(){return c()},keyed:!0,children:l=>n(Ln,{event:l})})}})},Bn=()=>{const[e,t]=T();return{targetRef:t,currentPosition:()=>e()?.scrollTop??0,scrollToTop:()=>{const o=e();o?.scrollTo(0,0)},scrollToBottom:()=>{const o=e();o?.scrollTo(0,o.scrollHeight)}}},Dn=h('<button class="flex h-12 w-full flex-col items-center justify-center hover:text-fg-secondary"><span>'),Un=h('<button class="flex h-12 w-full flex-col items-center justify-center hover:text-fg-secondary disabled:text-fg-secondary/30"><span>'),j=e=>{const t=M(e),r=v=>{const{duration:$}=t();if($!=null)return v-$},[c,l]=T([]),[o,s]=T(r(X())),[i,a]=T(),f=()=>i()==null,m=Bn(),d=()=>{J(()=>{a(void 0),s(r(X()))}),m.scrollToTop()},g=()=>{const v=Ne(c());v!=null&&(J(()=>{a(v.created_at),s(r(v.created_at))}),m.scrollToTop())};return{timelineRef:m.targetRef,setEvents:l,since:o,until:i,continuous:f,loadLatest:d,loadOld:g}},H=e=>{const t=p();return[n(k,{get when(){return!e.loadMore.continuous()},get children(){return n(R,{get children(){const r=Dn(),c=r.firstChild;return r.$$click=()=>e.loadMore.loadLatest(),u(c,()=>t()("column.loadLatest")),r}})}}),M(()=>e.children),n(R,{get children(){const r=Un(),c=r.firstChild;return r.$$click=()=>e.loadMore.loadOld(),u(c,()=>t()("column.loadOld")),N(()=>r.disabled=!e.eose),r}})]};P(["click"]);const E=e=>t=>{switch(e.filterType){case"AND":return e.children.every(r=>E(r)(t));case"OR":return e.children.some(r=>E(r)(t));case"NOT":return!E(e.child)(t);case"Text":return t.includes(e.text);case"Regex":return new RegExp(e.regex,e.flag).test(t);default:console.error("unsupported content filter type");break}return!1},Nn=e=>{const t=p(),{config:r,removeColumn:c}=w(),{followingPubkeys:l}=Oe(()=>({pubkey:e.column.pubkey})),o=j(()=>({duration:4*60*60})),{events:s,eose:i}=L(()=>{const a=we.uniq([...l()]);return a.length===0?null:{debugId:"following",relayUrls:r().relayUrls,filters:[{kinds:[1,6],authors:a,limit:20,since:o.since(),until:o.until()}],eoseLimit:20,continuous:o.continuous(),clientEventFilter:f=>e.column.contentFilter==null?!0:E(e.column.contentFilter)(f.content)}});return S(()=>{console.log("home",s()),o.setEvents(s())}),K(()=>console.log("home timeline mounted")),re(()=>console.log("home timeline unmounted")),n(F,{get header(){return n(O,{get name(){return e.column.name??t()("column.home")},get icon(){return n(je,{})},settings:()=>n(q,{get column(){return e.column},get columnIndex(){return e.columnIndex}}),onClose:()=>c(e.column.id)})},get width(){return e.column.width},get columnIndex(){return e.columnIndex},get lastColumn(){return e.lastColumn},get timelineRef(){return o.timelineRef},get children(){return n(H,{loadMore:o,get eose(){return i()},get children(){return n(A,{get events(){return s()}})}})}})},On=h('<img alt=icon class="h-full w-full object-cover">'),jn=h('<div class="flex items-center gap-1 pl-[2px] text-sm"><div class="notification-icon flex max-w-[64px] place-items-center"></div><div class="notification-user flex flex-1 gap-1 overflow-hidden"><div class="author-icon h-5 w-5 shrink-0 overflow-hidden rounded"></div><div class="flex min-w-0 flex-1 overflow-hidden"><button class="select-text truncate font-bold hover:text-link hover:underline"></button><span class=shrink-0></span></div></div><div class=text-xs>'),Hn=h('<div class="notification-event py-1">'),zn=h("<div class=truncate> "),An=e=>{const t=p(),r=He(),{shouldMuteEvent:c}=w(),{showProfile:l}=ue(),o=()=>ke(e.event),s=()=>o().lastTaggedEventId(),{profile:i}=Q(()=>({pubkey:e.event.pubkey})),{event:a,query:f}=ze(()=>ae([s()])(([d])=>({eventId:d}))),m=()=>f.isSuccess&&a()==null;return n(k,{get when(){return M(()=>!m())()&&!c(e.event)},get children(){return[(()=>{const d=jn(),g=d.firstChild,v=g.nextSibling,$=v.firstChild,x=$.nextSibling,b=x.firstChild,y=b.nextSibling,I=v.nextSibling;return u(g,n(Ae,{get reactionTypes(){return o().toReactionTypes()}})),u($,n(k,{get when(){return i()?.picture!=null},get children(){const C=On();return N(()=>D(C,"src",i()?.picture)),C}})),b.$$click=()=>l(e.event.pubkey),u(b,n(ce,{get pubkey(){return e.event.pubkey}})),u(y,()=>t()("notification.reacted")),u(I,()=>r(o().createdAtAsDate())),d})(),(()=>{const d=Hn();return u(d,n(k,{get when(){return a()},get fallback(){return(()=>{const g=zn(),v=g.firstChild;return u(g,()=>t()("general.loading"),v),u(g,s,null),g})()},keyed:!0,children:g=>n(ie,{event:g})})),d})()]}})};P(["click"]);const Kn=h('<svg xmlns=http://www.w3.org/2000/svg fill=currentColor aria-hidden=true data-slot=icon viewBox="0 0 24 24"><path fill-rule=evenodd d="M14.615 1.595a.75.75 0 0 1 .359.852L12.982 9.75h7.268a.75.75 0 0 1 .548 1.262l-10.5 11.25a.75.75 0 0 1-1.272-.71l1.992-7.302H3.75a.75.75 0 0 1-.548-1.262l10.5-11.25a.75.75 0 0 1 .913-.143"clip-rule=evenodd>'),Qn=(e={})=>(()=>{const t=Kn();return U(t,e,!0,!0),t})(),Gn=h('<img alt=icon class="h-full w-full object-cover">'),Vn=h('<div class="flex items-center gap-1 text-sm"><div class="flex w-6 flex-col items-center"><div class="h-4 w-4 shrink-0 text-amber-500"aria-hidden=true></div><div class="mt-[-2px] shrink-0 text-xs"></div></div><div class="notification-user flex gap-1 overflow-hidden"><div class="author-icon h-5 w-5 shrink-0 overflow-hidden rounded"></div><div class="flex min-w-0 flex-1 overflow-hidden"><button class="select-text truncate font-bold hover:text-link hover:underline"></button><span class=shrink-0>'),Zn=h('<div class="ml-7 whitespace-pre-wrap break-all rounded border border-border px-1 text-sm">'),Jn=h('<div class="notification-event py-1">'),Wn=e=>{const t=p(),{shouldMuteEvent:r}=w(),{showProfile:c}=ue(),l=M(()=>be(e.event)),{profile:o}=Q(()=>({pubkey:l().senderPubkey()})),{profile:s,query:i}=Q(()=>ae([l().zappedPubkey()])(([m])=>({pubkey:m}))),a=te(()=>({queryKey:["fetchLnurlPayRequestMetadata",s()],queryFn:({queryKey:m})=>{const[,d]=m;if(d!=null)return Ce(d)},staleTime:5*60*1e3,gcTime:3*24*60*60*1e3})),f=()=>{const m=s(),d=i.data,g=a.data;if(m==null||d==null||g==null||!(g.allowsNostr&&g.nostrPubkey!=null))return!1;const v=_e(m);if(v==null)return null;const $=g.nostrPubkey,x=pe({zapReceipt:l().rawEvent,lnurlPayUrl:v,lnurlProviderPubkey:$});return console.log("result",x),x.success};return n(k,{get when(){return M(()=>!r(e.event))()&&f()},get children(){return[(()=>{const m=Vn(),d=m.firstChild,g=d.firstChild,v=g.nextSibling,$=d.nextSibling,x=$.firstChild,b=x.nextSibling,y=b.firstChild,I=y.nextSibling;return u(g,n(Qn,{})),u(v,()=>Ke(l().amountSats())),u(x,n(k,{get when(){return o()?.picture!=null},get children(){const C=Gn();return N(()=>D(C,"src",o()?.picture)),C}})),y.$$click=()=>c(l().senderPubkey()),u(y,n(ce,{get pubkey(){return l().senderPubkey()}})),u(I,()=>t()("notification.zapped")),m})(),n(k,{get when(){return l().description().content.length>0},get children(){const m=Zn();return u(m,()=>l().description().content),m}}),n(k,{get when(){return l().zappedEventId()!=null},get children(){const m=Jn();return u(m,n(se,{get eventId(){return l().zappedEventId()}})),m}})]}})};P(["click"]);const Xn=h("<div>unknown event"),me=e=>{const{shouldMuteEvent:t}=w();return n(V,{get each(){return e.events},children:r=>n(k,{get when(){return!t(r)},get children(){return n(G,{get fallback(){return Xn()},get children(){return[n(_,{get when(){return r.kind===ne},get children(){return n(R,{get children(){return n(ie,{event:r})}})}}),n(_,{get when(){return r.kind===Ie},get children(){return n(R,{get children(){return n(An,{event:r})}})}}),n(_,{get when(){return r.kind===Te},get children(){return n(R,{get children(){return n(Qe,{event:r})}})}}),n(_,{get when(){return r.kind===Ee},get children(){return n(R,{get children(){return n(Wn,{event:r})}})}})]}})}})})},Yn=e=>{const t=p(),{config:r,removeColumn:c}=w(),l=j(()=>({duration:null})),{events:o,eose:s}=L(()=>({relayUrls:r().relayUrls,filters:[{kinds:[1,6,7,9735],"#p":[e.column.pubkey],limit:20,since:l.since(),until:l.until()}],eoseLimit:20,clientEventFilter:i=>e.column.contentFilter==null?!0:E(e.column.contentFilter)(i.content)}));return S(()=>l.setEvents(o())),n(F,{get header(){return n(O,{get name(){return e.column.name??t()("column.notification")},get icon(){return n(Ge,{})},settings:()=>n(q,{get column(){return e.column},get columnIndex(){return e.columnIndex}}),onClose:()=>c(e.column.id)})},get width(){return e.column.width},get columnIndex(){return e.columnIndex},get lastColumn(){return e.lastColumn},get timelineRef(){return l.timelineRef},get children(){return n(H,{loadMore:l,get eose(){return s()},get children(){return n(me,{get events(){return o()}})}})}})},et=e=>{const t=p(),{config:r,removeColumn:c}=w(),l=j(()=>({duration:null})),{events:o,eose:s}=L(()=>({relayUrls:r().relayUrls,filters:[{kinds:[1,6],authors:[e.column.pubkey],limit:10,since:l.since(),until:l.until()}],eoseLimit:10,clientEventFilter:i=>e.column.contentFilter==null?!0:E(e.column.contentFilter)(i.content)}));return S(()=>l.setEvents(o())),n(F,{get header(){return n(O,{get name(){return e.column.name??t()("column.posts")},get icon(){return n(Ve,{})},settings:()=>n(q,{get column(){return e.column},get columnIndex(){return e.columnIndex}}),onClose:()=>c(e.column.id)})},get width(){return e.column.width},get columnIndex(){return e.columnIndex},get lastColumn(){return e.lastColumn},get timelineRef(){return l.timelineRef},get children(){return n(H,{loadMore:l,get eose(){return s()},get children(){return n(A,{get events(){return o()}})}})}})},nt=e=>{const t=p(),{config:r,removeColumn:c}=w(),l=j(()=>({duration:null})),{events:o,eose:s}=L(()=>({relayUrls:r().relayUrls,filters:[{kinds:[7],authors:[e.column.pubkey],limit:10,since:l.since(),until:l.until()}],eoseLimit:10,clientEventFilter:i=>e.column.contentFilter==null?!0:E(e.column.contentFilter)(i.content)}));return S(()=>l.setEvents(o())),n(F,{get header(){return n(O,{get name(){return e.column.name??t()("column.reactions")},get icon(){return n(Ze,{})},settings:()=>n(q,{get column(){return e.column},get columnIndex(){return e.columnIndex}}),onClose:()=>c(e.column.id)})},get width(){return e.column.width},get columnIndex(){return e.columnIndex},get lastColumn(){return e.lastColumn},get timelineRef(){return l.timelineRef},get children(){return n(H,{loadMore:l,get eose(){return s()},get children(){return n(me,{get events(){return o()}})}})}})},tt=e=>{const t=p(),{removeColumn:r}=w(),c=j(()=>({duration:4*60*60})),{events:l,eose:o}=L(()=>({relayUrls:e.column.relayUrls,filters:[{kinds:[1],limit:20,since:c.since(),until:c.until()}],eoseLimit:20,clientEventFilter:s=>e.column.contentFilter==null?!0:E(e.column.contentFilter)(s.content)}));return S(()=>c.setEvents(l())),n(F,{get header(){return n(O,{get name(){return e.column.name??t()("column.relay")},get icon(){return n(Je,{})},settings:()=>n(q,{get column(){return e.column},get columnIndex(){return e.columnIndex}}),onClose:()=>r(e.column.id)})},get width(){return e.column.width},get columnIndex(){return e.columnIndex},get lastColumn(){return e.lastColumn},get timelineRef(){return c.timelineRef},get children(){return n(H,{loadMore:c,get eose(){return o()},get children(){return n(A,{get events(){return l()}})}})}})},rt=h('<div class="flex flex-col"><div class="flex h-8 items-center gap-1 px-2"><h2 class="flex items-center gap-1"><span class="inline-block h-4 w-4 text-fg-secondary"></span></h2><form class=flex-1><input class="w-full rounded border border-border bg-bg px-1 py-0 ring-border focus:border-border focus:ring-primary"type=text name=query></form><button class="h-4 w-4">'),lt=e=>{const[t,r]=T(!1),[c,l]=T(""),{saveColumn:o}=w(),s=()=>r(d=>!d),i=()=>{c()!==e.column.query&&o({...e.column,query:c()})},a=()=>{i()},f=d=>{l(d.currentTarget.value)},m=d=>{d.preventDefault(),i()};return K(()=>{l(e.column.query)}),(()=>{const d=rt(),g=d.firstChild,v=g.firstChild,$=v.firstChild,x=v.nextSibling,b=x.firstChild,y=x.nextSibling;return u($,n(We,{})),x.addEventListener("submit",m),b.addEventListener("blur",a),b.addEventListener("change",f),y.$$click=()=>s(),u(y,n(de,{})),u(d,n(k,{get when(){return t()},get children(){return e.settings()}}),null),N(()=>b.value=c()),d})()},ot=e=>{const{removeColumn:t}=w(),r=j(()=>({duration:null})),{events:c,eose:l}=L(()=>{const{query:o}=e.column;return o.length===0?null:{relayUrls:Se,filters:[{kinds:[1],search:o,limit:20,since:r.since(),until:r.until()}],eoseLimit:20,clientEventFilter:s=>s.tags.findIndex(([i])=>i==="mostr"||i==="proxy")>=0?!1:e.column.contentFilter==null?!0:E(e.column.contentFilter)(s.content)}});return S(()=>{r.setEvents(c())}),n(F,{get header(){return n(lt,{get column(){return e.column},settings:()=>n(q,{get column(){return e.column},get columnIndex(){return e.columnIndex}}),onClose:()=>t(e.column.id)})},get width(){return e.column.width},get columnIndex(){return e.columnIndex},get lastColumn(){return e.lastColumn},get timelineRef(){return r.timelineRef},get children(){return n(H,{loadMore:r,get eose(){return l()},get children(){return n(A,{get events(){return c()}})}})}})};P(["click"]);const st=h('<div class="scrollbar flex h-full snap-x snap-mandatory flex-row overflow-x-scroll scroll-smooth">'),ct=()=>{const{config:e}=w();return(()=>{const t=st();return u(t,n(V,{get each(){return e().columns},children:(r,c)=>{const l=()=>c()+1,o=()=>l()===e().columns.length;return n(G,{get children(){return[n(_,{get when(){return r.columnType==="Following"&&r},keyed:!0,children:s=>n(Nn,{column:s,get columnIndex(){return l()},get lastColumn(){return o()}})}),n(_,{get when(){return r.columnType==="Notification"&&r},keyed:!0,children:s=>n(Yn,{column:s,get columnIndex(){return l()},get lastColumn(){return o()}})}),n(_,{get when(){return r.columnType==="Posts"&&r},keyed:!0,children:s=>n(et,{column:s,get columnIndex(){return l()},get lastColumn(){return o()}})}),n(_,{get when(){return r.columnType==="Reactions"&&r},keyed:!0,children:s=>n(nt,{column:s,get columnIndex(){return l()},get lastColumn(){return o()}})}),n(_,{get when(){return r.columnType==="Relays"&&r},keyed:!0,children:s=>n(tt,{column:s,get columnIndex(){return l()},get lastColumn(){return o()}})}),n(_,{get when(){return r.columnType==="Bookmark"&&r},keyed:!0,children:s=>n(qn,{column:s,get columnIndex(){return l()},get lastColumn(){return o()}})}),n(_,{get when(){return r.columnType==="Search"&&r},keyed:!0,children:s=>n(ot,{column:s,get columnIndex(){return l()},get lastColumn(){return o()}})})]}})}})),t})()},it=[{key:"n",command:{command:"openPostForm"}},{key:"h",command:{command:"moveToPrevColumn"}},{key:"j",command:{command:"moveToNextItem"}},{key:"k",command:{command:"moveToPrevItem"}},{key:"l",command:{command:"moveToNextColumn"}},{key:"1",command:{command:"moveToColumn",columnIndex:1}},{key:"2",command:{command:"moveToColumn",columnIndex:2}},{key:"3",command:{command:"moveToColumn",columnIndex:3}},{key:"4",command:{command:"moveToColumn",columnIndex:4}},{key:"5",command:{command:"moveToColumn",columnIndex:5}},{key:"6",command:{command:"moveToColumn",columnIndex:6}},{key:"7",command:{command:"moveToColumn",columnIndex:7}},{key:"8",command:{command:"moveToColumn",columnIndex:8}},{key:"9",command:{command:"moveToColumn",columnIndex:9}},{key:"0",command:{command:"moveToLastColumn"}},{key:"ArrowLeft",command:{command:"moveToPrevColumn"}},{key:"ArrowDown",command:{command:"moveToNextItem"}},{key:"ArrowUp",command:{command:"moveToPrevItem"}},{key:"ArrowRight",command:{command:"moveToNextColumn"}},{key:"f",command:{command:"like"}},{key:"t",command:{command:"repost"}},{key:"r",command:{command:"openReplyForm"}},{key:"?",command:{command:"openHelp"}},{key:"Enter",command:{command:"openItemDetail"}},{key:"Backspace",command:{command:"closeItemDetail"}}],ut=e=>{const t=new Map;return e.forEach(r=>{t.set(r.key,r)}),t},at=({shortcuts:e=it,onShortcut:t})=>{const r=ut(e);K(()=>{const c=Xe(l=>{if(l.type!=="keydown"||l.ctrlKey||l.altKey||l.metaKey||l.target instanceof HTMLTextAreaElement||l.target instanceof HTMLInputElement)return;const o=r.get(l.key);o!=null&&t(o)},50);window.addEventListener("keydown",c),re(()=>{window.removeEventListener("keydown",c)})})},dt=()=>{const e=le();at({onShortcut:t=>{e(t.command).then(()=>console.debug(`shortcut key '${t.key}' was processed successfully`),r=>console.error(r))}})},mt=h('<div class="absolute inset-0 flex w-screen touch-manipulation flex-row overflow-hidden">'),vt=()=>{dt();const e=Re(),{persistStatus:t}=tn(),r=nn(),{config:c,initializeColumns:l}=w(),o=oe();return S(()=>{c().relayUrls.map(async s=>{try{const i=await r().ensureRelay(s);i.onnotice=a=>{console.error(`NOTICE: ${s}: ${a}`)},i.onclose=()=>{console.warn(`CLOSE: ${s}`)}}catch(i){console.error("ensureRelay failed",i)}})}),S(()=>{const s=o();s!=null&&l({pubkey:s})}),K(()=>{t().loggedIn||e("/hello")}),Me(s=>{console.error("uncaught error: ",s)}),(()=>{const s=mt();return u(s,n(Ye,{}),null),u(s,n(ct,{}),null),u(s,n(en,{}),null),s})()};export{vt as default};
//# sourceMappingURL=Home-f792476d.js.map
