{"version":3,"mappings":"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","names":["ColumnItem","props","_el$","_tmpl$","_$insert","children","ArrowPathRoundedSquare","_$spread","tryEncodeNote","eventId","noteEncode","err","console","error","tryEncodeNevent","neventEncode","id","EventLink","_$createComponent","Show","when","kind","fallback","useEvent","propsProvider","createMemo","query","createQuery","queryKey","signal","currentProps","task","BatchedEventsTask","promise","registerTask","timeout","EventDisplayById","i18n","useTranslation","localProps","restProps","splitProps","shouldMuteEvent","useConfig","event","fetchedEvent","eventQuery","ensureNonNull","eventIdNonNull","hidden","ev","Switch","Match","keyed","EventDisplay","_$mergeProps","isLoading","_el$2","_tmpl$2","_el$3","firstChild","useDatePulser","currentDate","setCurrentDate","createSignal","createEffect","onCleanup","defaultRelativeDateFormatter","parsedDate","formatTime","date","defaultAbsoluteDateLongFormatter","defaultAbsoluteDateShortFormatter","calcDiffSec","parseDateDiff","diffSec","isSameDate","lhs","rhs","yesterdayOf","formatAbsolute","formatter","formatAbsoluteLong","formatAbsoluteShort","formatRelative","currentDateHigh","createRoot","currentDateLow","useFormatDate","config","Repost","showProfile","useModalState","formatDate","genericEvent","lastTaggedEventId","_el$4","_el$5","nextSibling","_el$6","_el$7","_el$8","_el$9","$$click","pubkey","UserDisplayName","createdAtAsDate","_$delegateEvents","Bolt","ChatBubbleLeft","EllipsisHorizontal","HeartSolid","isPlus","r","type","content","EmojiDisplay","reactionTypes","shortcode","url","_tmpl$3","_$setAttribute","MenuItemDisplay","handleClick","item","onSelect","onClose","useContextMenu","popup","usePopup","For","each","menu","filter","e","close","EmojiRegex","queryKeyUseReactions","useReactions","queryClient","useQueryClient","genQueryKey","eventsQuery","mentionedEventId","reactions","result","key","reaction","events","useReactionMutation","commands","useCommands","createMutation","params","promises","results","succeeded","res","failed","queryKeyUseReposts","useReposts","reposts","useRepostMutation","Prefixes","siPrefix","value","options","precision","minValue","divider","divided","rounded","index","formatSiPrefix","inputValue","prefix","digits","wholeNumberDigits","EventDebugModal","lazy","UserList","ZapRequestModal","emojiDataToReactionTypes","emoji","native","src","Error","ReactionAction","usePubkey","reacted","setReacted","isReactedByWithEmoji","isReactedBy","isReactedByMe","p","isReactedByMeWithEmoji","publishReactionMutation","doReaction","pubkeyNonNull","mutate","relayUrls","notifyPubkey","handleReaction","stopPropagation","handleEmojiSelect","emojiPickerPopup","useEmojiPicker","onEmojiSelect","_$memo","HeartOutlined","hideCount","showEmojiReaction","length","minDigits","_$effect","_p$","_v$","isPending","_v$2","_$classList","disabled","undefined","useEmojiReaction","open","_ref$","targetRef","_$use","Plus","_$p","RepostAction","reposted","setReposted","isRepostedBy","isRepostedByMe","publishRepostMutation","handleRepost","_v$3","_v$4","ReactionsModal","data","pubkeyExtractor","renderInfo","_el$10","_tmpl$4","toReactionTypes","RepostsModal","EmojiReactions","reactionsGrouped","mutation","_el$11","_tmpl$5","entries","isReactedByMeWithThisContent","findIndex","_el$12","_tmpl$7","_el$13","_tmpl$6","_v$5","_v$6","Actions","modal","setModal","closeModal","deleteMutation","mutationKey","mutationFn","deleteEvent","then","promeses","Promise","allSettled","map","onSuccess","status","window","alert","count","onError","otherActionsPopup","navigator","clipboard","writeText","catch","_el$14","_tmpl$8","confirm","_el$15","_tmpl$9","_el$16","_el$17","_el$18","_el$19","_el$20","onClickReply","_ref$2","ContentWarningDisplay","showContentWarning","setShowContentWarning","contentWarning","ExclamationTriangle","reason","GeneralUserMentionDisplay","profile","useProfile","name","npubEncodeFallback","isImageUrl","urlString","isVideoUrl","isWebSocketUrl","thumbnailUrl","size","match","imageId","ext","withoutI","isTwitterUrl","YouTubeHosts","parseYouTubeVideoUrl","videoId","ImageDisplay","imageRef","setHidden","initialHidden","LazyLoad","SafeLink","href","MentionedEventDisplay","mentionedEvent","marker","embedding","actions","ensureKinds","Kind","MentionedUserDisplay","parseOgpFromDOM","doc","m","property","parseOgp","text","isOgpUrl","allowList","fetchOgpContent","useOgp","twitterUrl","URL","host","youtubeUrl","iframeUrl","pathname","searchParams","set","location","origin","TwitterEmbed","twitterRef","getColorTheme","twttr","widgets","load","dataTheme","brightness","OgpEmbed","ogp","ogpProps","title","description","image","ClickToShow","PreviewedLink","twitter","youtube","VideoDisplay","videoRef","TextNoteContentDisplay","saveColumn","request","useRequestCommand","addHashTagColumn","createSearchColumn","command","addRelayColumn","createRelaysColumn","parsed","showMedia","reference","Offset","ThrottleWaitMs","useDetectOverflow","elementRef","overflow","setOverflow","setElementRef","el","detectOverflow","throttle","onMount","observer","entry","handleResize","Post","showOverflow","setShowOverflow","createdAt","createdAtFull","toLocaleString","author","authorPubkey","preventDefault","onShowProfile","picture","display_name","onShowEvent","current","footer","classList","toggle","TimelineContext","createContext","useTimelineContext","useContext","useTimelineState","timelineState","setTimelineState","createStore","setTimeline","clearTimeline","TextNote","textAreaRef","timelineContext","showReplyForm","setShowReplyForm","closeReplyForm","toggleReplyForm","focus","textNote","showReplyEvent","replyingToEvent","containsEventMention","rootEvent","taggedPubkeys","replyToPubkey","NotePostForm","mode","replyTo","onPost","isAllowedKind","includes","Timeline","setActiveSubscriptions","useStats","useSubscription","pool","usePool","setEvents","eose","setEose","eoseLimit","limit","on","currentEvents","addEvent","epoch","sorted","insertEventIntoDescendingList","deduped","uniqBy","startSubscription","filters","onEvent","onEOSE","clientEventFilter","continuous","subscribing","pushed","storedEvents","updateEvents","sortEvents","sub","intervalId","buildMethods","dataProvider","followings","tag","followingPubkey","mainRelayUrl","petname","following","follow","fetchLatestFollowings","latestFollowings","useFollowings","latestEventQuery","invalidateFollowings"],"sources":["../../src/components/ColumnItem.tsx","../../node_modules/heroicons/24/outline/arrow-path-rounded-square.svg","../../src/components/EventLink.tsx","../../src/nostr/useEvent.ts","../../src/components/event/EventDisplayById.tsx","../../src/hooks/useDatePulser.ts","../../src/utils/formatDate.ts","../../src/hooks/useFormatDate.ts","../../src/components/event/Repost.tsx","../../node_modules/heroicons/24/outline/bolt.svg","../../node_modules/heroicons/24/outline/chat-bubble-left.svg","../../node_modules/heroicons/24/outline/ellipsis-horizontal.svg","../../node_modules/heroicons/24/solid/heart.svg","../../src/components/EmojiDisplay.tsx","../../src/components/utils/useContextMenu.tsx","../../src/nostr/useReactions.ts","../../src/nostr/mutation/useReactionMutation.ts","../../src/nostr/useReposts.ts","../../src/nostr/mutation/useRepostMutation.ts","../../src/utils/siPrefix.ts","../../src/components/Actions.tsx","../../src/components/event/textNote/ContentWarningDisplay.tsx","../../src/components/event/textNote/GeneralUserMentionDisplay.tsx","../../src/utils/url.ts","../../src/components/event/textNote/ImageDisplay.tsx","../../src/components/event/textNote/MentionedEventDisplay.tsx","../../src/components/event/textNote/MentionedUserDisplay.tsx","../../src/utils/ogp.ts","../../src/components/event/textNote/PreviewedLink.tsx","../../src/components/event/textNote/VideoDisplay.tsx","../../src/components/event/textNote/TextNoteContentDisplay.tsx","../../src/hooks/useDetectOverflow.ts","../../src/components/Post.tsx","../../src/components/timeline/TimelineContext.tsx","../../src/components/event/TextNote.tsx","../../src/components/event/EventDisplay.tsx","../../src/components/timeline/Timeline.tsx","../../src/nostr/useSubscription.ts","../../src/nostr/useFollowings.ts"],"sourcesContent":["import { type Component, type JSX } from 'solid-js';\n\ntype ColumnItemProps = {\n  children: JSX.Element;\n};\n\nconst ColumnItem: Component<ColumnItemProps> = (props) => (\n  <div class=\"block shrink-0 overflow-hidden border-b border-border p-1\">{props.children}</div>\n);\n\nexport default ColumnItem;\n","export default (props = {}) => <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\" aria-hidden=\"true\" data-slot=\"icon\" viewBox=\"0 0 24 24\"{...props}><path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M19.5 12c0-1.232-.046-2.453-.138-3.662a4.006 4.006 0 0 0-3.7-3.7 48.678 48.678 0 0 0-7.324 0 4.006 4.006 0 0 0-3.7 3.7c-.017.22-.032.441-.046.662M19.5 12l3-3m-3 3-3-3m-12 3c0 1.232.046 2.453.138 3.662a4.006 4.006 0 0 0 3.7 3.7 48.656 48.656 0 0 0 7.324 0 4.006 4.006 0 0 0 3.7-3.7c.017-.22.032-.441.046-.662M4.5 12l3 3m-3-3-3 3\"/></svg>","import { Show, type Component } from 'solid-js';\n\nimport { noteEncode, neventEncode } from 'nostr-tools/nip19';\n\ntype EventLinkProps = {\n  eventId: string;\n  kind?: number;\n};\n\nconst tryEncodeNote = (eventId: string) => {\n  try {\n    return noteEncode(eventId);\n  } catch (err) {\n    console.error('failed to encode event id into Bech32 entity (NIP-19) but ignore', eventId, err);\n    return eventId;\n  }\n};\n\nconst tryEncodeNevent = (eventId: string) => {\n  try {\n    return neventEncode({ id: eventId });\n  } catch (err) {\n    console.error('failed to encode event id into Bech32 entity (NIP-19) but ignore', eventId, err);\n    return eventId;\n  }\n};\n\nconst EventLink: Component<EventLinkProps> = (props) => (\n  <button class=\"text-link underline\">\n    <Show when={props.kind == null || props.kind === 1} fallback={tryEncodeNevent(props.eventId)}>\n      {tryEncodeNote(props.eventId)}\n    </Show>\n  </button>\n);\n\nexport default EventLink;\n","import { createMemo } from 'solid-js';\n\nimport { createQuery, type CreateQueryResult } from '@tanstack/solid-query';\nimport { type Event as NostrEvent } from 'nostr-tools/pure';\n\nimport { registerTask, BatchedEventsTask, EventTask } from '@/nostr/useBatchedEvents';\nimport timeout from '@/utils/timeout';\n\nexport type UseEventProps = {\n  eventId: string;\n};\n\nexport type UseEvent = {\n  event: () => NostrEvent | null;\n  query: CreateQueryResult<NostrEvent | null>;\n};\n\nconst useEvent = (propsProvider: () => UseEventProps | null): UseEvent => {\n  const props = createMemo(propsProvider);\n\n  const query = createQuery(() => ({\n    queryKey: ['useEvent', props()] as const,\n    queryFn: ({ queryKey, signal }) => {\n      const [, currentProps] = queryKey;\n      if (currentProps == null) return null;\n      const { eventId } = currentProps;\n      const task = new BatchedEventsTask<EventTask>({ type: 'Event', eventId });\n      const promise = task.firstEventPromise().catch(() => {\n        throw new Error(`event not found: ${eventId}`);\n      });\n      registerTask({ task, signal });\n      return timeout(15000, `useEvent: ${eventId}`)(promise);\n    },\n    // Text notes never change, so they can be stored for a long time.\n    // However, events tend to be unreferenced as time passes.\n    staleTime: 4 * 60 * 60 * 1000, // 4 hour\n    gcTime: 4 * 60 * 60 * 1000, // 4 hour\n    refetchOnWindowFocus: false,\n    refetchOnMount: false,\n  }));\n\n  const event = () => query.data ?? null;\n\n  return { event, query };\n};\n\nexport default useEvent;\n","import { Switch, Match, type Component, splitProps } from 'solid-js';\n\n// eslint-disable-next-line import/no-cycle\nimport EventDisplay from '@/components/event/EventDisplay';\nimport { type EventDisplayProps } from '@/components/event/EventDisplay';\nimport EventLink from '@/components/EventLink';\nimport useConfig from '@/core/useConfig';\nimport { useTranslation } from '@/i18n/useTranslation';\nimport useEvent from '@/nostr/useEvent';\nimport ensureNonNull from '@/utils/ensureNonNull';\n\ntype EventDisplayByIdProps = Omit<EventDisplayProps, 'event'> & {\n  eventId: string | undefined;\n};\n\nconst EventDisplayById: Component<EventDisplayByIdProps> = (props) => {\n  const i18n = useTranslation();\n  const [localProps, restProps] = splitProps(props, ['eventId']);\n  const { shouldMuteEvent } = useConfig();\n\n  const { event: fetchedEvent, query: eventQuery } = useEvent(() =>\n    ensureNonNull([localProps.eventId] as const)(([eventIdNonNull]) => ({\n      eventId: eventIdNonNull,\n    })),\n  );\n\n  const hidden = (): boolean => {\n    const ev = fetchedEvent();\n    return ev != null && shouldMuteEvent(ev);\n  };\n\n  return (\n    <Switch\n      fallback={\n        <span>\n          {i18n()('post.failedToFetchEvent')}\n          {props.eventId}\n        </span>\n      }\n    >\n      <Match when={hidden()}>{null}</Match>\n      <Match when={fetchedEvent()} keyed>\n        {(event) => <EventDisplay event={event} {...restProps} />}\n      </Match>\n      <Match when={eventQuery.isLoading && localProps.eventId} keyed>\n        {(id) => (\n          <div class=\"truncate\">\n            {i18n()('general.loading')} <EventLink eventId={id} />\n          </div>\n        )}\n      </Match>\n    </Switch>\n  );\n};\n\nexport default EventDisplayById;\n","import { createSignal, createEffect, onCleanup, type Accessor } from 'solid-js';\n\ntype DatePulserProps = {\n  interval: number;\n};\n\nconst useDatePulser = (propsProvider: () => DatePulserProps): Accessor<Date> => {\n  const [currentDate, setCurrentDate] = createSignal(new Date());\n\n  createEffect(() => {\n    const id = setInterval(() => {\n      setCurrentDate(new Date());\n    }, propsProvider().interval);\n\n    onCleanup(() => clearInterval(id));\n  });\n\n  return currentDate;\n};\n\nexport default useDatePulser;\n","export type RelativeDate =\n  | { kind: 'now' }\n  | { kind: 'seconds'; value: number }\n  | { kind: 'minutes'; value: number }\n  | { kind: 'hours'; value: number }\n  | { kind: 'days'; value: number }\n  | { kind: 'abs'; value: Date };\n\nexport type AbsoluteDate =\n  | { kind: 'today'; value: Date }\n  | { kind: 'yesterday'; value: Date }\n  | { kind: 'abs'; value: Date };\n\nexport type RelativeDateFormatter = (parsedDate: RelativeDate) => string;\nexport type AbsoluteDateFormatter = (parsedDate: AbsoluteDate) => string;\n\nconst defaultRelativeDateFormatter = (parsedDate: RelativeDate): string => {\n  switch (parsedDate.kind) {\n    case 'now':\n      return 'now';\n    case 'seconds':\n      return `${parsedDate.value}s`;\n    case 'minutes':\n      return `${parsedDate.value}m`;\n    case 'hours':\n      return `${parsedDate.value}h`;\n    case 'days':\n      return `${parsedDate.value}d`;\n    case 'abs':\n    default:\n      return parsedDate.value.toLocaleDateString();\n  }\n};\n\nconst formatTime = (date: Date): string =>\n  `${date.getHours()}:${date.getMinutes().toString().padStart(2, '0')}`;\n\nconst defaultAbsoluteDateLongFormatter = (parsedDate: AbsoluteDate): string => {\n  switch (parsedDate.kind) {\n    case 'today':\n      return parsedDate.value.toLocaleTimeString();\n    case 'yesterday':\n    case 'abs':\n    default:\n      return parsedDate.value.toLocaleString();\n  }\n};\n\nconst defaultAbsoluteDateShortFormatter = (parsedDate: AbsoluteDate): string => {\n  switch (parsedDate.kind) {\n    case 'today':\n      return formatTime(parsedDate.value);\n    case 'yesterday':\n      return `昨日 ${formatTime(parsedDate.value)}`;\n    case 'abs':\n    default:\n      return parsedDate.value.toLocaleString();\n  }\n};\n\nconst calcDiffSec = (date: Date, currentDate: Date): number =>\n  Math.round(Number(currentDate) - Number(date)) / 1000;\n\nconst parseDateDiff = (date: Date, currentDate: Date): RelativeDate => {\n  const diffSec = calcDiffSec(date, currentDate);\n\n  if (diffSec < 10) {\n    return { kind: 'now' };\n  }\n  if (diffSec < 60) {\n    return { kind: 'seconds', value: Math.round(diffSec) };\n  }\n  if (diffSec < 3600) {\n    return { kind: 'minutes', value: Math.round(diffSec / 60) };\n  }\n  if (diffSec < 86400) {\n    // 1 days\n    return { kind: 'hours', value: Math.round(diffSec / 3600) };\n  }\n  if (diffSec < 604800) {\n    // 1 week\n    return { kind: 'days', value: Math.round(diffSec / 86400) };\n  }\n  return { kind: 'abs', value: date };\n};\n\nconst isSameDate = (lhs: Date, rhs: Date): boolean =>\n  lhs.getFullYear() === rhs.getFullYear() &&\n  lhs.getMonth() === rhs.getMonth() &&\n  lhs.getDate() === rhs.getDate();\n\nconst yesterdayOf = (date: Date): Date => new Date(+date - 24 * 60 * 60 * 1000);\n\nconst formatAbsolute = (\n  date: Date,\n  currentDate: Date,\n  formatter: AbsoluteDateFormatter,\n): string => {\n  if (isSameDate(date, currentDate)) {\n    return formatter({ kind: 'today', value: date });\n  }\n  if (isSameDate(date, yesterdayOf(currentDate))) {\n    return formatter({ kind: 'yesterday', value: date });\n  }\n  return formatter({ kind: 'abs', value: date });\n};\n\nexport const formatAbsoluteLong = (date: Date, currentDate: Date = new Date()) =>\n  formatAbsolute(date, currentDate, defaultAbsoluteDateLongFormatter);\n\nexport const formatAbsoluteShort = (date: Date, currentDate: Date = new Date()) =>\n  formatAbsolute(date, currentDate, defaultAbsoluteDateShortFormatter);\n\nexport const formatRelative = (\n  date: Date,\n  currentDate: Date = new Date(),\n  formatter: RelativeDateFormatter = defaultRelativeDateFormatter,\n): string => formatter(parseDateDiff(date, currentDate));\n","import { createRoot } from 'solid-js';\n\nimport useConfig from '@/core/useConfig';\nimport useDatePulser from '@/hooks/useDatePulser';\nimport { formatRelative, formatAbsoluteLong, formatAbsoluteShort } from '@/utils/formatDate';\n\n// 7 seconds is used here so that the last digit of relative time is changed.\nconst currentDateHigh = createRoot(() => useDatePulser(() => ({ interval: 7000 })));\nconst currentDateLow = createRoot(() => useDatePulser(() => ({ interval: 60 * 1000 })));\n\nconst useFormatDate = () => {\n  const { config } = useConfig();\n\n  return (date: Date) => {\n    switch (config().dateFormat) {\n      case 'absolute-long':\n        return formatAbsoluteLong(date, currentDateLow());\n      case 'absolute-short':\n        return formatAbsoluteShort(date, currentDateLow());\n      case 'relative':\n        return formatRelative(date, currentDateHigh());\n      default:\n        return formatRelative(date, currentDateHigh());\n    }\n  };\n};\n\nexport default useFormatDate;\n","// NIP-18\nimport { type Component, createMemo } from 'solid-js';\n\nimport ArrowPathRoundedSquare from 'heroicons/24/outline/arrow-path-rounded-square.svg';\nimport { type Event as NostrEvent } from 'nostr-tools/pure';\n\n// eslint-disable-next-line import/no-cycle\nimport EventDisplayById from '@/components/event/EventDisplayById';\nimport UserDisplayName from '@/components/UserDisplayName';\nimport useFormatDate from '@/hooks/useFormatDate';\nimport useModalState from '@/hooks/useModalState';\nimport { useTranslation } from '@/i18n/useTranslation';\nimport { genericEvent } from '@/nostr/event';\n\nexport type RepostProps = {\n  event: NostrEvent;\n};\n\nconst Repost: Component<RepostProps> = (props) => {\n  const i18n = useTranslation();\n  const { showProfile } = useModalState();\n  const formatDate = useFormatDate();\n  const event = createMemo(() => genericEvent(props.event));\n  const eventId = () => event().lastTaggedEventId();\n\n  return (\n    <div>\n      <div class=\"flex items-center gap-1\">\n        <div class=\"flex shrink-0 place-items-center pl-[2px]\" aria-hidden=\"true\">\n          <span class=\"h-4 w-4 text-r-repost\">\n            <ArrowPathRoundedSquare />\n          </span>\n        </div>\n        <div class=\"notification-user flex min-w-0 flex-1 overflow-hidden text-xs\">\n          <button\n            class=\"select-text truncate hover:text-link hover:underline\"\n            onClick={() => showProfile(props.event.pubkey)}\n          >\n            <UserDisplayName pubkey={props.event.pubkey} />\n          </button>\n          <span class=\"shrink-0\">{i18n()('notification.reposted')}</span>\n        </div>\n        <div class=\"text-xs\">{formatDate(event().createdAtAsDate())}</div>\n      </div>\n      <div class=\"pt-1\">\n        <EventDisplayById eventId={eventId()} />\n      </div>\n    </div>\n  );\n};\n\nexport default Repost;\n","export default (props = {}) => <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\" aria-hidden=\"true\" data-slot=\"icon\" viewBox=\"0 0 24 24\"{...props}><path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"m3.75 13.5 10.5-11.25L12 10.5h8.25L9.75 21.75 12 13.5z\"/></svg>","export default (props = {}) => <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\" aria-hidden=\"true\" data-slot=\"icon\" viewBox=\"0 0 24 24\"{...props}><path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M2.25 12.76c0 1.6 1.123 2.994 2.707 3.227 1.087.16 2.185.283 3.293.369V21l4.076-4.076a1.526 1.526 0 0 1 1.037-.443 48.282 48.282 0 0 0 5.68-.494c1.584-.233 2.707-1.626 2.707-3.228V6.741c0-1.602-1.123-2.995-2.707-3.228A48.394 48.394 0 0 0 12 3c-2.392 0-4.744.175-7.043.513C3.373 3.746 2.25 5.14 2.25 6.741z\"/></svg>","export default (props = {}) => <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\" aria-hidden=\"true\" data-slot=\"icon\" viewBox=\"0 0 24 24\"{...props}><path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M6.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0m6 0a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0m6 0a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0\"/></svg>","export default (props = {}) => <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"currentColor\" aria-hidden=\"true\" data-slot=\"icon\" viewBox=\"0 0 24 24\"{...props}><path d=\"m11.645 20.91-.007-.003-.022-.012a15.247 15.247 0 0 1-.383-.218 25.18 25.18 0 0 1-4.244-3.17C4.688 15.36 2.25 12.174 2.25 8.25 2.25 5.322 4.714 3 7.688 3A5.5 5.5 0 0 1 12 5.052 5.5 5.5 0 0 1 16.313 3c2.973 0 5.437 2.322 5.437 5.25 0 3.925-2.438 7.111-4.739 9.256a25.175 25.175 0 0 1-4.244 3.17 15.247 15.247 0 0 1-.383.219l-.022.012-.007.004-.003.001a.752.752 0 0 1-.704 0l-.003-.001Z\"/></svg>","import { Component, Match, Switch } from 'solid-js';\n\nimport HeartSolid from 'heroicons/24/solid/heart.svg';\n\nimport { ReactionTypes } from '@/nostr/event/Reaction';\n\nexport type EmojiDisplayProps = {\n  reactionTypes: ReactionTypes;\n};\n\nconst isPlus = (r: ReactionTypes) => r.type === 'LikeDislike' && r.content === '+';\n\nconst EmojiDisplay: Component<EmojiDisplayProps> = (props) => (\n  <Switch fallback={<span class=\"truncate\">{props.reactionTypes.content}</span>}>\n    <Match when={isPlus(props.reactionTypes)}>\n      <span class=\"inline-block h-4 w-4 pt-[1px] text-r-reaction\">\n        <HeartSolid />\n      </span>\n    </Match>\n    <Match when={props.reactionTypes.type === 'Emoji' && props.reactionTypes} keyed>\n      {({ content }) => <span class=\"truncate\">{content}</span>}\n    </Match>\n    <Match when={props.reactionTypes.type === 'CustomEmoji' && props.reactionTypes} keyed>\n      {({ shortcode, url }) => <img class=\"h-4 max-w-[3rem]\" src={url} alt={`:${shortcode}:`} />}\n    </Match>\n  </Switch>\n);\n\nexport default EmojiDisplay;\n","import { createMemo, For, type Component, type JSX } from 'solid-js';\n\nimport usePopup, { type UsePopupProps } from '@/components/utils/usePopup';\n\nexport type MenuItem = {\n  content: JSX.Element;\n  when?: () => boolean;\n  onSelect?: () => void;\n};\n\nexport type UseContextMenuProps = Omit<UsePopupProps, 'popup'> & {\n  menu: MenuItem[];\n};\n\nexport type MenuItemDisplayProps = {\n  item: MenuItem;\n  onClose: () => void;\n};\n\nconst MenuItemDisplay: Component<MenuItemDisplayProps> = (props) => {\n  const handleClick = () => {\n    props.item?.onSelect?.();\n    props.onClose();\n  };\n\n  return (\n    <li class=\"border-b border-border hover:bg-bg-tertiary\">\n      <button class=\"w-full px-4 py-1 text-start\" onClick={handleClick}>\n        {props.item.content}\n      </button>\n    </li>\n  );\n};\n\nconst useContextMenu = (propsProvider: () => UseContextMenuProps) => {\n  const props = createMemo(propsProvider);\n\n  const popup = usePopup(() => ({\n    ...props(),\n    popup: (\n      <ul class=\"min-w-[96px] rounded border border-border bg-bg shadow-md\">\n        <For each={props().menu.filter((e) => e.when == null || e.when())}>\n          {(item: MenuItem) => <MenuItemDisplay item={item} onClose={() => popup.close()} />}\n        </For>\n      </ul>\n    ),\n  }));\n\n  return popup;\n};\n\nexport default useContextMenu;\n","import { createMemo } from 'solid-js';\n\nimport { createQuery, useQueryClient, type CreateQueryResult } from '@tanstack/solid-query';\nimport { type Event as NostrEvent } from 'nostr-tools/pure';\n\nimport useConfig from '@/core/useConfig';\nimport { reaction } from '@/nostr/event';\nimport { eventsQuery } from '@/nostr/query';\nimport { BatchedEventsTask } from '@/nostr/useBatchedEvents';\n\nexport type UseReactionsProps = {\n  eventId: string;\n};\n\nexport type UseReactions = {\n  reactions: () => NostrEvent[];\n  reactionsGrouped: () => Map<string, NostrEvent[]>;\n  isReactedBy: (pubkey: string) => boolean;\n  isReactedByWithEmoji: (pubkey: string) => boolean;\n  query: CreateQueryResult<NostrEvent[]>;\n};\n\nconst EmojiRegex = /\\p{Emoji_Presentation}/u;\n\nexport const queryKeyUseReactions = (props: UseReactionsProps | null) =>\n  ['useReactions', props] as const;\n\nconst useReactions = (propsProvider: () => UseReactionsProps | null): UseReactions => {\n  const { shouldMuteEvent } = useConfig();\n  const queryClient = useQueryClient();\n  const genQueryKey = createMemo(() => queryKeyUseReactions(propsProvider()));\n\n  const query = createQuery(() => ({\n    queryKey: genQueryKey(),\n    queryFn: eventsQuery<ReturnType<typeof queryKeyUseReactions>>({\n      taskProvider: ([, currentProps]) => {\n        if (currentProps == null) return null;\n        const { eventId: mentionedEventId } = currentProps;\n        return new BatchedEventsTask({ type: 'Reactions', mentionedEventId });\n      },\n      queryClient,\n    }),\n    staleTime: 1 * 60 * 1000, // 1 min\n    gcTime: 4 * 60 * 60 * 1000, // 4 hour\n    refetchInterval: 1 * 60 * 1000, // 1 min\n  }));\n\n  const reactions = () => {\n    const data = query.data ?? [];\n    return data.filter((ev) => !shouldMuteEvent(ev));\n  };\n\n  const reactionsGrouped = () => {\n    const result = new Map<string, NostrEvent[]>();\n    reactions().forEach((event) => {\n      const key = reaction(event).isCustomEmoji()\n        ? `${event.content}${reaction(event).getUrl() ?? ''}`\n        : event.content;\n      const events = result.get(key) ?? [];\n      events.push(event);\n      result.set(key, events);\n    });\n    return result;\n  };\n\n  const isReactedBy = (pubkey: string): boolean =>\n    reactions().findIndex((event) => event.pubkey === pubkey) !== -1;\n\n  const isReactedByWithEmoji = (pubkey: string): boolean =>\n    reactions().findIndex((event) => event.pubkey === pubkey && EmojiRegex.test(event.content)) !==\n    -1;\n\n  return {\n    reactions,\n    reactionsGrouped,\n    isReactedBy,\n    isReactedByWithEmoji,\n    query,\n  };\n};\n\nexport default useReactions;\n","import { createMemo } from 'solid-js';\n\nimport { createMutation, useQueryClient } from '@tanstack/solid-query';\n\nimport useCommands from '@/nostr/useCommands';\nimport { queryKeyUseReactions } from '@/nostr/useReactions';\nimport timeout from '@/utils/timeout';\n\ntype UseReactionMutationProps = {\n  eventId: string;\n};\n\nconst useReactionMutation = (propsProvider: () => UseReactionMutationProps) => {\n  const queryClient = useQueryClient();\n  const props = createMemo(propsProvider);\n\n  const commands = useCommands();\n\n  const mutation = createMutation(() => ({\n    mutationKey: ['useReactionMutation', props().eventId] as const,\n    mutationFn: (...params: Parameters<typeof commands.publishReaction>) =>\n      commands\n        .publishReaction(...params)\n        .then((promises) => Promise.allSettled(promises.map(timeout(5000)))),\n    onSuccess: (results) => {\n      const succeeded = results.filter((res) => res.status === 'fulfilled').length;\n      const failed = results.length - succeeded;\n      if (succeeded === results.length) {\n        console.log('Succeeded to publish a reaction');\n      } else if (succeeded > 0) {\n        console.warn(`failed to publish a reaction on ${failed} relays`);\n      } else {\n        console.error('failed to publish reaction on all relays');\n      }\n    },\n    onError: (err) => {\n      console.error('failed to publish reaction: ', err);\n    },\n    onSettled: () => {\n      const queryKey = queryKeyUseReactions({ eventId: props().eventId });\n      queryClient\n        .refetchQueries({ queryKey })\n        .then(() => queryClient.invalidateQueries({ queryKey }))\n        .catch((err) => console.error('failed to refetch reactions', err));\n    },\n  }));\n\n  return mutation;\n};\n\nexport default useReactionMutation;\n","import { createMemo } from 'solid-js';\n\nimport { createQuery, useQueryClient, type CreateQueryResult } from '@tanstack/solid-query';\nimport { Event as NostrEvent } from 'nostr-tools/pure';\n\nimport useConfig from '@/core/useConfig';\nimport { eventsQuery } from '@/nostr/query';\nimport { BatchedEventsTask } from '@/nostr/useBatchedEvents';\n\nexport type UseRepostsProps = {\n  eventId: string;\n};\n\nexport type UseReposts = {\n  reposts: () => NostrEvent[];\n  isRepostedBy: (pubkey: string) => boolean;\n  query: CreateQueryResult<NostrEvent[]>;\n};\n\nexport const queryKeyUseReposts = (props: UseRepostsProps) => ['useReposts', props] as const;\n\nconst useReposts = (propsProvider: () => UseRepostsProps): UseReposts => {\n  const { shouldMuteEvent } = useConfig();\n  const queryClient = useQueryClient();\n  const props = createMemo(propsProvider);\n  const genQueryKey = createMemo(() => queryKeyUseReposts(props()));\n\n  const query = createQuery(() => ({\n    queryKey: genQueryKey(),\n    queryFn: eventsQuery<ReturnType<typeof genQueryKey>>({\n      taskProvider: ([, currentProps]) => {\n        if (currentProps == null) return null;\n        const { eventId: mentionedEventId } = currentProps;\n        return new BatchedEventsTask({ type: 'Reposts', mentionedEventId });\n      },\n      queryClient,\n    }),\n    staleTime: 1 * 60 * 1000, // 1 min\n    gcTime: 4 * 60 * 60 * 1000, // 4 hour\n    refetchInterval: 1 * 60 * 1000, // 1 min\n  }));\n\n  const reposts = () => {\n    const data = query.data ?? [];\n    return data.filter((ev) => !shouldMuteEvent(ev));\n  };\n\n  const isRepostedBy = (pubkey: string): boolean =>\n    reposts().findIndex((event) => event.pubkey === pubkey) !== -1;\n\n  return { reposts, isRepostedBy, query };\n};\n\nexport default useReposts;\n","import { createMemo } from 'solid-js';\n\nimport { createMutation, useQueryClient } from '@tanstack/solid-query';\n\nimport useCommands from '@/nostr/useCommands';\nimport { queryKeyUseReposts } from '@/nostr/useReposts';\nimport timeout from '@/utils/timeout';\n\ntype UseRepostMutationProps = {\n  eventId: string;\n};\n\nconst useRepostMutation = (propsProvider: () => UseRepostMutationProps) => {\n  const queryClient = useQueryClient();\n  const props = createMemo(propsProvider);\n\n  const commands = useCommands();\n\n  const mutation = createMutation(() => ({\n    mutationKey: ['useRepostMutation', props().eventId] as const,\n    mutationFn: (...params: Parameters<typeof commands.publishRepost>) =>\n      commands\n        .publishRepost(...params)\n        .then((promises) => Promise.allSettled(promises.map(timeout(10000)))),\n    onSuccess: (results) => {\n      const succeeded = results.filter((res) => res.status === 'fulfilled').length;\n      const failed = results.length - succeeded;\n      if (succeeded === results.length) {\n        console.log('Succeeded to publish a repost');\n      } else if (succeeded > 0) {\n        console.warn(`Failed to publish a repost on ${failed} relays`);\n      } else {\n        console.error('Failed to publish a repost on all relays');\n      }\n    },\n    onError: (err) => {\n      console.error('failed to publish repost: ', err);\n    },\n    onSettled: () => {\n      const queryKey = queryKeyUseReposts({ eventId: props().eventId });\n      queryClient\n        .refetchQueries({ queryKey })\n        .then(() => queryClient.invalidateQueries({ queryKey }))\n        .catch((err) => console.error('failed to refetch repost', err));\n    },\n  }));\n\n  return mutation;\n};\n\nexport default useRepostMutation;\n","const Prefixes = ['k', 'M', 'G', 'T', 'P'] as const;\n\nexport type SIPrefix = {\n  value: number;\n  prefix: (typeof Prefixes)[number] | null;\n};\n\nconst siPrefix = (\n  value: number,\n  options?: { precision?: number; minDigits?: number },\n): SIPrefix => {\n  const precision = options?.precision ?? 3;\n  if (precision <= 0) throw new Error(`precision is too small: ${precision}`);\n\n  const minDigits = options?.minDigits ?? 4;\n  const minValue = 10 ** (minDigits - 1);\n  if (value < minValue) return { value, prefix: null };\n\n  const divider = 10 ** (Math.floor(Math.log10(value) / 3) * 3);\n  const divided = value / divider;\n  let rounded = Math.round(divided * 10 ** precision) / 10 ** precision;\n  let index = Math.max(Math.floor(Math.log10(value) / 3) - 1, 0);\n  if (rounded >= 1000) {\n    rounded /= 1000;\n    index += 1;\n  }\n  if (index >= Prefixes.length) return { value, prefix: null };\n\n  return { value: rounded, prefix: Prefixes[index] };\n};\n\nexport const formatSiPrefix = (\n  inputValue: number,\n  options?: { digits?: number; minDigits?: number },\n): string => {\n  const { value, prefix } = siPrefix(inputValue, {\n    precision: 2,\n    minDigits: options?.minDigits ?? 5,\n  });\n  if (prefix == null) return `${inputValue}`;\n\n  const digits = options?.digits ?? 3;\n  const wholeNumberDigits = Math.floor(Math.log10(value)) + 1;\n  const precision = Math.max(digits - wholeNumberDigits, 0);\n  const rounded = Math.round(value * 10 ** precision) / 10 ** precision;\n\n  return `${rounded}${prefix}`;\n};\n\nexport default siPrefix;\n","import {\n  type JSX,\n  type Component,\n  Switch,\n  Match,\n  Show,\n  lazy,\n  createSignal,\n  createMemo,\n  For,\n} from 'solid-js';\n\nimport { createMutation } from '@tanstack/solid-query';\nimport ArrowPathRoundedSquare from 'heroicons/24/outline/arrow-path-rounded-square.svg';\nimport Bolt from 'heroicons/24/outline/bolt.svg';\nimport ChatBubbleLeft from 'heroicons/24/outline/chat-bubble-left.svg';\nimport EllipsisHorizontal from 'heroicons/24/outline/ellipsis-horizontal.svg';\nimport HeartOutlined from 'heroicons/24/outline/heart.svg';\nimport Plus from 'heroicons/24/outline/plus.svg';\nimport HeartSolid from 'heroicons/24/solid/heart.svg';\nimport { noteEncode } from 'nostr-tools/nip19';\nimport { type Event as NostrEvent } from 'nostr-tools/pure';\n\nimport EmojiDisplay from '@/components/EmojiDisplay';\nimport useEmojiPicker, { EmojiData } from '@/components/useEmojiPicker';\nimport useContextMenu from '@/components/utils/useContextMenu';\nimport useConfig from '@/core/useConfig';\nimport { useTranslation } from '@/i18n/useTranslation';\nimport { reaction } from '@/nostr/event';\nimport { ReactionTypes } from '@/nostr/event/Reaction';\nimport useReactionMutation from '@/nostr/mutation/useReactionMutation';\nimport useRepostMutation from '@/nostr/mutation/useRepostMutation';\nimport useCommands from '@/nostr/useCommands';\nimport usePubkey from '@/nostr/usePubkey';\nimport useReactions from '@/nostr/useReactions';\nimport useReposts from '@/nostr/useReposts';\nimport ensureNonNull from '@/utils/ensureNonNull';\nimport { formatSiPrefix } from '@/utils/siPrefix';\nimport timeout from '@/utils/timeout';\n\nconst EventDebugModal = lazy(() => import('@/components/modal/EventDebugModal'));\nconst UserList = lazy(() => import('@/components/modal/UserList'));\n// eslint-disable-next-line import/no-cycle\nconst ZapRequestModal = lazy(() => import('@/components/modal/ZapRequestModal'));\n\nexport type ActionProps = {\n  event: NostrEvent;\n  onClickReply: () => void;\n};\n\nconst emojiDataToReactionTypes = (emoji: EmojiData): ReactionTypes => {\n  if (emoji.native != null) {\n    return { type: 'Emoji', content: emoji.native };\n  }\n  if (emoji.src != null) {\n    return {\n      type: 'CustomEmoji',\n      content: `:${emoji.id}:`,\n      shortcode: emoji.id,\n      url: emoji.src,\n    };\n  }\n  throw new Error('unknown emoji');\n};\n\nconst ReactionAction = (props: { event: NostrEvent }) => {\n  const { config } = useConfig();\n  const pubkey = usePubkey();\n\n  const [reacted, setReacted] = createSignal(false);\n\n  const { reactions, isReactedByWithEmoji, isReactedBy } = useReactions(() => ({\n    eventId: props.event.id,\n  }));\n\n  const isReactedByMe = createMemo(() => {\n    const p = pubkey();\n    return (p != null && isReactedBy(p)) || reacted();\n  });\n  const isReactedByMeWithEmoji = createMemo(() => {\n    const p = pubkey();\n    return p != null && isReactedByWithEmoji(p);\n  });\n\n  const publishReactionMutation = useReactionMutation(() => ({\n    eventId: props.event.id,\n  }));\n\n  const doReaction = (reactionTypes?: ReactionTypes) => {\n    if (isReactedByMe()) {\n      // TODO remove reaction\n      return;\n    }\n\n    ensureNonNull([pubkey(), props.event.id] as const)(([pubkeyNonNull, eventIdNonNull]) => {\n      publishReactionMutation.mutate({\n        relayUrls: config().relayUrls,\n        pubkey: pubkeyNonNull,\n        reactionTypes: reactionTypes ?? { type: 'LikeDislike', content: '+' },\n        eventId: eventIdNonNull,\n        kind: props.event.kind,\n        notifyPubkey: props.event.pubkey,\n      });\n      setReacted(true);\n    });\n  };\n\n  const handleReaction: JSX.EventHandler<HTMLButtonElement, MouseEvent> = (ev) => {\n    ev.stopPropagation();\n    doReaction();\n  };\n\n  const handleEmojiSelect = (emoji: EmojiData) => {\n    doReaction(emojiDataToReactionTypes(emoji));\n  };\n\n  const emojiPickerPopup = useEmojiPicker(() => ({\n    onEmojiSelect: handleEmojiSelect,\n  }));\n\n  return (\n    <>\n      <div\n        class=\"flex shrink-0 items-center gap-1\"\n        classList={{\n          'text-fg-tertiary': !isReactedByMe() || isReactedByMeWithEmoji(),\n          'hover:text-r-reaction': !isReactedByMe() || isReactedByMeWithEmoji(),\n          'text-r-reaction':\n            (isReactedByMe() && !isReactedByMeWithEmoji()) || publishReactionMutation.isPending,\n        }}\n      >\n        <button\n          class=\"h-4 w-4\"\n          onClick={handleReaction}\n          disabled={publishReactionMutation.isPending}\n        >\n          <Show when={isReactedByMe() && !isReactedByMeWithEmoji()} fallback={<HeartOutlined />}>\n            <HeartSolid />\n          </Show>\n        </button>\n        <Show when={!config().hideCount && !config().showEmojiReaction && reactions().length > 0}>\n          <div class=\"text-sm text-fg-tertiary\">\n            {formatSiPrefix(reactions().length, { minDigits: 4 })}\n          </div>\n        </Show>\n      </div>\n      <Show when={config().useEmojiReaction}>\n        <div\n          class=\"flex shrink-0 items-center gap-1\"\n          classList={{\n            'text-fg-tertiary': !isReactedByMe() || !isReactedByMeWithEmoji(),\n            'hover:text-r-reaction': !isReactedByMe() || !isReactedByMeWithEmoji(),\n            'text-r-reaction':\n              (isReactedByMe() && isReactedByMeWithEmoji()) || publishReactionMutation.isPending,\n          }}\n        >\n          <button\n            ref={emojiPickerPopup.targetRef}\n            class=\"h-4 w-4\"\n            onClick={() => emojiPickerPopup.open()}\n          >\n            <Plus />\n          </button>\n          {emojiPickerPopup.popup()}\n        </div>\n      </Show>\n    </>\n  );\n};\n\nconst RepostAction = (props: { event: NostrEvent }) => {\n  const { config } = useConfig();\n  const pubkey = usePubkey();\n\n  const [reposted, setReposted] = createSignal(false);\n\n  const { reposts, isRepostedBy } = useReposts(() => ({\n    eventId: props.event.id,\n  }));\n\n  const isRepostedByMe = createMemo(() => {\n    const p = pubkey();\n    return (p != null && isRepostedBy(p)) || reposted();\n  });\n\n  const publishRepostMutation = useRepostMutation(() => ({\n    eventId: props.event.id,\n  }));\n\n  const handleRepost: JSX.EventHandler<HTMLButtonElement, MouseEvent> = (ev) => {\n    ev.stopPropagation();\n\n    if (isRepostedByMe()) {\n      // TODO remove reaction\n      return;\n    }\n\n    ensureNonNull([pubkey(), props.event.id] as const)(([pubkeyNonNull, eventIdNonNull]) => {\n      publishRepostMutation.mutate({\n        relayUrls: config().relayUrls,\n        pubkey: pubkeyNonNull,\n        eventId: eventIdNonNull,\n        kind: props.event.kind,\n        notifyPubkey: props.event.pubkey,\n      });\n      setReposted(true);\n    });\n  };\n\n  return (\n    <div\n      class=\"flex shrink-0 items-center gap-1\"\n      classList={{\n        'text-fg-tertiary': !isRepostedByMe(),\n        'hover:text-r-repost': !isRepostedByMe(),\n        'text-r-repost': isRepostedByMe() || publishRepostMutation.isPending,\n      }}\n    >\n      <button onClick={handleRepost} disabled={publishRepostMutation.isPending}>\n        <span class=\"flex h-4 w-4\">\n          <ArrowPathRoundedSquare />\n        </span>\n      </button>\n      <Show when={!config().hideCount && reposts().length > 0}>\n        <div class=\"text-sm text-fg-tertiary\">\n          {formatSiPrefix(reposts().length, { minDigits: 4 })}\n        </div>\n      </Show>\n    </div>\n  );\n};\n\nconst ReactionsModal: Component<{ event: NostrEvent; onClose: () => void }> = (props) => {\n  const { reactions } = useReactions(() => ({\n    eventId: props.event.id,\n  }));\n\n  return (\n    <UserList\n      data={reactions()}\n      pubkeyExtractor={(ev) => ev.pubkey}\n      renderInfo={(ev) => (\n        <div class=\"w-6\">\n          <EmojiDisplay reactionTypes={reaction(ev).toReactionTypes()} />\n        </div>\n      )}\n      onClose={props.onClose}\n    />\n  );\n};\n\nconst RepostsModal: Component<{ event: NostrEvent; onClose: () => void }> = (props) => {\n  const { reposts } = useReposts(() => ({\n    eventId: props.event.id,\n  }));\n\n  return <UserList data={reposts()} pubkeyExtractor={(ev) => ev.pubkey} onClose={props.onClose} />;\n};\n\nconst EmojiReactions: Component<{ event: NostrEvent }> = (props) => {\n  const { config } = useConfig();\n  const pubkey = usePubkey();\n\n  const [reacted, setReacted] = createSignal(false);\n\n  const { reactions, reactionsGrouped, isReactedBy } = useReactions(() => ({\n    eventId: props.event.id,\n  }));\n\n  const mutation = useReactionMutation(() => ({\n    eventId: props.event.id,\n  }));\n\n  const isReactedByMe = () => {\n    const p = pubkey();\n    if (p == null) return reacted();\n    return reacted() || isReactedBy(p);\n  };\n\n  const doReaction = (reactionTypes?: ReactionTypes) => {\n    if (isReactedByMe()) {\n      // TODO remove reaction\n      return;\n    }\n\n    ensureNonNull([pubkey(), props.event.id] as const)(([pubkeyNonNull, eventIdNonNull]) => {\n      mutation.mutate({\n        relayUrls: config().relayUrls,\n        pubkey: pubkeyNonNull,\n        reactionTypes: reactionTypes ?? { type: 'LikeDislike', content: '+' },\n        eventId: eventIdNonNull,\n        kind: props.event.kind,\n        notifyPubkey: props.event.pubkey,\n      });\n      setReacted(true);\n    });\n  };\n\n  return (\n    <Show when={config().showEmojiReaction && reactions().length > 0}>\n      <div class=\"scrollbar flex gap-2 overflow-x-auto py-1\">\n        <For each={[...reactionsGrouped().entries()]}>\n          {([, events]) => {\n            const isReactedByMeWithThisContent =\n              events.findIndex((ev) => ev.pubkey === pubkey()) >= 0;\n            const reactionTypes = reaction(events[0]).toReactionTypes();\n\n            return (\n              <button\n                class=\"flex h-6 max-w-[128px] items-center rounded border border-border px-1\"\n                classList={{\n                  'text-fg-tertiary': !isReactedByMeWithThisContent,\n                  'hover:bg-r-reaction/10': !isReactedByMeWithThisContent,\n                  'hover:border-r-reaction/40': !isReactedByMeWithThisContent,\n                  'bg-r-reaction/10': isReactedByMeWithThisContent,\n                  'border-r-reaction/40': isReactedByMeWithThisContent,\n                  'text-r-reaction': isReactedByMeWithThisContent,\n                }}\n                type=\"button\"\n                onClick={(ev) => {\n                  ev.stopPropagation();\n                  doReaction(reactionTypes);\n                }}\n                disabled={isReactedByMe()}\n              >\n                <EmojiDisplay reactionTypes={reactionTypes} />\n                <Show when={!config().hideCount}>\n                  <span class=\"ml-1 text-sm\">{events.length}</span>\n                </Show>\n              </button>\n            );\n          }}\n        </For>\n      </div>\n    </Show>\n  );\n};\n\nconst Actions: Component<ActionProps> = (props) => {\n  const i18n = useTranslation();\n  const { config } = useConfig();\n  const pubkey = usePubkey();\n  const commands = useCommands();\n\n  const [modal, setModal] = createSignal<\n    'EventDebugModal' | 'Reactions' | 'Reposts' | 'ZapRequest' | null\n  >(null);\n\n  const closeModal = () => setModal(null);\n\n  const deleteMutation = createMutation(() => ({\n    mutationKey: ['deleteEvent', props.event.id],\n    mutationFn: (...params: Parameters<typeof commands.deleteEvent>) =>\n      commands\n        .deleteEvent(...params)\n        .then((promeses) => Promise.allSettled(promeses.map(timeout(10000)))),\n    onSuccess: (results) => {\n      // TODO タイムラインから削除する\n      const succeeded = results.filter((res) => res.status === 'fulfilled').length;\n      const failed = results.length - succeeded;\n      if (succeeded === results.length) {\n        window.alert(i18n()('post.deletedSuccessfully'));\n      } else if (succeeded > 0) {\n        window.alert(i18n()('post.failedToDeletePartially', { count: failed }));\n      } else {\n        window.alert(i18n()('post.failedToDelete'));\n      }\n    },\n    onError: (err) => {\n      console.error('failed to delete', err);\n    },\n  }));\n\n  const otherActionsPopup = useContextMenu(() => ({\n    menu: [\n      {\n        content: i18n()('post.copyEventId'),\n        onSelect: () => {\n          navigator.clipboard\n            .writeText(noteEncode(props.event.id))\n            .catch((err) => window.alert(err));\n        },\n      },\n      {\n        content: i18n()('post.showJSON'),\n        onSelect: () => {\n          setModal('EventDebugModal');\n        },\n      },\n      {\n        content: i18n()('post.showReposts'),\n        onSelect: () => {\n          setModal('Reposts');\n        },\n      },\n      {\n        content: i18n()('post.showReactions'),\n        onSelect: () => {\n          setModal('Reactions');\n        },\n      },\n      {\n        when: () => props.event.pubkey === pubkey(),\n        content: <span class=\"text-red-500\">{i18n()('post.deletePost')}</span>,\n        onSelect: () => {\n          const p = pubkey();\n          if (p == null) return;\n\n          if (!window.confirm(i18n()('post.confirmDelete'))) return;\n          deleteMutation.mutate({\n            relayUrls: config().relayUrls,\n            pubkey: p,\n            eventId: props.event.id,\n          });\n        },\n      },\n    ],\n  }));\n\n  return (\n    <>\n      <EmojiReactions event={props.event} />\n      <div class=\"actions flex w-64 max-w-full items-center justify-between pt-1\">\n        <button\n          class=\"shrink-0 text-fg-tertiary hover:text-fg-tertiary/70\"\n          onClick={(ev) => {\n            ev.stopPropagation();\n            props.onClickReply();\n          }}\n        >\n          <span class=\"flex h-4 w-4\">\n            <ChatBubbleLeft />\n          </span>\n        </button>\n        <RepostAction event={props.event} />\n        <ReactionAction event={props.event} />\n        <button type=\"button\" onClick={() => setModal('ZapRequest')}>\n          <span class=\"flex h-4 w-4 text-fg-tertiary hover:text-r-zap\">\n            <Bolt />\n          </span>\n        </button>\n        <button\n          ref={otherActionsPopup.targetRef}\n          type=\"button\"\n          class=\"h-4 w-4 shrink-0 text-fg-tertiary hover:text-fg-tertiary/70\"\n          onClick={() => otherActionsPopup.open()}\n        >\n          <EllipsisHorizontal />\n        </button>\n        {otherActionsPopup.popup()}\n      </div>\n      <Switch>\n        <Match when={modal() === 'EventDebugModal'}>\n          <EventDebugModal event={props.event} onClose={closeModal} />\n        </Match>\n        <Match when={modal() === 'Reactions'}>\n          <ReactionsModal event={props.event} onClose={closeModal} />\n        </Match>\n        <Match when={modal() === 'Reposts'}>\n          <RepostsModal event={props.event} onClose={closeModal} />\n        </Match>\n        <Match when={modal() === 'ZapRequest'}>\n          <ZapRequestModal event={props.event} onClose={closeModal} />\n        </Match>\n      </Switch>\n    </>\n  );\n};\n\nexport default Actions;\n","import { createSignal, type Component, type JSX, Show } from 'solid-js';\n\nimport ExclamationTriangle from 'heroicons/24/outline/exclamation-triangle.svg';\n\nimport { useTranslation } from '@/i18n/useTranslation';\nimport { ContentWarning } from '@/nostr/event/TextNoteLike';\n\nexport type ContentWarningDisplayProps = {\n  contentWarning: ContentWarning;\n  children: JSX.Element;\n};\n\nconst ContentWarningDisplay: Component<ContentWarningDisplayProps> = (props) => {\n  const i18n = useTranslation();\n  const [showContentWarning, setShowContentWarning] = createSignal(false);\n\n  return (\n    <Show\n      when={!props.contentWarning.contentWarning || showContentWarning()}\n      fallback={\n        <button\n          class=\"mt-2 flex w-full flex-col items-center rounded border border-border p-2 text-center text-xs text-fg-secondary\"\n          onClick={() => setShowContentWarning(true)}\n        >\n          <span class=\"inline-block h-4 w-4\">\n            <ExclamationTriangle />\n          </span>\n          <span>{i18n()('post.contentWarning.show')}</span>\n          <Show when={props.contentWarning.reason != null}>\n            <span>\n              {i18n()('post.contentWarning.reason')}: {props.contentWarning.reason}\n            </span>\n          </Show>\n        </button>\n      }\n    >\n      <div>{props.children}</div>\n      <Show when={props.contentWarning.contentWarning}>\n        <button\n          class=\"text-xs text-fg-secondary hover:text-fg-secondary/70\"\n          onClick={() => setShowContentWarning(false)}\n        >\n          隠す\n        </button>\n      </Show>\n    </Show>\n  );\n};\n\nexport default ContentWarningDisplay;\n","import { Show } from 'solid-js';\n\nimport useProfile from '@/nostr/useProfile';\nimport npubEncodeFallback from '@/utils/npubEncodeFallback';\n\nexport type GeneralUserMentionDisplayProps = {\n  pubkey: string;\n};\n\nconst GeneralUserMentionDisplay = (props: GeneralUserMentionDisplayProps) => {\n  const { profile } = useProfile(() => ({\n    pubkey: props.pubkey,\n  }));\n\n  return (\n    <Show\n      when={(profile()?.name?.length ?? 0) > 0}\n      fallback={`@${npubEncodeFallback(props.pubkey)}`}\n    >\n      @{profile()?.name ?? props.pubkey}\n    </Show>\n  );\n};\n\nexport default GeneralUserMentionDisplay;\n","export const isImageUrl = (urlString: string): boolean => {\n  try {\n    const url = new URL(urlString);\n    return /\\.(jpeg|jpg|png|gif|webp|avif|apng|svg)$/i.test(url.pathname);\n  } catch {\n    return false;\n  }\n};\n\nexport const isVideoUrl = (urlString: string): boolean => {\n  try {\n    const url = new URL(urlString);\n    return /\\.(mpg|mpeg|mp4|avi|mov|webm|ogv)$/i.test(url.pathname);\n  } catch {\n    return false;\n  }\n};\n\nexport const isWebSocketUrl = (urlString: string): boolean => {\n  try {\n    const url = new URL(urlString);\n    return /^wss?:$/.test(url.protocol);\n  } catch {\n    return false;\n  }\n};\n\n/**\n * Generate a URL of thumbnail for a given URL.\n */\nexport const thumbnailUrl = (\n  urlString: string,\n  size: 'icon' | 'thumbnail' = 'thumbnail',\n): string => {\n  try {\n    const url = new URL(urlString);\n    // Imgur\n    if (url.host === 'i.imgur.com' || url.host === 'imgur.com') {\n      const match = url.pathname.match(/^\\/([a-zA-Z0-9]+)\\.(jpeg|jpg|png|gif|webp|avif|apng)/);\n      if (match != null) {\n        const result = new URL(url);\n        const imageId = match[1];\n        const ext = match[2];\n        result.host = 'i.imgur.com';\n        if (size === 'icon') {\n          result.pathname = `${imageId}s.${ext}`;\n        } else if (size === 'thumbnail') {\n          result.pathname = `${imageId}l.${ext}`;\n        } else {\n          // fallback\n          return urlString;\n        }\n        return result.toString();\n      }\n      return url.toString();\n    }\n\n    // Gyazo\n    if (url.host === 'i.gyazo.com') {\n      const result = new URL(url);\n      result.host = 'thumb.gyazo.com';\n      if (size === 'icon') {\n        result.pathname = `/thumb/160${url.pathname}`;\n      } else if (size === 'thumbnail') {\n        result.pathname = `/thumb/640${url.pathname}`;\n      } else {\n        // fallback\n        return urlString;\n      }\n      return result.toString();\n    }\n\n    // nostr.build\n    // https://github.com/nostrbuild/nostr.build/blob/main/SiteConfig.php#L71-L75\n    // https://github.com/nostrbuild/nostr.build/blob/main/api/v2/routes_upload.php\n    if (\n      url.host === 'nostr.build' ||\n      url.host === 'i.nostr.build' ||\n      url.host === 'image.nostr.build' ||\n      url.host === 'cdn.nostr.build'\n    ) {\n      // profile pic (PFP)\n      if (url.pathname.startsWith('/i/p/')) return urlString;\n\n      const result = new URL(url);\n      if (url.pathname.startsWith('/i/')) {\n        const withoutI = url.pathname.replace(/^\\/i/, '');\n        result.hostname = 'image.nostr.build';\n        result.pathname = `/resp/240p${withoutI}`;\n      } else if (url.pathname.match(/^\\/[0-9a-zA-Z]+\\.(jpeg|jpg|png|gif|webp|avif|apng)$/)) {\n        result.pathname = `/resp/240p${url.pathname}`;\n      } else {\n        // fallback\n        return urlString;\n      }\n      return result.toString();\n    }\n\n    // pbs.twimg.com\n    // https://qiita.com/ma7ma7pipipi/items/713460b24710e0a46242\n    if (url.host === 'pbs.twimg.com') {\n      if (url.pathname.startsWith('/profile_images/')) {\n        const result = new URL(url);\n        result.pathname = url.pathname.replace(\n          /(?:_(?:mini|normal|bigger|200x200|400x400))?\\.(jpg|png)$/,\n          '_normal.$1',\n        );\n        return result.toString();\n      }\n      if (url.pathname.startsWith('/media/')) {\n        const result = new URL(url);\n        result.searchParams.set('format', 'jpg');\n        result.searchParams.set('name', 'small');\n        return result.toString();\n      }\n      return urlString;\n    }\n\n    // media.discrodapp.net\n    if (\n      url.hostname === 'media.discordapp.net' &&\n      url.pathname.match(/^\\/attachments\\/\\d+\\/\\d+\\/[a-z0-9]+\\.(png|jpg|gif)/)\n    ) {\n      const result = new URL(url);\n      result.searchParams.set('format', 'webp');\n      if (size === 'icon') {\n        result.searchParams.set('width', '100');\n        result.searchParams.set('height', '100');\n      } else if (size === 'thumbnail') {\n        result.searchParams.set('width', '320');\n        result.searchParams.set('height', '320');\n      } else {\n        return urlString;\n      }\n    }\n    return url.toString();\n  } catch {\n    return urlString;\n  }\n};\n\nexport const isTwitterUrl = (urlString: string): boolean => {\n  try {\n    const url = new URL(urlString);\n    return url.protocol === 'https:' && (url.host === 'twitter.com' || url.host === 'x.com');\n  } catch {\n    return false;\n  }\n};\n\ntype YouTubeVideo = {\n  videoId: string;\n};\n\nconst YouTubeHosts = ['www.youtube.com', 'm.youtube.com', 'youtube.com'];\nexport const parseYouTubeVideoUrl = (urlString: string): YouTubeVideo | null => {\n  try {\n    const url = new URL(urlString);\n    if (url.protocol !== 'https:') return null;\n\n    if (YouTubeHosts.includes(url.host)) {\n      if (url.pathname === '/watch') {\n        const videoId = url.searchParams.get('v');\n        if (videoId != null) {\n          return { videoId };\n        }\n      }\n      if (url.pathname.startsWith('/shorts/')) {\n        const match = url.pathname.match(/^\\/shorts\\/([0-9a-zA-Z_-]*)$/);\n        if (match) {\n          return { videoId: match[1] };\n        }\n      }\n    }\n\n    if (url.host === 'youtu.be' && url.pathname.lastIndexOf('/') === 0) {\n      return { videoId: url.pathname };\n    }\n\n    return null;\n  } catch {\n    return null;\n  }\n};\n","import { Component, createSignal, Show } from 'solid-js';\n\nimport LazyLoad from '@/components/utils/LazyLoad';\nimport SafeLink from '@/components/utils/SafeLink';\nimport { useTranslation } from '@/i18n/useTranslation';\nimport { thumbnailUrl } from '@/utils/url';\n\ntype ImageDisplayProps = {\n  url: string;\n  initialHidden: boolean;\n};\n\nconst ImageDisplay: Component<ImageDisplayProps> = (props) => {\n  let imageRef: HTMLImageElement | undefined;\n  const i18n = useTranslation();\n  const [hidden, setHidden] = createSignal(props.initialHidden);\n\n  return (\n    <Show\n      when={!hidden()}\n      fallback={\n        <button\n          class=\"rounded bg-bg-tertiary p-3 text-xs text-fg-secondary hover:shadow\"\n          onClick={() => setHidden(false)}\n        >\n          {i18n()('post.showImage')}\n        </button>\n      }\n    >\n      <LazyLoad\n        fallback={\n          <div class=\"aspect-video max-w-full\">\n            <SafeLink href={props.url} />\n          </div>\n        }\n      >\n        {() => (\n          <SafeLink class=\"my-2 block\" href={props.url}>\n            <img\n              ref={imageRef}\n              class=\"max-h-64 max-w-full rounded object-contain shadow hover:shadow-md\"\n              src={thumbnailUrl(props.url)}\n              alt={props.url}\n            />\n          </SafeLink>\n        )}\n      </LazyLoad>\n    </Show>\n  );\n};\n\nexport default ImageDisplay;\n","import { Show } from 'solid-js';\n\nimport * as Kind from 'nostr-tools/kinds';\n\n// eslint-disable-next-line import/no-cycle\nimport EventDisplayById from '@/components/event/EventDisplayById';\nimport EventLink from '@/components/EventLink';\nimport LazyLoad from '@/components/utils/LazyLoad';\nimport { type MentionedEvent } from '@/nostr/parseTextNote';\n\nexport type MentionedEventDisplayProps = {\n  mentionedEvent: MentionedEvent;\n};\n\nconst MentionedEventDisplay = (props: MentionedEventDisplayProps) => (\n  <Show\n    when={props.mentionedEvent.marker != null && props.mentionedEvent.marker.length > 0}\n    fallback={<EventLink eventId={props.mentionedEvent.eventId} />}\n  >\n    <div class=\"my-1 rounded border p-1\">\n      <LazyLoad>\n        {() => (\n          <EventDisplayById\n            eventId={props.mentionedEvent.eventId}\n            embedding={false}\n            actions={false}\n            ensureKinds={[Kind.ShortTextNote]}\n          />\n        )}\n      </LazyLoad>\n    </div>\n  </Show>\n);\n\nexport default MentionedEventDisplay;\n","import GeneralUserMentionDisplay from '@/components/event/textNote/GeneralUserMentionDisplay';\nimport useModalState from '@/hooks/useModalState';\n\nexport type MentionedUserDisplayProps = {\n  pubkey: string;\n};\n\nconst MentionedUserDisplay = (props: MentionedUserDisplayProps) => {\n  const { showProfile } = useModalState();\n\n  const handleClick = () => {\n    showProfile(props.pubkey);\n  };\n  return (\n    <button class=\"inline select-text text-link underline\" onClick={handleClick}>\n      <GeneralUserMentionDisplay pubkey={props.pubkey} />\n    </button>\n  );\n};\n\nexport default MentionedUserDisplay;\n","import { createQuery } from '@tanstack/solid-query';\n\nexport type OgpContent = {\n  url: string;\n  title: string;\n  description: string;\n  image: string;\n};\n\nexport const parseOgpFromDOM = (doc: HTMLDocument): OgpContent | null => {\n  const props: { [property: string]: string } = {};\n\n  Array.from(doc.head.querySelectorAll('meta')).forEach((m) => {\n    const property = m.getAttribute('property');\n    const content = m.getAttribute('content');\n    if (property != null && content != null) {\n      props[property] = content;\n    }\n  });\n\n  if (\n    props['og:image'] != null &&\n    props['og:title'] != null &&\n    props['og:description'] != null &&\n    props['og:url']\n  ) {\n    return {\n      title: props['og:title'],\n      description: props['og:description'],\n      image: props['og:image'],\n      url: props['og:url'],\n    } satisfies OgpContent;\n  }\n  return null;\n};\n\nexport const parseOgp = (text: string): OgpContent | null => {\n  const doc = new DOMParser().parseFromString(text, 'text/html');\n  return parseOgpFromDOM(doc);\n};\n\nexport const isOgpUrl = (urlString: string): boolean => {\n  const allowList = ['www3.nhk.or.jp'];\n  const url = new URL(urlString);\n  return allowList.includes(url.host);\n};\n\nexport const fetchOgpContent = async (urlString: string): Promise<OgpContent | null> => {\n  if (!isOgpUrl(urlString)) return null;\n\n  const res = await fetch(urlString, { headers: { Accept: 'text/html' } });\n  const text = await res.text();\n  return parseOgp(text);\n};\n\nexport type UseOgpProps = {\n  url: string;\n};\n\nexport const useOgp = (propsProvider: () => UseOgpProps) => {\n  const genQueryKey = () => ['useOgp', propsProvider().url] as const;\n\n  const query = createQuery(() => ({\n    queryKey: genQueryKey(),\n    queryFn: ({ queryKey: [, url] }) => fetchOgpContent(url),\n    staleTime: 4 * 60 * 60 * 1000, // 4 hour\n    gcTime: 4 * 60 * 60 * 1000, // 4 hour\n    refetchOnWindowFocus: false,\n    refetchOnMount: false,\n  }));\n\n  const ogp = () => query.data;\n\n  return { query, ogp };\n};\n","import { Component, JSX, Switch, Match, createSignal, createEffect, Show } from 'solid-js';\n\nimport LazyLoad from '@/components/utils/LazyLoad';\nimport SafeLink from '@/components/utils/SafeLink';\nimport useConfig from '@/core/useConfig';\nimport { useTranslation } from '@/i18n/useTranslation';\nimport { useOgp, isOgpUrl } from '@/utils/ogp';\nimport { isTwitterUrl, parseYouTubeVideoUrl } from '@/utils/url';\n\ntype PreviewdLinkProps = {\n  url: string;\n  initialHidden: boolean;\n  children?: JSX.Element;\n};\n\nconst twitterUrl = (urlString: string): string => {\n  try {\n    const url = new URL(urlString);\n    url.host = 'twitter.com';\n    return url.href;\n  } catch {\n    return urlString;\n  }\n};\n\nconst youtubeUrl = (videoId: string): string => {\n  const iframeUrl = new URL(`https://www.youtube-nocookie.com/embed/`);\n  iframeUrl.pathname += videoId;\n  iframeUrl.searchParams.set('origin', window.location.origin);\n  return iframeUrl.href;\n};\n\nconst TwitterEmbed: Component<{ url: string }> = (props) => {\n  let twitterRef: HTMLQuoteElement | undefined;\n\n  const { getColorTheme } = useConfig();\n\n  createEffect(() => {\n    if (isTwitterUrl(props.url)) {\n      window.twttr?.widgets?.load(twitterRef);\n    }\n  });\n\n  const dataTheme = () => {\n    const colorTheme = getColorTheme();\n    if (colorTheme.brightness === 'dark') {\n      return 'dark';\n    }\n    return 'light';\n  };\n\n  return (\n    <blockquote ref={twitterRef} class=\"twitter-tweet\" data-theme={dataTheme()}>\n      <a\n        class=\"text-link underline\"\n        href={twitterUrl(props.url)}\n        target=\"_blank\"\n        rel=\"noreferrer noopener\"\n      >\n        {twitterUrl(props.url)}\n      </a>\n    </blockquote>\n  );\n};\n\nconst OgpEmbed: Component<{ class?: string; url: string }> = (props) => {\n  const { ogp } = useOgp(() => ({\n    url: props.url,\n  }));\n\n  return (\n    <Show when={ogp()} fallback={<SafeLink class=\"text-link underline\" href={props.url} />} keyed>\n      {(ogpProps) => (\n        <SafeLink href={props.url}>\n          <div class=\"my-2 rounded-lg border border-border transition-colors hover:bg-bg-tertiary\">\n            <img\n              alt={ogpProps.title}\n              class=\"max-w-full rounded-t-lg object-contain shadow\"\n              src={ogpProps.image}\n            />\n            <div class=\"mb-1 p-1\">\n              <div class=\"text-xs text-fg-secondary\">{new URL(ogpProps.url).host}</div>\n              <div class=\"text-sm\">{ogpProps.title}</div>\n              <div class=\"text-xs text-fg-secondary\">{ogpProps.description}</div>\n            </div>\n          </div>\n        </SafeLink>\n      )}\n    </Show>\n  );\n};\n\ntype ClickToShowProps = {\n  initialHidden: boolean;\n  url: string;\n  children: JSX.Element;\n};\n\nconst ClickToShow: Component<ClickToShowProps> = (props) => {\n  const i18n = useTranslation();\n  const [hidden, setHidden] = createSignal(props.initialHidden);\n\n  return (\n    <Show\n      when={!hidden()}\n      fallback={\n        <div>\n          <button\n            class=\"flex flex-col items-center rounded bg-bg-tertiary p-3 text-xs text-fg-secondary hover:shadow\"\n            onClick={() => setHidden(false)}\n          >\n            {i18n()('post.showPreview')}\n          </button>\n          <SafeLink class=\"text-link underline\" href={props.url} />\n        </div>\n      }\n    >\n      {props.children}\n    </Show>\n  );\n};\n\nconst PreviewedLink: Component<PreviewdLinkProps> = (props) => {\n  const { config } = useConfig();\n\n  return (\n    <Switch fallback={<SafeLink class=\"text-link underline\" href={props.url} />}>\n      <Match when={config().embedding.twitter && isTwitterUrl(props.url)}>\n        <ClickToShow url={props.url} initialHidden={props.initialHidden}>\n          <TwitterEmbed url={props.url} />\n        </ClickToShow>\n      </Match>\n      <Match when={config().embedding.youtube && parseYouTubeVideoUrl(props.url)} keyed>\n        {({ videoId }) => (\n          <ClickToShow url={props.url} initialHidden={props.initialHidden}>\n            <LazyLoad\n              fallback={\n                <div class=\"aspect-video max-w-full\">\n                  <SafeLink href={props.url} />\n                </div>\n              }\n            >\n              {() => (\n                <div class=\"my-2 aspect-video w-full\">\n                  <iframe\n                    loading=\"lazy\"\n                    title=\"YouTube\"\n                    class=\"my-2 h-full w-full\"\n                    src={youtubeUrl(videoId)}\n                    allowfullscreen\n                  />\n                </div>\n              )}\n            </LazyLoad>\n          </ClickToShow>\n        )}\n      </Match>\n      <Match when={config().embedding.ogp && isOgpUrl(props.url)}>\n        <ClickToShow url={props.url} initialHidden={props.initialHidden}>\n          <LazyLoad>{() => <OgpEmbed url={props.url} />}</LazyLoad>\n        </ClickToShow>\n      </Match>\n    </Switch>\n  );\n};\n\nexport default PreviewedLink;\n","import { Component, createSignal, Show } from 'solid-js';\n\nimport LazyLoad from '@/components/utils/LazyLoad';\nimport SafeLink from '@/components/utils/SafeLink';\nimport { useTranslation } from '@/i18n/useTranslation';\n\ntype VideoDisplayProps = {\n  url: string;\n  initialHidden: boolean;\n};\n\nconst VideoDisplay: Component<VideoDisplayProps> = (props) => {\n  let videoRef: HTMLVideoElement | undefined;\n  const i18n = useTranslation();\n  const [hidden, setHidden] = createSignal(props.initialHidden);\n\n  return (\n    <Show\n      when={!hidden()}\n      fallback={\n        <button\n          class=\"rounded bg-bg-tertiary p-3 text-xs text-fg-secondary hover:shadow\"\n          onClick={() => setHidden(false)}\n        >\n          {i18n()('post.showVideo')}\n        </button>\n      }\n    >\n      <LazyLoad fallback={<div class=\"aspect-video max-w-full\" />}>\n        {() => (\n          <SafeLink class=\"my-2 block\" href={props.url}>\n            {/* eslint-disable-next-line jsx-a11y/media-has-caption */}\n            <video\n              ref={videoRef}\n              class=\"max-h-64 max-w-full rounded-sm object-contain shadow\"\n              src={props.url}\n              controls\n            >\n              <a href={props.url}>{i18n()('post.download')}</a>\n            </video>\n          </SafeLink>\n        )}\n      </LazyLoad>\n    </Show>\n  );\n};\n\nexport default VideoDisplay;\n","import { For } from 'solid-js';\n\nimport * as Kind from 'nostr-tools/kinds';\n\n// eslint-disable-next-line import/no-cycle\nimport EventDisplayById from '@/components/event/EventDisplayById';\n// import ParameterizedReplaceableEventDisplayById from '@/components/event/ParameterizedReplaceableEventDisplayById';\nimport ImageDisplay from '@/components/event/textNote/ImageDisplay';\nimport MentionedEventDisplay from '@/components/event/textNote/MentionedEventDisplay';\nimport MentionedUserDisplay from '@/components/event/textNote/MentionedUserDisplay';\nimport PreviewedLink from '@/components/event/textNote/PreviewedLink';\nimport VideoDisplay from '@/components/event/textNote/VideoDisplay';\nimport EventLink from '@/components/EventLink';\nimport { createRelaysColumn, createSearchColumn } from '@/core/column';\nimport useConfig from '@/core/useConfig';\nimport { useRequestCommand } from '@/hooks/useCommandBus';\nimport { ParsedTextNoteResolvedNode, type ParsedTextNoteResolved } from '@/nostr/parseTextNote';\nimport { isImageUrl, isVideoUrl, isWebSocketUrl } from '@/utils/url';\n\nexport type TextNoteContentDisplayProps = {\n  parsed: ParsedTextNoteResolved;\n  embedding: boolean;\n  initialHidden?: boolean;\n};\n\nconst TextNoteContentDisplay = (props: TextNoteContentDisplayProps) => {\n  const { config, saveColumn } = useConfig();\n\n  const request = useRequestCommand();\n\n  const addHashTagColumn = (query: string) => {\n    saveColumn(createSearchColumn({ query }));\n    request({ command: 'moveToLastColumn' }).catch((err) => console.error(err));\n  };\n\n  const addRelayColumn = (url: string) => {\n    saveColumn(createRelaysColumn({ name: url, relayUrls: [url] }));\n    request({ command: 'moveToLastColumn' }).catch((err) => console.error(err));\n  };\n\n  return (\n    <For each={props.parsed}>\n      {(item: ParsedTextNoteResolvedNode) => {\n        if (item.type === 'PlainText') {\n          return <span>{item.content}</span>;\n        }\n        if (item.type === 'URL') {\n          const initialHidden = () =>\n            !config().showMedia || !props.embedding || (props.initialHidden ?? false);\n\n          if (isImageUrl(item.content)) {\n            return <ImageDisplay url={item.content} initialHidden={initialHidden()} />;\n          }\n          if (isVideoUrl(item.content)) {\n            return <VideoDisplay url={item.content} initialHidden={initialHidden()} />;\n          }\n          if (isWebSocketUrl(item.content)) {\n            return (\n              <button\n                class=\"select-text text-link underline\"\n                onClick={() => addRelayColumn(item.content)}\n              >\n                {item.content}\n              </button>\n            );\n          }\n          return <PreviewedLink url={item.content} initialHidden={initialHidden()} />;\n        }\n        if (item.type === 'TagReferenceResolved') {\n          if (item.reference == null) {\n            return <span>{item.content}</span>;\n          }\n          if (item.reference.type === 'MentionedUser') {\n            return <MentionedUserDisplay pubkey={item.reference.pubkey} />;\n          }\n          if (item.reference.type === 'MentionedEvent') {\n            if (props.embedding) {\n              return <MentionedEventDisplay mentionedEvent={item.reference} />;\n            }\n            return <EventLink eventId={item.reference.eventId} />;\n          }\n        }\n        if (item.type === 'Bech32Entity') {\n          if (item.data.type === 'note' && props.embedding) {\n            return (\n              <div class=\"my-1 rounded border border-border p-1\">\n                <EventDisplayById\n                  eventId={item.data.data}\n                  actions={false}\n                  embedding={false}\n                  ensureKinds={[Kind.ShortTextNote]}\n                />\n              </div>\n            );\n          }\n          if (item.data.type === 'nevent' && props.embedding) {\n            return (\n              <div class=\"my-1 rounded border border-border p-1\">\n                <EventDisplayById eventId={item.data.data.id} actions={false} embedding={false} />\n              </div>\n            );\n          }\n          if (item.data.type === 'npub') {\n            return <MentionedUserDisplay pubkey={item.data.data} />;\n          }\n          if (item.data.type === 'nprofile') {\n            return <MentionedUserDisplay pubkey={item.data.data.pubkey} />;\n          }\n          if (item.data.type === 'nrelay') {\n            const url: string = item.data.data;\n            return (\n              <button class=\"select-text text-link underline\" onClick={() => addRelayColumn(url)}>\n                {url} ({item.content})\n              </button>\n            );\n          }\n          return <span class=\"text-link underline\">{item.content}</span>;\n        }\n        if (item.type === 'HashTag') {\n          return (\n            <button\n              class=\"select-text text-link underline\"\n              onClick={() => addHashTagColumn(item.content)}\n            >\n              {item.content}\n            </button>\n          );\n        }\n        if (item.type === 'CustomEmojiResolved') {\n          if (item.url == null) return <span>{item.content}</span>;\n          // const { imageRef, canvas } = useImageAnimation({ initialPlaying: false });\n          return (\n            <img\n              class=\"inline-block h-8 max-w-[128px] align-middle\"\n              src={item.url}\n              alt={item.content}\n              title={item.shortcode}\n            />\n          );\n        }\n        console.error('Not all ParsedTextNoteNodes are covered', item);\n        return null;\n      }}\n    </For>\n  );\n};\n\nexport default TextNoteContentDisplay;\n","import { createSignal, onMount, onCleanup } from 'solid-js';\n\nimport throttle from 'lodash/throttle';\n\n// TODO Find a better way to solve this. Firefox on Windows can cause 2px gap.\nconst Offset = 2;\n\nconst ThrottleWaitMs = 200;\n\n/**\n * Detect overflow if the height of the target element content is bigger than\n * actual displayed height or window height.\n */\nconst useDetectOverflow = () => {\n  let elementRef: HTMLElement | undefined;\n  const [overflow, setOverflow] = createSignal(false);\n\n  const setElementRef = (el: HTMLElement) => {\n    elementRef = el;\n  };\n\n  const detectOverflow = throttle(() => {\n    if (elementRef != null) {\n      setOverflow(\n        elementRef.scrollHeight > elementRef.clientHeight + Offset ||\n          elementRef.scrollHeight > document.documentElement.clientHeight + Offset,\n      );\n    }\n  }, ThrottleWaitMs);\n\n  onMount(() => {\n    if (elementRef != null) {\n      detectOverflow();\n\n      const observer = new IntersectionObserver(\n        (entries) => {\n          entries.forEach((entry) => {\n            if (entry.isIntersecting) {\n              detectOverflow();\n            }\n          });\n        },\n        {\n          threshold: [0, 0.25, 0.5, 0.75, 1],\n        },\n      );\n      observer.observe(elementRef);\n\n      const handleResize = () => detectOverflow();\n      window.addEventListener('resize', handleResize);\n\n      onCleanup(() => {\n        observer.disconnect();\n        window.removeEventListener('resize', handleResize);\n      });\n    }\n  });\n\n  return { overflow, elementRef: setElementRef };\n};\n\nexport default useDetectOverflow;\n","import { Component, JSX, Show, createSignal } from 'solid-js';\n\nimport LazyLoad from '@/components/utils/LazyLoad';\nimport useDetectOverflow from '@/hooks/useDetectOverflow';\nimport useFormatDate from '@/hooks/useFormatDate';\nimport { useTranslation } from '@/i18n/useTranslation';\nimport useProfile from '@/nostr/useProfile';\nimport npubEncodeFallback from '@/utils/npubEncodeFallback';\nimport { thumbnailUrl } from '@/utils/url';\n\nexport type PostProps = {\n  authorPubkey: string;\n  createdAt: Date;\n  content: JSX.Element;\n  actions?: JSX.Element;\n  footer?: JSX.Element;\n  onShowProfile?: () => void;\n  onShowEvent?: () => void;\n};\n\nconst Post: Component<PostProps> = (props) => {\n  const i18n = useTranslation();\n  const { overflow, elementRef } = useDetectOverflow();\n  const formatDate = useFormatDate();\n\n  const [showOverflow, setShowOverflow] = createSignal(false);\n  const createdAt = () => formatDate(props.createdAt);\n  const createdAtFull = () => props.createdAt.toLocaleString();\n\n  const { profile: author } = useProfile(() => ({\n    pubkey: props.authorPubkey,\n  }));\n\n  return (\n    <div class=\"post flex flex-col\">\n      <div class=\"flex w-full gap-1\">\n        <button\n          type=\"button\"\n          class=\"author-icon h-10 w-10 shrink-0 overflow-hidden rounded\"\n          onClick={(ev) => {\n            ev.preventDefault();\n            props.onShowProfile?.();\n          }}\n        >\n          <Show when={author()?.picture} keyed>\n            {(url) => (\n              <LazyLoad>\n                {() => (\n                  <img\n                    src={thumbnailUrl(url, 'icon')}\n                    alt=\"icon\"\n                    referrerpolicy=\"no-referrer\"\n                    class=\"h-full w-full object-cover\"\n                  />\n                )}\n              </LazyLoad>\n            )}\n          </Show>\n        </button>\n        <div class=\"min-w-0 flex-auto\">\n          <div class=\"flex justify-between gap-1 text-xs\">\n            <button\n              type=\"button\"\n              class=\"author flex min-w-0 select-text truncate hover:text-link\"\n              onClick={(ev) => {\n                ev.preventDefault();\n                props?.onShowProfile?.();\n              }}\n            >\n              <span class=\"author flex min-w-0 truncate hover:text-link\">\n                <Show when={(author()?.display_name?.length ?? 0) > 0}>\n                  <div class=\"author-name truncate pr-1 font-bold hover:underline\">\n                    {author()?.display_name}\n                  </div>\n                </Show>\n                <div class=\"author-username truncate text-fg-secondary\">\n                  <Show\n                    when={author()?.name != null}\n                    fallback={`@${npubEncodeFallback(props.authorPubkey)}`}\n                  >\n                    @{author()?.name}\n                  </Show>\n                  {/* TODO <Match when={author()?.nip05 != null}>@{author()?.nip05}</Match> */}\n                </div>\n              </span>\n            </button>\n            <div class=\"created-at shrink-0\">\n              <button\n                type=\"button\"\n                class=\"select-text hover:underline\"\n                onClick={(ev) => {\n                  ev.preventDefault();\n                  props.onShowEvent?.();\n                }}\n                title={createdAtFull()}\n              >\n                {createdAt()}\n              </button>\n            </div>\n          </div>\n          <div\n            ref={elementRef}\n            class=\"overflow-hidden\"\n            classList={{ 'max-h-screen': !showOverflow(), 'max-h-none': showOverflow() }}\n          >\n            {props.content}\n          </div>\n          <Show when={overflow()}>\n            <button\n              class=\"mt-2 w-full rounded border border-border p-2 text-center text-xs text-fg-secondary shadow-sm hover:bg-bg-tertiary hover:shadow\"\n              onClick={(ev) => {\n                ev.stopPropagation();\n                setShowOverflow((current) => !current);\n              }}\n            >\n              <Show when={!showOverflow()} fallback={i18n()('post.hideOverflow')}>\n                {i18n()('post.showOverflow')}\n              </Show>\n            </button>\n          </Show>\n          <div class=\"actions\">{props.actions}</div>\n        </div>\n      </div>\n      <Show when={props.footer}>{props.footer}</Show>\n    </div>\n  );\n};\n\nexport default Post;\n","import { createContext, useContext } from 'solid-js';\n\nimport { type Event as NostrEvent } from 'nostr-tools/pure';\nimport { createStore } from 'solid-js/store';\n\nexport type TimelineContent = {\n  type: 'Replies';\n  event: NostrEvent;\n};\n\nexport type TimelineState = {\n  content?: TimelineContent;\n};\n\nexport type UseTimelineState = {\n  timelineState: TimelineState;\n  setTimeline: (content: TimelineContent) => void;\n  clearTimeline: () => void;\n};\n\nexport const TimelineContext = createContext<UseTimelineState>();\n\nexport const useTimelineContext = () => useContext(TimelineContext);\n\nexport const useTimelineState = (): UseTimelineState => {\n  const [timelineState, setTimelineState] = createStore<TimelineState>({});\n\n  return {\n    timelineState,\n    setTimeline: (content: TimelineContent) => setTimelineState('content', content),\n    clearTimeline: () => setTimelineState('content', undefined),\n  };\n};\n","import { Show, For, createSignal, createMemo, type Component } from 'solid-js';\n\nimport { type Event as NostrEvent } from 'nostr-tools/pure';\n\n// eslint-disable-next-line import/no-cycle\nimport Actions from '@/components/Actions';\n// eslint-disable-next-line import/no-cycle\nimport EventDisplayById from '@/components/event/EventDisplayById';\nimport ContentWarningDisplay from '@/components/event/textNote/ContentWarningDisplay';\nimport GeneralUserMentionDisplay from '@/components/event/textNote/GeneralUserMentionDisplay';\nimport TextNoteContentDisplay from '@/components/event/textNote/TextNoteContentDisplay';\nimport NotePostForm from '@/components/NotePostForm';\nimport Post from '@/components/Post';\nimport { useTimelineContext } from '@/components/timeline/TimelineContext';\nimport LazyLoad from '@/components/utils/LazyLoad';\nimport useModalState from '@/hooks/useModalState';\nimport { useTranslation } from '@/i18n/useTranslation';\nimport { textNote } from '@/nostr/event';\n\nexport type TextNoteProps = {\n  event: NostrEvent;\n  embedding?: boolean;\n  actions?: boolean;\n};\n\nconst TextNote: Component<TextNoteProps> = (props) => {\n  let textAreaRef: HTMLTextAreaElement | undefined;\n\n  const i18n = useTranslation();\n  const { showProfile } = useModalState();\n  const timelineContext = useTimelineContext();\n\n  const [showReplyForm, setShowReplyForm] = createSignal(false);\n  const closeReplyForm = () => setShowReplyForm(false);\n  const toggleReplyForm = () => {\n    setShowReplyForm((current) => !current);\n    if (showReplyForm() && textAreaRef != null) {\n      textAreaRef.focus();\n    }\n  };\n\n  const event = createMemo(() => textNote(props.event));\n\n  const embedding = () => props.embedding ?? true;\n  const actions = () => props.actions ?? true;\n\n  const showReplyEvent = (): string | undefined => {\n    if (embedding()) {\n      const replyingToEvent = event().replyingToEvent();\n\n      if (replyingToEvent != null && !event().containsEventMention(replyingToEvent.id)) {\n        return replyingToEvent.id;\n      }\n\n      const rootEvent = event().rootEvent();\n\n      if (\n        replyingToEvent == null &&\n        rootEvent != null &&\n        !event().containsEventMention(rootEvent.id)\n      ) {\n        return rootEvent.id;\n      }\n    }\n    return undefined;\n  };\n\n  return (\n    <div class=\"nostr-textnote\">\n      <Post\n        authorPubkey={event().pubkey}\n        createdAt={event().createdAtAsDate()}\n        content={\n          <div class=\"textnote-content\">\n            <Show when={showReplyEvent()} keyed>\n              {(id) => (\n                <div class=\"mt-1 rounded border border-border p-1\">\n                  <LazyLoad fallback={<div class=\"h-12\" />}>\n                    {() => <EventDisplayById eventId={id} actions={false} embedding={false} />}\n                  </LazyLoad>\n                </div>\n              )}\n            </Show>\n            <Show when={event().taggedPubkeys().length > 0}>\n              <div class=\"text-xs\">\n                {i18n()('post.replyToPre')}\n                <For each={event().taggedPubkeys()}>\n                  {(replyToPubkey: string) => (\n                    <button\n                      class=\"select-text pr-1 text-link hover:underline\"\n                      onClick={(ev) => {\n                        ev.stopPropagation();\n                        showProfile(replyToPubkey);\n                      }}\n                    >\n                      <GeneralUserMentionDisplay pubkey={replyToPubkey} />\n                    </button>\n                  )}\n                </For>\n                {i18n()('post.replyToPost')}\n              </div>\n            </Show>\n            <ContentWarningDisplay contentWarning={event().contentWarning()}>\n              <div class=\"content whitespace-pre-wrap break-all\">\n                <TextNoteContentDisplay\n                  parsed={event().parsed()}\n                  embedding={embedding()}\n                  initialHidden={event().contentWarning().contentWarning}\n                />\n              </div>\n            </ContentWarningDisplay>\n          </div>\n        }\n        actions={\n          <Show when={actions()}>\n            <LazyLoad fallback={<div class=\"h-5\" />}>\n              {() => <Actions event={props.event} onClickReply={toggleReplyForm} />}\n            </LazyLoad>\n          </Show>\n        }\n        footer={\n          <Show when={showReplyForm()}>\n            <NotePostForm\n              textAreaRef={(el) => {\n                textAreaRef = el;\n              }}\n              mode=\"reply\"\n              replyTo={props.event}\n              onClose={closeReplyForm}\n              onPost={closeReplyForm}\n            />\n          </Show>\n        }\n        onShowProfile={() => {\n          showProfile(event().pubkey);\n        }}\n        onShowEvent={() => {\n          timelineContext?.setTimeline({ type: 'Replies', event: props.event });\n        }}\n      />\n    </div>\n  );\n};\n\nexport default TextNote;\n","import { Switch, Match, Component } from 'solid-js';\n\nimport * as Kind from 'nostr-tools/kinds';\nimport { type Event as NostrEvent } from 'nostr-tools/pure';\n\n// import ChannelInfo from '@/components/event/ChannelInfo';\n// eslint-disable-next-line import/no-cycle\nimport Repost from '@/components/event/Repost';\n// eslint-disable-next-line import/no-cycle\nimport TextNote from '@/components/event/TextNote';\nimport EventLink from '@/components/EventLink';\n\nexport type EventDisplayProps = {\n  event: NostrEvent;\n  embedding?: boolean;\n  actions?: boolean;\n  ensureKinds?: number[];\n};\n\nconst EventDisplay: Component<EventDisplayProps> = (props) => {\n  // noteの場合は kind:1 であることを保証するために利用できる\n  // タイムラインで表示されるべきでないイベントが表示されてしまうのを防ぐ\n  const isAllowedKind = () =>\n    props.ensureKinds == null ||\n    props.ensureKinds.length === 0 ||\n    props.ensureKinds.includes(props.event.kind);\n\n  return (\n    <Switch\n      fallback={\n        <span>\n          <span>未対応のイベント種別（{props.event.kind}）</span>\n          <EventLink eventId={props.event.id} kind={props.event.kind} />\n        </span>\n      }\n    >\n      <Match when={!isAllowedKind()} keyed>\n        <span>\n          予期しないイベント種別（{props.event.kind}）\n          <EventLink eventId={props.event.id} kind={props.event.kind} />\n        </span>\n      </Match>\n      <Match when={props.event.kind === Kind.ShortTextNote}>\n        <TextNote event={props.event} embedding={props.actions} actions={props.actions} />\n      </Match>\n      <Match when={props.event.kind === Kind.Repost}>\n        <Repost event={props.event} />\n      </Match>\n    </Switch>\n  );\n  /*\n      <Match when={props.event.kind === Kind.ChannelCreation}>\n        <ChannelInfo event={props.event} />\n      </Match>\n   */\n};\n\nexport default EventDisplay;\n","import { For, type Component, Show } from 'solid-js';\n\nimport { type Event as NostrEvent } from 'nostr-tools/pure';\n\nimport ColumnItem from '@/components/ColumnItem';\nimport EventDisplay from '@/components/event/EventDisplay';\nimport useConfig from '@/core/useConfig';\n\nexport type TimelineProps = {\n  events: NostrEvent[];\n};\n\nconst Timeline: Component<TimelineProps> = (props) => {\n  const { shouldMuteEvent } = useConfig();\n\n  return (\n    <For each={props.events}>\n      {(event) => (\n        <Show when={!shouldMuteEvent(event)}>\n          <ColumnItem>\n            <EventDisplay event={event} />\n          </ColumnItem>\n        </Show>\n      )}\n    </For>\n  );\n};\n\nexport default Timeline;\n","import { createSignal, createEffect, createMemo, onMount, onCleanup, on } from 'solid-js';\n\nimport uniqBy from 'lodash/uniqBy';\nimport { type Filter } from 'nostr-tools/filter';\nimport { type SubscribeManyParams } from 'nostr-tools/pool';\nimport { type Event as NostrEvent } from 'nostr-tools/pure';\nimport { insertEventIntoDescendingList } from 'nostr-tools/utils';\n\nimport useConfig from '@/core/useConfig';\nimport { sortEvents } from '@/nostr/event/comparator';\nimport usePool from '@/nostr/usePool';\nimport useStats from '@/nostr/useStats';\nimport epoch from '@/utils/epoch';\n\nexport type UseSubscriptionProps = {\n  relayUrls: string[];\n  filters: Filter[];\n  options?: SubscribeManyParams;\n  /**\n   * subscribe not only stored events but also new events published after the subscription\n   * default is true\n   */\n  continuous?: boolean;\n  /**\n   * limit the number of events\n   */\n  limit?: number;\n  /**\n   * limit the number of events until EOSE\n   * This should be same to `limit` of REQ\n   */\n  eoseLimit?: number;\n  clientEventFilter?: (event: NostrEvent) => boolean;\n  onEvent?: (event: NostrEvent & { id: string }) => void;\n  onEOSE?: () => void;\n  signal?: AbortSignal;\n  debugId?: string;\n};\n\nlet count = 0;\n\nconst { setActiveSubscriptions } = useStats();\nsetInterval(() => {\n  setActiveSubscriptions(count);\n}, 1000);\n\nconst useSubscription = (propsProvider: () => UseSubscriptionProps | null) => {\n  const { config, shouldMuteEvent } = useConfig();\n  const pool = usePool();\n  const [events, setEvents] = createSignal<NostrEvent[]>([]);\n  const [eose, setEose] = createSignal<boolean>(false);\n  const props = createMemo(propsProvider);\n\n  const eoseLimit = () => propsProvider()?.eoseLimit ?? 25;\n  const limit = () => propsProvider()?.limit ?? 50;\n\n  createEffect(\n    on(\n      () => [config().mutedPubkeys, config().mutedKeywords],\n      () => {\n        setEvents((currentEvents) => currentEvents.filter((event) => !shouldMuteEvent(event)));\n      },\n      { defer: true },\n    ),\n  );\n\n  onMount(() => {\n    console.debug('subscription mounted', propsProvider()?.debugId, propsProvider());\n    onCleanup(() => {\n      console.debug('subscription unmount', propsProvider()?.debugId, propsProvider());\n    });\n  });\n\n  const addEvent = (event: NostrEvent) => {\n    const SecondsToIgnore = 300; // 5 min\n\n    const diffSec = event.created_at - epoch();\n    if (diffSec > SecondsToIgnore) return;\n    if (diffSec > 0) {\n      setTimeout(() => addEvent(event), diffSec * 1000);\n      return;\n    }\n\n    setEvents((current) => {\n      const sorted = insertEventIntoDescendingList(current, event).slice(0, limit());\n      // FIXME なぜか重複して取得される問題があるが一旦uniqByで対処\n      // https://github.com/syusui-s/rabbit/issues/5\n      const deduped = uniqBy(sorted, (e) => e.id);\n      if (deduped.length !== sorted.length) {\n        console.warn('duplicated event', event);\n      }\n      return deduped;\n    });\n  };\n\n  const startSubscription = () => {\n    console.debug('startSubscription: start');\n\n    const currentProps = props();\n    if (currentProps == null) return;\n    const {\n      relayUrls,\n      filters,\n      options,\n      onEvent,\n      onEOSE,\n      clientEventFilter,\n      continuous = true,\n    } = currentProps;\n    let subscribing = true;\n    count += 1;\n\n    let pushed = false;\n    setEose(false);\n    const storedEvents: NostrEvent[] = [];\n\n    const updateEvents = () => setEvents(sortEvents(storedEvents).slice(0, eoseLimit()));\n\n    const sub = pool().subscribeMany(\n      relayUrls,\n      filters,\n      options ?? {\n        eoseTimeout: 12000,\n        maxWait: 6000,\n        onevent: (event: NostrEvent) => {\n          if (onEvent != null) {\n            onEvent(event as NostrEvent & { id: string });\n          }\n          if (clientEventFilter != null && !clientEventFilter(event)) {\n            return;\n          }\n\n          if (!eose()) {\n            pushed = true;\n            storedEvents.push(event);\n          } else {\n            addEvent(event);\n          }\n        },\n        oneose: () => {\n          // sometimes `oneose` called twice\n          if (eose()) return;\n\n          if (onEOSE != null) {\n            onEOSE();\n          }\n\n          setEose(true);\n          updateEvents();\n          storedEvents.splice(0, storedEvents.length);\n\n          if (!continuous) {\n            sub.close();\n            if (subscribing) {\n              subscribing = false;\n              count -= 1;\n            }\n          }\n        },\n      },\n    );\n\n    // avoid updating an array too rapidly while this is fetching stored events\n    const intervalId = setInterval(() => {\n      if (eose()) {\n        clearInterval(intervalId);\n        return;\n      }\n      if (pushed) {\n        pushed = false;\n        updateEvents();\n      }\n    }, 100);\n\n    onCleanup(() => {\n      console.debug('startSubscription: end');\n      sub.close();\n      if (subscribing) {\n        subscribing = false;\n        count -= 1;\n      }\n      clearInterval(intervalId);\n    });\n  };\n\n  createEffect(\n    on(\n      () => [props()],\n      () => startSubscription(),\n    ),\n  );\n\n  return { events, eose };\n};\n\nexport default useSubscription;\n","import { createMemo } from 'solid-js';\n\nimport { createQuery, useQueryClient, type CreateQueryResult } from '@tanstack/solid-query';\nimport { Event as NostrEvent } from 'nostr-tools/pure';\n\nimport { genericEvent } from '@/nostr/event';\nimport { latestEventQuery } from '@/nostr/query';\nimport { BatchedEventsTask, FollowingsTask, registerTask } from '@/nostr/useBatchedEvents';\n\ntype Following = {\n  pubkey: string;\n  mainRelayUrl?: string;\n  petname?: string;\n};\n\ntype UseFollowingsProps = {\n  pubkey: string;\n};\n\nexport type UseFollowings = {\n  followings: () => Following[];\n  followingPubkeys: () => string[];\n  invalidateFollowings: () => Promise<void>;\n  query: CreateQueryResult<NostrEvent | null>;\n};\n\nconst buildMethods = (dataProvider: () => NostrEvent | undefined | null) => {\n  const followings = () => {\n    const data = dataProvider();\n    if (data == null) return [];\n\n    const result: Following[] = [];\n\n    // TODO zodにする\n    const event = genericEvent(data);\n    event.pTags().forEach((tag) => {\n      const [, followingPubkey, mainRelayUrl, petname] = tag;\n\n      const following: Following = { pubkey: followingPubkey, petname };\n      if (mainRelayUrl != null && mainRelayUrl.length > 0) {\n        following.mainRelayUrl = mainRelayUrl;\n      }\n\n      result.push(following);\n    });\n\n    return result;\n  };\n\n  const followingPubkeys = (): string[] => followings().map((follow) => follow.pubkey);\n\n  return { followings, followingPubkeys, data: dataProvider };\n};\n\nexport const fetchLatestFollowings = async (\n  { pubkey }: UseFollowingsProps,\n  signal?: AbortSignal,\n) => {\n  const task = new BatchedEventsTask<FollowingsTask>({ type: 'Followings', pubkey });\n  registerTask({ task, signal });\n\n  const latestFollowings = await task.latestEventPromise();\n  return buildMethods(() => latestFollowings);\n};\n\nconst useFollowings = (propsProvider: () => UseFollowingsProps | null): UseFollowings => {\n  const queryClient = useQueryClient();\n  const props = createMemo(propsProvider);\n  const genQueryKey = () => ['useFollowings', props()] as const;\n\n  const query = createQuery(() => ({\n    queryKey: genQueryKey(),\n    queryFn: latestEventQuery<ReturnType<typeof genQueryKey>>({\n      taskProvider: ([, currentProps]) => {\n        if (currentProps == null) return null;\n        const { pubkey } = currentProps;\n        return new BatchedEventsTask<FollowingsTask>({ type: 'Followings', pubkey });\n      },\n      queryClient,\n    }),\n    staleTime: 5 * 60 * 1000, // 5 min\n    gcTime: 3 * 24 * 60 * 60 * 1000, // 3 days\n    refetchOnMount: true,\n    refetchOnWindowFocus: false,\n    refetchOnReconnect: false,\n    refetchInterval: 0,\n  }));\n\n  const invalidateFollowings = (): Promise<void> =>\n    queryClient.invalidateQueries({ queryKey: genQueryKey() });\n\n  return { ...buildMethods(() => query.data), invalidateFollowings, query };\n};\n\nexport default useFollowings;\n"],"file":"assets/useFollowings-2b546950.js"}