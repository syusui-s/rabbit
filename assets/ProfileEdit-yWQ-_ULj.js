import{av as Pe,aw as X,ax as Ce,ay as Fe,az as De,aA as Ge,aB as Xe,aC as je,X as Le,aD as Ee,aE as Ke,aa as Me,Y as Oe,g as ze,u as Ze,c as m,a6 as qe,y as He,x as Je,a as _,i as s,S as A,j as b,l as Z,F as Ye,d as We,t as $}from"./index-yaV19nBq.js";import{A as Qe}from"./arrow-left-5-Ocb_Ho.js";import{_ as Ve,a as et,b as Ae,c as tt,d as rt}from"./_baseClone-FlJ-eIqJ.js";import{B as nt}from"./BasicModal-xyOTS5fD.js";import{b as lt,d as it,f as at,t as st,j as ot}from"./SideBar-iy70qhT1.js";import"./usePersistStatus-aZ5kLbOX.js";function dt(t){var e=t==null?0:t.length;return e?t[e-1]:void 0}var ct=dt;function ut(t,e,i){var o=-1,a=t.length;e<0&&(e=-e>a?0:a+e),i=i>a?a:i,i<0&&(i+=a),a=e>i?0:i-e>>>0,e>>>=0;for(var d=Array(a);++o<a;)d[o]=t[o+e];return d}var ft=ut,bt=Pe,gt=ft;function vt(t,e){return e.length<2?t:bt(t,gt(e,0,-1))}var pt=vt,mt=X,_t=ct,$t=pt,ht=Ce;function xt(t,e){return e=mt(e,t),t=$t(t,e),t==null||delete t[ht(_t(e))]}var yt=xt,wt=Fe,St=Ve,Pt=De,Ct="[object Object]",Lt=Function.prototype,Et=Object.prototype,ke=Lt.toString,Ot=Et.hasOwnProperty,At=ke.call(Object);function kt(t){if(!Pt(t)||wt(t)!=Ct)return!1;var e=St(t);if(e===null)return!0;var i=Ot.call(e,"constructor")&&e.constructor;return typeof i=="function"&&i instanceof i&&ke.call(i)==At}var Rt=kt,Tt=Rt;function Nt(t){return Tt(t)?void 0:t}var It=Nt,Bt=Ge;function Ut(t){var e=t==null?0:t.length;return e?Bt(t,1):[]}var Ft=Ut,Dt=Ft,Gt=Xe,Xt=je;function jt(t){return Xt(Gt(t,void 0,Dt),t+"")}var Kt=jt,Mt=Ee,zt=tt,Zt=yt,qt=X,Ht=et,Jt=It,Yt=Kt,Wt=Ae,Qt=1,Vt=2,er=4,tr=Yt(function(t,e){var i={};if(t==null)return i;var o=!1;e=Mt(e,function(d){return d=qt(d,t),o||(o=d.length>1),d}),Ht(t,Wt(t),i),o&&(i=zt(i,Qt|Vt|er,Jt));for(var a=e.length;a--;)Zt(i,e[a]);return i}),rr=tr;const nr=Le(rr);var lr="Expected a function";function ir(t){if(typeof t!="function")throw new TypeError(lr);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}var ar=ir,sr=rt,or=X,dr=Ke,Se=Me,cr=Ce;function ur(t,e,i,o){if(!Se(t))return t;e=or(e,t);for(var a=-1,d=e.length,g=d-1,c=t;c!=null&&++a<d;){var v=cr(e[a]),h=i;if(v==="__proto__"||v==="constructor"||v==="prototype")return t;if(a!=g){var y=c[v];h=o?o(y,v,c):void 0,h===void 0&&(h=Se(y)?y:dr(e[a+1])?[]:{})}sr(c,v,h),c=c[v]}return t}var fr=ur,br=Pe,gr=fr,vr=X;function pr(t,e,i){for(var o=-1,a=e.length,d={};++o<a;){var g=e[o],c=br(t,g);i(c,g)&&gr(d,vr(g,t),c)}return d}var mr=pr,_r=Ee,$r=Oe,hr=mr,xr=Ae;function yr(t,e){if(t==null)return{};var i=_r(xr(t),function(o){return[o]});return e=$r(e),hr(t,i,function(o,a){return e(o,a[0])})}var wr=yr,Sr=Oe,Pr=ar,Cr=wr;function Lr(t,e){return Cr(t,Pr(Sr(e)))}var Er=Lr;const Or=Le(Er),Ar=$('<div class="h-40 w-full shrink-0 sm:h-52"><img alt=header class="h-full w-full object-cover">'),kr=$('<img alt="user icon"class="h-full w-full rounded-lg object-cover">'),Rr=$('<div><div class="ml-4 mt-[-64px] h-28 w-28 rounded-lg shadow-md">'),Tr=$('<div class="px-4 pt-4">'),Nr=$("<div><span class=font-bold></span><div>"),Ir=$('<div><form class="flex flex-col gap-4 p-4"><div class="flex flex-col items-start gap-1"><label class=font-bold for=picture></label><input class="w-full rounded-md border-border bg-bg ring-border focus:border-border focus:ring-primary"type=text id=picture name=picture placeholder=https://....../picture.png></div><div class="flex flex-col items-start gap-1"><label class=font-bold for=picture></label><input class="w-full rounded-md border-border bg-bg focus:border-border focus:ring-primary"type=text id=banner name=banner placeholder=https://....../banner.png></div><div class="flex flex-col items-start gap-1"><label class=font-bold for=name></label><div class="flex w-full items-center gap-2"><span>@</span><input class="flex-1 rounded-md border-border bg-bg ring-border focus:border-border focus:ring-primary"type=text id=name name=name maxlength=32 required></div></div><div class="flex flex-col items-start gap-1"><label class=font-bold for=name></label><input class="w-full rounded-md border-border bg-bg ring-border focus:border-border focus:ring-primary"type=text name=displayName maxlength=32></div><div class="flex flex-col items-start gap-1"><label class=font-bold for=name></label><textarea class="w-full rounded-md border-border bg-bg ring-border focus:border-border focus:ring-primary"name=about rows=5></textarea></div><div class="flex flex-col items-start gap-1"><label class=font-bold for=name></label><input class="w-full rounded-md border-border bg-bg ring-border focus:border-border focus:ring-primary"type=text name=website placeholder=https://....../></div><div class="flex flex-col items-start gap-1"><label class=font-bold for=name></label><input class="w-full rounded-md border-border bg-bg ring-border focus:border-border focus:ring-primary"type=text name=nip05 placeholder=yourname@domain.example.com></div><div class="flex flex-col items-start gap-1"><label class=font-bold for=name></label><span class=text-xs></span><input class="w-full rounded-md border-border bg-bg ring-border focus:border-border focus:ring-primary"type=text name=website pattern=^((LNURL1[AC-HJ-NP-Z02-9]+|lnurl1[ac-hj-np-z02-9]+)|[-_a-zA-Z0-9.]+@[-a-zA-Z0-9.]+)$ placeholder="LNURL1XXXXXX / abcdef@wallet.example.com"></div><div class="flex gap-2"><button type=submit class="rounded p-2 font-bold text-primary-fg hover:bg-primary-hover"></button><button type=button class="rounded border border-primary p-2 font-bold text-primary hover:border-primary-hover hover:text-primary-hover">'),Br=$('<div class="h-24 shrink-0">'),Ur=$('<div class="flex flex-col items-start "><span class="text-sm font-bold"></span><span class="whitespace-pre-wrap break-all text-sm">'),Fr="(LNURL1[AC-HJ-NP-Z02-9]+|lnurl1[ac-hj-np-z02-9]+)",Dr="[-_a-zA-Z0-9.]+@[-a-zA-Z0-9.]+",Gr=new RegExp(`^${Fr}$`),Re=new RegExp(`^${Dr}$`),Xr=t=>Gr.test(t),jr=t=>Re.test(t),Jr=t=>{const e=ze(),i=lt(),{config:o}=Ze(),[a,d]=m(""),[g,c]=m(""),[v,h]=m(""),[y,q]=m(""),[H,J]=m(""),[Y,W]=m(""),[Q,V]=m(""),[S,j]=m(""),{profile:ee,invalidateProfile:Te,query:K}=it(()=>at([i()])(([n])=>({pubkey:n}))),{updateProfile:Ne}=ot(),w=qe(()=>({mutationKey:["updateProfile"],mutationFn:(...n)=>Ne(...n).then(l=>Promise.allSettled(l.map(st(1e4)))),onSuccess:n=>{const l=n.filter(f=>f.status==="fulfilled").length,u=n.length-l;l===n.length?window.alert(e()("profile.edit.updateSucceeded")):l>0?window.alert(e()("profile.edit.failedToUpdatePartially",{count:u})):window.alert(e()("profile.edit.failedToUpdate")),Te().then(()=>K.refetch()).catch(f=>console.error(f)),t.onClose()},onError:n=>{console.error("failed to delete",n)}})),te=()=>K.isPending||w.isPending,p=()=>te(),M=()=>nr(ee(),["picture","banner","name","display_name","about","website","nip05","lud06","lud16"]),Ie=n=>{n.preventDefault();const l=i();if(l==null)return;const u=Or({picture:a(),banner:g(),name:v(),display_name:y(),about:H(),website:Y(),nip05:Q(),lud06:Xr(S())?S():null,lud16:jr(S())?S():null},f=>f==null||f.length===0);w.mutate({relayUrls:o().relayUrls,pubkey:l,profile:u,otherProperties:M()})},x=n=>n.key==="Enter"&&n.preventDefault();return He(()=>{const n=ee();n!=null&&(K.refetch().catch(l=>console.error(l)),Je(()=>{d(l=>n.picture??l),c(l=>n.banner??l),h(l=>n.name??l),q(l=>n.display_name??l),J(l=>n.about??l),W(l=>n.website??l),V(l=>n.nip05??l),n.lud16!=null?j(n.lud16):n.lud06!=null&&j(n.lud06)}))}),_(nt,{closeButton:()=>_(Qe,{}),get onClose(){return t.onClose},get children(){return[(()=>{const n=Rr(),l=n.firstChild;return s(n,_(A,{get when(){return g().length>0},get fallback(){return Br()},keyed:!0,get children(){const u=Ar(),f=u.firstChild;return b(()=>Z(f,"src",g())),u}}),l),s(l,_(A,{get when(){return a().length>0},get children(){const u=kr();return b(()=>Z(u,"src",a())),u}})),n})(),_(A,{get when(){return te()},get children(){const n=Tr();return s(n,()=>e()("general.loading")),n}}),(()=>{const n=Ir(),l=n.firstChild,u=l.firstChild,f=u.firstChild,k=f.nextSibling,re=u.nextSibling,ne=re.firstChild,R=ne.nextSibling,le=re.nextSibling,ie=le.firstChild,Be=ie.nextSibling,Ue=Be.firstChild,T=Ue.nextSibling,ae=le.nextSibling,se=ae.firstChild,N=se.nextSibling,oe=ae.nextSibling,de=oe.firstChild,z=de.nextSibling,ce=oe.nextSibling,ue=ce.firstChild,I=ue.nextSibling,fe=ce.nextSibling,be=fe.firstChild,P=be.nextSibling,ge=fe.nextSibling,ve=ge.firstChild,pe=ve.nextSibling,B=pe.nextSibling,me=ge.nextSibling,C=me.firstChild,_e=C.nextSibling;return l.addEventListener("submit",Ie),s(f,()=>e()("profile.edit.icon")),k.$$keydown=x,k.addEventListener("blur",r=>d(r.currentTarget.value)),s(ne,()=>e()("profile.edit.banner")),R.$$keydown=x,R.addEventListener("blur",r=>c(r.currentTarget.value)),s(ie,()=>e()("profile.edit.name")),T.$$keydown=x,T.addEventListener("change",r=>h(r.currentTarget.value)),s(se,()=>e()("profile.edit.displayName")),N.$$keydown=x,N.addEventListener("change",r=>q(r.currentTarget.value)),s(de,()=>e()("profile.edit.about")),z.addEventListener("change",r=>J(r.currentTarget.value)),s(ue,()=>e()("profile.edit.website")),I.$$keydown=x,I.addEventListener("change",r=>W(r.currentTarget.value)),s(be,()=>e()("profile.edit.nip05")),P.$$keydown=x,P.addEventListener("change",r=>V(r.currentTarget.value)),s(ve,()=>e()("profile.edit.lightningAddress")),s(pe,()=>e()("profile.edit.lightningAddressDescription")),B.$$keydown=x,B.addEventListener("change",r=>j(r.currentTarget.value)),s(l,_(A,{get when(){return Object.entries(M()).length>0},get children(){const r=Nr(),L=r.firstChild,U=L.nextSibling;return s(L,()=>e()("profile.edit.otherProperties")),s(U,_(Ye,{get each(){return Object.entries(M())},children:([F,D])=>(()=>{const E=Ur(),O=E.firstChild,G=O.nextSibling;return s(O,F),s(G,D),E})()})),r}}),me),s(C,()=>e()("profile.edit.save")),_e.$$click=()=>t.onClose(),s(_e,()=>e()("profile.edit.cancel")),s(l,_(A,{get when(){return w.isPending},get children(){return e()("profile.edit.updating")}}),null),b(r=>{const L=p(),U=p(),F=p(),D=p(),E=p(),O=p(),G=Re.source,$e=p(),he=p(),xe=!w.isPending,ye=!!w.isPending,we=w.isPending;return L!==r._v$&&(k.disabled=r._v$=L),U!==r._v$2&&(R.disabled=r._v$2=U),F!==r._v$3&&(T.disabled=r._v$3=F),D!==r._v$4&&(N.disabled=r._v$4=D),E!==r._v$5&&(z.disabled=r._v$5=E),O!==r._v$6&&(I.disabled=r._v$6=O),G!==r._v$7&&Z(P,"pattern",r._v$7=G),$e!==r._v$8&&(P.disabled=r._v$8=$e),he!==r._v$9&&(B.disabled=r._v$9=he),xe!==r._v$10&&C.classList.toggle("bg-primary",r._v$10=xe),ye!==r._v$11&&C.classList.toggle("bg-primary-disabled",r._v$11=ye),we!==r._v$12&&(C.disabled=r._v$12=we),r},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0,_v$5:void 0,_v$6:void 0,_v$7:void 0,_v$8:void 0,_v$9:void 0,_v$10:void 0,_v$11:void 0,_v$12:void 0}),b(()=>k.value=a()),b(()=>R.value=g()),b(()=>T.value=v()),b(()=>N.value=y()),b(()=>z.value=H()),b(()=>I.value=Y()),b(()=>P.value=Q()),b(()=>B.value=S()),n})()]}})};We(["keydown","click"]);export{Jr as default};
//# sourceMappingURL=ProfileEdit-yWQ-_ULj.js.map
