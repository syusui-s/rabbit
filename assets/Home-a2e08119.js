import{s as D,t as g,d as j,c as P,i,a as t,S as T,M as b,b as z,e as K,f as ge,u as he,g as R,h as U,j as oe,k as H,l as le,F as J,m as fe,o as Q,n as ce,p as ve,q as ye}from"./index-af4b9b59.js";import{u as N,T as q,a as xe,b as w,t as ke,c as we,d as Z,A as $e,e as be,f as se,z as W,g as Ce,h as ue,i as ie,C as A,E as _e,K as G,j as Ie,p as Te,r as Ee,k as Se,B as pe,l as Fe,H as Re,m as Ne,n as ae,o as Le,q as Me,s as Pe,U as Be,v as Oe,w as Ue,x as De,y as je,R as qe,D as Ae,F as He,G as ze,I as Ke,M as Qe,J as We,_ as Ve,L as X,N as Ge,O as Je,S as Xe,P as Ye,Q as Ze}from"./SideBar-b9dc213b.js";import{u as en}from"./resolveAsset-8bf392a6.js";const nn=g('<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M17.593 3.322c1.1.128 1.907 1.077 1.907 2.185V21L12 17.25 4.5 21V5.507c0-1.108.806-2.057 1.907-2.185a48.507 48.507 0 0 1 11.186 0z">'),tn=(e={})=>(()=>{const n=nn();return D(n,e,!0,!0),n})(),rn=g('<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5zm0 6a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5zm0 6a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5z">'),me=(e={})=>(()=>{const n=rn();return D(n,e,!0,!0),n})(),on=g('<div class="flex flex-col"><div class="flex h-8 items-center gap-1 px-2"><h2 class="flex flex-1 items-center gap-1"><span class="column-name"></span></h2><button class="h-4 w-4">'),ln=g('<span class="inline-block h-4 w-4 text-gray-700">'),B=e=>{const[n,r]=P(!1),c=()=>r(o=>!o);return(()=>{const o=on(),s=o.firstChild,l=s.firstChild,u=l.firstChild,a=l.nextSibling;return i(l,t(T,{get when(){return e.icon},keyed:!0,children:h=>(()=>{const d=ln();return i(d,h),d})()}),u),i(u,()=>e.name),a.$$click=()=>c(),i(a,t(me,{})),i(o,t(T,{get when(){return n()},get children(){return e.settings()}}),null),o})()};j(["click"]);const cn=e=>{const n=[e.id],r=e.rootEvent()?.id;r!=null&&n.push(r);const c=e.replyingToEvent()?.id;return c!=null&&n.push(c),xe(n)},sn=e=>{const{config:n}=w(),r=()=>ke(e.event),{events:c}=N(()=>({relayUrls:n().relayUrls,filters:[{kinds:[1],ids:cn(r()),limit:25},{kinds:[1],"#e":[e.event.id],limit:25}],limit:200}));return t(q,{get events(){return[...c()].reverse()}})},un=e=>t(z,{get children(){return t(b,{get when(){return e.timelineContent.type==="Replies"&&e.timelineContent},keyed:!0,children:n=>t(sn,{get event(){return n.event}})})}}),an=g('<div class="flex w-[80vw] shrink-0 snap-center snap-always flex-col border-r sm:snap-align-none">'),mn=g('<div class="shrink-0 border-b">'),dn=g('<div class="scrollbar flex flex-col overflow-y-scroll scroll-smooth">'),gn=g('<div class="h-full w-full bg-white"><div class="flex shrink-0 items-center border-b bg-white px-2"><button class="flex w-full items-center gap-1"><div class="inline-block h-4 w-4"></div><div>ホームに戻る</div></button></div><ul class="scrollbar flex h-full flex-col overflow-y-scroll scroll-smooth pb-8">'),L=e=>{let n;const r=we(),c=()=>e.width??"medium";return Z(()=>({commandType:"moveToColumn",handler:o=>{o.command==="moveToColumn"&&o.columnIndex===e.columnIndex&&n?.scrollIntoView({behavior:"smooth",inline:"center"})}})),Z(()=>({commandType:"moveToLastColumn",handler:()=>{e.lastColumn&&n?.scrollIntoView({behavior:"smooth"})}})),t(be.Provider,{value:r,get children(){const o=an(),s=n;return typeof s=="function"?he(s,o):n=o,i(o,t(T,{get when(){return r.timelineState.content},keyed:!0,get fallback(){return[(()=>{const l=mn();return i(l,()=>e.header),l})(),(()=>{const l=dn();return i(l,()=>e.children),l})()]},children:l=>(()=>{const u=gn(),a=u.firstChild,h=a.firstChild,d=h.firstChild,m=a.nextSibling;return h.$$click=()=>r?.clearTimeline(),i(d,t($e,{})),i(m,t(un,{timelineContent:l})),u})()})),K(l=>ge(o,{"sm:w-[500px]":c()==="widest","sm:w-[360px]":c()==="wide","sm:w-[320px]":c()==="medium","sm:w-[280px]":c()==="narrow"},l)),o}})};j(["click"]);const hn=g('<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5 8.25 12l7.5-7.5">'),fn=(e={})=>(()=>{const n=hn();return D(n,e,!0,!0),n})(),vn=g('<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="m8.25 4.5 7.5 7.5-7.5 7.5">'),yn=(e={})=>(()=>{const n=vn();return D(n,e,!0,!0),n})(),xn=g('<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0">'),kn=(e={})=>(()=>{const n=xn();return D(n,e,!0,!0),n})(),wn=g('<div class="flex flex-col gap-2 border-b p-2"><div></div><div>'),$n=g('<div class="scrollbar flex h-9 gap-2 overflow-x-scroll"><button class="rounded-md border px-4 hover:bg-stone-100"></button><button class="rounded-md border px-4 hover:bg-stone-100"></button><button class="rounded-md border px-4 hover:bg-stone-100"></button><button class="rounded-md border px-4 hover:bg-stone-100">'),bn=g('<div class="flex flex-col border-t"><div class="flex h-10 items-center gap-2"><button class="py-4 pl-2"><span class="inline-block h-4 w-4"></span></button><button class="py-4 pr-2"><span class="inline-block h-4 w-4"></span></button><div class="flex-1"></div><button class="px-2 py-4 text-rose-500 hover:text-rose-600"><span class="inline-block h-4 w-4">'),Cn=e=>(()=>{const n=wn(),r=n.firstChild,c=r.nextSibling;return i(r,()=>e.title),i(c,()=>e.children),n})(),M=e=>{const n=R(),{saveColumn:r,removeColumn:c,moveColumn:o}=w(),s=se(),l=a=>{r({...e.column,width:a})},u=a=>{o(e.column.id,a),s({command:"moveToColumn",columnIndex:a}).catch(h=>console.error(h))};return(()=>{const a=bn(),h=a.firstChild,d=h.firstChild,m=d.firstChild,x=d.nextSibling,$=x.firstChild,C=x.nextSibling,k=C.nextSibling,y=k.firstChild;return i(a,t(Cn,{get title(){return n()("column.config.columnWidth")},get children(){const f=$n(),_=f.firstChild,S=_.nextSibling,p=S.nextSibling,I=p.nextSibling;return _.$$click=()=>l("widest"),i(_,()=>n()("column.config.widest")),S.$$click=()=>l("wide"),i(S,()=>n()("column.config.wide")),p.$$click=()=>l("medium"),i(p,()=>n()("column.config.medium")),I.$$click=()=>l("narrow"),i(I,()=>n()("column.config.narrow")),f}}),h),d.$$click=()=>u(e.columnIndex-1),i(m,t(fn,{})),x.$$click=()=>u(e.columnIndex+1),i($,t(yn,{})),k.$$click=()=>c(e.column.id),i(y,t(kn,{})),K(f=>{const _=n()("column.config.moveLeft"),S=n()("column.config.moveRight"),p=n()("column.config.removeColumn"),I=n()("column.config.removeColumn");return _!==f._v$&&U(d,"title",f._v$=_),S!==f._v$2&&U(x,"title",f._v$2=S),p!==f._v$3&&U(k,"title",f._v$3=p),I!==f._v$4&&U(y,"aria-label",f._v$4=I),f},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0}),a})()};j(["click"]);const _n=W.array(W.array(W.string()));class In extends Ce{constructor(n){super(),this.tags=n}}const Tn=e=>{try{const n=_n.parse(JSON.parse(e));return new In(n)}catch(n){throw new TypeError("failed to parse tags schema: ",{cause:n})}},[ee,En]=oe(()=>P({})),[Sn,pn]=oe(()=>P({})),Fn=e=>{const n=ue(),[r,c]=P(null);return H(()=>{const o=e();if(o==null)return;const{encrypted:s}=o;if(s in ee()){c(ee()[s]);return}const l=n();l!=null&&(Sn()[s]||(pn(u=>({...u,[s]:!0})),window.nostr?.nip04?.decrypt?.(l,s)?.then(u=>{En(a=>({...a,[s]:u})),c(u)}).catch(u=>{console.error(`failed to decrypt "${s}"`,u)})))}),r},Rn=e=>{const n=le(()=>ie(e.event)),r=Fn(()=>{const{content:s}=n();return s==null||s.length===0?null:{id:n().id,encrypted:s}}),c=()=>{const s=r();if(s==null)return[];console.log(s);try{return Tn(s).taggedEventIds()}catch(l){return console.warn(l),[]}},o=()=>n().taggedEventIds();return t(J,{get each(){return[...o(),...c()]},children:s=>t(A,{get children(){return t(_e,{eventId:s,get ensureKinds(){return[G.Text]}})}})})},Nn=e=>{const n=fe(),r=le(e),o=Ie(()=>["useFollowings",r()],({queryKey:l,signal:u})=>{console.debug("useFollowings");const[,a]=l;if(a==null)return Promise.resolve(null);const{kind:h,author:d,identifier:m}=a,x=new pe({type:"ParameterizedReplaceableEvent",kind:h,author:d,identifier:m}),$=x.firstEventPromise().catch(()=>{throw new Error(`parameterized replaceable event not found: ${h}:${d}:${m}`)});return x.onUpdate(C=>{const k=Te(C);n.setQueryData(l,k)}),Ee({task:x,signal:u}),Se(15e3,`useParameterizedReplaceableEvent: ${h}:${d}:${m}`)($)},{staleTime:5*60*1e3,cacheTime:4*60*60*1e3});return{event:()=>o.data??null,query:o}},Ln=e=>{const n=R(),{removeColumn:r}=w(),{event:c}=Nn(()=>({kind:30001,author:e.column.pubkey,identifier:e.column.identifier}));return t(L,{get header(){return t(B,{get name(){return e.column.name??n()("column.bookmark")},get icon(){return t(tn,{})},settings:()=>t(M,{get column(){return e.column},get columnIndex(){return e.columnIndex}}),onClose:()=>r(e.column.id)})},get width(){return e.column.width},get columnIndex(){return e.columnIndex},get lastColumn(){return e.lastColumn},get children(){return t(T,{get when(){return c()},keyed:!0,children:o=>t(Rn,{event:o})})}})},E=e=>n=>{switch(e.filterType){case"AND":return e.children.every(r=>E(r)(n));case"OR":return e.children.some(r=>E(r)(n));case"NOT":return!E(e.child)(n);case"Text":return n.includes(e.text);case"Regex":return new RegExp(e.regex,e.flag).test(n);default:console.error("unsupported content filter type");break}return!1},Mn=e=>{const n=R(),{config:r,removeColumn:c}=w(),{followingPubkeys:o}=Fe(()=>({pubkey:e.column.pubkey})),{events:s}=N(()=>{const l=Ne.uniq([...o()]);return l.length===0?null:{debugId:"following",relayUrls:r().relayUrls,filters:[{kinds:[1,6],authors:l,limit:10,since:ae()-4*60*60}],clientEventFilter:u=>e.column.contentFilter==null?!0:E(e.column.contentFilter)(u.content)}});return H(()=>{console.log("home",s())}),Q(()=>console.log("home timeline mounted")),ce(()=>console.log("home timeline unmounted")),t(L,{get header(){return t(B,{get name(){return e.column.name??n()("column.home")},get icon(){return t(Re,{})},settings:()=>t(M,{get column(){return e.column},get columnIndex(){return e.columnIndex}}),onClose:()=>c(e.column.id)})},get width(){return e.column.width},get columnIndex(){return e.columnIndex},get lastColumn(){return e.lastColumn},get children(){return t(q,{get events(){return s()}})}})},Pn=g('<span class="h-4 w-4 pt-[1px] text-rose-400">'),Bn=g('<img alt="icon" class="rounded">'),On=g('<div class="flex gap-1 px-1 text-sm"><div class="notification-icon flex max-w-[64px] place-items-center"></div><div class="notification-user flex gap-1 overflow-hidden"><div class="author-icon h-5 w-5 shrink-0 overflow-hidden object-cover"></div><div class="flex-1 overflow-hidden"><button class="truncate font-bold hover:text-blue-500 hover:underline">'),Un=g('<div class="notification-event py-1">'),Dn=g('<span class="truncate">'),jn=g('<div class="truncate">読み込み中 '),qn=e=>{const n=R(),{shouldMuteEvent:r}=w(),{showProfile:c}=Ue(),o=()=>ie(e.event),s=()=>o().lastTaggedEventId(),{profile:l}=Le(()=>({pubkey:e.event.pubkey})),{event:u,query:a}=Me(()=>De([s()])(([d])=>({eventId:d}))),h=()=>a.isSuccess&&u()==null;return t(T,{get when(){return!h()||r(e.event)},get children(){return[(()=>{const d=On(),m=d.firstChild,x=m.nextSibling,$=x.firstChild,C=$.nextSibling,k=C.firstChild;return i(m,t(z,{get fallback(){return(()=>{const y=Dn();return i(y,()=>e.event.content),y})()},get children(){return t(b,{get when(){return e.event.content==="+"},get children(){const y=Pn();return i(y,t(Pe,{})),y}})}})),i($,t(T,{get when(){return l()?.picture!=null},get children(){const y=Bn();return K(()=>U(y,"src",l()?.picture)),y}})),k.$$click=()=>c(e.event.pubkey),i(k,t(Be,{get pubkey(){return e.event.pubkey}})),i(C,()=>n()("notification.reacted"),null),d})(),(()=>{const d=Un();return i(d,t(T,{get when(){return u()},get fallback(){return(()=>{const m=jn();return m.firstChild,i(m,s,null),m})()},keyed:!0,children:m=>t(Oe,{event:m})})),d})()]}})};j(["click"]);const An=g("<div>unknown event"),de=e=>{const{shouldMuteEvent:n}=w();return t(J,{get each(){return e.events},children:r=>t(T,{get when(){return!n(r)},get children(){return t(z,{get fallback(){return An()},get children(){return[t(b,{get when(){return r.kind===G.Text},get children(){return t(A,{get children(){return t(je,{event:r})}})}}),t(b,{get when(){return r.kind===G.Reaction},get children(){return t(A,{get children(){return t(qn,{event:r})}})}}),t(b,{get when(){return r.kind===6},get children(){return t(A,{get children(){return t(qe,{event:r})}})}})]}})}})})},Hn=e=>{const n=R(),{config:r,removeColumn:c}=w(),{events:o}=N(()=>({relayUrls:r().relayUrls,filters:[{kinds:[1,6,7],"#p":[e.column.pubkey],limit:10}],clientEventFilter:s=>e.column.contentFilter==null?!0:E(e.column.contentFilter)(s.content)}));return t(L,{get header(){return t(B,{get name(){return e.column.name??n()("column.notification")},get icon(){return t(Ae,{})},settings:()=>t(M,{get column(){return e.column},get columnIndex(){return e.columnIndex}}),onClose:()=>c(e.column.id)})},get width(){return e.column.width},get columnIndex(){return e.columnIndex},get lastColumn(){return e.lastColumn},get children(){return t(de,{get events(){return o()}})}})},zn=e=>{const n=R(),{config:r,removeColumn:c}=w(),{events:o}=N(()=>({relayUrls:r().relayUrls,filters:[{kinds:[1,6],authors:[e.column.pubkey],limit:10}],clientEventFilter:s=>e.column.contentFilter==null?!0:E(e.column.contentFilter)(s.content)}));return t(L,{get header(){return t(B,{get name(){return e.column.name??n()("column.posts")},get icon(){return t(He,{})},settings:()=>t(M,{get column(){return e.column},get columnIndex(){return e.columnIndex}}),onClose:()=>c(e.column.id)})},get width(){return e.column.width},get columnIndex(){return e.columnIndex},get lastColumn(){return e.lastColumn},get children(){return t(q,{get events(){return o()}})}})},Kn=e=>{const n=R(),{config:r,removeColumn:c}=w(),{events:o}=N(()=>({relayUrls:r().relayUrls,filters:[{kinds:[7],authors:[e.column.pubkey],limit:10}],clientEventFilter:s=>e.column.contentFilter==null?!0:E(e.column.contentFilter)(s.content)}));return t(L,{get header(){return t(B,{get name(){return e.column.name??n()("column.reactions")},get icon(){return t(ze,{})},settings:()=>t(M,{get column(){return e.column},get columnIndex(){return e.columnIndex}}),onClose:()=>c(e.column.id)})},get width(){return e.column.width},get columnIndex(){return e.columnIndex},get lastColumn(){return e.lastColumn},get children(){return t(de,{get events(){return o()}})}})},Qn=e=>{const n=R(),{removeColumn:r}=w(),{events:c}=N(()=>({relayUrls:e.column.relayUrls,filters:[{kinds:[1,6],limit:25,since:ae()-4*60*60}],clientEventFilter:o=>e.column.contentFilter==null?!0:E(e.column.contentFilter)(o.content)}));return t(L,{get header(){return t(B,{get name(){return e.column.name??n()("column.relay")},get icon(){return t(Ke,{})},settings:()=>t(M,{get column(){return e.column},get columnIndex(){return e.columnIndex}}),onClose:()=>r(e.column.id)})},get width(){return e.column.width},get columnIndex(){return e.columnIndex},get lastColumn(){return e.lastColumn},get children(){return t(q,{get events(){return c()}})}})},Wn=g('<div class="flex flex-col"><div class="flex h-8 items-center gap-1 px-2"><h2 class="flex items-center gap-1"><span class="inline-block h-4 w-4 text-gray-700"></span></h2><form class="flex-1"><input class="w-full rounded border border-stone-300 px-1 py-0 focus:border-rose-100 focus:ring-rose-300" type="text" name="query"></form><button class="h-4 w-4">'),Vn=e=>{const[n,r]=P(!1),[c,o]=P(""),{saveColumn:s}=w(),l=()=>r(m=>!m),u=()=>{c()!==e.column.query&&s({...e.column,query:c()})},a=()=>{u()},h=m=>{o(m.currentTarget.value)},d=m=>{m.preventDefault(),u()};return Q(()=>{o(e.column.query)}),(()=>{const m=Wn(),x=m.firstChild,$=x.firstChild,C=$.firstChild,k=$.nextSibling,y=k.firstChild,f=k.nextSibling;return i(C,t(Qe,{})),k.addEventListener("submit",d),y.addEventListener("blur",a),y.addEventListener("change",h),f.$$click=()=>l(),i(f,t(me,{})),i(m,t(T,{get when(){return n()},get children(){return e.settings()}}),null),K(()=>y.value=c()),m})()},Gn=e=>{const{removeColumn:n}=w(),{events:r}=N(()=>{const{query:c}=e.column;return c.length===0?null:{relayUrls:We,filters:[{kinds:[1,6],search:c,limit:25}],clientEventFilter:o=>o.tags.findIndex(([s])=>s==="mostr")>=0?!1:e.column.contentFilter==null?!0:E(e.column.contentFilter)(o.content)}});return t(L,{get header(){return t(Vn,{get column(){return e.column},settings:()=>t(M,{get column(){return e.column},get columnIndex(){return e.columnIndex}}),onClose:()=>n(e.column.id)})},get width(){return e.column.width},get columnIndex(){return e.columnIndex},get lastColumn(){return e.lastColumn},get children(){return t(q,{get events(){return r()}})}})};j(["click"]);const Jn=g('<div class="flex h-full snap-x snap-mandatory flex-row overflow-scroll scroll-smooth">'),Xn=()=>{const{config:e}=w();return(()=>{const n=Jn();return i(n,t(J,{get each(){return e().columns},children:(r,c)=>{const o=()=>c()+1,s=()=>o()===e().columns.length;return t(z,{get children(){return[t(b,{get when(){return r.columnType==="Following"&&r},keyed:!0,children:l=>t(Mn,{column:l,get columnIndex(){return o()},get lastColumn(){return s()}})}),t(b,{get when(){return r.columnType==="Notification"&&r},keyed:!0,children:l=>t(Hn,{column:l,get columnIndex(){return o()},get lastColumn(){return s()}})}),t(b,{get when(){return r.columnType==="Posts"&&r},keyed:!0,children:l=>t(zn,{column:l,get columnIndex(){return o()},get lastColumn(){return s()}})}),t(b,{get when(){return r.columnType==="Reactions"&&r},keyed:!0,children:l=>t(Kn,{column:l,get columnIndex(){return o()},get lastColumn(){return s()}})}),t(b,{get when(){return r.columnType==="Relays"&&r},keyed:!0,children:l=>t(Qn,{column:l,get columnIndex(){return o()},get lastColumn(){return s()}})}),t(b,{get when(){return r.columnType==="Bookmark"&&r},keyed:!0,children:l=>t(Ln,{column:l,get columnIndex(){return o()},get lastColumn(){return s()}})}),t(b,{get when(){return r.columnType==="Search"&&r},keyed:!0,children:l=>t(Gn,{column:l,get columnIndex(){return o()},get lastColumn(){return s()}})})]}})}})),n})()};var Yn=Ve,Zn=function(){return Yn.Date.now()},et=Zn,nt=/\s/;function tt(e){for(var n=e.length;n--&&nt.test(e.charAt(n)););return n}var rt=tt,ot=rt,lt=/^\s+/;function ct(e){return e&&e.slice(0,ot(e)+1).replace(lt,"")}var st=ct,ut=st,ne=X,it=Ge,te=0/0,at=/^[-+]0x[0-9a-f]+$/i,mt=/^0b[01]+$/i,dt=/^0o[0-7]+$/i,gt=parseInt;function ht(e){if(typeof e=="number")return e;if(it(e))return te;if(ne(e)){var n=typeof e.valueOf=="function"?e.valueOf():e;e=ne(n)?n+"":n}if(typeof e!="string")return e===0?e:+e;e=ut(e);var r=mt.test(e);return r||dt.test(e)?gt(e.slice(2),r?2:8):at.test(e)?te:+e}var ft=ht,vt=X,V=et,re=ft,yt="Expected a function",xt=Math.max,kt=Math.min;function wt(e,n,r){var c,o,s,l,u,a,h=0,d=!1,m=!1,x=!0;if(typeof e!="function")throw new TypeError(yt);n=re(n)||0,vt(r)&&(d=!!r.leading,m="maxWait"in r,s=m?xt(re(r.maxWait)||0,n):s,x="trailing"in r?!!r.trailing:x);function $(v){var F=c,O=o;return c=o=void 0,h=v,l=e.apply(O,F),l}function C(v){return h=v,u=setTimeout(f,n),d?$(v):l}function k(v){var F=v-a,O=v-h,Y=n-F;return m?kt(Y,s-O):Y}function y(v){var F=v-a,O=v-h;return a===void 0||F>=n||F<0||m&&O>=s}function f(){var v=V();if(y(v))return _(v);u=setTimeout(f,k(v))}function _(v){return u=void 0,x&&c?$(v):(c=o=void 0,l)}function S(){u!==void 0&&clearTimeout(u),h=0,c=a=o=u=void 0}function p(){return u===void 0?l:_(V())}function I(){var v=V(),F=y(v);if(c=arguments,o=this,a=v,F){if(u===void 0)return C(a);if(m)return clearTimeout(u),u=setTimeout(f,n),$(a)}return u===void 0&&(u=setTimeout(f,n)),l}return I.cancel=S,I.flush=p,I}var $t=wt,bt=$t,Ct=X,_t="Expected a function";function It(e,n,r){var c=!0,o=!0;if(typeof e!="function")throw new TypeError(_t);return Ct(r)&&(c="leading"in r?!!r.leading:c,o="trailing"in r?!!r.trailing:o),bt(e,n,{leading:c,maxWait:n,trailing:o})}var Tt=It;const Et=Je(Tt),St=[{key:"n",command:{command:"openPostForm"}},{key:"h",command:{command:"moveToPrevColumn"}},{key:"j",command:{command:"moveToNextItem"}},{key:"k",command:{command:"moveToPrevItem"}},{key:"l",command:{command:"moveToNextColumn"}},{key:"1",command:{command:"moveToColumn",columnIndex:1}},{key:"2",command:{command:"moveToColumn",columnIndex:2}},{key:"3",command:{command:"moveToColumn",columnIndex:3}},{key:"4",command:{command:"moveToColumn",columnIndex:4}},{key:"5",command:{command:"moveToColumn",columnIndex:5}},{key:"6",command:{command:"moveToColumn",columnIndex:6}},{key:"7",command:{command:"moveToColumn",columnIndex:7}},{key:"8",command:{command:"moveToColumn",columnIndex:8}},{key:"9",command:{command:"moveToColumn",columnIndex:9}},{key:"0",command:{command:"moveToLastColumn"}},{key:"ArrowLeft",command:{command:"moveToPrevColumn"}},{key:"ArrowDown",command:{command:"moveToNextItem"}},{key:"ArrowUp",command:{command:"moveToPrevItem"}},{key:"ArrowRight",command:{command:"moveToNextColumn"}},{key:"f",command:{command:"like"}},{key:"t",command:{command:"repost"}},{key:"r",command:{command:"openReplyForm"}},{key:"?",command:{command:"openHelp"}},{key:"Enter",command:{command:"openItemDetail"}},{key:"Backspace",command:{command:"closeItemDetail"}}],pt=e=>{const n=new Map;return e.forEach(r=>{n.set(r.key,r)}),n},Ft=({shortcuts:e=St,onShortcut:n})=>{const r=pt(e);Q(()=>{const c=Et(o=>{if(o.type!=="keydown"||o.ctrlKey||o.altKey||o.metaKey||o.target instanceof HTMLTextAreaElement||o.target instanceof HTMLInputElement)return;const s=r.get(o.key);s!=null&&n(s)},50);window.addEventListener("keydown",c),ce(()=>{window.removeEventListener("keydown",c)})})},Rt=()=>{const e=se();Ft({onShortcut:n=>{e(n.command).then(()=>console.debug(`shortcut key '${n.key}' was processed successfully`),r=>console.error(r))}})},Nt=g('<div class="absolute inset-0 flex w-screen touch-manipulation flex-row overflow-hidden">'),Bt=()=>{Rt();const e=ve(),{persistStatus:n}=en(),r=Ze(),{config:c,initializeColumns:o}=w(),s=ue();return H(()=>{c().relayUrls.map(async l=>{try{(await r().ensureRelay(l)).on("notice",a=>{console.error(`NOTICE: ${l}: ${a}`)})}catch(u){console.error("ensureRelay failed",u)}})}),H(()=>{const l=s();l!=null&&o({pubkey:l})}),Q(()=>{n().loggedIn||e("/hello")}),ye(l=>{console.error("uncaught error: ",l)}),(()=>{const l=Nt();return i(l,t(Xe,{}),null),i(l,t(Xn,{}),null),i(l,t(Ye,{}),null),l})()};export{Bt as default};
//# sourceMappingURL=Home-a2e08119.js.map
