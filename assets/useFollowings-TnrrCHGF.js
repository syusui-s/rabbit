import{i as d,t as h,s as j,a as r,h as w,ar as Se,as as nt,v as p,z,u as P,at as rt,j as S,M as x,ad as ot,S as B,c as R,r as O,B as H,q as Te,d as M,w as Me,f as E,F as N,m as A,y as Q,C as Z,a8 as se,D as le,_ as ie,b as T,n as J,x as ce,ah as st,ak as lt,o as Ie,ag as it,af as ct,U as at,l as ut,E as dt,au as he}from"./index-6GcGm1j7.js";import{r as Pe,t as X,B as V,g as ee,U as gt,h as ae,s as ht,v as De,q as ue,b as te,w as ft,k as vt,P as $t,E as mt,f as Le,o as Fe,a as yt,l as bt,N as wt,x as _t,y as fe,e as kt,n as pt,z as xt}from"./SideBar-my2KE9jO.js";import{L as U}from"./LazyLoad-CCWC6YyF.js";import{S as L}from"./SafeLink-2J2WPo4Q.js";import{t as qe,a as Ue,p as Et,b as Rt,c as Ct,i as St}from"./url-4UJeT0bq.js";const Tt=h('<div class="block shrink-0 overflow-hidden border-b border-border p-1">'),Mt=e=>(()=>{const t=Tt();return d(t,()=>e.children),t})(),It=h('<svg xmlns=http://www.w3.org/2000/svg fill=none stroke=currentColor stroke-width=1.5 aria-hidden=true data-slot=icon viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round d="M19.5 12c0-1.232-.046-2.453-.138-3.662a4.006 4.006 0 0 0-3.7-3.7 48.678 48.678 0 0 0-7.324 0 4.006 4.006 0 0 0-3.7 3.7c-.017.22-.032.441-.046.662M19.5 12l3-3m-3 3-3-3m-12 3c0 1.232.046 2.453.138 3.662a4.006 4.006 0 0 0 3.7 3.7 48.656 48.656 0 0 0 7.324 0 4.006 4.006 0 0 0 3.7-3.7c.017-.22.032-.441.046-.662M4.5 12l3 3m-3-3-3 3">'),Ae=(e={})=>(()=>{const t=It();return j(t,e,!0,!0),t})(),Pt=h('<button class="text-link underline">'),Dt=e=>{try{return Se(e)}catch(t){return console.error("failed to encode event id into Bech32 entity (NIP-19) but ignore",e,t),e}},Lt=e=>{try{return nt({id:e})}catch(t){return console.error("failed to encode event id into Bech32 entity (NIP-19) but ignore",e,t),e}},W=e=>(()=>{const t=Pt();return d(t,r(w,{get when(){return e.kind==null||e.kind===1},get fallback(){return Lt(e.eventId)},get children(){return Dt(e.eventId)}})),t})(),Ft=e=>{const t=p(e),n=z(()=>({queryKey:["useEvent",t()],queryFn:({queryKey:a,signal:l})=>{const[,o]=a;if(o==null)return null;const{eventId:s}=o,c=new V({type:"Event",eventId:s}),u=c.firstEventPromise().catch(()=>{throw new Error(`event not found: ${s}`)});return Pe({task:c,signal:l}),X(15e3,`useEvent: ${s}`)(u)},staleTime:4*60*60*1e3,gcTime:4*60*60*1e3,refetchOnWindowFocus:!1,refetchOnMount:!1}));return{event:()=>n.data??null,query:n}},qt=h("<span>"),Ut=h("<div class=truncate> "),K=e=>{const t=P(),[n,i]=rt(e,["eventId"]),{shouldMuteEvent:a}=S(),{event:l,query:o}=Ft(()=>ee([n.eventId])(([c])=>({eventId:c}))),s=()=>{const c=l();return c!=null&&a(c)};return r(B,{get fallback(){return(()=>{const c=qt();return d(c,()=>t.t("post.failedToFetchEvent"),null),d(c,()=>e.eventId,null),c})()},get children(){return[r(x,{get when(){return s()},children:null}),r(x,{get when(){return l()},keyed:!0,children:c=>r(et,ot({event:c},i))}),r(x,{get when(){return o.isLoading&&n.eventId},keyed:!0,children:c=>(()=>{const u=Ut(),g=u.firstChild;return d(u,()=>t.t("general.loading"),g),d(u,r(W,{eventId:c}),null),u})()})]}})},je=e=>{const[t,n]=R(new Date);return O(()=>{const i=setInterval(()=>{n(new Date)},e().interval);H(()=>clearInterval(i))}),t},At=e=>{switch(e.kind){case"now":return"now";case"seconds":return`${e.value}s`;case"minutes":return`${e.value}m`;case"hours":return`${e.value}h`;case"days":return`${e.value}d`;case"abs":default:return e.value.toLocaleDateString()}},ve=e=>`${e.getHours()}:${e.getMinutes().toString().padStart(2,"0")}`,jt=e=>{switch(e.kind){case"today":return e.value.toLocaleTimeString();case"yesterday":case"abs":default:return e.value.toLocaleString()}},Bt=e=>{switch(e.kind){case"today":return ve(e.value);case"yesterday":return`昨日 ${ve(e.value)}`;case"abs":default:return e.value.toLocaleString()}},Ot=(e,t)=>Math.round(Number(t)-Number(e))/1e3,Ht=(e,t)=>{const n=Ot(e,t);return n<10?{kind:"now"}:n<60?{kind:"seconds",value:Math.round(n)}:n<3600?{kind:"minutes",value:Math.round(n/60)}:n<86400?{kind:"hours",value:Math.round(n/3600)}:n<604800?{kind:"days",value:Math.round(n/86400)}:{kind:"abs",value:e}},$e=(e,t)=>e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate(),Wt=e=>new Date(+e-24*60*60*1e3),Be=(e,t,n)=>$e(e,t)?n({kind:"today",value:e}):$e(e,Wt(t))?n({kind:"yesterday",value:e}):n({kind:"abs",value:e}),Kt=(e,t=new Date)=>Be(e,t,jt),zt=(e,t=new Date)=>Be(e,t,Bt),me=(e,t=new Date,n=At)=>n(Ht(e,t)),ye=Te(()=>je(()=>({interval:7e3}))),be=Te(()=>je(()=>({interval:60*1e3}))),Oe=()=>{const{config:e}=S();return t=>{switch(e().dateFormat){case"absolute-long":return Kt(t,be());case"absolute-short":return zt(t,be());case"relative":return me(t,ye());default:return me(t,ye())}}},Nt=h('<div><div class="flex items-center gap-1"><div class="flex shrink-0 place-items-center pl-[2px]"aria-hidden=true><span class="size-4 text-r-repost"></span></div><div class="notification-user flex min-w-0 flex-1 overflow-hidden text-xs"><button class="select-text truncate hover:text-link hover:underline"></button><span class=shrink-0></span></div><div class=text-xs></div></div><div class=pt-1>'),Qt=e=>{const t=P(),{showProfile:n}=ae(),i=Oe(),a=p(()=>Me(e.event)),l=()=>a().lastTaggedEventId();return(()=>{const o=Nt(),s=o.firstChild,c=s.firstChild,u=c.firstChild,g=c.nextSibling,v=g.firstChild,b=v.nextSibling,$=g.nextSibling,m=s.nextSibling;return d(u,r(Ae,{})),v.$$click=()=>n(e.event.pubkey),d(v,r(gt,{get pubkey(){return e.event.pubkey}})),d(b,()=>t.t("notification.reposted")),d($,()=>i(a().createdAtAsDate())),d(m,r(K,{get eventId(){return l()}})),o})()};M(["click"]);const Vt=h('<svg xmlns=http://www.w3.org/2000/svg fill=none stroke=currentColor stroke-width=1.5 aria-hidden=true data-slot=icon viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round d="m3.75 13.5 10.5-11.25L12 10.5h8.25L9.75 21.75 12 13.5z">'),Gt=(e={})=>(()=>{const t=Vt();return j(t,e,!0,!0),t})(),Yt=h('<svg xmlns=http://www.w3.org/2000/svg fill=none stroke=currentColor stroke-width=1.5 aria-hidden=true data-slot=icon viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round d="M2.25 12.76c0 1.6 1.123 2.994 2.707 3.227 1.087.16 2.185.283 3.293.369V21l4.076-4.076a1.526 1.526 0 0 1 1.037-.443 48.282 48.282 0 0 0 5.68-.494c1.584-.233 2.707-1.626 2.707-3.228V6.741c0-1.602-1.123-2.995-2.707-3.228A48.394 48.394 0 0 0 12 3c-2.392 0-4.744.175-7.043.513C3.373 3.746 2.25 5.14 2.25 6.741z">'),Zt=(e={})=>(()=>{const t=Yt();return j(t,e,!0,!0),t})(),Jt=h('<svg xmlns=http://www.w3.org/2000/svg fill=none stroke=currentColor stroke-width=1.5 aria-hidden=true data-slot=icon viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round d="M6.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0m6 0a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0m6 0a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0">'),Xt=(e={})=>(()=>{const t=Jt();return j(t,e,!0,!0),t})(),en=h('<svg xmlns=http://www.w3.org/2000/svg fill=currentColor aria-hidden=true data-slot=icon viewBox="0 0 24 24"><path d="m11.645 20.91-.007-.003-.022-.012a15.247 15.247 0 0 1-.383-.218 25.18 25.18 0 0 1-4.244-3.17C4.688 15.36 2.25 12.174 2.25 8.25 2.25 5.322 4.714 3 7.688 3A5.5 5.5 0 0 1 12 5.052 5.5 5.5 0 0 1 16.313 3c2.973 0 5.437 2.322 5.437 5.25 0 3.925-2.438 7.111-4.739 9.256a25.175 25.175 0 0 1-4.244 3.17 15.247 15.247 0 0 1-.383.219l-.022.012-.007.004-.003.001a.752.752 0 0 1-.704 0l-.003-.001Z">'),He=(e={})=>(()=>{const t=en();return j(t,e,!0,!0),t})(),tn=h('<span class="inline-block size-4 pt-[1px] text-r-reaction">'),we=h("<span class=truncate>"),nn=h('<img class="h-4 max-w-[6rem]">'),rn=e=>e.type==="LikeDislike"&&e.content==="+",We=e=>r(B,{get fallback(){return(()=>{const t=we();return d(t,()=>e.reactionTypes.content),t})()},get children(){return[r(x,{get when(){return rn(e.reactionTypes)},get children(){const t=tn();return d(t,r(He,{})),t}}),r(x,{get when(){return e.reactionTypes.type==="Emoji"&&e.reactionTypes},keyed:!0,children:({content:t})=>(()=>{const n=we();return d(n,t),n})()}),r(x,{get when(){return e.reactionTypes.type==="CustomEmoji"&&e.reactionTypes},keyed:!0,children:({shortcode:t,url:n})=>(()=>{const i=nn();return E(i,"src",n),E(i,"alt",`:${t}:`),i})()})]}}),on=h('<svg xmlns=http://www.w3.org/2000/svg fill=none stroke=currentColor stroke-width=1.5 aria-hidden=true data-slot=icon viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round d="m8.25 4.5 7.5 7.5-7.5 7.5">'),sn=(e={})=>(()=>{const t=on();return j(t,e,!0,!0),t})(),ln=h('<li class="border-b border-border hover:bg-bg-tertiary"><button class="w-full px-4 py-1 text-start">'),cn=h('<li class="border-b border-border hover:bg-bg-tertiary"><button class="flex w-full items-center py-1 pe-2 ps-4 text-start"><span class=flex-1></span><span class="inline-block size-4 shrink-0">'),an=h('<ul class="min-w-[96px] rounded border border-border bg-bg shadow-md">'),un=e=>{const t=()=>{e.item?.onSelect?.(),e.onClose()};return(()=>{const n=ln(),i=n.firstChild;return i.$$click=t,d(i,()=>e.item.content),n})()},dn=e=>{const t=Ke(()=>({menu:e.submenu.items,position:"right"})),n=()=>{t.open()};return(()=>{const i=cn(),a=i.firstChild,l=a.firstChild,o=l.nextSibling,s=t.targetRef;return typeof s=="function"?A(s,i):t.targetRef=i,a.$$click=n,d(l,()=>e.submenu.content),d(o,r(sn,{})),d(i,()=>t.popup(),null),i})()},gn=e=>"onSelect"in e?e:null,hn=e=>"items"in e?e:null,Ke=e=>{const t=p(e),n=ht(()=>({ensureWidth:300,...t(),popup:(()=>{const i=an();return d(i,r(N,{get each(){return t().menu.filter(a=>a.when==null||a.when())},children:a=>r(B,{get children(){return[r(x,{get when(){return gn(a)},keyed:!0,children:l=>r(un,{item:l,onClose:()=>n.close()})}),r(x,{get when(){return hn(a)},keyed:!0,children:l=>r(dn,{submenu:l,onClose:()=>n.close()})})]}})})),i})()}));return n};M(["click"]);const fn=/\p{Emoji_Presentation}/u,ze=e=>["useReactions",e],de=e=>{const{shouldMuteEvent:t}=S(),n=Q(),i=p(()=>ze(e())),a=z(()=>({queryKey:i(),queryFn:De({taskProvider:([,u])=>{if(u==null)return null;const{eventId:g}=u;return new V({type:"Reactions",mentionedEventId:g})},queryClient:n}),staleTime:1*60*1e3,gcTime:4*60*60*1e3,refetchInterval:1*60*1e3})),l=()=>(a.data??[]).filter(g=>!t(g));return{reactions:l,reactionsGrouped:()=>{const u=new Map;return l().forEach(g=>{const v=Z(g).isCustomEmoji()?`${g.content}${Z(g).getUrl()??""}`:g.content,b=u.get(v)??[];b.push(g),u.set(v,b)}),u},isReactedBy:u=>l().findIndex(g=>g.pubkey===u)!==-1,isReactedByWithEmoji:u=>l().findIndex(g=>g.pubkey===u&&fn.test(g.content))!==-1,query:a}},Ne=e=>{const t=Q(),n=p(e),i=ue();return se(()=>({mutationKey:["useReactionMutation",n().eventId],mutationFn:(...l)=>i.publishReaction(...l).then(o=>Promise.allSettled(o.map(X(5e3)))),onSuccess:l=>{const o=l.filter(c=>c.status==="fulfilled").length,s=l.length-o;o===l.length?console.log("Succeeded to publish a reaction"):o>0?console.warn(`failed to publish a reaction on ${s} relays`):console.error("failed to publish reaction on all relays")},onError:l=>{console.error("failed to publish reaction: ",l)},onSettled:()=>{const l=ze({eventId:n().eventId});t.refetchQueries({queryKey:l}).then(()=>t.invalidateQueries({queryKey:l})).catch(o=>console.error("failed to refetch reactions",o))}}))},Qe=e=>["useReposts",e],Ve=e=>{const{shouldMuteEvent:t}=S(),n=Q(),i=p(e),a=p(()=>Qe(i())),l=z(()=>({queryKey:a(),queryFn:De({taskProvider:([,c])=>{if(c==null)return null;const{eventId:u}=c;return new V({type:"Reposts",mentionedEventId:u})},queryClient:n}),staleTime:1*60*1e3,gcTime:4*60*60*1e3,refetchInterval:1*60*1e3})),o=()=>(l.data??[]).filter(u=>!t(u));return{reposts:o,isRepostedBy:c=>o().findIndex(u=>u.pubkey===c)!==-1,query:l}},vn=e=>{const t=Q(),n=p(e),i=ue();return se(()=>({mutationKey:["useRepostMutation",n().eventId],mutationFn:(...l)=>i.publishRepost(...l).then(o=>Promise.allSettled(o.map(X(1e4)))),onSuccess:l=>{const o=l.filter(c=>c.status==="fulfilled").length,s=l.length-o;o===l.length?console.log("Succeeded to publish a repost"):o>0?console.warn(`Failed to publish a repost on ${s} relays`):console.error("Failed to publish a repost on all relays")},onError:l=>{console.error("failed to publish repost: ",l)},onSettled:()=>{const l=Qe({eventId:n().eventId});t.refetchQueries({queryKey:l}).then(()=>t.invalidateQueries({queryKey:l})).catch(o=>console.error("failed to refetch repost",o))}}))},_e=["k","M","G","T","P"],$n=(e,t)=>{const n=t?.precision??3;if(n<=0)throw new Error(`precision is too small: ${n}`);const a=10**((t?.minDigits??4)-1);if(e<a)return{value:e,prefix:null};const l=10**(Math.floor(Math.log10(e)/3)*3),o=e/l;let s=Math.round(o*10**n)/10**n,c=Math.max(Math.floor(Math.log10(e)/3)-1,0);return s>=1e3&&(s/=1e3,c+=1),c>=_e.length?{value:e,prefix:null}:{value:s,prefix:_e[c]}},Ge=(e,t)=>{const{value:n,prefix:i}=$n(e,{precision:2,minDigits:t?.minDigits??5});if(i==null)return`${e}`;const a=t?.digits??3,l=Math.floor(Math.log10(n))+1,o=Math.max(a-l,0);return`${Math.round(n*10**o)/10**o}${i}`},Ye=h('<div class="text-sm text-fg-tertiary">'),ke=h('<div class="flex shrink-0 items-center gap-1"><button class=size-4>'),mn=h('<div class="flex shrink-0 items-center gap-1"><button><span class="flex size-4">'),yn=h("<div class=w-6>"),bn=h('<div class="scrollbar flex gap-2 overflow-x-auto py-1">'),wn=h('<span class="ml-1 text-sm">'),_n=h('<button class="flex h-6 max-w-[128px] items-center rounded border border-border px-1"type=button>'),kn=h("<span class=text-red-500>"),pn=h('<div class="actions flex w-64 max-w-full items-center justify-between pt-1"><button class="shrink-0 text-fg-tertiary hover:text-fg-tertiary/70"><span class="flex size-4"></span></button><button type=button><span class="flex size-4 text-fg-tertiary hover:text-r-zap"></span></button><button type=button class="size-4 shrink-0 text-fg-tertiary hover:text-fg-tertiary/70">'),xn=le(()=>ie(()=>import("./EventDebugModal-IpEmCxYz.js"),__vite__mapDeps([0,1,2,3,4,5,6]))),Ze=le(()=>ie(()=>import("./UserList-bvLq6RoK.js"),__vite__mapDeps([7,1,2,4,5,8,3,9]))),En=le(()=>ie(()=>import("./ZapRequestModal-rt4EwrS5.js"),__vite__mapDeps([10,1,2,3,4,5,6,11,12,9,13,8]))),Rn=e=>{if(e.native!=null)return{type:"Emoji",content:e.native};if(e.src!=null)return{type:"CustomEmoji",content:`:${e.id}:`,shortcode:e.id,url:e.src};throw new Error("unknown emoji")},Cn=e=>{const{config:t}=S(),n=te(),[i,a]=R(!1),{reactions:l,isReactedByWithEmoji:o,isReactedBy:s}=de(()=>({eventId:e.event.id})),c=p(()=>{const f=n();return f!=null&&s(f)||i()}),u=p(()=>{const f=n();return f!=null&&o(f)}),g=Ne(()=>({eventId:e.event.id})),v=f=>{c()||ee([n(),e.event.id])(([y,k])=>{g.mutate({relayUrls:t().relayUrls,pubkey:y,reactionTypes:f??{type:"LikeDislike",content:"+"},eventId:k,kind:e.event.kind,notifyPubkey:e.event.pubkey}),a(!0)})},b=f=>{f.stopPropagation(),v()},$=f=>{v(Rn(f))},m=ft(()=>({onEmojiSelect:$}));return[(()=>{const f=ke(),y=f.firstChild;return y.$$click=b,d(y,r(w,{get when(){return p(()=>!!c())()&&!u()},get fallback(){return r(vt,{})},get children(){return r(He,{})}})),d(f,r(w,{get when(){return p(()=>!t().hideCount&&!t().showEmojiReaction)()&&l().length>0},get children(){const k=Ye();return d(k,()=>Ge(l().length,{minDigits:4})),k}}),null),T(k=>{const C={"text-fg-tertiary":!c()||u(),"hover:text-r-reaction":!c()||u(),"text-r-reaction":c()&&!u()||g.isPending},D=g.isPending;return k._v$=J(f,C,k._v$),D!==k._v$2&&(y.disabled=k._v$2=D),k},{_v$:void 0,_v$2:void 0}),f})(),r(w,{get when(){return t().useEmojiReaction},get children(){const f=ke(),y=f.firstChild;y.$$click=()=>m.open();const k=m.targetRef;return typeof k=="function"?A(k,y):m.targetRef=y,d(y,r($t,{})),d(f,()=>m.popup(),null),T(C=>J(f,{"text-fg-tertiary":!c()||!u(),"hover:text-r-reaction":!c()||!u(),"text-r-reaction":c()&&u()||g.isPending},C)),f}})]},Sn=e=>{const{config:t}=S(),n=te(),[i,a]=R(!1),{reposts:l,isRepostedBy:o}=Ve(()=>({eventId:e.event.id})),s=p(()=>{const g=n();return g!=null&&o(g)||i()}),c=vn(()=>({eventId:e.event.id})),u=g=>{g.stopPropagation(),!s()&&ee([n(),e.event.id])(([v,b])=>{c.mutate({relayUrls:t().relayUrls,pubkey:v,eventId:b,kind:e.event.kind,notifyPubkey:e.event.pubkey}),a(!0)})};return(()=>{const g=mn(),v=g.firstChild,b=v.firstChild;return v.$$click=u,d(b,r(Ae,{})),d(g,r(w,{get when(){return p(()=>!t().hideCount)()&&l().length>0},get children(){const $=Ye();return d($,()=>Ge(l().length,{minDigits:4})),$}}),null),T($=>{const m={"text-fg-tertiary":!s(),"hover:text-r-repost":!s(),"text-r-repost":s()||c.isPending},f=c.isPending;return $._v$3=J(g,m,$._v$3),f!==$._v$4&&(v.disabled=$._v$4=f),$},{_v$3:void 0,_v$4:void 0}),g})()},Tn=e=>{const{reactions:t}=de(()=>({eventId:e.event.id}));return r(Ze,{get data(){return t()},pubkeyExtractor:n=>n.pubkey,renderInfo:n=>(()=>{const i=yn();return d(i,r(We,{get reactionTypes(){return Z(n).toReactionTypes()}})),i})(),get onClose(){return e.onClose}})},Mn=e=>{const{reposts:t}=Ve(()=>({eventId:e.event.id}));return r(Ze,{get data(){return t()},pubkeyExtractor:n=>n.pubkey,get onClose(){return e.onClose}})},In=e=>{const{config:t}=S(),n=te(),[i,a]=R(!1),{reactions:l,reactionsGrouped:o,isReactedBy:s}=de(()=>({eventId:e.event.id})),c=Ne(()=>({eventId:e.event.id})),u=()=>{const v=n();return v==null?i():i()||s(v)},g=v=>{u()||ee([n(),e.event.id])(([b,$])=>{c.mutate({relayUrls:t().relayUrls,pubkey:b,reactionTypes:v??{type:"LikeDislike",content:"+"},eventId:$,kind:e.event.kind,notifyPubkey:e.event.pubkey}),a(!0)})};return r(w,{get when(){return p(()=>!!t().showEmojiReaction)()&&l().length>0},get children(){const v=bn();return d(v,r(N,{get each(){return[...o().entries()]},children:([,b])=>{const $=b.findIndex(f=>f.pubkey===n())>=0,m=Z(b[0]).toReactionTypes();return(()=>{const f=_n();return f.$$click=y=>{y.stopPropagation(),g(m)},d(f,r(We,{reactionTypes:m}),null),d(f,r(w,{get when(){return!t().hideCount},get children(){const y=wn();return d(y,()=>b.length),y}}),null),T(y=>{const k={"text-fg-tertiary":!$,"hover:bg-r-reaction/10":!$,"hover:border-r-reaction/40":!$,"bg-r-reaction/10":$,"border-r-reaction/40":$,"text-r-reaction":$},C=u();return y._v$5=J(f,k,y._v$5),C!==y._v$6&&(f.disabled=y._v$6=C),y},{_v$5:void 0,_v$6:void 0}),f})()}})),v}})},Pn=e=>{const t=P(),{config:n}=S(),i=te(),a=ue(),[l,o]=R(null),s=()=>o(null),c=se(()=>({mutationKey:["deleteEvent",e.event.id],mutationFn:(...g)=>a.deleteEvent(...g).then(v=>Promise.allSettled(v.map(X(1e4)))),onSuccess:g=>{const v=g.filter($=>$.status==="fulfilled").length,b=g.length-v;v===g.length?window.alert(t.t("post.deletedSuccessfully")):v>0?window.alert(t.t("post.failedToDeletePartially",{count:b})):window.alert(t.t("post.failedToDelete"))},onError:g=>{console.error("failed to delete",g)}})),u=Ke(()=>({menu:[{content:t.t("post.copyEventId"),onSelect:()=>{navigator.clipboard.writeText(Se(e.event.id)).catch(g=>window.alert(g))}},{content:t.t("post.showJSON"),onSelect:()=>{o("EventDebugModal")}},{content:t.t("post.showReposts"),onSelect:()=>{o("Reposts")}},{content:t.t("post.showReactions"),onSelect:()=>{o("Reactions")}},{when:()=>e.event.pubkey===i(),content:(()=>{const g=kn();return d(g,()=>t.t("post.deletePost")),g})(),onSelect:()=>{const g=i();g!=null&&window.confirm(t.t("post.confirmDelete"))&&c.mutate({relayUrls:n().relayUrls,pubkey:g,eventId:e.event.id})}}]}));return[r(In,{get event(){return e.event}}),(()=>{const g=pn(),v=g.firstChild,b=v.firstChild,$=v.nextSibling,m=$.firstChild,f=$.nextSibling;v.$$click=k=>{k.stopPropagation(),e.onClickReply()},d(b,r(Zt,{})),d(g,r(Sn,{get event(){return e.event}}),$),d(g,r(Cn,{get event(){return e.event}}),$),$.$$click=()=>o("ZapRequest"),d(m,r(Gt,{})),f.$$click=()=>u.open();const y=u.targetRef;return typeof y=="function"?A(y,f):u.targetRef=f,d(f,r(Xt,{})),d(g,()=>u.popup(),null),g})(),r(B,{get children(){return[r(x,{get when(){return l()==="EventDebugModal"},get children(){return r(xn,{get event(){return e.event},onClose:s})}}),r(x,{get when(){return l()==="Reactions"},get children(){return r(Tn,{get event(){return e.event},onClose:s})}}),r(x,{get when(){return l()==="Reposts"},get children(){return r(Mn,{get event(){return e.event},onClose:s})}}),r(x,{get when(){return l()==="ZapRequest"},get children(){return r(En,{get event(){return e.event},onClose:s})}})]}})]};M(["click"]);const Dn=h("<div>"),Ln=h('<button class="text-xs text-fg-secondary hover:text-fg-secondary/70">'),Fn=h("<span>: "),qn=h('<button class="mt-2 flex w-full flex-col items-center rounded border border-border p-2 text-center text-xs text-fg-secondary"><span class="inline-block size-4"></span><span>'),Un=e=>{const t=P(),[n,i]=R(!1);return r(w,{get when(){return!e.contentWarning.contentWarning||n()},get fallback(){return(()=>{const a=qn(),l=a.firstChild,o=l.nextSibling;return a.$$click=()=>i(!0),d(l,r(mt,{})),d(o,()=>t.t("post.contentWarning.show")),d(a,r(w,{get when(){return e.contentWarning.reason!=null},get children(){const s=Fn(),c=s.firstChild;return d(s,()=>t.t("post.contentWarning.reason"),c),d(s,()=>e.contentWarning.reason,null),s}}),null),a})()},get children(){return[(()=>{const a=Dn();return d(a,()=>e.children),a})(),r(w,{get when(){return e.contentWarning.contentWarning},get children(){const a=Ln();return a.$$click=()=>i(!1),d(a,()=>t.t("post.contentWarning.hide")),a}})]}})};M(["click"]);const Je=e=>{const{profile:t}=Le(()=>({pubkey:e.pubkey}));return r(w,{get when(){return(t()?.name?.length??0)>0},get fallback(){return`@${Fe(e.pubkey)}`},get children(){return["@",p(()=>t()?.name??e.pubkey)]}})},An=h('<button class="rounded bg-bg-tertiary p-3 text-xs text-fg-secondary hover:shadow">'),jn=h('<div class="aspect-video max-w-full">'),Bn=h('<img class="max-h-64 max-w-full rounded object-contain shadow hover:shadow-md">'),On=e=>{let t;const n=P(),[i,a]=R(e.initialHidden),[l,o]=R(!1);return r(w,{get when(){return!i()},get fallback(){return(()=>{const s=An();return s.$$click=()=>a(!1),d(s,()=>n.t("post.showImage")),s})()},get children(){return r(U,{get fallback(){return(()=>{const s=jn();return d(s,r(L,{class:"text-link underline",get href(){return e.url}})),s})()},children:()=>r(w,{get when(){return!l()},get fallback(){return r(L,{class:"text-link underline",get href(){return e.url}})},get children(){return r(L,{class:"my-2 block",get href(){return e.url},get children(){const s=Bn();s.addEventListener("error",()=>o(!0));const c=t;return typeof c=="function"?A(c,s):t=s,T(u=>{const g=qe(e.url),v=e.url;return g!==u._v$&&E(s,"src",u._v$=g),v!==u._v$2&&E(s,"alt",u._v$2=v),u},{_v$:void 0,_v$2:void 0}),s}})}})})}})};M(["click"]);const Hn=h('<div class="my-1 rounded border p-1">'),Wn=e=>r(w,{get when(){return e.mentionedEvent.marker!=null&&e.mentionedEvent.marker.length>0},get fallback(){return r(W,{get eventId(){return e.mentionedEvent.eventId}})},get children(){const t=Hn();return d(t,r(U,{children:()=>r(K,{get eventId(){return e.mentionedEvent.eventId},embedding:!1,actions:!1,get ensureKinds(){return[ce]}})})),t}}),Kn=h('<button class="inline select-text text-link underline">'),ne=e=>{const{showProfile:t}=ae(),n=()=>{t(e.pubkey)};return(()=>{const i=Kn();return i.$$click=n,d(i,r(Je,{get pubkey(){return e.pubkey}})),i})()};M(["click"]);const zn=e=>{const t={};return Array.from(e.head.querySelectorAll("meta")).forEach(n=>{const i=n.getAttribute("property"),a=n.getAttribute("content");i!=null&&a!=null&&(t[i]=a)}),t["og:image"]!=null&&t["og:title"]!=null&&t["og:description"]!=null&&t["og:url"]?{title:t["og:title"],description:t["og:description"],image:t["og:image"],url:t["og:url"]}:null},Nn=e=>{const t=new DOMParser().parseFromString(e,"text/html");return zn(t)},Xe=e=>{const t=["www3.nhk.or.jp"],n=new URL(e);return t.includes(n.host)},Qn=async e=>{if(!Xe(e))return null;const n=await(await fetch(e,{headers:{Accept:"text/html"}})).text();return Nn(n)},Vn=e=>{const t=()=>["useOgp",e().url],n=z(()=>({queryKey:t(),queryFn:({queryKey:[,a]})=>Qn(a),staleTime:144e5,gcTime:144e5,refetchOnWindowFocus:!1,refetchOnMount:!1}));return{query:n,ogp:()=>n.data}},Gn=h('<blockquote class=twitter-tweet><a class="text-link underline"target=_blank rel="noreferrer noopener">'),Yn=h('<div class="my-2 rounded-lg border border-border transition-colors hover:bg-bg-tertiary"><img class="max-w-full rounded-t-lg object-contain shadow"><div class="mb-1 p-1"><div class="text-xs text-fg-secondary"></div><div class=text-sm></div><div class="text-xs text-fg-secondary">'),Zn=h('<div><button class="flex flex-col items-center rounded bg-bg-tertiary p-3 text-xs text-fg-secondary hover:shadow">'),Jn=h('<div class="aspect-video max-w-full">'),Xn=h('<div class="my-2 aspect-video w-full"><iframe loading=lazy title=YouTube class="my-2 size-full"allowfullscreen>'),pe=e=>{try{const t=new URL(e);return t.host="twitter.com",t.href}catch{return e}},er=e=>{const t=new URL("https://www.youtube-nocookie.com/embed/");return t.pathname+=e,t.searchParams.set("origin",window.location.origin),t.href},tr=e=>{let t;const{getColorTheme:n}=S();O(()=>{Ue(e.url)&&window.twttr?.widgets?.load(t)});const i=()=>n().brightness==="dark"?"dark":"light";return(()=>{const a=Gn(),l=a.firstChild,o=t;return typeof o=="function"?A(o,a):t=a,d(l,()=>pe(e.url)),T(s=>{const c=i(),u=pe(e.url);return c!==s._v$&&E(a,"data-theme",s._v$=c),u!==s._v$2&&E(l,"href",s._v$2=u),s},{_v$:void 0,_v$2:void 0}),a})()},nr=e=>{const{ogp:t}=Vn(()=>({url:e.url}));return r(w,{get when(){return t()},get fallback(){return r(L,{class:"text-link underline",get href(){return e.url}})},keyed:!0,children:n=>r(L,{get href(){return e.url},get children(){const i=Yn(),a=i.firstChild,l=a.nextSibling,o=l.firstChild,s=o.nextSibling,c=s.nextSibling;return d(o,()=>new URL(n.url).host),d(s,()=>n.title),d(c,()=>n.description),T(u=>{const g=n.title,v=n.image;return g!==u._v$3&&E(a,"alt",u._v$3=g),v!==u._v$4&&E(a,"src",u._v$4=v),u},{_v$3:void 0,_v$4:void 0}),i}})})},re=e=>{const t=P(),[n,i]=R(e.initialHidden);return r(w,{get when(){return!n()},get fallback(){return(()=>{const a=Zn(),l=a.firstChild;return l.$$click=()=>i(!1),d(l,()=>t.t("post.showPreview")),d(a,r(L,{class:"text-link underline",get href(){return e.url}}),null),a})()},get children(){return e.children}})},rr=e=>{const{config:t}=S();return r(B,{get fallback(){return r(L,{class:"text-link underline",get href(){return e.url}})},get children(){return[r(x,{get when(){return p(()=>!!t().embedding.twitter)()&&Ue(e.url)},get children(){return r(re,{get url(){return e.url},get initialHidden(){return e.initialHidden},get children(){return r(tr,{get url(){return e.url}})}})}}),r(x,{get when(){return p(()=>!!t().embedding.youtube)()&&Et(e.url)},keyed:!0,children:({videoId:n})=>r(re,{get url(){return e.url},get initialHidden(){return e.initialHidden},get children(){return r(U,{get fallback(){return(()=>{const i=Jn();return d(i,r(L,{get href(){return e.url}})),i})()},children:()=>(()=>{const i=Xn(),a=i.firstChild;return T(()=>E(a,"src",er(n))),i})()})}})}),r(x,{get when(){return p(()=>!!t().embedding.ogp)()&&Xe(e.url)},get children(){return r(re,{get url(){return e.url},get initialHidden(){return e.initialHidden},get children(){return r(U,{children:()=>r(nr,{get url(){return e.url}})})}})}})]}})};M(["click"]);const or=h('<button class="rounded bg-bg-tertiary p-3 text-xs text-fg-secondary hover:shadow">'),sr=h('<div class="aspect-video max-w-full">'),lr=h('<video class="max-h-64 max-w-full rounded-sm object-contain shadow"controls><a>'),ir=e=>{let t;const n=P(),[i,a]=R(e.initialHidden);return r(w,{get when(){return!i()},get fallback(){return(()=>{const l=or();return l.$$click=()=>a(!1),d(l,()=>n.t("post.showVideo")),l})()},get children(){return r(U,{get fallback(){return sr()},children:()=>r(L,{class:"my-2 block",get href(){return e.url},get children(){const l=lr(),o=l.firstChild,s=t;return typeof s=="function"?A(s,l):t=l,d(o,()=>n.t("post.download")),T(c=>{const u=e.url,g=e.url;return u!==c._v$&&E(l,"src",c._v$=u),g!==c._v$2&&E(o,"href",c._v$2=g),c},{_v$:void 0,_v$2:void 0}),l}})})}})};M(["click"]);const oe=h("<span>"),xe=h('<button class="select-text text-link underline">'),Ee=h('<div class="my-1 rounded border border-border p-1">'),cr=h('<button class="select-text text-link underline"> (<!>)'),ar=h('<span class="text-link underline">'),ur=h('<img class="inline-block h-8 max-w-[8rem]">'),dr=e=>{const{config:t,saveColumn:n}=S(),i=yt(),a=o=>{n(st({query:o})),i({command:"moveToLastColumn"}).catch(s=>console.error(s))},l=o=>{n(lt({name:o,relayUrls:[o]})),i({command:"moveToLastColumn"}).catch(s=>console.error(s))};return r(N,{get each(){return e.parsed},children:o=>{if(o.type==="PlainText")return(()=>{const s=oe();return d(s,()=>o.content),s})();if(o.type==="URL"){const s=()=>!t().showMedia||!e.embedding||(e.initialHidden??!1);return Rt(o.content)?r(On,{get url(){return o.content},get initialHidden(){return s()}}):Ct(o.content)?r(ir,{get url(){return o.content},get initialHidden(){return s()}}):St(o.content)?(()=>{const c=xe();return c.$$click=()=>l(o.content),d(c,()=>o.content),c})():r(rr,{get url(){return o.content},get initialHidden(){return s()}})}if(o.type==="TagReferenceResolved"){if(o.reference==null)return(()=>{const s=oe();return d(s,()=>o.content),s})();if(o.reference.type==="MentionedUser")return r(ne,{get pubkey(){return o.reference.pubkey}});if(o.reference.type==="MentionedEvent")return e.embedding?r(Wn,{get mentionedEvent(){return o.reference}}):r(W,{get eventId(){return o.reference.eventId}})}if(o.type==="Bech32Entity"){if(o.data.type==="note"&&e.embedding)return(()=>{const s=Ee();return d(s,r(K,{get eventId(){return o.data.data},actions:!1,embedding:!1,get ensureKinds(){return[ce]}})),s})();if(o.data.type==="nevent"&&e.embedding)return(()=>{const s=Ee();return d(s,r(K,{get eventId(){return o.data.data.id},actions:!1,embedding:!1})),s})();if(o.data.type==="npub")return r(ne,{get pubkey(){return o.data.data}});if(o.data.type==="nprofile")return r(ne,{get pubkey(){return o.data.data.pubkey}});if(o.data.type==="nrelay"){const s=o.data.data;return(()=>{const c=cr(),u=c.firstChild,g=u.nextSibling;return g.nextSibling,c.$$click=()=>l(s),d(c,s,u),d(c,()=>o.content,g),c})()}return(()=>{const s=ar();return d(s,()=>o.content),s})()}return o.type==="HashTag"?(()=>{const s=xe();return s.$$click=()=>a(o.content),d(s,()=>o.content),s})():o.type==="CustomEmojiResolved"?o.url==null?(()=>{const s=oe();return d(s,()=>o.content),s})():(()=>{const s=ur();return T(c=>{const u=o.url,g=o.content,v=o.shortcode;return u!==c._v$&&E(s,"src",c._v$=u),g!==c._v$2&&E(s,"alt",c._v$2=g),v!==c._v$3&&E(s,"title",c._v$3=v),c},{_v$:void 0,_v$2:void 0,_v$3:void 0}),s})():(console.error("Not all ParsedTextNoteNodes are covered",o),null)}})};M(["click"]);const Re=2,gr=200,hr=()=>{let e;const[t,n]=R(!1),i=l=>{e=l},a=bt(()=>{e!=null&&n(e.scrollHeight>e.clientHeight+Re||e.scrollHeight>document.documentElement.clientHeight+Re)},gr);return Ie(()=>{if(e!=null){a();const l=new IntersectionObserver(s=>{s.forEach(c=>{c.isIntersecting&&a()})},{threshold:[0,.25,.5,.75,1]});l.observe(e);const o=()=>a();window.addEventListener("resize",o),H(()=>{l.disconnect(),window.removeEventListener("resize",o)})}}),{overflow:t,elementRef:i}},fr=h('<div class="author-name truncate pr-1 font-bold hover:underline">'),vr=h('<button class="mt-2 w-full rounded border border-border p-2 text-center text-xs text-fg-secondary shadow-sm hover:bg-bg-tertiary hover:shadow">'),$r=h('<div class="post flex flex-col"><div class="flex w-full gap-1"><button type=button class="author-icon size-10 shrink-0 overflow-hidden rounded"></button><div class="min-w-0 flex-auto"><div class="flex justify-between gap-1 text-xs"><button type=button class="author flex min-w-0 select-text truncate hover:text-link"><span class="author flex min-w-0 truncate hover:text-link"><div class="author-username truncate text-fg-secondary"></div></span></button><div class="created-at shrink-0"><button type=button class="select-text hover:underline"></button></div></div><div class=overflow-hidden></div><div class=actions>'),mr=h('<img alt=icon referrerpolicy=no-referrer class="size-full object-cover">'),yr=e=>{const t=P(),{overflow:n,elementRef:i}=hr(),a=Oe(),[l,o]=R(!1),s=()=>a(e.createdAt),c=()=>e.createdAt.toLocaleString(),{profile:u}=Le(()=>({pubkey:e.authorPubkey}));return(()=>{const g=$r(),v=g.firstChild,b=v.firstChild,$=b.nextSibling,m=$.firstChild,f=m.firstChild,y=f.firstChild,k=y.firstChild,C=f.nextSibling,D=C.firstChild,F=m.nextSibling,G=F.nextSibling;return b.$$click=_=>{_.preventDefault(),e.onShowProfile?.()},d(b,r(w,{get when(){return u()?.picture},keyed:!0,children:_=>r(U,{children:()=>(()=>{const I=mr();return T(()=>E(I,"src",qe(_,"icon"))),I})()})})),f.$$click=_=>{_.preventDefault(),e?.onShowProfile?.()},d(y,r(w,{get when(){return(u()?.display_name?.length??0)>0},get children(){const _=fr();return d(_,()=>u()?.display_name),_}}),k),d(k,r(w,{get when(){return u()?.name!=null},get fallback(){return`@${Fe(e.authorPubkey)}`},get children(){return["@",p(()=>u()?.name)]}})),D.$$click=_=>{_.preventDefault(),e.onShowEvent?.()},d(D,s),A(i,F),d(F,()=>e.content),d($,r(w,{get when(){return n()},get children(){const _=vr();return _.$$click=I=>{I.stopPropagation(),o(q=>!q)},d(_,r(w,{get when(){return!l()},get fallback(){return t.t("post.hideOverflow")},get children(){return t.t("post.showOverflow")}})),_}}),G),d(G,()=>e.actions),d(g,r(w,{get when(){return e.footer},get children(){return e.footer}}),null),T(_=>{const I=c(),q=!l(),ge=!!l();return I!==_._v$&&E(D,"title",_._v$=I),q!==_._v$2&&F.classList.toggle("max-h-screen",_._v$2=q),ge!==_._v$3&&F.classList.toggle("max-h-none",_._v$3=ge),_},{_v$:void 0,_v$2:void 0,_v$3:void 0}),g})()};M(["click"]);const br=ct(),wr=()=>it(br),Ur=()=>{const[e,t]=at({});return{timelineState:e,setTimeline:n=>t("content",n),clearTimeline:()=>t("content",void 0)}},_r=h("<div class=nostr-textnote>"),kr=h("<div class=text-xs>"),pr=h('<div class="content whitespace-pre-wrap break-all">'),xr=h("<div class=textnote-content>"),Er=h('<div class="mt-1 rounded border border-border p-1">'),Rr=h("<div class=h-12>"),Cr=h('<button class="select-text pr-1 text-link hover:underline">'),Sr=h("<div class=h-5>"),Tr=e=>{let t;const n=P(),{showProfile:i}=ae(),a=wr(),[l,o]=R(!1),s=()=>o(!1),c=()=>{o($=>!$),l()&&t!=null&&t.focus()},u=p(()=>ut(e.event)),g=()=>e.embedding??!0,v=()=>e.actions??!0,b=()=>{if(g()){const $=u().replyingToEvent();if($!=null&&!u().containsEventMention($.id))return $.id;const m=u().rootEvent();if($==null&&m!=null&&!u().containsEventMention(m.id))return m.id}};return(()=>{const $=_r();return d($,r(yr,{get authorPubkey(){return u().pubkey},get createdAt(){return u().createdAtAsDate()},get content(){return(()=>{const m=xr();return d(m,r(w,{get when(){return b()},keyed:!0,children:f=>(()=>{const y=Er();return d(y,r(U,{get fallback(){return Rr()},children:()=>r(K,{eventId:f,actions:!1,embedding:!1})})),y})()}),null),d(m,r(w,{get when(){return u().taggedPubkeys().length>0},get children(){const f=kr();return d(f,()=>n.t("post.replyToPre"),null),d(f,r(N,{get each(){return u().taggedPubkeys()},children:y=>(()=>{const k=Cr();return k.$$click=C=>{C.stopPropagation(),i(y)},d(k,r(Je,{pubkey:y})),k})()}),null),d(f,()=>n.t("post.replyToPost"),null),f}}),null),d(m,r(Un,{get contentWarning(){return u().contentWarning()},get children(){const f=pr();return d(f,r(dr,{get parsed(){return u().parsed()},get embedding(){return g()},get initialHidden(){return u().contentWarning().contentWarning}})),f}}),null),m})()},get actions(){return r(w,{get when(){return v()},get children(){return r(U,{get fallback(){return Sr()},children:()=>r(Pn,{get event(){return e.event},onClickReply:c})})}})},get footer(){return r(w,{get when(){return l()},get children(){return r(wt,{textAreaRef:m=>{t=m},mode:"reply",get replyTo(){return e.event},onClose:s,onPost:s})}})},onShowProfile:()=>{i(u().pubkey)},onShowEvent:()=>{a?.setTimeline({type:"Replies",event:e.event})}})),$})()};M(["click"]);const Ce=h("<div><span>"),et=e=>{const t=P(),n=()=>e.ensureKinds==null||e.ensureKinds.length===0||e.ensureKinds.includes(e.event.kind);return r(B,{get fallback(){return(()=>{const i=Ce(),a=i.firstChild;return d(a,()=>t.t("post.unsupportedKind",{kind:e.event.kind})),d(i,r(W,{get eventId(){return e.event.id},get kind(){return e.event.kind}}),null),i})()},get children(){return[r(x,{get when(){return!n()},keyed:!0,get children(){const i=Ce(),a=i.firstChild;return d(a,()=>t.t("post.unexpectedKind",{kind:e.event.kind})),d(i,r(W,{get eventId(){return e.event.id},get kind(){return e.event.kind}}),null),i}}),r(x,{get when(){return e.event.kind===ce},get children(){return r(Tr,{get event(){return e.event},get embedding(){return e.actions},get actions(){return e.actions}})}}),r(x,{get when(){return e.event.kind===dt},get children(){return r(Qt,{get event(){return e.event}})}})]}})},Ar=e=>{const{shouldMuteEvent:t}=S();return r(N,{get each(){return e.events},children:n=>r(w,{get when(){return!t(n)},get children(){return r(Mt,{get children(){return r(et,{event:n})}})}})})};let Y=0;const{setActiveSubscriptions:Mr}=_t();setInterval(()=>{Mr(Y)},1e3);const Ir=({eose:e,limit:t,eoseLimit:n})=>{const[a,l]=R([]),o=[];let s;const c=()=>{l($=>{const m=[...$];return o.forEach(f=>{fe(m,f)}),m.slice(0,n())}),o.splice(0,o.length)},u=()=>{s==null&&(s=setTimeout(()=>{s=void 0,c()},100))},g=()=>{s!=null&&clearTimeout(s)},v=$=>{const m=$.created_at-kt();if(!(m>300)){if(m>0){setTimeout(()=>v($),m*1e3);return}e()?l(f=>{const y=[...f];return fe(y,$),y.slice(0,t())}):(o.push($),u())}},b=()=>{l([]),g()};return O(()=>{e()&&c()}),H(()=>{g()}),{events:a,setEvents:l,addEvent:v,clearEvents:b}},jr=e=>{const{config:t,shouldMuteEvent:n}=S(),i=pt(),[a,l]=R(!1),o=p(e),s=()=>e()?.eoseLimit??25,c=()=>e()?.limit??50,{events:u,addEvent:g,clearEvents:v,setEvents:b}=Ir({eose:a,eoseLimit:s,limit:c});O(he(()=>[t().mutedPubkeys,t().mutedKeywords],()=>{b(m=>m.filter(f=>!n(f)))},{defer:!0})),Ie(()=>{console.debug("subscription mounted",e()?.debugId,e()),H(()=>{console.debug("subscription unmount",e()?.debugId,e())})});const $=()=>{console.debug("startSubscription: start");const m=o();if(m==null)return;const{relayUrls:f,filters:y,options:k,onEvent:C,onEOSE:D,clientEventFilter:F,continuous:G=!0}=m;let _=!0;Y+=1,v(),l(!1);const I=i().subscribeMany(f,y,k??{maxWait:12e3,onevent:q=>{C?.(q),!(F!=null&&!F(q))&&g(q)},oneose:()=>{a()||(D?.(),l(!0),G||(I.close(),_&&(_=!1,Y-=1)))}});H(()=>{console.debug("startSubscription: end"),I.close(),_&&(_=!1,Y-=1)})};return O(he(()=>[o()],()=>$())),{events:u,eose:a}},tt=e=>{const t=()=>{const i=e();if(i==null)return[];const a=[];return Me(i).pTags().forEach(o=>{const[,s,c,u]=o,g={pubkey:s,petname:u};c!=null&&c.length>0&&(g.mainRelayUrl=c),a.push(g)}),a};return{followings:t,followingPubkeys:()=>t().map(i=>i.pubkey),data:e}},Br=async({pubkey:e},t)=>{const n=new V({type:"Followings",pubkey:e});Pe({task:n,signal:t});const i=await n.latestEventPromise();return tt(()=>i)},Or=e=>{const t=Q(),n=p(e),i=()=>["useFollowings",n()],a=z(()=>({queryKey:i(),queryFn:xt({taskProvider:([,o])=>{if(o==null)return null;const{pubkey:s}=o;return new V({type:"Followings",pubkey:s})},queryClient:t}),staleTime:5*60*1e3,gcTime:3*24*60*60*1e3,refetchOnMount:!0,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchInterval:0})),l=()=>t.invalidateQueries({queryKey:i()});return{...tt(()=>a.data),invalidateFollowings:l,query:a}};export{Gt as B,sn as C,K as E,Qt as R,Ar as T,Ur as a,br as b,Mt as c,Or as d,Oe as e,Ft as f,We as g,et as h,Tr as i,Ke as j,Xt as k,dr as l,Br as m,Ge as n,jr as u};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/EventDebugModal-IpEmCxYz.js","assets/index-6GcGm1j7.js","assets/index-j9GdtEmf.css","assets/BasicModal-nhgDn-z_.js","assets/SideBar-my2KE9jO.js","assets/resolveAsset-adjucDlC.js","assets/Copy-o-O_0spL.js","assets/UserList-bvLq6RoK.js","assets/url-4UJeT0bq.js","assets/LazyLoad-CCWC6YyF.js","assets/ZapRequestModal-rt4EwrS5.js","assets/lud16ToLnurlPayUrl-qYTT-tOR.js","assets/_baseClone-pBijlxVw.js","assets/SafeLink-2J2WPo4Q.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
//# sourceMappingURL=useFollowings-TnrrCHGF.js.map
