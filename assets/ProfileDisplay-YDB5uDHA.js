import{s as L,t as a,k as X,w as v,X as ge,l as he,A as ye,u as we,c as E,a8 as be,a as n,j as h,g as I,i as r,f as T,M as y,b as V,n as $e,S as ve,d as ke,aa as _e,al as xe,x as Ce,aj as Pe,ag as Fe}from"./index-WwbqkKbH.js";import{u as Y,c as G,i as Me,j as Se,k as Ee,T as Te,l as Ue}from"./useFollowings-mXJ4HcOE.js";import{G as qe}from"./globe-alt-M7c0gmQT.js";import{B as Le}from"./BasicModal-g3KzZ0Oh.js";import je from"./UserList-RUY1KRQu.js";import{a as ze,b as Ae,d as Ne,g as Be,n as Re,f as K,t as Qe,e as He,j as Ie}from"./SideBar-5bVMeQFM.js";import"./LazyLoad-WM5QveLR.js";import"./resolveAsset-5N8SGxqM.js";const Ve=a('<svg xmlns=http://www.w3.org/2000/svg fill=none stroke=currentColor stroke-width=1.5 aria-hidden=true data-slot=icon viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99">'),Ge=(l={})=>(()=>{const t=Ve();return L(t,l,!0,!0),t})(),Ke=a('<svg xmlns=http://www.w3.org/2000/svg fill=currentColor aria-hidden=true data-slot=icon viewBox="0 0 24 24"><path fill-rule=evenodd d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12m13.36-1.814a.75.75 0 1 0-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 0 0-1.06 1.06l2.25 2.25a.75.75 0 0 0 1.14-.094z"clip-rule=evenodd>'),De=(l={})=>(()=>{const t=Ke();return L(t,l,!0,!0),t})(),Oe=a('<svg xmlns=http://www.w3.org/2000/svg fill=currentColor aria-hidden=true data-slot=icon viewBox="0 0 24 24"><path fill-rule=evenodd d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12M12 8.25a.75.75 0 0 1 .75.75v3.75a.75.75 0 0 1-1.5 0V9a.75.75 0 0 1 .75-.75m0 8.25a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5"clip-rule=evenodd>'),Xe=(l={})=>(()=>{const t=Oe();return L(t,l,!0,!0),t})();function Ye(l){const{config:t}=X(),m=v(l),{events:f}=Y(()=>({relayUrls:t().relayUrls,filters:[{kinds:[ge],"#p":[m().pubkey]}],limit:1e6,continuous:!1})),w=()=>he(f()?.map(b=>b.pubkey));return{followersPubkeys:w,count:()=>w().length}}var Je=/^(?:([\w.+-]+)@)?([\w.-]+)$/,J;try{J=fetch}catch{}async function We(l){const t=l.match(Je);if(!t)return null;const[m,f="_",w]=t;try{const $=await J(`https://${w}/.well-known/nostr.json?name=${f}`),{names:b,relays:k}=Ze(await $.json()),x=b[f];return x?{pubkey:x,relays:k?.[x]}:null}catch{return null}}function Ze(l){const t={names:{}};for(const[m,f]of Object.entries(l.names))typeof m=="string"&&typeof f=="string"&&(t.names[m]=f);if(l.relays){t.relays={};for(const[m,f]of Object.entries(l.relays))typeof m=="string"&&Array.isArray(f)&&(t.relays[m]=f.filter(w=>typeof w=="string"))}return t}const et=l=>{const t=v(l),m=()=>["useVerification",t()],f=ye(()=>({queryKey:m(),queryFn:({queryKey:$})=>{const[,b]=$;if(b==null)return Promise.resolve(null);const{nip05:k}=b;return We(k)},staleTime:30*60*1e3,gcTime:24*60*60*1e3}));return{verification:()=>f?.data??null,query:f}},tt=a('<button class="rounded-full border border-primary px-4 py-2 text-center font-bold text-primary hover:bg-primary hover:text-primary-fg sm:w-20">'),D=a('<span class="rounded-full border border-primary px-4 py-2 text-primary sm:text-base">'),nt=a('<button class="rounded-full border border-primary bg-primary px-4 py-2 text-center font-bold text-primary-fg hover:bg-primary-hover sm:w-36">'),lt=a('<button class="w-28 rounded-full border border-primary px-4 py-2 text-primary hover:border-primary-hover hover:text-primary-hover">'),O=a('<div class="shrink-0 text-xs">'),rt=a('<div class="flex shrink-0 flex-col items-center gap-1"><div class="flex flex-row justify-start gap-1"><button type=button class="w-10 rounded-full border border-primary p-2 text-primary hover:border-primary-hover hover:text-primary-hover">'),ot=a('<div class="mt-[-54px] flex items-end gap-4 px-4 pt-4"><div class="flex-1 shrink-0"><div class="size-28 overflow-hidden rounded-lg shadow-md">'),st=a('<div class="truncate text-xl font-bold">'),it=a('<div class="truncate text-xs">@'),at=a('<span class="inline-block size-3">'),ct=a('<span class="inline-block size-4 text-link">'),ut=a('<div class="flex items-center text-xs">'),dt=a('<div class="flex items-start px-4 pt-2"><div class="h-16 shrink overflow-hidden"><div class="flex items-center gap-2"></div><div class="flex gap-1"><div class="truncate text-xs">'),ft=a('<div class="flex flex-1 flex-col items-start"><div class=text-sm></div><div class=text-xl>'),pt=a('<div class="flex border-t border-border px-4 py-2"><button class="flex flex-1 flex-col items-start"><div class=text-sm></div><div class=text-xl>'),mt=a('<ul class="border-t border-border px-5 py-2 text-xs">'),gt=a('<ul class="border-t border-border p-1">'),ht=a('<div class="h-12 shrink-0">'),yt=a('<div class="h-40 w-full shrink-0 sm:h-52"><img alt=header class="size-full object-cover">'),wt=a('<img alt="user icon"class="size-full object-cover">'),bt=a('<span class="inline-block size-4 text-danger">'),$t=a('<div class="max-h-40 shrink-0 overflow-y-auto whitespace-pre-wrap px-4 py-2 text-sm">'),vt=a("<span class=text-sm>"),kt=a('<button class="text-sm hover:text-fg-secondary">'),_t=a('<li class="flex items-center gap-1"><span class="inline-block size-4"area-label=website title=website>'),xt=l=>{const{count:t}=Ye(()=>({pubkey:l.pubkey}));return v(t)},qt=l=>{const t=we(),{config:m,addMutedPubkey:f,removeMutedPubkey:w,isPubkeyMuted:$,saveColumn:b}=X(),k=ze(),x=Ie(),_=Ae(),{showProfileEdit:W}=Be(),C=v(()=>Re(l.pubkey)),[Z,j]=E(!1),[ee,z]=E(!1),[te,ne]=E(!1),[le,A]=E(null),re=()=>A(null),{profile:g,event:oe,query:U}=Ne(()=>({pubkey:l.pubkey})),{verification:se,query:ie}=et(()=>K([g()?.nip05])(([e])=>({nip05:e}))),ae=()=>{const e=g()?.nip05;if(e==null)return null;const[o,i]=e.split("@");return i==null?null:o==="_"?{domain:i,ident:i}:{user:o,domain:i,ident:e}},ce=()=>se()?.pubkey===l.pubkey,N=()=>$(l.pubkey),ue=v(()=>{const e=oe(),o=g()?.about;if(e==null||o==null)return;const i=_e(o);return xe(i,Ce(e))}),{followingPubkeys:de,invalidateFollowings:fe,query:P}=G(()=>K([_()])(([e])=>({pubkey:e}))),F=()=>de().includes(l.pubkey),{followingPubkeys:q,query:B}=G(()=>({pubkey:l.pubkey})),pe=()=>{const e=_();return e!=null&&q().includes(e)},M=be(()=>({mutationKey:["updateContacts"],mutationFn:(...e)=>x.updateContacts(...e).then(o=>Promise.allSettled(o.map(Qe(5e3)))),onSuccess:e=>{const o=e.filter(u=>u.status==="fulfilled").length,i=e.length-o;o===e.length?console.log("succeeded to update contacts"):o>0?console.log(`succeeded to update contacts for ${o} relays but failed for ${i} relays`):console.error("failed to update contacts")},onError:e=>{console.error("failed to update contacts: ",e)},onSettled:()=>{fe().then(()=>P.refetch()).catch(e=>console.error("failed to refetch contacts",e))}})),R=async(e,o)=>{try{const i=_();if(i==null)return;j(!0);const u=await Ue({pubkey:i});if((u.data()==null||u.followingPubkeys().length===0)&&!window.confirm(t.t("profile.confirmUpdateEvenIfEmpty")))return;if((u?.data()?.created_at??0)<(P.data?.created_at??0)){window.alert(t.t("profile.failedToFetchLatestFollowList"));return}const d=u.data()?.tags??[];let c;switch(e){case"follow":c=[...d,["p",o]];break;case"unfollow":c=d.filter(([p,s])=>!(p==="p"&&s===o));break;default:console.error("updateContacts: invalid operation",e);return}await M.mutateAsync({relayUrls:m().relayUrls,pubkey:i,updatedTags:c,content:u.data()?.content??""})}catch(i){console.error("failed to update contact list",i),window.alert(t.t("profile.failedToUpdateFollowList"))}finally{j(!1)}},Q=()=>{R("follow",l.pubkey).catch(e=>{console.log("failed to follow",e)})},H=()=>{window.confirm(t.t("profile.confirmUnfollow"))&&R("unfollow",l.pubkey).catch(e=>{console.log("failed to unfollow",e)})},S=Me(()=>({menu:[{content:t.t("profile.copyPubkey"),onSelect:()=>{navigator.clipboard.writeText(C()).catch(e=>window.alert(e))}},{content:t.t("profile.addUserColumn"),onSelect:()=>{const e=g()?.name??C();b(Pe({name:e,pubkey:l.pubkey})),k({command:"moveToLastColumn"}).catch(o=>console.error(o)),l.onClose?.()}},{content:t.t("profile.addUserHomeColumn"),onSelect:()=>{const e=`${t.t("column.home")} / ${g()?.name??C()}`;b(Fe({name:e,pubkey:l.pubkey})),k({command:"moveToLastColumn"}).catch(o=>console.error(o)),l.onClose?.()}},{content:N()?t.t("profile.unmute"):t.t("profile.mute"),onSelect:()=>{N()?w(l.pubkey):f(l.pubkey)}},{when:()=>l.pubkey===_(),content:F()?t.t("profile.unfollowMyself"):t.t("profile.followMyself"),onSelect:()=>{F()?H():Q()}}]})),{events:me}=Y(()=>({relayUrls:m().relayUrls,filters:[{kinds:[1,6],authors:[l.pubkey],limit:10,until:He()}],continuous:!1}));return n(Le,{onClose:()=>l.onClose?.(),get children(){return[n(h,{get when(){return v(()=>!!U.isFetched)()&&g()?.banner},get fallback(){return ht()},keyed:!0,children:e=>(()=>{const o=yt(),i=o.firstChild;return I(i,"src",e),o})()}),(()=>{const e=ot(),o=e.firstChild,i=o.firstChild;return r(i,n(h,{get when(){return v(()=>!!U.isFetched)()&&g()?.picture},keyed:!0,children:u=>(()=>{const d=wt();return I(d,"src",u),d})()})),r(e,n(h,{get when(){return _()!=null},get children(){const u=rt(),d=u.firstChild,c=d.firstChild;r(d,n(T,{get children(){return[n(y,{get when(){return l.pubkey===_()},get children(){const s=tt();return s.$$click=()=>W(),r(s,()=>t.t("profile.editProfile")),s}}),n(y,{get when(){return M.isPending||Z()},get children(){const s=D();return r(s,()=>t.t("general.updating")),s}}),n(y,{get when(){return P.isPending||P.isFetching},get children(){const s=D();return r(s,()=>t.t("general.loading")),s}}),n(y,{get when(){return F()},get children(){const s=nt();return s.$$click=()=>H(),s.addEventListener("mouseleave",()=>z(!1)),s.addEventListener("mouseenter",()=>z(!0)),r(s,n(h,{get when(){return!ee()},get fallback(){return t.t("profile.unfollow")},get children(){return t.t("profile.followingCurrently")}})),V(()=>s.disabled=M.isPending),s}}),n(y,{get when(){return!F()},get children(){const s=lt();return s.$$click=()=>Q(),r(s,()=>t.t("profile.follow")),V(()=>s.disabled=M.isPending),s}})]}}),c),c.$$click=()=>S.open();const p=S.targetRef;return typeof p=="function"?$e(p,c):S.targetRef=c,r(c,n(Se,{})),r(d,()=>S.popup(),null),r(u,n(T,{get children(){return[n(y,{get when(){return B.isPending},get children(){const s=O();return r(s,()=>t.t("general.loading")),s}}),n(y,{get when(){return pe()},get children(){const s=O();return r(s,()=>t.t("profile.followsYou")),s}})]}}),null),u}}),null),e})(),(()=>{const e=dt(),o=e.firstChild,i=o.firstChild,u=i.nextSibling,d=u.firstChild;return r(o,n(h,{get when(){return U.isPending},get children(){return t.t("general.loading")}}),i),r(o,n(h,{get when(){return(g()?.display_name?.length??0)>0},get children(){const c=st();return r(c,()=>g()?.display_name),c}}),i),r(i,n(h,{get when(){return(g()?.name?.length??0)>0},get children(){const c=it();return c.firstChild,r(c,()=>g()?.name,null),c}}),null),r(i,n(h,{get when(){return(g()?.nip05?.length??0)>0},get children(){const c=ut();return r(c,()=>ae()?.ident,null),r(c,n(T,{get fallback(){return(()=>{const p=bt();return r(p,n(Xe,{})),p})()},get children(){return[n(y,{get when(){return ie.isPending},get children(){const p=at();return r(p,n(Ge,{})),p}}),n(y,{get when(){return ce()},get children(){const p=ct();return r(p,n(De,{})),p}})]}}),null),c}}),null),r(d,C),e})(),n(h,{get when(){return ue()},keyed:!0,children:e=>(()=>{const o=$t();return r(o,n(Ee,{parsed:e,embedding:!1,initialHidden:!0})),o})()}),(()=>{const e=pt(),o=e.firstChild,i=o.firstChild,u=i.nextSibling;return o.$$click=()=>A("Following"),r(i,()=>t.t("profile.following")),r(u,n(h,{get when(){return B.isFetched},get fallback(){return(()=>{const d=vt();return r(d,()=>t.t("general.loading")),d})()},get children(){return q().length}})),r(e,n(h,{get when(){return!m().hideCount},get children(){const d=ft(),c=d.firstChild,p=c.nextSibling;return r(c,()=>t.t("profile.followers")),r(p,n(h,{get when(){return te()},get fallback(){return(()=>{const s=kt();return s.$$click=()=>ne(!0),r(s,()=>t.t("profile.loadFollowers")),s})()},keyed:!0,get children(){return n(xt,{get pubkey(){return l.pubkey}})}})),d}}),null),e})(),n(h,{get when(){return(g()?.website??"").length>0},get children(){const e=mt();return r(e,n(h,{get when(){return g()?.website},keyed:!0,children:o=>(()=>{const i=_t(),u=i.firstChild;return r(u,n(qe,{})),r(i,n(ve,{class:"text-link underline",href:o}),null),i})()})),e}}),n(T,{get children(){return n(y,{get when(){return le()==="Following"},get children(){return n(je,{get data(){return q()},pubkeyExtractor:e=>e,onClose:re})}})}}),(()=>{const e=gt();return r(e,n(Te,{get events(){return me()}})),e})()]}})};ke(["click"]);export{qt as default};
//# sourceMappingURL=ProfileDisplay-YDB5uDHA.js.map
