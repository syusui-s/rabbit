import{s as z,t as i,j as Z,v as $,V as we,k as be,z as ve,u as $e,c as T,a7 as ke,r as _e,a as r,h as g,f as G,i as l,S as U,M as y,b as K,n as xe,d as Ce,a8 as Pe,aq as Me,w as Fe,ao as Se,al as Ee}from"./index-QPQwOpEp.js";import{u as ee,d as J,k as Le,e as Te,l as Ue,m as qe,L as Ne,T as ze,n as Ae}from"./useFollowings-FoBI74ax.js";import{a as je,b as Be,d as Re,G as Qe,f as De,n as Ve,e as X,t as He,m as Ie}from"./SideBar-aqJkD1DH.js";import{B as Oe}from"./BasicModal-8HIEChVF.js";import Ge from"./EventDebugModal-4FKF_hMB.js";import Ke from"./UserList-x92szxPZ.js";import{S as Je}from"./SafeLink-JrV1PGzA.js";import"./LazyLoad-0XsPja0_.js";import"./url-4UJeT0bq.js";import"./resolveAsset-UMmPc4FE.js";import"./Copy-XSl00A4q.js";const Xe=i('<svg xmlns=http://www.w3.org/2000/svg fill=none stroke=currentColor stroke-width=1.5 aria-hidden=true data-slot=icon viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99">'),Ye=(n={})=>(()=>{const t=Xe();return z(t,n,!0,!0),t})(),We=i('<svg xmlns=http://www.w3.org/2000/svg fill=currentColor aria-hidden=true data-slot=icon viewBox="0 0 24 24"><path fill-rule=evenodd d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12m13.36-1.814a.75.75 0 1 0-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 0 0-1.06 1.06l2.25 2.25a.75.75 0 0 0 1.14-.094z"clip-rule=evenodd>'),Ze=(n={})=>(()=>{const t=We();return z(t,n,!0,!0),t})(),et=i('<svg xmlns=http://www.w3.org/2000/svg fill=currentColor aria-hidden=true data-slot=icon viewBox="0 0 24 24"><path fill-rule=evenodd d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12M12 8.25a.75.75 0 0 1 .75.75v3.75a.75.75 0 0 1-1.5 0V9a.75.75 0 0 1 .75-.75m0 8.25a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5"clip-rule=evenodd>'),tt=(n={})=>(()=>{const t=et();return z(t,n,!0,!0),t})();var te=/^(?:([\w.+-]+)@)?([\w.-]+)$/,ne;try{ne=fetch}catch{}async function nt(n){const t=n.match(te);if(!t)return null;const[f,d="_",w]=t;try{const v=await ne(`https://${w}/.well-known/nostr.json?name=${d}`),{names:b,relays:k}=rt(await v.json()),x=b[d];return x?{pubkey:x,relays:k?.[x]}:null}catch{return null}}function rt(n){const t={names:{}};for(const[f,d]of Object.entries(n.names))typeof f=="string"&&typeof d=="string"&&(t.names[f]=d);if(n.relays){t.relays={};for(const[f,d]of Object.entries(n.relays))typeof f=="string"&&Array.isArray(d)&&(t.relays[f]=d.filter(w=>typeof w=="string"))}return t}const lt=n=>{if(n==null||n.length===0)return null;const t=n.match(te);if(t==null)return null;const[,f,d]=t;return f==null||f==="_"?{user:"_",domain:d,ident:d}:{user:f,domain:d,ident:n}};function ot(n){const{config:t}=Z(),f=$(n),{events:d}=ee(()=>({relayUrls:t().relayUrls,filters:[{kinds:[we],"#p":[f().pubkey]}],limit:1e6,eoseLimit:1e6,continuous:!1})),w=()=>be(d()?.map(b=>b.pubkey));return{followersPubkeys:w,count:()=>w().length}}const st=n=>{const t=$(n),f=()=>["useVerification",t()],d=ve(()=>({queryKey:f(),queryFn:({queryKey:v})=>{const[,b]=v;if(b==null)return Promise.resolve(null);const{nip05:k}=b;return nt(k)},staleTime:30*60*1e3,gcTime:24*60*60*1e3}));return{verification:()=>d?.data??null,query:d}},it=i('<button class="rounded-full border border-primary px-4 py-2 text-center font-bold text-primary hover:bg-primary hover:text-primary-fg sm:w-20">'),Y=i('<span class="rounded-full border border-primary px-4 py-2 text-primary sm:text-base">'),at=i('<button class="rounded-full border border-primary bg-primary px-4 py-2 text-center font-bold text-primary-fg hover:bg-primary-hover sm:w-36">'),ct=i('<button class="w-28 rounded-full border border-primary px-4 py-2 text-primary hover:border-primary-hover hover:text-primary-hover">'),W=i('<div class="shrink-0 text-xs">'),ut=i('<div class="flex shrink-0 flex-col items-center gap-1"><div class="flex flex-row justify-start gap-1"><button type=button class="w-10 rounded-full border border-primary p-2 text-primary hover:border-primary-hover hover:text-primary-hover">'),dt=i('<div class="mt-[-54px] flex items-end gap-4 px-4 pt-4"><div class="flex-1 shrink-0"><div class="size-28 overflow-hidden rounded-lg shadow-md">'),ft=i('<div class="truncate text-xl font-bold">'),pt=i('<div class="truncate text-xs">@'),mt=i('<span class="inline-block size-3">'),ht=i('<span class="inline-block size-4 text-link">'),gt=i('<div class="flex items-center text-xs">'),yt=i('<div class="flex items-start px-4 pt-2"><div class="h-16 shrink overflow-hidden"><div class="flex items-center gap-2"></div><div class="flex gap-1"><div class="truncate text-xs">'),wt=i('<div class="flex flex-1 flex-col items-start"><div class=text-sm></div><div class=text-xl>'),bt=i('<div class="flex border-t border-border px-4 py-2"><button class="flex flex-1 flex-col items-start"><div class=text-sm></div><div class=text-xl>'),vt=i('<ul class="border-t border-border px-5 py-2 text-xs">'),$t=i('<ul class="border-t border-border p-1">'),kt=i('<div class="h-12 shrink-0">'),_t=i('<div class="h-40 w-full shrink-0 sm:h-52"><img alt=header class="size-full object-cover">'),xt=i('<img alt="user icon"class="size-full object-cover">'),Ct=i('<span class="inline-block size-4 text-danger">'),Pt=i('<div class="max-h-40 shrink-0 overflow-y-auto whitespace-pre-wrap px-4 py-2 text-sm">'),Mt=i("<span class=text-sm>"),Ft=i('<button class="text-sm hover:text-fg-secondary">'),St=i('<li class="flex items-center gap-1"><span class="inline-block size-4"area-label=website title=website>'),Et=n=>{const{count:t}=ot(()=>({pubkey:n.pubkey}));return $(t)},Dt=n=>{const t=$e(),{config:f,addMutedPubkey:d,removeMutedPubkey:w,isPubkeyMuted:v,saveColumn:b}=Z(),k=je(),x=Ie(),_=Be(),{showProfileEdit:re}=De(),C=$(()=>Ve(n.pubkey)),[le,A]=T(!1),[oe,j]=T(!1),[se,ie]=T(!1),[B,q]=T(null),R=()=>q(null),{profile:m,event:ae,query:P}=Re(()=>({pubkey:n.pubkey})),{verification:ce,query:ue}=st(()=>X([m()?.nip05])(([e])=>({nip05:e}))),de=()=>lt(m()?.nip05),fe=()=>ce()?.pubkey===n.pubkey,Q=()=>v(n.pubkey),pe=$(()=>{const e=ae(),o=m()?.about;if(e==null||o==null)return;const a=Pe(o);return Me(a,Fe(e))}),{followingPubkeys:me,invalidateFollowings:he,query:M}=J(()=>X([_()])(([e])=>({pubkey:e}))),F=()=>me().includes(n.pubkey),{followingPubkeys:N,query:D}=J(()=>({pubkey:n.pubkey})),ge=()=>{const e=_();return e!=null&&N().includes(e)},S=ke(()=>({mutationKey:["updateContacts"],mutationFn:(...e)=>x.updateContacts(...e).then(o=>Promise.allSettled(o.map(He(5e3)))),onSuccess:e=>{const o=e.filter(u=>u.status==="fulfilled").length,a=e.length-o;o===e.length?console.log("succeeded to update contacts"):o>0?console.log(`succeeded to update contacts for ${o} relays but failed for ${a} relays`):console.error("failed to update contacts")},onError:e=>{console.error("failed to update contacts: ",e)},onSettled:()=>{he().then(()=>M.refetch()).catch(e=>console.error("failed to refetch contacts",e))}})),V=async(e,o)=>{try{const a=_();if(a==null)return;A(!0);const u=await Ae({pubkey:a});if((u.data()==null||u.followingPubkeys().length===0)&&!window.confirm(t.t("profile.confirmUpdateEvenIfEmpty")))return;if((u?.data()?.created_at??0)<(M.data?.created_at??0)){window.alert(t.t("profile.failedToFetchLatestFollowList"));return}const p=u.data()?.tags??[];let c;switch(e){case"follow":c=[...p,["p",o]];break;case"unfollow":c=p.filter(([h,s])=>!(h==="p"&&s===o));break;default:console.error("updateContacts: invalid operation",e);return}await S.mutateAsync({relayUrls:f().relayUrls,pubkey:a,updatedTags:c,content:u.data()?.content??""})}catch(a){console.error("failed to update contact list",a),window.alert(t.t("profile.failedToUpdateFollowList"))}finally{A(!1)}},H=()=>{V("follow",n.pubkey).catch(e=>{console.log("failed to follow",e)})},I=()=>{window.confirm(t.t("profile.confirmUnfollow"))&&V("unfollow",n.pubkey).catch(e=>{console.log("failed to unfollow",e)})},E=Le(()=>({menu:[{content:t.t("profile.copyPubkey"),onSelect:()=>{navigator.clipboard.writeText(C()).catch(e=>window.alert(e))}},{content:t.t("profile.showJSON"),onSelect:()=>{q("EventDebugModal")}},{content:t.t("profile.addColumn"),items:[{content:t.t("profile.addUserColumn"),onSelect:()=>{const e=m()?.name??C();b(Se({name:e,pubkey:n.pubkey})),k({command:"moveToLastColumn"}).catch(o=>console.error(o)),n.onClose?.()}},{content:t.t("profile.addUserHomeColumn"),onSelect:()=>{const e=`${t.t("column.home")} / ${m()?.name??C()}`;b(Ee({name:e,pubkey:n.pubkey})),k({command:"moveToLastColumn"}).catch(o=>console.error(o)),n.onClose?.()}}]},{content:Q()?t.t("profile.unmute"):t.t("profile.mute"),onSelect:()=>{Q()?w(n.pubkey):d(n.pubkey)}},{when:()=>n.pubkey===_(),content:F()?t.t("profile.unfollowMyself"):t.t("profile.followMyself"),onSelect:()=>{F()?I():H()}}]})),L=Te(()=>({duration:null})),{events:O,eose:ye}=ee(()=>({relayUrls:f().relayUrls,filters:[{kinds:[1,6],authors:[n.pubkey],limit:10,since:L.since(),until:L.until()}],eoseLimit:10,continuous:!1}));return _e(()=>L.setEvents(O())),r(Oe,{onClose:()=>n.onClose?.(),get children(){return[r(g,{get when(){return $(()=>!!P.isFetched)()&&m()?.banner},get fallback(){return kt()},keyed:!0,children:e=>(()=>{const o=_t(),a=o.firstChild;return G(a,"src",e),o})()}),(()=>{const e=dt(),o=e.firstChild,a=o.firstChild;return l(a,r(g,{get when(){return $(()=>!!P.isFetched)()&&m()?.picture},keyed:!0,children:u=>(()=>{const p=xt();return G(p,"src",u),p})()})),l(e,r(g,{get when(){return _()!=null},get children(){const u=ut(),p=u.firstChild,c=p.firstChild;l(p,r(U,{get children(){return[r(y,{get when(){return n.pubkey===_()},get children(){const s=it();return s.$$click=()=>re(),l(s,()=>t.t("profile.editProfile")),s}}),r(y,{get when(){return S.isPending||le()},get children(){const s=Y();return l(s,()=>t.t("general.updating")),s}}),r(y,{get when(){return M.isPending||M.isFetching},get children(){const s=Y();return l(s,()=>t.t("general.loading")),s}}),r(y,{get when(){return F()},get children(){const s=at();return s.$$click=()=>I(),s.addEventListener("mouseleave",()=>j(!1)),s.addEventListener("mouseenter",()=>j(!0)),l(s,r(g,{get when(){return!oe()},get fallback(){return t.t("profile.unfollow")},get children(){return t.t("profile.followingCurrently")}})),K(()=>s.disabled=S.isPending),s}}),r(y,{get when(){return!F()},get children(){const s=ct();return s.$$click=()=>H(),l(s,()=>t.t("profile.follow")),K(()=>s.disabled=S.isPending),s}})]}}),c),c.$$click=()=>E.open();const h=E.targetRef;return typeof h=="function"?xe(h,c):E.targetRef=c,l(c,r(Ue,{})),l(p,()=>E.popup(),null),l(u,r(U,{get children(){return[r(y,{get when(){return D.isPending},get children(){const s=W();return l(s,()=>t.t("general.loading")),s}}),r(y,{get when(){return ge()},get children(){const s=W();return l(s,()=>t.t("profile.followsYou")),s}})]}}),null),u}}),null),e})(),(()=>{const e=yt(),o=e.firstChild,a=o.firstChild,u=a.nextSibling,p=u.firstChild;return l(o,r(g,{get when(){return P.isPending},get children(){return t.t("general.loading")}}),a),l(o,r(g,{get when(){return(m()?.display_name?.length??0)>0},get children(){const c=ft();return l(c,()=>m()?.display_name),c}}),a),l(a,r(g,{get when(){return(m()?.name?.length??0)>0},get children(){const c=pt();return c.firstChild,l(c,()=>m()?.name,null),c}}),null),l(a,r(g,{get when(){return(m()?.nip05?.length??0)>0},get children(){const c=gt();return l(c,()=>de()?.ident,null),l(c,r(U,{get fallback(){return(()=>{const h=Ct();return l(h,r(tt,{})),h})()},get children(){return[r(y,{get when(){return ue.isPending},get children(){const h=mt();return l(h,r(Ye,{})),h}}),r(y,{get when(){return fe()},get children(){const h=ht();return l(h,r(Ze,{})),h}})]}}),null),c}}),null),l(p,C),e})(),r(g,{get when(){return pe()},keyed:!0,children:e=>(()=>{const o=Pt();return l(o,r(qe,{parsed:e,embedding:!1,initialHidden:!0})),o})()}),(()=>{const e=bt(),o=e.firstChild,a=o.firstChild,u=a.nextSibling;return o.$$click=()=>q("Following"),l(a,()=>t.t("profile.following")),l(u,r(g,{get when(){return D.isFetched},get fallback(){return(()=>{const p=Mt();return l(p,()=>t.t("general.loading")),p})()},get children(){return N().length}})),l(e,r(g,{get when(){return!f().hideCount},get children(){const p=wt(),c=p.firstChild,h=c.nextSibling;return l(c,()=>t.t("profile.followers")),l(h,r(g,{get when(){return se()},get fallback(){return(()=>{const s=Ft();return s.$$click=()=>ie(!0),l(s,()=>t.t("profile.loadFollowers")),s})()},keyed:!0,get children(){return r(Et,{get pubkey(){return n.pubkey}})}})),p}}),null),e})(),r(g,{get when(){return(m()?.website??"").length>0},get children(){const e=vt();return l(e,r(g,{get when(){return m()?.website},keyed:!0,children:o=>(()=>{const a=St(),u=a.firstChild;return l(u,r(Qe,{})),l(a,r(Je,{class:"text-link underline",href:o}),null),a})()})),e}}),r(U,{get children(){return[r(y,{get when(){return B()==="Following"},get children(){return r(Ke,{get data(){return N()},pubkeyExtractor:e=>e,onClose:R})}}),r(y,{get when(){return B()==="EventDebugModal"&&P.data},keyed:!0,children:e=>r(Ge,{event:e,get extra(){return JSON.stringify(m(),null,2)},onClose:R})})]}}),(()=>{const e=$t();return l(e,r(Ne,{loadMore:L,get eose(){return ye()},get children(){return r(ze,{get events(){return O()}})}})),e})()]}})};Ce(["click"]);export{Dt as default};
//# sourceMappingURL=ProfileDisplay-T78DhCey.js.map
