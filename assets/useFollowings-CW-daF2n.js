const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/EventDebugModal-BVI5cMfD.js","assets/index-CQ2Pvw-m.js","assets/index-D0gJNBac.css","assets/BasicModal-CPnD2lxc.js","assets/SideBar-Ck3Iopy8.js","assets/resolveAsset-3vY2n3nc.js","assets/Copy-DTX8uf9q.js","assets/UserList-DgABSbOt.js","assets/url-DPIb-kBm.js","assets/LazyLoad-C6pxGWuT.js","assets/ZapRequestModal-DiGNNhhV.js","assets/lud16ToLnurlPayUrl-DEg6v1Nh.js","assets/_baseClone-C1CvY8Hx.js","assets/SafeLink-sOTTTVCq.js"])))=>i.map(i=>d[i]);
import{i as h,t as f,s as O,r as p,a as r,f as C,h as w,av as Ie,aw as ct,y as N,u as L,ax as at,j as M,M as E,ag as ut,S as q,c as x,q as B,A as H,p as Pe,d as I,v as Le,o as ee,F as Q,n as j,x as V,B as J,ab as ce,C as ae,_ as ue,b as S,m as X,w as de,al as dt,ao as ht,aj as ft,ai as gt,K as vt,l as mt,D as $t,ay as me,ak as $e}from"./index-CQ2Pvw-m.js";import{r as De,t as te,B as Z,f as K,U as yt,g as he,q as je,s as Ae,o as fe,b as ne,v as bt,j as wt,P as kt,E as pt,e as Ue,n as Fe,a as _t,k as xt,N as Et,w as Ct,x as ye,y as le,m as Rt,z as Tt,A as St}from"./SideBar-Ck3Iopy8.js";import{L as A}from"./LazyLoad-C6pxGWuT.js";import{S as T}from"./SafeLink-sOTTTVCq.js";import{t as qe,a as He,p as Mt,b as It,c as Pt,d as Lt,i as Dt}from"./url-DPIb-kBm.js";const jt=f('<div class="block shrink-0 overflow-hidden border-b border-border p-1">'),ie=e=>(()=>{const t=jt();return h(t,()=>e.children),t})(),At=f('<svg xmlns=http://www.w3.org/2000/svg fill=none stroke=currentColor stroke-width=1.5 aria-hidden=true data-slot=icon viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round d="M19.5 12c0-1.232-.046-2.453-.138-3.662a4.006 4.006 0 0 0-3.7-3.7 48.678 48.678 0 0 0-7.324 0 4.006 4.006 0 0 0-3.7 3.7c-.017.22-.032.441-.046.662M19.5 12l3-3m-3 3-3-3m-12 3c0 1.232.046 2.453.138 3.662a4.006 4.006 0 0 0 3.7 3.7 48.656 48.656 0 0 0 7.324 0 4.006 4.006 0 0 0 3.7-3.7c.017-.22.032-.441.046-.662M4.5 12l3 3m-3-3-3 3">'),Oe=(e={})=>(()=>{const t=At();return O(t,e,!0),t})(),Ut=f("<span>"),Ft=f('<a class="text-link underline">'),qt=e=>{try{return Ie(e)}catch(t){return console.error("failed to encode event id into Bech32 entity (NIP-19) but ignore",e,t),e}},Ht=(e,t)=>{try{return ct({id:e,kind:t})}catch(n){return console.error("failed to encode event id into Bech32 entity (NIP-19) but ignore",e,n),e}},W=e=>{const t=p(()=>e.kind==null||e.kind===1?qt(e.eventId):Ht(e.eventId,e.kind)),n=()=>t()!==e.eventId?`nostr:${t()}`:null;return r(w,{get when(){return n()},get fallback(){return(()=>{const l=Ut();return h(l,()=>e.eventId),l})()},keyed:!0,children:l=>(()=>{const c=Ft();return C(c,"href",l),h(c,t),c})()})},Ot=e=>{const t=p(e),n=N(()=>({queryKey:["useEvent",t()],queryFn:({queryKey:c,signal:i})=>{const[,o]=c;if(o==null)return null;const{eventId:s}=o,u=new Z({type:"Event",eventId:s}),a=u.firstEventPromise().catch(()=>{throw new Error(`event not found: ${s}`)});return console.log("useEvent",t()),De({task:u,signal:i}),te(15e3,`useEvent: ${s}`)(a)},staleTime:4*60*60*1e3,gcTime:4*60*60*1e3,refetchOnWindowFocus:!1,refetchOnMount:!1}));return{event:()=>n.data??null,query:n}},Bt=f("<span>"),Kt=f("<div class=truncate> "),z=e=>{const t=L(),[n,l]=at(e,["eventId"]),{shouldMuteEvent:c}=M(),{event:i,query:o}=Ot(()=>K([n.eventId])(([u])=>({eventId:u}))),s=()=>{const u=i();return u!=null&&c(u)};return r(q,{get fallback(){return(()=>{const u=Bt();return h(u,()=>t.t("post.failedToFetchEvent"),null),h(u,()=>e.eventId,null),u})()},get children(){return[r(E,{get when(){return s()},children:null}),r(E,{get when(){return i()},keyed:!0,children:u=>r(lt,ut({event:u},l))}),r(E,{get when(){return o.isLoading&&n.eventId},keyed:!0,children:u=>(()=>{const a=Kt(),d=a.firstChild;return h(a,()=>t.t("general.loading"),d),h(a,r(W,{eventId:u}),null),a})()})]}})},Be=e=>{const[t,n]=x(new Date);return B(()=>{const l=setInterval(()=>{n(new Date)},e().interval);H(()=>clearInterval(l))}),t},Wt=e=>{switch(e.kind){case"now":return"now";case"seconds":return`${e.value}s`;case"minutes":return`${e.value}m`;case"hours":return`${e.value}h`;case"days":return`${e.value}d`;case"abs":default:return e.value.toLocaleDateString()}},be=e=>`${e.getHours()}:${e.getMinutes().toString().padStart(2,"0")}`,zt=e=>{switch(e.kind){case"today":return e.value.toLocaleTimeString();case"yesterday":case"abs":default:return e.value.toLocaleString()}},Nt=e=>{switch(e.kind){case"today":return be(e.value);case"yesterday":return`昨日 ${be(e.value)}`;case"abs":default:return e.value.toLocaleString()}},Qt=(e,t)=>Math.round(Number(t)-Number(e))/1e3,Vt=(e,t)=>{const n=Qt(e,t);return n<10?{kind:"now"}:n<60?{kind:"seconds",value:Math.round(n)}:n<3600?{kind:"minutes",value:Math.round(n/60)}:n<86400?{kind:"hours",value:Math.round(n/3600)}:n<604800?{kind:"days",value:Math.round(n/86400)}:{kind:"abs",value:e}},we=(e,t)=>e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate(),Zt=e=>new Date(+e-24*60*60*1e3),Ke=(e,t,n)=>we(e,t)?n({kind:"today",value:e}):we(e,Zt(t))?n({kind:"yesterday",value:e}):n({kind:"abs",value:e}),Gt=(e,t=new Date)=>Ke(e,t,zt),Yt=(e,t=new Date)=>Ke(e,t,Nt),ke=(e,t=new Date,n=Wt)=>n(Vt(e,t)),pe=Pe(()=>Be(()=>({interval:7e3}))),_e=Pe(()=>Be(()=>({interval:60*1e3}))),We=()=>{const{config:e}=M();return t=>{switch(e().dateFormat){case"absolute-long":return Gt(t,_e());case"absolute-short":return Yt(t,_e());case"relative":return ke(t,pe());default:return ke(t,pe())}}},Jt=f('<div><div class="flex items-center gap-1"><div class="flex shrink-0 place-items-center pl-[2px]"aria-hidden=true><span class="size-4 text-r-repost"></span></div><div class="notification-user flex min-w-0 flex-1 overflow-hidden text-xs"><button class="select-text truncate hover:text-link hover:underline"></button><span class="shrink-0 whitespace-pre"></span></div><div class=text-xs></div></div><div class=pt-1>'),Xt=e=>{const t=L(),{showProfile:n}=he(),l=We(),c=p(()=>Le(e.event)),i=()=>c().lastTaggedEventId();return(()=>{const o=Jt(),s=o.firstChild,u=s.firstChild,a=u.firstChild,d=u.nextSibling,g=d.firstChild,y=g.nextSibling,m=d.nextSibling,$=s.nextSibling;return h(a,r(Oe,{})),g.$$click=()=>n(e.event.pubkey),h(g,r(yt,{get pubkey(){return e.event.pubkey}})),h(y,()=>t.t("notification.reposted")),h(m,()=>l(c().createdAtAsDate())),h($,r(z,{get eventId(){return i()}})),o})()};I(["click"]);const en=f('<svg xmlns=http://www.w3.org/2000/svg fill=none stroke=currentColor stroke-width=1.5 aria-hidden=true data-slot=icon viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round d="m3.75 13.5 10.5-11.25L12 10.5h8.25L9.75 21.75 12 13.5z">'),tn=(e={})=>(()=>{const t=en();return O(t,e,!0),t})(),nn=f('<svg xmlns=http://www.w3.org/2000/svg fill=none stroke=currentColor stroke-width=1.5 aria-hidden=true data-slot=icon viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round d="M2.25 12.76c0 1.6 1.123 2.994 2.707 3.227 1.087.16 2.185.283 3.293.369V21l4.076-4.076a1.526 1.526 0 0 1 1.037-.443 48.282 48.282 0 0 0 5.68-.494c1.584-.233 2.707-1.626 2.707-3.228V6.741c0-1.602-1.123-2.995-2.707-3.228A48.394 48.394 0 0 0 12 3c-2.392 0-4.744.175-7.043.513C3.373 3.746 2.25 5.14 2.25 6.741z">'),rn=(e={})=>(()=>{const t=nn();return O(t,e,!0),t})(),on=f('<svg xmlns=http://www.w3.org/2000/svg fill=none stroke=currentColor stroke-width=1.5 aria-hidden=true data-slot=icon viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round d="M6.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0m6 0a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0m6 0a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0">'),sn=(e={})=>(()=>{const t=on();return O(t,e,!0),t})(),ln=f('<svg xmlns=http://www.w3.org/2000/svg fill=currentColor aria-hidden=true data-slot=icon viewBox="0 0 24 24"><path d="m11.645 20.91-.007-.003-.022-.012a15.247 15.247 0 0 1-.383-.218 25.18 25.18 0 0 1-4.244-3.17C4.688 15.36 2.25 12.174 2.25 8.25 2.25 5.322 4.714 3 7.688 3A5.5 5.5 0 0 1 12 5.052 5.5 5.5 0 0 1 16.313 3c2.973 0 5.437 2.322 5.437 5.25 0 3.925-2.438 7.111-4.739 9.256a25.175 25.175 0 0 1-4.244 3.17 15.247 15.247 0 0 1-.383.219l-.022.012-.007.004-.003.001a.752.752 0 0 1-.704 0l-.003-.001Z">'),ze=(e={})=>(()=>{const t=ln();return O(t,e,!0),t})(),cn=f("<span class=truncate>"),an=f('<img class="pointer-events-none h-full w-auto object-contain">'),Ne=e=>r(q,{get children(){return[r(E,{get when(){return e.emoji.type==="Emoji"&&e.emoji.content},keyed:!0,children:t=>(()=>{const n=cn();return h(n,t),n})()}),r(E,{get when(){return e.emoji.type==="CustomEmoji"&&e.emoji},keyed:!0,children:({shortcode:t,url:n})=>(()=>{const l=an();return C(l,"src",n),C(l,"alt",`:${t}:`),l})()})]}}),un=f('<span class="inline-block size-full pt-px text-r-reaction">'),dn=f("<span class=truncate>"),hn=e=>e.type==="LikeDislike"&&(e.content==="+"||e.content.length===0),Qe=e=>{if(e.type==="Emoji"||e.type==="CustomEmoji")return e},Ve=e=>r(q,{get fallback(){return(()=>{const t=dn();return h(t,()=>e.reactionTypes.content),t})()},get children(){return[r(E,{get when(){return hn(e.reactionTypes)},get children(){const t=un();return h(t,r(ze,{})),t}}),r(E,{get when(){return Qe(e.reactionTypes)},keyed:!0,children:t=>r(Ne,{emoji:t})})]}}),fn=300,gn=e=>{let t,n=!1;return ee(()=>{if(t==null)return;const{onLongPress:l,onClick:c,delay:i=fn}=e();let o;const s=()=>{n=!1,o=setTimeout(()=>{n=!0,l()},i)},u=()=>{o!=null&&clearTimeout(o)},a=y=>{y.preventDefault(),s()},d=y=>{y.preventDefault(),u()},g=()=>{n||(u(),c())};t.addEventListener("mousedown",a),t.addEventListener("mouseup",d),t.addEventListener("touchstart",a),t.addEventListener("touchend",d),t.addEventListener("click",g),H(()=>{u(),t?.removeEventListener("mouseddown",a),t?.removeEventListener("mouseup",d),t?.removeEventListener("touchstart",a),t?.removeEventListener("touchend",d),t?.removeEventListener("click",g)})}),{ref:l=>{t=l}}},vn=f('<div><div class="flex h-24 min-w-24 max-w-screen-lg items-center justify-center rounded border border-border bg-bg text-5xl shadow">'),Ze=e=>{let t;const n=p(e),[l,c]=x(!1);let i;const o=()=>{setTimeout(()=>{l()||i.close()},100)},s=()=>{i.open()};i=je(()=>({popup:()=>r(w,{get when(){return n()?.emoji},keyed:!0,children:a=>(()=>{const d=vn(),g=d.firstChild;return d.addEventListener("mouseleave",()=>{c(!1),o()}),d.addEventListener("mouseenter",()=>{c(!0)}),h(g,r(Ne,{emoji:a})),d})()}),position:{x:"center",y:"top"}}));const u=gn(()=>({onLongPress:()=>s(),onClick:()=>n()?.onClick?.()}));return ee(()=>{t?.addEventListener("mouseenter",s),t?.addEventListener("mouseleave",o)}),{emojiRef:a=>{t=a,i.targetRef(a),u.ref(a)},popup:i.popup}},mn=f('<svg xmlns=http://www.w3.org/2000/svg fill=none stroke=currentColor stroke-width=1.5 aria-hidden=true data-slot=icon viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round d="m8.25 4.5 7.5 7.5-7.5 7.5">'),$n=(e={})=>(()=>{const t=mn();return O(t,e,!0),t})(),yn=f('<li class="border-b border-border hover:bg-bg-tertiary"><button class="w-full px-4 py-1 text-start">'),bn=f('<li class="border-b border-border hover:bg-bg-tertiary"><button class="flex w-full items-center py-1 pe-2 ps-4 text-start"><span class=flex-1></span><span class="inline-block size-4 shrink-0">'),wn=f('<ul class="min-w-[96px] rounded border border-border bg-bg shadow-md">'),kn=e=>{const t=()=>{e.item?.onSelect?.(),e.onClose()};return(()=>{const n=yn(),l=n.firstChild;return l.$$click=t,h(l,()=>e.item.content),n})()},pn=e=>{const t=Ge(()=>({menu:e.submenu.items,position:{x:"right",y:"bottom"}})),n=()=>{t.open()};return(()=>{const l=bn(),c=l.firstChild,i=c.firstChild,o=i.nextSibling,s=t.targetRef;return typeof s=="function"?j(s,l):t.targetRef=l,c.$$click=n,h(i,()=>e.submenu.content),h(o,r($n,{})),h(l,()=>t.popup(),null),l})()},_n=e=>"onSelect"in e?e:null,xn=e=>"items"in e?e:null,Ge=e=>{const t=p(e),n=je(()=>({ensureWidth:300,position:{x:"right",y:"bottom"},...t(),popup:(()=>{const l=wn();return h(l,r(Q,{get each(){return t().menu.filter(c=>c.when==null||c.when())},children:c=>r(q,{get children(){return[r(E,{get when(){return _n(c)},keyed:!0,children:i=>r(kn,{item:i,onClose:()=>n.close()})}),r(E,{get when(){return xn(c)},keyed:!0,children:i=>r(pn,{submenu:i,onClose:()=>n.close()})})]}})})),l})()}));return n};I(["click"]);const En=/\p{Emoji_Presentation}/u,Ye=e=>["useReactions",e],ge=e=>{const{shouldMuteEvent:t}=M(),n=V(),l=p(()=>Ye(e())),c=N(()=>({queryKey:l(),queryFn:Ae({taskProvider:([,a])=>{if(a==null)return null;const{eventId:d}=a;return new Z({type:"Reactions",mentionedEventId:d})},queryClient:n}),staleTime:1*60*1e3,gcTime:4*60*60*1e3,refetchInterval:1*60*1e3})),i=()=>(c.data??[]).filter(d=>!t(d));return{reactions:i,reactionsGrouped:()=>{const a=new Map;return i().forEach(d=>{const g=J(d).isCustomEmoji()?`${d.content}${J(d).getUrl()??""}`:d.content,y=a.get(g)??[];y.push(d),a.set(g,y)}),a},isReactedBy:a=>i().findIndex(d=>d.pubkey===a)!==-1,isReactedByWithEmoji:a=>i().findIndex(d=>d.pubkey===a&&En.test(d.content))!==-1,query:c}},Je=e=>{const t=V(),n=p(e),l=fe();return ce(()=>({mutationKey:["useReactionMutation",n().eventId],mutationFn:(...i)=>l.publishReaction(...i).then(o=>Promise.allSettled(o.map(te(5e3)))),onSuccess:i=>{const o=i.filter(u=>u.status==="fulfilled").length,s=i.length-o;o===i.length?console.log("Succeeded to publish a reaction"):o>0?console.warn(`failed to publish a reaction on ${s} relays`):console.error("failed to publish reaction on all relays")},onError:i=>{console.error("failed to publish reaction: ",i)},onSettled:()=>{const i=Ye({eventId:n().eventId});t.refetchQueries({queryKey:i}).then(()=>t.invalidateQueries({queryKey:i})).catch(o=>console.error("failed to refetch reactions",o))}}))},Xe=e=>["useReposts",e],et=e=>{const{shouldMuteEvent:t}=M(),n=V(),l=p(e),c=p(()=>Xe(l())),i=N(()=>({queryKey:c(),queryFn:Ae({taskProvider:([,u])=>{if(u==null)return null;const{eventId:a}=u;return new Z({type:"Reposts",mentionedEventId:a})},queryClient:n}),staleTime:1*60*1e3,gcTime:4*60*60*1e3,refetchInterval:1*60*1e3})),o=()=>(i.data??[]).filter(a=>!t(a));return{reposts:o,isRepostedBy:u=>o().findIndex(a=>a.pubkey===u)!==-1,query:i}},Cn=e=>{const t=V(),n=p(e),l=fe();return ce(()=>({mutationKey:["useRepostMutation",n().eventId],mutationFn:(...i)=>l.publishRepost(...i).then(o=>Promise.allSettled(o.map(te(1e4)))),onSuccess:i=>{const o=i.filter(u=>u.status==="fulfilled").length,s=i.length-o;o===i.length?console.log("Succeeded to publish a repost"):o>0?console.warn(`Failed to publish a repost on ${s} relays`):console.error("Failed to publish a repost on all relays")},onError:i=>{console.error("failed to publish repost: ",i)},onSettled:()=>{const i=Xe({eventId:n().eventId});t.refetchQueries({queryKey:i}).then(()=>t.invalidateQueries({queryKey:i})).catch(o=>console.error("failed to refetch repost",o))}}))},xe=["k","M","G","T","P"],Rn=(e,t)=>{const n=t?.precision,c=10**((t?.minDigits??4)-1);if(e<c)return{value:e,prefix:null};const i=10**(Math.floor(Math.log10(e)/3)*3),o=e/i;let s=Math.round(o*10**n)/10**n,u=Math.max(Math.floor(Math.log10(e)/3)-1,0);return s>=1e3&&(s/=1e3,u+=1),u>=xe.length?{value:e,prefix:null}:{value:s,prefix:xe[u]}},tt=(e,t)=>{const{value:n,prefix:l}=Rn(e,{precision:2,minDigits:t?.minDigits??5});if(l==null)return`${e}`;const c=t?.digits??3,i=Math.floor(Math.log10(n))+1,o=Math.max(c-i,0);return`${Math.round(n*10**o)/10**o}${l}`},nt=f('<div class="text-sm text-fg-tertiary">'),Ee=f('<div class="flex shrink-0 items-center gap-1"><button class=size-4>'),Tn=f('<div class="flex shrink-0 items-center gap-1"><button><span class="flex size-4">'),Sn=f('<div class="h-4 min-w-4 max-w-8">'),Mn=f('<div class="scrollbar flex gap-2 overflow-x-auto py-1">'),In=f('<span class="ml-1 text-sm">'),Pn=f('<button class="webkit-touch-callout-none flex h-6 touch-none select-none items-center rounded border border-border px-1"type=button><span class="flex h-5 min-w-5 max-w-[128px] items-center justify-center">'),Ln=f("<span class=text-red-500>"),Dn=f('<div class="actions flex w-64 max-w-full items-center justify-between pt-1"><button class="shrink-0 text-fg-tertiary hover:text-fg-tertiary/70"><span class="flex size-4"></span></button><button type=button><span class="flex size-4 text-fg-tertiary hover:text-r-zap"></span></button><button type=button class="size-4 shrink-0 text-fg-tertiary hover:text-fg-tertiary/70">'),jn=ae(()=>ue(()=>import("./EventDebugModal-BVI5cMfD.js"),__vite__mapDeps([0,1,2,3,4,5,6]))),rt=ae(()=>ue(()=>import("./UserList-DgABSbOt.js"),__vite__mapDeps([7,1,2,4,5,8,3,9]))),An=ae(()=>ue(()=>import("./ZapRequestModal-DiGNNhhV.js"),__vite__mapDeps([10,1,2,3,4,5,6,11,12,9,13,8]))),Un=e=>{if(e.native!=null)return{type:"Emoji",content:e.native};if(e.src!=null)return{type:"CustomEmoji",content:`:${e.id}:`,shortcode:e.id,url:e.src};throw new Error("unknown emoji")},Fn=e=>{const{config:t}=M(),n=ne(),[l,c]=x(!1),{reactions:i,isReactedByWithEmoji:o,isReactedBy:s}=ge(()=>({eventId:e.event.id})),u=p(()=>{const v=n();return v!=null&&s(v)||l()}),a=p(()=>{const v=n();return v!=null&&o(v)}),d=Je(()=>({eventId:e.event.id})),g=v=>{u()||K([n(),e.event.id])(([k,b])=>{d.mutate({relayUrls:t().relayUrls,pubkey:k,reactionTypes:v??{type:"LikeDislike",content:"+"},eventId:b,kind:e.event.kind,notifyPubkey:e.event.pubkey}),c(!0)})},y=v=>{v.stopPropagation(),g()},m=v=>{g(Un(v))},$=bt(()=>({onEmojiSelect:m}));return[(()=>{const v=Ee(),k=v.firstChild;return k.$$click=y,h(k,r(w,{get when(){return p(()=>!!u())()&&!a()},get fallback(){return r(wt,{})},get children(){return r(ze,{})}})),h(v,r(w,{get when(){return p(()=>!t().hideCount&&!t().showEmojiReaction)()&&i().length>0},get children(){const b=nt();return h(b,()=>tt(i().length,{minDigits:4})),b}}),null),S(b=>{const P={"text-fg-tertiary":!u()||a(),"hover:text-r-reaction":!u()||a(),"text-r-reaction":u()&&!a()||d.isPending},R=d.isPending;return b._v$=X(v,P,b._v$),R!==b._v$2&&(k.disabled=b._v$2=R),b},{_v$:void 0,_v$2:void 0}),v})(),r(w,{get when(){return t().useEmojiReaction},get children(){const v=Ee(),k=v.firstChild;k.$$click=()=>$.open();const b=$.targetRef;return typeof b=="function"?j(b,k):$.targetRef=k,h(k,r(kt,{})),h(v,()=>$.popup(),null),S(P=>X(v,{"text-fg-tertiary":!u()||!a(),"hover:text-r-reaction":!u()||!a(),"text-r-reaction":u()&&a()||d.isPending},P)),v}})]},qn=e=>{const{config:t}=M(),n=ne(),[l,c]=x(!1),{reposts:i,isRepostedBy:o}=et(()=>({eventId:e.event.id})),s=p(()=>{const d=n();return d!=null&&o(d)||l()}),u=Cn(()=>({eventId:e.event.id})),a=d=>{d.stopPropagation(),!s()&&K([n(),e.event.id])(([g,y])=>{u.mutate({relayUrls:t().relayUrls,pubkey:g,eventId:y,kind:e.event.kind,notifyPubkey:e.event.pubkey}),c(!0)})};return(()=>{const d=Tn(),g=d.firstChild,y=g.firstChild;return g.$$click=a,h(y,r(Oe,{})),h(d,r(w,{get when(){return p(()=>!t().hideCount)()&&i().length>0},get children(){const m=nt();return h(m,()=>tt(i().length,{minDigits:4})),m}}),null),S(m=>{const $={"text-fg-tertiary":!s(),"hover:text-r-repost":!s(),"text-r-repost":s()||u.isPending},v=u.isPending;return m._v$3=X(d,$,m._v$3),v!==m._v$4&&(g.disabled=m._v$4=v),m},{_v$3:void 0,_v$4:void 0}),d})()},Hn=e=>{const{reactions:t}=ge(()=>({eventId:e.event.id}));return r(rt,{get data(){return t()},pubkeyExtractor:n=>n.pubkey,renderInfo:n=>(()=>{const l=Sn();return h(l,r(Ve,{get reactionTypes(){return J(n).toReactionTypes()}})),l})(),get onClose(){return e.onClose}})},On=e=>{const{reposts:t}=et(()=>({eventId:e.event.id}));return r(rt,{get data(){return t()},pubkeyExtractor:n=>n.pubkey,get onClose(){return e.onClose}})},Bn=e=>{const{config:t}=M(),n=ne(),[l,c]=x(!1),{reactions:i,reactionsGrouped:o,isReactedBy:s}=ge(()=>({eventId:e.event.id})),u=Je(()=>({eventId:e.event.id})),a=()=>{const g=n();return g==null?l():l()||s(g)},d=g=>{a()||K([n(),e.event.id])(([y,m])=>{u.mutate({relayUrls:t().relayUrls,pubkey:y,reactionTypes:g??{type:"LikeDislike",content:"+"},eventId:m,kind:e.event.kind,notifyPubkey:e.event.pubkey}),c(!0)})};return r(w,{get when(){return p(()=>!!t().showEmojiReaction)()&&i().length>0},get children(){const g=Mn();return h(g,r(Q,{get each(){return[...o().entries()]},children:([,y])=>{const m=y.findIndex(b=>b.pubkey===n())>=0,$=J(y[0]).toReactionTypes(),v=Qe($),k=Ze(()=>K([v])(([b])=>({emoji:b,onClick:()=>{a()||u.isPending||d($)}})));return(()=>{const b=Pn(),P=b.firstChild;return j(R=>k.emojiRef(R),b),h(P,r(Ve,{reactionTypes:$})),h(b,r(w,{get when(){return!t().hideCount},get children(){const R=In();return h(R,()=>y.length),R}}),null),h(b,()=>k.popup(),null),S(R=>X(b,{"text-fg-tertiary":!m,"hover:bg-r-reaction/10":!m,"hover:border-r-reaction/40":!m,"bg-r-reaction/10":m,"border-r-reaction/40":m,"text-r-reaction":m},R)),b})()}})),g}})},Kn=e=>{const t=L(),{config:n}=M(),l=ne(),c=fe(),[i,o]=x(null),s=()=>o(null),u=ce(()=>({mutationKey:["deleteEvent",e.event.id],mutationFn:(...d)=>c.deleteEvent(...d).then(g=>Promise.allSettled(g.map(te(1e4)))),onSuccess:d=>{const g=d.filter(m=>m.status==="fulfilled").length,y=d.length-g;g===d.length?window.alert(t.t("post.deletedSuccessfully")):g>0?window.alert(t.t("post.failedToDeletePartially",{count:y})):window.alert(t.t("post.failedToDelete"))},onError:d=>{console.error("failed to delete",d)}})),a=Ge(()=>({menu:[{content:t.t("post.copyEventId"),onSelect:()=>{navigator.clipboard.writeText(Ie(e.event.id)).catch(d=>window.alert(d))}},{content:t.t("post.showJSON"),onSelect:()=>{o("EventDebugModal")}},{content:t.t("post.showReposts"),onSelect:()=>{o("Reposts")}},{content:t.t("post.showReactions"),onSelect:()=>{o("Reactions")}},{when:()=>e.event.pubkey===l(),content:(()=>{const d=Ln();return h(d,()=>t.t("post.deletePost")),d})(),onSelect:()=>{const d=l();d!=null&&window.confirm(t.t("post.confirmDelete"))&&u.mutate({relayUrls:n().relayUrls,pubkey:d,eventId:e.event.id,kind:e.event.kind})}}]}));return[r(Bn,{get event(){return e.event}}),(()=>{const d=Dn(),g=d.firstChild,y=g.firstChild,m=g.nextSibling,$=m.firstChild,v=m.nextSibling;g.$$click=b=>{b.stopPropagation(),e.onClickReply()},h(y,r(rn,{})),h(d,r(qn,{get event(){return e.event}}),m),h(d,r(Fn,{get event(){return e.event}}),m),m.$$click=()=>o("ZapRequest"),h($,r(tn,{})),v.$$click=()=>a.open();const k=a.targetRef;return typeof k=="function"?j(k,v):a.targetRef=v,h(v,r(sn,{})),h(d,()=>a.popup(),null),d})(),r(q,{get children(){return[r(E,{get when(){return i()==="EventDebugModal"},get children(){return r(jn,{get event(){return e.event},onClose:s})}}),r(E,{get when(){return i()==="Reactions"},get children(){return r(Hn,{get event(){return e.event},onClose:s})}}),r(E,{get when(){return i()==="Reposts"},get children(){return r(On,{get event(){return e.event},onClose:s})}}),r(E,{get when(){return i()==="ZapRequest"},get children(){return r(An,{get zapTo(){return{event:e.event}},onClose:s})}})]}})]};I(["click"]);const Wn=f("<div>"),zn=f('<button class="text-xs text-fg-secondary hover:text-fg-secondary/70">'),Nn=f("<span>: "),Qn=f('<button class="mt-2 flex w-full flex-col items-center rounded border border-border p-2 text-center text-xs text-fg-secondary"><span class="inline-block size-4"></span><span>'),Vn=e=>{const t=L(),[n,l]=x(!1);return r(w,{get when(){return!e.contentWarning.contentWarning||n()},get fallback(){return(()=>{const c=Qn(),i=c.firstChild,o=i.nextSibling;return c.$$click=()=>l(!0),h(i,r(pt,{})),h(o,()=>t.t("post.contentWarning.show")),h(c,r(w,{get when(){return e.contentWarning.reason!=null},get children(){const s=Nn(),u=s.firstChild;return h(s,()=>t.t("post.contentWarning.reason"),u),h(s,()=>e.contentWarning.reason,null),s}}),null),c})()},get children(){return[(()=>{const c=Wn();return h(c,()=>e.children),c})(),r(w,{get when(){return e.contentWarning.contentWarning},get children(){const c=zn();return c.$$click=()=>l(!1),h(c,()=>t.t("post.contentWarning.hide")),c}})]}})};I(["click"]);const ot=e=>{const{profile:t}=Ue(()=>({pubkey:e.pubkey}));return r(w,{get when(){return(t()?.name?.length??0)>0},get fallback(){return`@${Fe(e.pubkey)}`},get children(){return["@",p(()=>t()?.name??e.pubkey)]}})},Zn=f('<button class="rounded bg-bg-tertiary p-3 text-xs text-fg-secondary hover:shadow">'),Gn=f("<div class=max-w-full>"),Yn=f("<audio controls><a>"),Jn=e=>{const t=L(),[n,l]=x(e.initialHidden);return r(w,{get when(){return!n()},get fallback(){return(()=>{const c=Zn();return c.$$click=()=>l(!1),h(c,()=>t.t("post.showAudio")),c})()},get children(){return r(A,{get fallback(){return Gn()},children:()=>r(T,{class:"my-2 block",get href(){return e.url},get children(){const c=Yn(),i=c.firstChild;return h(i,()=>t.t("post.download")),S(o=>{const s=e.url,u=e.url;return s!==o._v$&&C(c,"src",o._v$=s),u!==o._v$2&&C(i,"href",o._v$2=u),o},{_v$:void 0,_v$2:void 0}),c}})})}})};I(["click"]);const Xn=f('<button class="rounded bg-bg-tertiary p-3 text-xs text-fg-secondary hover:shadow">'),er=f('<div class="aspect-video max-w-full">'),tr=f('<img class="max-h-64 max-w-full rounded object-contain shadow hover:shadow-md">'),nr=e=>{let t;const n=L(),[l,c]=x(e.initialHidden),[i,o]=x(!1);return r(w,{get when(){return!l()},get fallback(){return(()=>{const s=Xn();return s.$$click=()=>c(!1),h(s,()=>n.t("post.showImage")),s})()},get children(){return r(A,{get fallback(){return(()=>{const s=er();return h(s,r(T,{class:"text-link underline",get href(){return e.url}})),s})()},children:()=>r(w,{get when(){return!i()},get fallback(){return r(T,{class:"text-link underline",get href(){return e.url}})},get children(){return r(T,{class:"my-2 block",get href(){return e.url},get children(){const s=tr();s.addEventListener("error",()=>o(!0));const u=t;return typeof u=="function"?j(u,s):t=s,S(a=>{const d=qe(e.url),g=e.url;return d!==a._v$&&C(s,"src",a._v$=d),g!==a._v$2&&C(s,"alt",a._v$2=g),a},{_v$:void 0,_v$2:void 0}),s}})}})})}})};I(["click"]);const rr=f('<div class="my-1 rounded border p-1">'),or=e=>r(w,{get when(){return e.mentionedEvent.marker!=null&&e.mentionedEvent.marker.length>0},get fallback(){return r(W,{get eventId(){return e.mentionedEvent.eventId}})},get children(){const t=rr();return h(t,r(A,{children:()=>r(z,{get eventId(){return e.mentionedEvent.eventId},embedding:!1,actions:!1,get ensureKinds(){return[de]}})})),t}}),sr=f('<button class="inline select-text text-link underline">'),re=e=>{const{showProfile:t}=he(),n=()=>{t(e.pubkey)};return(()=>{const l=sr();return l.$$click=n,h(l,r(ot,{get pubkey(){return e.pubkey}})),l})()};I(["click"]);const lr=["www3.nhk.or.jp"],ir=e=>{const t=new TextDecoder("US-ASCII").decode(e.slice(0,1024)),n=t.match(/<meta\s+charset="([-A-Za-z0-9]+)"/i);if(n!=null)return n[1].toLowerCase();const l=t.match(/<meta\s+http-equiv="Content-Type"\s*content="text\/html;\s*charset=([-A-Za-z0-9_]+)"/i);return l!=null?l[1].toLowerCase():null},cr=new Set(["utf-8","shift_jis","shift-jis","euc-jp","iso-2022-jp"]),ar=e=>{try{const t=ir(e)??"utf-8";if(!cr.has(t))throw new Error(`Unsupported encodings: ${t}`);return new TextDecoder(t).decode(e)}catch(t){throw new Error("Failed to convert charset",{cause:t})}},ur=(e,t)=>{const n={};Array.from(e.head.querySelectorAll("meta")).forEach(s=>{const u=s.getAttribute("property")||s.getAttribute("name"),a=s.getAttribute("content");u!=null&&a!=null&&(n[u]=a)});const l=n["og:image"]||n["twitter:image"],c=n["og:title"]||n["twitter:title"],i=n["og:url"]||t,o=n["og:description"]||n["twitter:description"]||"";return l&&c&&i?{title:c,description:o,image:l,url:i}:null},dr=(e,t)=>{const n=new DOMParser().parseFromString(e,"text/html");return ur(n,t)},st=e=>new URL(e).protocol==="https:",hr=e=>{const t=new URL(e);return lr.includes(t.hostname)},fr=e=>hr(e)?e:`https://corsproxy.io/?${encodeURIComponent(e)}`,gr=async e=>{try{if(!st(e))return null;const t=fr(e),l=await(await fetch(t,{mode:"cors",headers:{Accept:"text/html"},credentials:"omit"})).arrayBuffer(),c=ar(l);return dr(c,e)}catch(t){return console.error(`failed to fetch ogp for ${e}`,t),null}},vr=e=>{const t=()=>["useOgp",e().url],n=N(()=>({queryKey:t(),queryFn:({queryKey:[,c]})=>gr(c),staleTime:144e5,gcTime:144e5,refetchOnWindowFocus:!1,refetchOnMount:!1}));return{query:n,ogp:()=>n.data}},mr=f('<blockquote class=twitter-tweet><a class="text-link underline"target=_blank rel="noreferrer noopener">'),$r=f('<div class="my-2 rounded-lg border border-border transition-colors hover:bg-bg-tertiary"><img class="max-w-full rounded-t-lg object-contain shadow"><div class="mb-1 p-1"><div class="text-xs text-fg-secondary"></div><div class=text-sm></div><div class="text-xs text-fg-secondary">'),yr=f('<div><button class="flex flex-col items-center rounded bg-bg-tertiary p-3 text-xs text-fg-secondary hover:shadow">'),br=f('<div class="my-2 aspect-video w-full"><iframe loading=lazy title=YouTube class="my-2 size-full"allowfullscreen>'),Ce=e=>{try{const t=new URL(e);return t.host="twitter.com",t.href}catch{return e}},wr=e=>{const t=new URL("https://www.youtube-nocookie.com/embed/");return t.pathname+=e,t.searchParams.set("origin",window.location.origin),t.href},kr=e=>{let t;const{getColorTheme:n}=M();B(()=>{He(e.url)&&window.twttr?.widgets?.load(t)});const l=()=>n().brightness==="dark"?"dark":"light";return[r(T,{class:"text-link underline",get href(){return e.url}}),(()=>{const c=mr(),i=c.firstChild,o=t;return typeof o=="function"?j(o,c):t=c,h(i,()=>Ce(e.url)),S(s=>{const u=l(),a=Ce(e.url);return u!==s._v$&&C(c,"data-theme",s._v$=u),a!==s._v$2&&C(i,"href",s._v$2=a),s},{_v$:void 0,_v$2:void 0}),c})()]},pr=e=>{const{ogp:t}=vr(()=>({url:e.url}));return r(w,{get when(){return t()},get fallback(){return r(T,{class:"text-link underline",get href(){return e.url}})},keyed:!0,children:n=>[r(T,{class:"text-link underline",get href(){return e.url}}),r(T,{get href(){return e.url},get children(){const l=$r(),c=l.firstChild,i=c.nextSibling,o=i.firstChild,s=o.nextSibling,u=s.nextSibling;return h(o,()=>new URL(n.url).host),h(s,()=>n.title),h(u,()=>n.description),S(a=>{const d=n.title,g=n.image;return d!==a._v$3&&C(c,"alt",a._v$3=d),g!==a._v$4&&C(c,"src",a._v$4=g),a},{_v$3:void 0,_v$4:void 0}),l}})]})},oe=e=>{const t=L(),[n,l]=x(e.initialHidden);return r(w,{get when(){return!n()},get fallback(){return[r(T,{class:"text-link underline",get href(){return e.url}}),(()=>{const c=yr(),i=c.firstChild;return i.$$click=()=>l(!1),h(i,()=>t.t("post.showPreview")),c})()]},get children(){return e.children}})},_r=e=>{const{config:t}=M();return r(q,{get fallback(){return r(T,{class:"text-link underline",get href(){return e.url}})},get children(){return[r(E,{get when(){return p(()=>!!t().embedding.twitter)()&&He(e.url)},get children(){return r(oe,{get url(){return e.url},get initialHidden(){return e.initialHidden},get children(){return r(kr,{get url(){return e.url}})}})}}),r(E,{get when(){return p(()=>!!t().embedding.youtube)()&&Mt(e.url)},keyed:!0,children:({videoId:n})=>r(oe,{get url(){return e.url},get initialHidden(){return e.initialHidden},get children(){return r(A,{get fallback(){return r(T,{class:"text-link underline",get href(){return e.url}})},children:()=>[r(T,{class:"text-link underline",get href(){return e.url}}),(()=>{const l=br(),c=l.firstChild;return S(()=>C(c,"src",wr(n))),l})()]})}})}),r(E,{get when(){return p(()=>!!t().embedding.ogp)()&&st(e.url)},get children(){return r(oe,{get url(){return e.url},get initialHidden(){return e.initialHidden},get children(){return r(A,{children:()=>r(pr,{get url(){return e.url}})})}})}})]}})};I(["click"]);const xr=f('<button class="rounded bg-bg-tertiary p-3 text-xs text-fg-secondary hover:shadow">'),Er=f('<div class="aspect-video max-w-full">'),Cr=f('<video class="max-h-64 max-w-full rounded-sm object-contain shadow"controls><a>'),Rr=e=>{let t;const n=L(),[l,c]=x(e.initialHidden);return r(w,{get when(){return!l()},get fallback(){return(()=>{const i=xr();return i.$$click=()=>c(!1),h(i,()=>n.t("post.showVideo")),i})()},get children(){return r(A,{get fallback(){return Er()},children:()=>r(T,{class:"my-2 block",get href(){return e.url},get children(){const i=Cr(),o=i.firstChild,s=t;return typeof s=="function"?j(s,i):t=i,h(o,()=>n.t("post.download")),S(u=>{const a=e.url,d=e.url;return a!==u._v$&&C(i,"src",u._v$=a),d!==u._v$2&&C(o,"href",u._v$2=d),u},{_v$:void 0,_v$2:void 0}),i}})})}})};I(["click"]);const se=f("<span>"),Re=f('<button class="select-text text-link underline">'),Te=f('<div class="my-1 rounded border border-border p-1">'),Tr=f('<span class="text-link underline">'),Sr=f('<img class="inline-block h-8 max-w-32">'),Mr=e=>{const{config:t,saveColumn:n}=M(),l=_t(),c=o=>{n(dt({query:o})),l({command:"moveToLastColumn"}).catch(s=>console.error(s))},i=o=>{n(ht({name:o,relayUrls:[o]})),l({command:"moveToLastColumn"}).catch(s=>console.error(s))};return r(Q,{get each(){return e.parsed},children:o=>{if(o.type==="PlainText")return(()=>{const s=se();return h(s,()=>o.content),s})();if(o.type==="URL"){const s=()=>!t().showMedia||!e.embedding||(e.initialHidden??!1);return It(o.content)?r(nr,{get url(){return o.content},get initialHidden(){return s()}}):Pt(o.content)?r(Rr,{get url(){return o.content},get initialHidden(){return s()}}):Lt(o.content)?r(Jn,{get url(){return o.content},get initialHidden(){return s()}}):Dt(o.content)?(()=>{const u=Re();return u.$$click=()=>i(o.content),h(u,()=>o.content),u})():r(_r,{get url(){return o.content},get initialHidden(){return s()}})}if(o.type==="TagReferenceResolved"){if(o.reference==null)return(()=>{const s=se();return h(s,()=>o.content),s})();if(o.reference.type==="MentionedUser")return r(re,{get pubkey(){return o.reference.pubkey}});if(o.reference.type==="MentionedEvent")return e.embedding?r(or,{get mentionedEvent(){return o.reference}}):r(W,{get eventId(){return o.reference.eventId}})}if(o.type==="Bech32Entity")return o.data.type==="note"&&e.embedding?(()=>{const s=Te();return h(s,r(z,{get eventId(){return o.data.data},actions:!1,embedding:!1,get ensureKinds(){return[de]}})),s})():o.data.type==="nevent"&&e.embedding?(()=>{const s=Te();return h(s,r(z,{get eventId(){return o.data.data.id},actions:!1,embedding:!1})),s})():o.data.type==="npub"?r(re,{get pubkey(){return o.data.data}}):o.data.type==="nprofile"?r(re,{get pubkey(){return o.data.data.pubkey}}):(()=>{const s=Tr();return h(s,()=>o.content),s})();if(o.type==="HashTag")return(()=>{const s=Re();return s.$$click=()=>c(o.content),h(s,()=>o.content),s})();if(o.type==="CustomEmojiResolved"){const{url:s,shortcode:u,content:a}=o;if(s==null)return(()=>{const y=se();return h(y,()=>o.content),y})();const{emojiRef:d,popup:g}=Ze(()=>({emoji:{type:"CustomEmoji",url:s,shortcode:u}}));return[p(g),(()=>{const y=Sr();return j(d,y),C(y,"src",s),C(y,"alt",a),C(y,"title",u),y})()]}return console.error("Not all ParsedTextNoteNodes are covered",o),null}})};I(["click"]);const Se=2,Ir=200,Pr=()=>{let e;const[t,n]=x(!1),l=i=>{e=i},c=xt(()=>{e!=null&&n(e.scrollHeight>e.clientHeight+Se||e.scrollHeight>document.documentElement.clientHeight+Se)},Ir);return ee(()=>{if(e!=null){c();const i=new IntersectionObserver(s=>{s.forEach(u=>{u.isIntersecting&&c()})},{threshold:[0,.25,.5,.75,1]});i.observe(e);const o=()=>c();window.addEventListener("resize",o),H(()=>{i.disconnect(),window.removeEventListener("resize",o)})}}),{overflow:t,elementRef:l}},Lr=f('<div class="author-name truncate pr-1 font-bold hover:underline">'),Dr=f('<button class="mt-2 w-full rounded border border-border p-2 text-center text-xs text-fg-secondary shadow-sm hover:bg-bg-tertiary hover:shadow">'),jr=f('<div class="post flex flex-col"><div class="flex w-full gap-1"><button type=button class="author-icon size-10 shrink-0 overflow-hidden rounded"></button><div class="min-w-0 flex-auto"><div class="flex justify-between gap-1 text-xs"><button type=button class="author flex min-w-0 select-text truncate hover:text-link"><span class="author flex min-w-0 truncate hover:text-link"><div class="author-username truncate text-fg-secondary"></div></span></button><div class="created-at shrink-0"><button type=button class="select-text hover:underline"></button></div></div><div class=overflow-hidden></div><div class=actions>'),Ar=f('<img alt=icon referrerpolicy=no-referrer class="size-full object-cover">'),Ur=e=>{const t=L(),{overflow:n,elementRef:l}=Pr(),c=We(),[i,o]=x(!1),s=()=>c(e.createdAt),u=()=>e.createdAt.toLocaleString(),{profile:a}=Ue(()=>({pubkey:e.authorPubkey}));return(()=>{const d=jr(),g=d.firstChild,y=g.firstChild,m=y.nextSibling,$=m.firstChild,v=$.firstChild,k=v.firstChild,b=k.firstChild,P=v.nextSibling,R=P.firstChild,U=$.nextSibling,G=U.nextSibling;return y.$$click=_=>{_.preventDefault(),e.onShowProfile?.()},h(y,r(w,{get when(){return a()?.picture},keyed:!0,children:_=>r(A,{children:()=>(()=>{const D=Ar();return S(()=>C(D,"src",qe(_,"icon"))),D})()})})),v.$$click=_=>{_.preventDefault(),e?.onShowProfile?.()},h(k,r(w,{get when(){return(a()?.display_name?.length??0)>0},get children(){const _=Lr();return h(_,()=>a()?.display_name),_}}),b),h(b,r(w,{get when(){return a()?.name!=null},get fallback(){return`@${Fe(e.authorPubkey)}`},get children(){return["@",p(()=>a()?.name)]}})),R.$$click=_=>{_.preventDefault(),e.onShowEvent?.()},h(R,s),j(l,U),h(U,()=>e.content),h(m,r(w,{get when(){return n()},get children(){const _=Dr();return _.$$click=D=>{D.stopPropagation(),o(F=>!F)},h(_,r(w,{get when(){return!i()},get fallback(){return t.t("post.hideOverflow")},get children(){return t.t("post.showOverflow")}})),_}}),G),h(G,()=>e.actions),h(d,r(w,{get when(){return e.footer},get children(){return e.footer}}),null),S(_=>{const D=u(),F=!i(),ve=!!i();return D!==_._v$&&C(R,"title",_._v$=D),F!==_._v$2&&U.classList.toggle("max-h-screen",_._v$2=F),ve!==_._v$3&&U.classList.toggle("max-h-none",_._v$3=ve),_},{_v$:void 0,_v$2:void 0,_v$3:void 0}),d})()};I(["click"]);const Fr=gt(),qr=()=>ft(Fr),so=()=>{const[e,t]=vt({});return{timelineState:e,setTimeline:n=>t("content",n),clearTimeline:()=>t("content",void 0)}},Hr=f("<div class=nostr-textnote>"),Or=f("<div class=text-xs>"),Br=f('<div class="content whitespace-pre-wrap break-words">'),Kr=f("<div class=textnote-content>"),Wr=f('<div class="mt-1 rounded border border-border p-1">'),zr=f("<div class=h-12>"),Nr=f('<button class="select-text pr-1 text-link hover:underline">'),Qr=f("<div class=h-5>"),Vr=e=>{let t;const n=L(),{showProfile:l}=he(),c=qr(),[i,o]=x(!1),s=()=>o(!1),u=()=>{o(m=>!m),i()&&t!=null&&t.focus()},a=p(()=>mt(e.event)),d=()=>e.embedding??!0,g=()=>e.actions??!0,y=()=>{if(d()){const m=a().replyingToEvent();if(m!=null&&!a().containsEventMention(m.id))return m.id;const $=a().rootEvent();if(m==null&&$!=null&&!a().containsEventMention($.id))return $.id}};return(()=>{const m=Hr();return h(m,r(Ur,{get authorPubkey(){return a().pubkey},get createdAt(){return a().createdAtAsDate()},get content(){return(()=>{const $=Kr();return h($,r(w,{get when(){return y()},keyed:!0,children:v=>(()=>{const k=Wr();return h(k,r(A,{get fallback(){return zr()},children:()=>r(z,{eventId:v,actions:!1,embedding:!1})})),k})()}),null),h($,r(w,{get when(){return a().taggedPubkeys().length>0},get children(){const v=Or();return h(v,()=>n.t("post.replyToPre"),null),h(v,r(Q,{get each(){return a().taggedPubkeys()},children:k=>(()=>{const b=Nr();return b.$$click=P=>{P.stopPropagation(),l(k)},h(b,r(ot,{pubkey:k})),b})()}),null),h(v,()=>n.t("post.replyToPost"),null),v}}),null),h($,r(Vn,{get contentWarning(){return a().contentWarning()},get children(){const v=Br();return h(v,r(Mr,{get parsed(){return a().parsed()},get embedding(){return d()},get initialHidden(){return a().contentWarning().contentWarning}})),v}}),null),$})()},get actions(){return r(w,{get when(){return g()},get children(){return r(A,{get fallback(){return Qr()},children:()=>r(Kn,{get event(){return e.event},onClickReply:u})})}})},get footer(){return r(w,{get when(){return i()},get children(){return r(Et,{textAreaRef:$=>{t=$},mode:"reply",get replyTo(){return e.event},onClose:s,onPost:s})}})},onShowProfile:()=>{l(a().pubkey)},onShowEvent:()=>{c?.setTimeline({type:"Replies",event:e.event})}})),m})()};I(["click"]);const Me=f("<div><span>"),lt=e=>{const t=L(),n=()=>e.ensureKinds==null||e.ensureKinds.length===0||e.ensureKinds.includes(e.event.kind);return r(q,{get fallback(){return(()=>{const l=Me(),c=l.firstChild;return h(c,()=>t.t("post.unsupportedKind",{kind:e.event.kind})),h(l,r(W,{get eventId(){return e.event.id},get kind(){return e.event.kind}}),null),l})()},get children(){return[r(E,{get when(){return!n()},keyed:!0,get children(){const l=Me(),c=l.firstChild;return h(c,()=>t.t("post.unexpectedKind",{kind:e.event.kind})),h(l,r(W,{get eventId(){return e.event.id},get kind(){return e.event.kind}}),null),l}}),r(E,{get when(){return e.event.kind===de},get children(){return r(Vr,{get event(){return e.event},get embedding(){return e.actions},get actions(){return e.actions}})}}),r(E,{get when(){return e.event.kind===$t},get children(){return r(Xt,{get event(){return e.event}})}})]}})},lo=e=>{const{shouldMuteEvent:t}=M();return r(Q,{get each(){return e.events},children:n=>r(w,{get when(){return!t(n)},get children(){return r(ie,{get children(){return r(lt,{event:n})}})}})})};let Y=0;const{setActiveSubscriptions:Zr}=Ct();setInterval(()=>{Zr(Y)},1e3);const Gr=({eose:e,limit:t,eoseLimit:n})=>{const[c,i]=x([]),o=[];let s;const u=()=>{i(m=>{const $=[...m];return o.forEach(v=>{ye($,v)}),$.slice(0,n())}),o.splice(0,o.length)},a=()=>{s==null&&(s=setTimeout(()=>{s=void 0,u()},100))},d=()=>{s!=null&&clearTimeout(s)},g=m=>{const $=m.created_at-le();if(!($>300)){if($>0){setTimeout(()=>g(m),$*1e3);return}e()?i(v=>{const k=[...v];return ye(k,m),k.slice(0,t())}):(o.push(m),a())}},y=()=>{i([]),d()};return B(()=>{e()&&u()}),H(()=>{d()}),{events:c,setEvents:i,addEvent:g,clearEvents:y}},io=e=>{const{config:t,shouldMuteEvent:n}=M(),l=Rt(),[c,i]=x(!1),o=p(e),s=()=>e()?.eoseLimit??25,u=()=>e()?.limit??50,{events:a,addEvent:d,clearEvents:g,setEvents:y}=Gr({eose:c,eoseLimit:s,limit:u});B(me(()=>[t().mutedPubkeys,t().mutedKeywords],()=>{y($=>$.filter(v=>!n(v)))},{defer:!0})),ee(()=>{console.debug("subscription mounted",e()?.debugId,e()),H(()=>{console.debug("subscription unmount",e()?.debugId,e())})});const m=()=>{console.debug("startSubscription: start");const $=o();if($==null)return;const{relayUrls:v,filters:k,options:b,onEvent:P,onEOSE:R,clientEventFilter:U,continuous:G=!0}=$;let _=!0;Y+=1,g(),i(!1);const D=l().subscribeMany(v,k,b??{maxWait:12e3,onevent:F=>{P?.(F),!(U!=null&&!U(F))&&d(F)},oneose:()=>{c()||(R?.(),i(!0),G||(D.close(),_&&(_=!1,Y-=1)))}});H(()=>{console.debug("startSubscription: end"),D.close(),_&&(_=!1,Y-=1)})};return B(me(()=>[o()],()=>m())),{events:a,eose:c}},Yr=f("<div class=none>"),Jr=f('<button class="flex h-12 w-full flex-col items-center justify-center hover:text-fg-secondary"><span>'),Xr=f('<button class="flex h-12 w-full flex-col items-center justify-center hover:text-fg-secondary disabled:text-fg-secondary/30"><span>'),co=e=>{const t=p(e),n=$=>{const{duration:v}=t();if(v!=null)return $-v},[l,c]=x([]),[i,o]=x(n(le())),[s,u]=x(),[a,d]=x();return{setEvents:c,since:i,until:s,continuous:()=>s()==null,loadLatest:()=>{$e(()=>{u(void 0),o(n(le()))}),a()?.scrollIntoView()},loadOld:()=>{const $=Tt(l());$!=null&&($e(()=>{u($.created_at),o(n($.created_at))}),a()?.scrollIntoView())},setTopMarkerRef:d}},ao=e=>{const t=L();return[r(w,{get when(){return!e.loadMore.continuous()},get children(){return[(()=>{const n=Yr(),l=e.loadMore.setTopMarkerRef;return typeof l=="function"?j(l,n):e.loadMore.setTopMarkerRef=n,n})(),r(ie,{get children(){const n=Jr(),l=n.firstChild;return n.$$click=()=>e.loadMore.loadLatest(),h(l,()=>t.t("column.loadLatest")),n}})]}}),p(()=>e.children),r(ie,{get children(){const n=Xr(),l=n.firstChild;return n.$$click=()=>e.loadMore.loadOld(),h(l,()=>t.t("column.loadOld")),S(()=>n.disabled=!e.eose),n}})]};I(["click"]);const it=e=>{const t=()=>{const l=e();if(l==null)return[];const c=[];return Le(l).pTags().forEach(o=>{const[,s,u,a]=o,d={pubkey:s,petname:a};u!=null&&u.length>0&&(d.mainRelayUrl=u),c.push(d)}),c};return{followings:t,followingPubkeys:()=>t().map(l=>l.pubkey),data:e}},uo=async({pubkey:e},t)=>{const n=new Z({type:"Followings",pubkey:e});De({task:n,signal:t});const l=await n.latestEventPromise();return it(()=>l)},ho=e=>{const t=V(),n=p(e),l=()=>["useFollowings",n()],c=N(()=>({queryKey:l(),queryFn:St({taskProvider:([,o])=>{if(o==null)return null;const{pubkey:s}=o;return new Z({type:"Followings",pubkey:s})},queryClient:t}),staleTime:5*60*1e3,gcTime:3*24*60*60*1e3,refetchOnMount:!0,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchInterval:0})),i=()=>t.invalidateQueries({queryKey:l()});return{...it(()=>c.data),invalidateFollowings:i,query:c}};export{Oe as A,tn as B,$n as C,z as E,ze as H,ao as L,Ve as R,lo as T,so as a,Fr as b,ie as c,ho as d,co as e,We as f,Ot as g,Ze as h,lt as i,Vr as j,Xt as k,Ge as l,sn as m,Mr as n,uo as o,tt as p,Qe as r,io as u};
//# sourceMappingURL=useFollowings-CW-daF2n.js.map
