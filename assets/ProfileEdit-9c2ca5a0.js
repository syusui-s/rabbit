import{aB as vr,aC as pr,aD as Ve,ae as Q,aE as He,aF as $r,aG as yr,ad as _r,aH as Je,aI as mr,aJ as hr,aK as xr,aL as Ar,aM as wr,aN as Sr,aO as ie,aP as se,aQ as We,aR as Ye,aS as Tr,aT as Pr,aU as Or,aV as Cr,aW as Qe,aX as z,aY as ze,aZ as Ir,a_ as Lr,a$ as jr,b0 as Er,a1 as er,b1 as rr,b2 as Br,a2 as tr,g as Ur,u as Nr,c as w,aa as Rr,y as Fr,x as Mr,a as S,i as b,S as R,j as m,l as ae,F as Kr,d as Dr,t as T}from"./index-0812911d.js";import{A as Gr}from"./arrow-left-4d90b126.js";import{B as kr}from"./BasicModal-a9dafc07.js";import{b as Xr,d as Zr,f as qr,t as Vr,j as Hr}from"./SideBar-e7f532c2.js";import"./usePersistStatus-8f0580a5.js";function Jr(e,r){for(var t=-1,a=e==null?0:e.length;++t<a&&r(e[t],t,e)!==!1;);return e}var Wr=Jr,Ne=vr;function Yr(e,r,t){r=="__proto__"&&Ne?Ne(e,r,{configurable:!0,enumerable:!0,value:t,writable:!0}):e[r]=t}var nr=Yr,Qr=nr,zr=pr,et=Object.prototype,rt=et.hasOwnProperty;function tt(e,r,t){var a=e[r];(!(rt.call(e,r)&&zr(a,t))||t===void 0&&!(r in e))&&Qr(e,r,t)}var le=tt,nt=le,at=nr;function it(e,r,t,a){var s=!t;t||(t={});for(var o=-1,c=r.length;++o<c;){var u=r[o],f=a?a(t[u],e[u],u,t,e):void 0;f===void 0&&(f=e[u]),s?at(t,u,f):nt(t,u,f)}return t}var F=it,st=F,lt=Ve;function ot(e,r){return e&&st(r,lt(r),e)}var ct=ot;function ut(e){var r=[];if(e!=null)for(var t in Object(e))r.push(t);return r}var dt=ut,ft=Q,bt=He,gt=dt,vt=Object.prototype,pt=vt.hasOwnProperty;function $t(e){if(!ft(e))return gt(e);var r=bt(e),t=[];for(var a in e)a=="constructor"&&(r||!pt.call(e,a))||t.push(a);return t}var yt=$t,_t=$r,mt=yt,ht=yr;function xt(e){return ht(e)?_t(e,!0):mt(e)}var oe=xt,At=F,wt=oe;function St(e,r){return e&&At(r,wt(r),e)}var Tt=St,Y={exports:{}};Y.exports;(function(e,r){var t=_r,a=r&&!r.nodeType&&r,s=a&&!0&&e&&!e.nodeType&&e,o=s&&s.exports===a,c=o?t.Buffer:void 0,u=c?c.allocUnsafe:void 0;function f(g,$){if($)return g.slice();var v=g.length,x=u?u(v):new g.constructor(v);return g.copy(x),x}e.exports=f})(Y,Y.exports);var Pt=Y.exports;function Ot(e,r){var t=-1,a=e.length;for(r||(r=Array(a));++t<a;)r[t]=e[t];return r}var Ct=Ot,It=F,Lt=Je;function jt(e,r){return It(e,Lt(e),r)}var Et=jt,Bt=mr,Ut=Bt(Object.getPrototypeOf,Object),ce=Ut,Nt=hr,Rt=ce,Ft=Je,Mt=xr,Kt=Object.getOwnPropertySymbols,Dt=Kt?function(e){for(var r=[];e;)Nt(r,Ft(e)),e=Rt(e);return r}:Mt,ar=Dt,Gt=F,kt=ar;function Xt(e,r){return Gt(e,kt(e),r)}var Zt=Xt,qt=Ar,Vt=ar,Ht=oe;function Jt(e){return qt(e,Ht,Vt)}var ue=Jt,Wt=Object.prototype,Yt=Wt.hasOwnProperty;function Qt(e){var r=e.length,t=new e.constructor(r);return r&&typeof e[0]=="string"&&Yt.call(e,"index")&&(t.index=e.index,t.input=e.input),t}var zt=Qt,Re=wr;function en(e){var r=new e.constructor(e.byteLength);return new Re(r).set(new Re(e)),r}var de=en,rn=de;function tn(e,r){var t=r?rn(e.buffer):e.buffer;return new e.constructor(t,e.byteOffset,e.byteLength)}var nn=tn,an=/\w*$/;function sn(e){var r=new e.constructor(e.source,an.exec(e));return r.lastIndex=e.lastIndex,r}var ln=sn,Fe=Sr,Me=Fe?Fe.prototype:void 0,Ke=Me?Me.valueOf:void 0;function on(e){return Ke?Object(Ke.call(e)):{}}var cn=on,un=de;function dn(e,r){var t=r?un(e.buffer):e.buffer;return new e.constructor(t,e.byteOffset,e.length)}var fn=dn,bn=de,gn=nn,vn=ln,pn=cn,$n=fn,yn="[object Boolean]",_n="[object Date]",mn="[object Map]",hn="[object Number]",xn="[object RegExp]",An="[object Set]",wn="[object String]",Sn="[object Symbol]",Tn="[object ArrayBuffer]",Pn="[object DataView]",On="[object Float32Array]",Cn="[object Float64Array]",In="[object Int8Array]",Ln="[object Int16Array]",jn="[object Int32Array]",En="[object Uint8Array]",Bn="[object Uint8ClampedArray]",Un="[object Uint16Array]",Nn="[object Uint32Array]";function Rn(e,r,t){var a=e.constructor;switch(r){case Tn:return bn(e);case yn:case _n:return new a(+e);case Pn:return gn(e,t);case On:case Cn:case In:case Ln:case jn:case En:case Bn:case Un:case Nn:return $n(e,t);case mn:return new a;case hn:case wn:return new a(e);case xn:return vn(e);case An:return new a;case Sn:return pn(e)}}var Fn=Rn,Mn=Q,De=Object.create,Kn=function(){function e(){}return function(r){if(!Mn(r))return{};if(De)return De(r);e.prototype=r;var t=new e;return e.prototype=void 0,t}}(),Dn=Kn,Gn=Dn,kn=ce,Xn=He;function Zn(e){return typeof e.constructor=="function"&&!Xn(e)?Gn(kn(e)):{}}var qn=Zn,Vn=ie,Hn=se,Jn="[object Map]";function Wn(e){return Hn(e)&&Vn(e)==Jn}var Yn=Wn,Qn=Yn,zn=Ye,Ge=We,ke=Ge&&Ge.isMap,ea=ke?zn(ke):Qn,ra=ea,ta=ie,na=se,aa="[object Set]";function ia(e){return na(e)&&ta(e)==aa}var sa=ia,la=sa,oa=Ye,Xe=We,Ze=Xe&&Xe.isSet,ca=Ze?oa(Ze):la,ua=ca,da=Tr,fa=Wr,ba=le,ga=ct,va=Tt,pa=Pt,$a=Ct,ya=Et,_a=Zt,ma=Or,ha=ue,xa=ie,Aa=zt,wa=Fn,Sa=qn,Ta=Cr,Pa=Pr,Oa=ra,Ca=Q,Ia=ua,La=Ve,ja=oe,Ea=1,Ba=2,Ua=4,ir="[object Arguments]",Na="[object Array]",Ra="[object Boolean]",Fa="[object Date]",Ma="[object Error]",sr="[object Function]",Ka="[object GeneratorFunction]",Da="[object Map]",Ga="[object Number]",lr="[object Object]",ka="[object RegExp]",Xa="[object Set]",Za="[object String]",qa="[object Symbol]",Va="[object WeakMap]",Ha="[object ArrayBuffer]",Ja="[object DataView]",Wa="[object Float32Array]",Ya="[object Float64Array]",Qa="[object Int8Array]",za="[object Int16Array]",ei="[object Int32Array]",ri="[object Uint8Array]",ti="[object Uint8ClampedArray]",ni="[object Uint16Array]",ai="[object Uint32Array]",d={};d[ir]=d[Na]=d[Ha]=d[Ja]=d[Ra]=d[Fa]=d[Wa]=d[Ya]=d[Qa]=d[za]=d[ei]=d[Da]=d[Ga]=d[lr]=d[ka]=d[Xa]=d[Za]=d[qa]=d[ri]=d[ti]=d[ni]=d[ai]=!0;d[Ma]=d[sr]=d[Va]=!1;function W(e,r,t,a,s,o){var c,u=r&Ea,f=r&Ba,g=r&Ua;if(t&&(c=s?t(e,a,s,o):t(e)),c!==void 0)return c;if(!Ca(e))return e;var $=Ta(e);if($){if(c=Aa(e),!u)return $a(e,c)}else{var v=xa(e),x=v==sr||v==Ka;if(Pa(e))return pa(e,u);if(v==lr||v==ir||x&&!s){if(c=f||x?{}:Sa(e),!u)return f?_a(e,va(c,e)):ya(e,ga(c,e))}else{if(!d[v])return s?e:{};c=wa(e,v,u)}}o||(o=new da);var C=o.get(e);if(C)return C;o.set(e,c),Ia(e)?e.forEach(function(y){c.add(W(y,r,t,y,e,o))}):Oa(e)&&e.forEach(function(y,h){c.set(h,W(y,r,t,h,e,o))});var M=g?f?ha:ma:f?ja:La,I=$?void 0:M(e);return fa(I||e,function(y,h){I&&(h=y,y=e[h]),ba(c,h,W(y,r,t,h,e,o))}),c}var ii=W;function si(e){var r=e==null?0:e.length;return r?e[r-1]:void 0}var li=si;function oi(e,r,t){var a=-1,s=e.length;r<0&&(r=-r>s?0:s+r),t=t>s?s:t,t<0&&(t+=s),s=r>t?0:t-r>>>0,r>>>=0;for(var o=Array(s);++a<s;)o[a]=e[a+r];return o}var ci=oi,ui=Qe,di=ci;function fi(e,r){return r.length<2?e:ui(e,di(r,0,-1))}var bi=fi,gi=z,vi=li,pi=bi,$i=ze;function yi(e,r){return r=gi(r,e),e=pi(e,r),e==null||delete e[$i(vi(r))]}var _i=yi,mi=Ir,hi=ce,xi=se,Ai="[object Object]",wi=Function.prototype,Si=Object.prototype,or=wi.toString,Ti=Si.hasOwnProperty,Pi=or.call(Object);function Oi(e){if(!xi(e)||mi(e)!=Ai)return!1;var r=hi(e);if(r===null)return!0;var t=Ti.call(r,"constructor")&&r.constructor;return typeof t=="function"&&t instanceof t&&or.call(t)==Pi}var Ci=Oi,Ii=Ci;function Li(e){return Ii(e)?void 0:e}var ji=Li,Ei=Lr;function Bi(e){var r=e==null?0:e.length;return r?Ei(e,1):[]}var Ui=Bi,Ni=Ui,Ri=jr,Fi=Er;function Mi(e){return Fi(Ri(e,void 0,Ni),e+"")}var Ki=Mi,Di=rr,Gi=ii,ki=_i,Xi=z,Zi=F,qi=ji,Vi=Ki,Hi=ue,Ji=1,Wi=2,Yi=4,Qi=Vi(function(e,r){var t={};if(e==null)return t;var a=!1;r=Di(r,function(o){return o=Xi(o,e),a||(a=o.length>1),o}),Zi(e,Hi(e),t),a&&(t=Gi(t,Ji|Wi|Yi,qi));for(var s=r.length;s--;)ki(t,r[s]);return t}),zi=Qi;const es=er(zi);var rs="Expected a function";function ts(e){if(typeof e!="function")throw new TypeError(rs);return function(){var r=arguments;switch(r.length){case 0:return!e.call(this);case 1:return!e.call(this,r[0]);case 2:return!e.call(this,r[0],r[1]);case 3:return!e.call(this,r[0],r[1],r[2])}return!e.apply(this,r)}}var ns=ts,as=le,is=z,ss=Br,qe=Q,ls=ze;function os(e,r,t,a){if(!qe(e))return e;r=is(r,e);for(var s=-1,o=r.length,c=o-1,u=e;u!=null&&++s<o;){var f=ls(r[s]),g=t;if(f==="__proto__"||f==="constructor"||f==="prototype")return e;if(s!=c){var $=u[f];g=a?a($,f,u):void 0,g===void 0&&(g=qe($)?$:ss(r[s+1])?[]:{})}as(u,f,g),u=u[f]}return e}var cs=os,us=Qe,ds=cs,fs=z;function bs(e,r,t){for(var a=-1,s=r.length,o={};++a<s;){var c=r[a],u=us(e,c);t(u,c)&&ds(o,fs(c,e),u)}return o}var gs=bs,vs=rr,ps=tr,$s=gs,ys=ue;function _s(e,r){if(e==null)return{};var t=vs(ys(e),function(a){return[a]});return r=ps(r),$s(e,t,function(a,s){return r(a,s[0])})}var ms=_s,hs=tr,xs=ns,As=ms;function ws(e,r){return As(e,xs(hs(r)))}var Ss=ws;const Ts=er(Ss),Ps=T('<div class="h-40 w-full shrink-0 sm:h-52"><img alt=header class="h-full w-full object-cover">'),Os=T('<img alt="user icon"class="h-full w-full rounded-lg object-cover">'),Cs=T('<div><div class="ml-4 mt-[-64px] h-28 w-28 rounded-lg shadow-md">'),Is=T('<div class="px-4 pt-4">'),Ls=T("<div><span class=font-bold></span><div>"),js=T('<div><form class="flex flex-col gap-4 p-4"><div class="flex flex-col items-start gap-1"><label class=font-bold for=picture></label><input class="w-full rounded-md border-border bg-bg ring-border focus:border-border focus:ring-primary"type=text id=picture name=picture placeholder=https://....../picture.png></div><div class="flex flex-col items-start gap-1"><label class=font-bold for=picture></label><input class="w-full rounded-md border-border bg-bg focus:border-border focus:ring-primary"type=text id=banner name=banner placeholder=https://....../banner.png></div><div class="flex flex-col items-start gap-1"><label class=font-bold for=name></label><div class="flex w-full items-center gap-2"><span>@</span><input class="flex-1 rounded-md border-border bg-bg ring-border focus:border-border focus:ring-primary"type=text id=name name=name maxlength=32 required></div></div><div class="flex flex-col items-start gap-1"><label class=font-bold for=name></label><input class="w-full rounded-md border-border bg-bg ring-border focus:border-border focus:ring-primary"type=text name=displayName maxlength=32></div><div class="flex flex-col items-start gap-1"><label class=font-bold for=name></label><textarea class="w-full rounded-md border-border bg-bg ring-border focus:border-border focus:ring-primary"name=about rows=5></textarea></div><div class="flex flex-col items-start gap-1"><label class=font-bold for=name></label><input class="w-full rounded-md border-border bg-bg ring-border focus:border-border focus:ring-primary"type=text name=website placeholder=https://....../></div><div class="flex flex-col items-start gap-1"><label class=font-bold for=name></label><input class="w-full rounded-md border-border bg-bg ring-border focus:border-border focus:ring-primary"type=text name=nip05 placeholder=yourname@domain.example.com></div><div class="flex flex-col items-start gap-1"><label class=font-bold for=name></label><span class=text-xs></span><input class="w-full rounded-md border-border bg-bg ring-border focus:border-border focus:ring-primary"type=text name=website pattern=^((LNURL1[AC-HJ-NP-Z02-9]+|lnurl1[ac-hj-np-z02-9]+)|[-_a-zA-Z0-9.]+@[-a-zA-Z0-9.]+)$ placeholder="LNURL1XXXXXX / abcdef@wallet.example.com"></div><div class="flex gap-2"><button type=submit class="rounded p-2 font-bold text-primary-fg hover:bg-primary-hover"></button><button type=button class="rounded border border-primary p-2 font-bold text-primary hover:border-primary-hover hover:text-primary-hover">'),Es=T('<div class="h-24 shrink-0">'),Bs=T('<div class="flex flex-col items-start "><span class="text-sm font-bold"></span><span class="whitespace-pre-wrap break-all text-sm">'),Us="(LNURL1[AC-HJ-NP-Z02-9]+|lnurl1[ac-hj-np-z02-9]+)",Ns="[-_a-zA-Z0-9.]+@[-a-zA-Z0-9.]+",Rs=new RegExp(`^${Us}$`),cr=new RegExp(`^${Ns}$`),Fs=e=>Rs.test(e),Ms=e=>cr.test(e),Zs=e=>{const r=Ur(),t=Xr(),{config:a}=Nr(),[s,o]=w(""),[c,u]=w(""),[f,g]=w(""),[$,v]=w(""),[x,C]=w(""),[M,I]=w(""),[y,h]=w(""),[L,ee]=w(""),{profile:fe,invalidateProfile:ur,query:re}=Zr(()=>qr([t()])(([i])=>({pubkey:i}))),{updateProfile:dr}=Hr(),O=Rr(()=>({mutationKey:["updateProfile"],mutationFn:(...i)=>dr(...i).then(l=>Promise.allSettled(l.map(Vr(1e4)))),onSuccess:i=>{const l=i.filter(_=>_.status==="fulfilled").length,p=i.length-l;l===i.length?window.alert(r()("profile.edit.updateSucceeded")):l>0?window.alert(r()("profile.edit.failedToUpdatePartially",{count:p})):window.alert(r()("profile.edit.failedToUpdate")),ur().then(()=>re.refetch()).catch(_=>console.error(_)),e.onClose()},onError:i=>{console.error("failed to delete",i)}})),be=()=>re.isPending||O.isPending,A=()=>be(),te=()=>es(fe(),["picture","banner","name","display_name","about","website","nip05","lud06","lud16"]),fr=i=>{i.preventDefault();const l=t();if(l==null)return;const p=Ts({picture:s(),banner:c(),name:f(),display_name:$(),about:x(),website:M(),nip05:y(),lud06:Fs(L())?L():null,lud16:Ms(L())?L():null},_=>_==null||_.length===0);O.mutate({relayUrls:a().relayUrls,pubkey:l,profile:p,otherProperties:te()})},P=i=>i.key==="Enter"&&i.preventDefault();return Fr(()=>{const i=fe();i!=null&&(re.refetch().catch(l=>console.error(l)),Mr(()=>{o(l=>i.picture??l),u(l=>i.banner??l),g(l=>i.name??l),v(l=>i.display_name??l),C(l=>i.about??l),I(l=>i.website??l),h(l=>i.nip05??l),i.lud16!=null?ee(i.lud16):i.lud06!=null&&ee(i.lud06)}))}),S(kr,{closeButton:()=>S(Gr,{}),get onClose(){return e.onClose},get children(){return[(()=>{const i=Cs(),l=i.firstChild;return b(i,S(R,{get when(){return c().length>0},get fallback(){return Es()},keyed:!0,get children(){const p=Ps(),_=p.firstChild;return m(()=>ae(_,"src",c())),p}}),l),b(l,S(R,{get when(){return s().length>0},get children(){const p=Os();return m(()=>ae(p,"src",s())),p}})),i})(),S(R,{get when(){return be()},get children(){const i=Is();return b(i,()=>r()("general.loading")),i}}),(()=>{const i=js(),l=i.firstChild,p=l.firstChild,_=p.firstChild,K=_.nextSibling,ge=p.nextSibling,ve=ge.firstChild,D=ve.nextSibling,pe=ge.nextSibling,$e=pe.firstChild,br=$e.nextSibling,gr=br.firstChild,G=gr.nextSibling,ye=pe.nextSibling,_e=ye.firstChild,k=_e.nextSibling,me=ye.nextSibling,he=me.firstChild,ne=he.nextSibling,xe=me.nextSibling,Ae=xe.firstChild,X=Ae.nextSibling,we=xe.nextSibling,Se=we.firstChild,j=Se.nextSibling,Te=we.nextSibling,Pe=Te.firstChild,Oe=Pe.nextSibling,Z=Oe.nextSibling,Ce=Te.nextSibling,E=Ce.firstChild,Ie=E.nextSibling;return l.addEventListener("submit",fr),b(_,()=>r()("profile.edit.icon")),K.$$keydown=P,K.addEventListener("blur",n=>o(n.currentTarget.value)),b(ve,()=>r()("profile.edit.banner")),D.$$keydown=P,D.addEventListener("blur",n=>u(n.currentTarget.value)),b($e,()=>r()("profile.edit.name")),G.$$keydown=P,G.addEventListener("change",n=>g(n.currentTarget.value)),b(_e,()=>r()("profile.edit.displayName")),k.$$keydown=P,k.addEventListener("change",n=>v(n.currentTarget.value)),b(he,()=>r()("profile.edit.about")),ne.addEventListener("change",n=>C(n.currentTarget.value)),b(Ae,()=>r()("profile.edit.website")),X.$$keydown=P,X.addEventListener("change",n=>I(n.currentTarget.value)),b(Se,()=>r()("profile.edit.nip05")),j.$$keydown=P,j.addEventListener("change",n=>h(n.currentTarget.value)),b(Pe,()=>r()("profile.edit.lightningAddress")),b(Oe,()=>r()("profile.edit.lightningAddressDescription")),Z.$$keydown=P,Z.addEventListener("change",n=>ee(n.currentTarget.value)),b(l,S(R,{get when(){return Object.entries(te()).length>0},get children(){const n=Ls(),B=n.firstChild,q=B.nextSibling;return b(B,()=>r()("profile.edit.otherProperties")),b(q,S(Kr,{get each(){return Object.entries(te())},children:([V,H])=>(()=>{const U=Bs(),N=U.firstChild,J=N.nextSibling;return b(N,V),b(J,H),U})()})),n}}),Ce),b(E,()=>r()("profile.edit.save")),Ie.$$click=()=>e.onClose(),b(Ie,()=>r()("profile.edit.cancel")),b(l,S(R,{get when(){return O.isPending},get children(){return r()("profile.edit.updating")}}),null),m(n=>{const B=A(),q=A(),V=A(),H=A(),U=A(),N=A(),J=cr.source,Le=A(),je=A(),Ee=!O.isPending,Be=!!O.isPending,Ue=O.isPending;return B!==n._v$&&(K.disabled=n._v$=B),q!==n._v$2&&(D.disabled=n._v$2=q),V!==n._v$3&&(G.disabled=n._v$3=V),H!==n._v$4&&(k.disabled=n._v$4=H),U!==n._v$5&&(ne.disabled=n._v$5=U),N!==n._v$6&&(X.disabled=n._v$6=N),J!==n._v$7&&ae(j,"pattern",n._v$7=J),Le!==n._v$8&&(j.disabled=n._v$8=Le),je!==n._v$9&&(Z.disabled=n._v$9=je),Ee!==n._v$10&&E.classList.toggle("bg-primary",n._v$10=Ee),Be!==n._v$11&&E.classList.toggle("bg-primary-disabled",n._v$11=Be),Ue!==n._v$12&&(E.disabled=n._v$12=Ue),n},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0,_v$5:void 0,_v$6:void 0,_v$7:void 0,_v$8:void 0,_v$9:void 0,_v$10:void 0,_v$11:void 0,_v$12:void 0}),m(()=>K.value=s()),m(()=>D.value=c()),m(()=>G.value=f()),m(()=>k.value=$()),m(()=>ne.value=x()),m(()=>X.value=M()),m(()=>j.value=y()),m(()=>Z.value=L()),i})()]}})};Dr(["keydown","click"]);export{Zs as default};
//# sourceMappingURL=ProfileEdit-9c2ca5a0.js.map
