import{s as j,t as s,V as Q,z as ke,w as C,j as te,k as $e,A as _e,u as xe,c as B,m as Ce,a as r,h,D as R,f as J,i as l,S as T,M as v,b as O,n as Pe,d as Me,ad as Fe,av as Se,x as Ee,as as qe,ap as Te}from"./index-Bl6kpxFH.js";import{a as Le,B as Ue,h as ze,i as Ne}from"./EventDisplay-B_nCYJ5C.js";import{T as Be,q as ne,s as Re,a as je,b as Qe,i as Ae,G as De,f as Ke,v as Ve,g as W}from"./SideBar-BIbYYUq1.js";import{q as He,u as X,a as Ge,L as Ie,T as Ze,f as Je}from"./useFollowings-Bg_gtKmP.js";import{B as Oe}from"./BasicModal-DACfewNe.js";import We from"./EventDebugModal-DprYgF5N.js";import Xe from"./UserList-B5wbiDUt.js";import Ye from"./ZapRequestModal-H8x_3KAI.js";import{S as et}from"./SafeLink-0V5BGpYX.js";import{u as re}from"./useSubscription-CB1P1jR9.js";import"./url-DPIb-kBm.js";import"./resolveAsset-CW1DiIhb.js";import"./Copy-CLEXtLJJ.js";import"./lud16ToLnurlPayUrl-SBxvm6YY.js";import"./_baseClone-BoP5O6Oe.js";const tt=s('<svg xmlns=http://www.w3.org/2000/svg fill=none stroke=currentColor stroke-width=1.5 aria-hidden=true data-slot=icon viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99">'),nt=(t={})=>(()=>{const e=tt();return j(e,t,!0),e})(),rt=s('<svg xmlns=http://www.w3.org/2000/svg fill=currentColor aria-hidden=true data-slot=icon viewBox="0 0 24 24"><path fill-rule=evenodd d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12m13.36-1.814a.75.75 0 1 0-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 0 0-1.06 1.06l2.25 2.25a.75.75 0 0 0 1.14-.094z"clip-rule=evenodd>'),lt=(t={})=>(()=>{const e=rt();return j(e,t,!0),e})(),ot=s('<svg xmlns=http://www.w3.org/2000/svg fill=currentColor aria-hidden=true data-slot=icon viewBox="0 0 24 24"><path fill-rule=evenodd d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12M12 8.25a.75.75 0 0 1 .75.75v3.75a.75.75 0 0 1-1.5 0V9a.75.75 0 0 1 .75-.75m0 8.25a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5"clip-rule=evenodd>'),st=(t={})=>(()=>{const e=ot();return j(e,t,!0),e})(),it=t=>({kind:Q,pubkey:t,created_at:ne(),content:"",tags:[]}),at=({pubkey:t,updatedTags:e,content:u})=>({kind:Q,pubkey:t,created_at:ne(),tags:e,content:u}),le=(t,e)=>at({pubkey:t.pubkey,content:t.content,updatedTags:e(t.tags)}),ut=(t,e)=>new Be(t.tags).taggedPubkeys().includes(e)?t:le(t,c=>[...c,["p",e]]),ct=(t,e)=>le(t,c=>c.filter(([w,k])=>!(w==="p"&&k===e))),dt=t=>{const e=ke(),u=C(t),{mutation:c,wrapMutate:w}=Re(()=>({mutationKey:["useFollowingsMutation",u().pubkey],onSuccess:b=>{const{pubkey:$}=u();if($!=null){const L=He({pubkey:$});e.invalidateQueries({queryKey:L}).catch(_=>console.error("failed to invalidate followings",_))}u().onSuccess?.(b)},onError:b=>{u().onError?.(b)}})),k=w(ut),y=w(ct);return{mutation:c,follow:k,unfollow:y}};var oe=/^(?:([\w.+-]+)@)?([\w_-]+(\.[\w_-]+)+)$/,se;try{se=fetch}catch{}async function pt(t){const e=t.match(oe);if(!e)return null;const[,u="_",c]=e;try{const w=`https://${c}/.well-known/nostr.json?name=${u}`,k=await se(w,{redirect:"manual"});if(k.status!==200)throw Error("Wrong response code");const y=await k.json(),b=y.names[u];return b?{pubkey:b,relays:y.relays?.[b]}:null}catch{return null}}const ft=t=>{if(t==null||t.length===0)return null;const e=t.match(oe);if(e==null)return null;const[,u,c]=e;return u==null||u==="_"?{user:"_",domain:c,ident:c}:{user:u,domain:c,ident:t}};function mt(t){const{config:e}=te(),u=C(t),{events:c}=re(()=>({relayUrls:e().relayUrls,filters:[{kinds:[Q],"#p":[u().pubkey]}],limit:1e6,eoseLimit:1e6,continuous:!1})),w=()=>$e(c()?.map(y=>y.pubkey));return{followersPubkeys:w,count:()=>w().length}}const gt=t=>{const e=C(t),u=()=>["useVerification",e()],c=_e(()=>({queryKey:u(),queryFn:({queryKey:k})=>{const[,y]=k;if(y==null)return Promise.resolve(null);const{nip05:b}=y;return pt(b)},staleTime:30*60*1e3,gcTime:24*60*60*1e3}));return{verification:()=>c?.data??null,query:c}},ht=s('<button class="rounded-full border border-primary px-4 py-2 text-center font-bold text-primary hover:bg-primary hover:text-primary-fg sm:w-20">'),Y=s('<span class="rounded-full border border-primary px-4 py-2 text-primary sm:text-base">'),wt=s('<button class="rounded-full border border-primary bg-primary px-4 py-2 text-center font-bold text-primary-fg hover:bg-primary-hover sm:w-36">'),yt=s('<button class="w-28 rounded-full border border-primary px-4 py-2 text-primary hover:border-primary-hover hover:text-primary-hover">'),ee=s('<div class="shrink-0 text-xs">'),bt=s('<div class="flex shrink-0 flex-col items-center gap-1"><div class="flex flex-row justify-start gap-1"><button class="w-10 rounded-full border border-primary p-2 text-primary hover:border-primary-hover hover:text-primary-hover"></button><button type=button class="w-10 rounded-full border border-primary p-2 text-primary hover:border-primary-hover hover:text-primary-hover">'),vt=s('<div class="mt-[-54px] flex items-end gap-4 px-4 pt-4"><div class="flex-1 shrink-0"><div class="size-28 overflow-hidden rounded-lg shadow-md">'),kt=s('<div class="truncate text-xl font-bold">'),$t=s('<div class="truncate text-xs">@'),_t=s('<span class="inline-block size-3">'),xt=s('<span class="inline-block size-4 text-link">'),Ct=s('<div class="flex items-center text-xs">'),Pt=s('<div class="flex items-start px-4 pt-2"><div class="h-16 shrink overflow-hidden"><div class="flex items-center gap-2"></div><div class="flex gap-1"><div class="truncate text-xs">'),Mt=s('<div class="flex flex-1 flex-col items-start"><div class=text-sm></div><div class=text-xl>'),Ft=s('<div class="flex border-t border-border px-4 py-2"><button class="flex flex-1 flex-col items-start"><div class=text-sm></div><div class=text-xl>'),St=s('<ul class="border-t border-border px-5 py-2 text-xs">'),Et=s('<ul class="border-t border-border p-1">'),qt=s('<div class="h-12 shrink-0">'),Tt=s('<div class="h-40 w-full shrink-0 sm:h-52"><img alt=header class="size-full object-cover">'),Lt=s('<img alt="user icon"class="size-full object-cover">'),Ut=s('<span class="inline-block size-4 text-danger">'),zt=s('<div class="max-h-40 shrink-0 overflow-y-auto whitespace-pre-wrap px-4 py-2 text-sm">'),Nt=s("<span class=text-sm>"),Bt=s('<button class="text-sm hover:text-fg-secondary">'),Rt=s('<li class="flex items-center gap-1"><span class="inline-block size-4"area-label=website title=website>'),jt=t=>{const{count:e}=mt(()=>({pubkey:t.pubkey}));return R(e)},tn=t=>{const e=xe(),{config:u,addMutedPubkey:c,removeMutedPubkey:w,isPubkeyMuted:k,saveColumn:y}=te(),b=je(),$=Qe(),{showProfileEdit:L}=Ke(),_=C(()=>Ve(t.pubkey)),[ie,A]=B(!1),[ae,ue]=B(!1),[U,P]=B(null),z=()=>P(null),{profile:p,event:ce,query:M}=Ae(()=>({pubkey:t.pubkey})),{verification:de,query:pe}=gt(()=>W([p()?.nip05])(([n])=>({nip05:n}))),fe=()=>ft(p()?.nip05),me=()=>de()?.pubkey===t.pubkey,D=()=>k(t.pubkey),ge=C(()=>{const n=ce(),o=p()?.about;if(n==null||o==null)return;const a=Fe(o);return Se(a,Ee(n))}),{followingPubkeys:he,query:K}=X(()=>W([$()])(([n])=>({pubkey:n}))),F=()=>he().includes(t.pubkey),{followingPubkeys:N,query:V}=X(()=>({pubkey:t.pubkey})),we=()=>{const n=$();return n!=null&&N().includes(n)},{mutation:S,follow:ye,unfollow:be}=dt(()=>({pubkey:$()})),H=async n=>{try{const o=$();if(o==null||S.isPending)return;const a=await Je({pubkey:o});if((a.data()==null||a.followingPubkeys().length===0)&&!window.confirm(e.t("profile.confirmUpdateEvenIfEmpty")))return;if((a?.data()?.created_at??0)<(K.data?.created_at??0)){window.alert(e.t("profile.failedToFetchLatestFollowList"));return}const m=a.data()??it(o);await n(m)}catch(o){console.error("failed to update contact list",o),window.alert(e.t("profile.failedToUpdateFollowList"))}},G=()=>{H(n=>ye(n,t.pubkey)).catch(n=>{console.log("failed to follow",n)})},I=()=>{window.confirm(e.t("profile.confirmUnfollow"))&&H(n=>be(n,t.pubkey)).catch(n=>{console.log("failed to unfollow",n)})},E=Le(()=>({menu:[{content:e.t("profile.copyPubkey"),onSelect:()=>{navigator.clipboard.writeText(_()).catch(n=>window.alert(n))}},{content:e.t("profile.showJSON"),onSelect:()=>{P("EventDebugModal")}},{content:e.t("profile.addColumn"),items:[{content:e.t("profile.addUserColumn"),onSelect:()=>{const n=p()?.name??_();y(qe({name:n,pubkey:t.pubkey})),b({command:"moveToLastColumn"}).catch(o=>console.error(o)),t.onClose?.()}},{content:e.t("profile.addUserHomeColumn"),onSelect:()=>{const n=`${e.t("column.home")} / ${p()?.name??_()}`;y(Te({name:n,pubkey:t.pubkey})),b({command:"moveToLastColumn"}).catch(o=>console.error(o)),t.onClose?.()}}]},{content:D()?e.t("profile.unmute"):e.t("profile.mute"),onSelect:()=>{D()?w(t.pubkey):c(t.pubkey)}},{when:()=>t.pubkey===$(),content:F()?e.t("profile.unfollowMyself"):e.t("profile.followMyself"),onSelect:()=>{F()?I():G()}}]})),q=Ge(()=>({duration:null})),{events:Z,eose:ve}=re(()=>({relayUrls:u().relayUrls,filters:[{kinds:[1,6],authors:[t.pubkey],limit:10,since:q.since(),until:q.until()}],eoseLimit:10,continuous:!1}));return Ce(()=>q.setEvents(Z())),r(Oe,{onClose:()=>t.onClose?.(),get children(){return[r(h,{get when(){return R(()=>!!M.isFetched)()&&p()?.banner},get fallback(){return qt()},keyed:!0,children:n=>(()=>{const o=Tt(),a=o.firstChild;return J(a,"src",n),o})()}),(()=>{const n=vt(),o=n.firstChild,a=o.firstChild;return l(a,r(h,{get when(){return R(()=>!!M.isFetched)()&&p()?.picture},keyed:!0,children:m=>(()=>{const g=Lt();return J(g,"src",m),g})()})),l(n,r(h,{get when(){return $()!=null},get children(){const m=bt(),g=m.firstChild,d=g.firstChild,f=d.nextSibling;l(g,r(T,{get children(){return[r(v,{get when(){return t.pubkey===$()},get children(){const i=ht();return i.$$click=()=>L(),l(i,()=>e.t("profile.editProfile")),i}}),r(v,{get when(){return S.isPending},get children(){const i=Y();return l(i,()=>e.t("general.updating")),i}}),r(v,{get when(){return K.isPending},get children(){const i=Y();return l(i,()=>e.t("general.loading")),i}}),r(v,{get when(){return F()},get children(){const i=wt();return i.$$click=()=>I(),i.addEventListener("mouseleave",()=>A(!1)),i.addEventListener("mouseenter",()=>A(!0)),l(i,r(h,{get when(){return!ie()},get fallback(){return e.t("profile.unfollow")},get children(){return e.t("profile.followingCurrently")}})),O(()=>i.disabled=S.isPending),i}}),r(v,{get when(){return!F()},get children(){const i=yt();return i.$$click=()=>G(),l(i,()=>e.t("profile.follow")),O(()=>i.disabled=S.isPending),i}})]}}),d),d.$$click=()=>P("ZapRequest"),l(d,r(Ue,{})),f.$$click=()=>E.open();const x=E.targetRef;return typeof x=="function"?Pe(x,f):E.targetRef=f,l(f,r(ze,{})),l(g,()=>E.popup(),null),l(m,r(T,{get children(){return[r(v,{get when(){return V.isPending},get children(){const i=ee();return l(i,()=>e.t("general.loading")),i}}),r(v,{get when(){return we()},get children(){const i=ee();return l(i,()=>e.t("profile.followsYou")),i}})]}}),null),m}}),null),n})(),(()=>{const n=Pt(),o=n.firstChild,a=o.firstChild,m=a.nextSibling,g=m.firstChild;return l(o,r(h,{get when(){return M.isPending},get children(){return e.t("general.loading")}}),a),l(o,r(h,{get when(){return(p()?.display_name?.length??0)>0},get children(){const d=kt();return l(d,()=>p()?.display_name),d}}),a),l(a,r(h,{get when(){return(p()?.name?.length??0)>0},get children(){const d=$t();return d.firstChild,l(d,()=>p()?.name,null),d}}),null),l(a,r(h,{get when(){return(p()?.nip05?.length??0)>0},get children(){const d=Ct();return l(d,()=>fe()?.ident,null),l(d,r(T,{get fallback(){return(()=>{const f=Ut();return l(f,r(st,{})),f})()},get children(){return[r(v,{get when(){return pe.isPending},get children(){const f=_t();return l(f,r(nt,{})),f}}),r(v,{get when(){return me()},get children(){const f=xt();return l(f,r(lt,{})),f}})]}}),null),d}}),null),l(g,_),n})(),r(h,{get when(){return ge()},keyed:!0,children:n=>(()=>{const o=zt();return l(o,r(Ne,{parsed:n,embedding:!1,initialHidden:!0})),o})()}),(()=>{const n=Ft(),o=n.firstChild,a=o.firstChild,m=a.nextSibling;return o.$$click=()=>P("Following"),l(a,()=>e.t("profile.following")),l(m,r(h,{get when(){return V.isFetched},get fallback(){return(()=>{const g=Nt();return l(g,()=>e.t("general.loading")),g})()},get children(){return N().length}})),l(n,r(h,{get when(){return!u().hideCount},get children(){const g=Mt(),d=g.firstChild,f=d.nextSibling;return l(d,()=>e.t("profile.followers")),l(f,r(h,{get when(){return ae()},get fallback(){return(()=>{const x=Bt();return x.$$click=()=>ue(!0),l(x,()=>e.t("profile.loadFollowers")),x})()},keyed:!0,get children(){return r(jt,{get pubkey(){return t.pubkey}})}})),g}}),null),n})(),r(h,{get when(){return(p()?.website??"").length>0},get children(){const n=St();return l(n,r(h,{get when(){return p()?.website},keyed:!0,children:o=>(()=>{const a=Rt(),m=a.firstChild;return l(m,r(De,{})),l(a,r(et,{class:"text-link underline",href:o}),null),a})()})),n}}),r(T,{get children(){return[r(v,{get when(){return U()==="Following"},get children(){return r(Xe,{get data(){return N()},pubkeyExtractor:n=>n,onClose:z})}}),r(v,{get when(){return U()==="EventDebugModal"&&M.data},keyed:!0,children:n=>r(We,{event:n,get extra(){return JSON.stringify(p(),null,2)},onClose:z})}),r(v,{get when(){return U()==="ZapRequest"},get children(){return r(Ye,{get zapTo(){return{pubkey:t.pubkey}},onClose:z})}})]}}),(()=>{const n=Et();return l(n,r(Ie,{loadMore:q,get eose(){return ve()},get children(){return r(Ze,{get events(){return Z()}})}})),n})()]}})};Me(["click"]);export{tn as default};
//# sourceMappingURL=ProfileDisplay-BBOQrRC2.js.map
