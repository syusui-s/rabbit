import{u as I,c as S,y as h,l as L,z as T,t as b,aK as C,aL as R,n as v,aM as E}from"./main-814ceb9c.js";const A=t=>{const s=new URL("/",window.location.href);return new URL(t,s).href},O=b("<iframe title=interwindow class=hidden>"),P=t=>{let s;const[r,o]=S(!1);h(()=>{s=(()=>{const n=O();return L(n,"src",t),n})(),document.body.appendChild(s),s.addEventListener("load",()=>o(!0)),T(()=>{s?.remove()})});const i=()=>r()?Promise.resolve():new Promise(n=>{C(r).subscribe(a=>{a&&n()})}),g=async(n,a=2e3)=>new Promise((u,f)=>{const c=d=>{if(console.log("message received",d),d.origin!==new URL(t).origin||typeof d.data!="string")return;const m=JSON.parse(d.data);m.requestId===n&&(window.removeEventListener("message",c),u(m))};setTimeout(()=>{f(new Error("timeout")),window.removeEventListener("message",c)},a),window.addEventListener("message",c,!1)}),l=async n=>{const a=Math.random(),u={...n,requestId:a},f=JSON.stringify(u);await i();const c=g(a);if(s==null)throw new Error("iframeRef is null");if(!r())throw new Error("iframeRef is not loaded");return s.contentWindow?.postMessage(f,new URL(t).origin),c};return{loaded:r,request:l,getConfig:()=>l({type:"GET_CONFIG"})}},M=()=>{const t="https://syusui-s.github.io/rabbit/transfer-config.html",{getConfig:s}=P(t),{setConfig:r}=I(),[o,i]=S(),g=()=>{const e=o();return e!=null&&e.length>0},l=()=>{const e=o();e!=null&&e.length>0&&r(JSON.parse(e))};return h(()=>{setTimeout(()=>{s().then(e=>{typeof e.payload=="string"&&e.payload.length>0&&i(e.payload)}).catch(e=>{console.error(e)})},100)}),{canImport:g,importConfig:l}},y={loggedIn:!1,agreements:{nostrBuild:!1}},N=t=>JSON.stringify(t),J=t=>JSON.parse(t),U=R(()=>window.localStorage,N,J),[w,p]=v(()=>E("RabbitPersistStatus",y,U)),W=()=>({persistStatus:()=>({...y,...w}),loggedIn:()=>{p(o=>({...o,loggedIn:!0}))},agreeToToS:o=>{p("agreements",i=>({...i,[o]:!0}))},didAgreeToToS:o=>w.agreements[o]??!1});export{M as a,A as r,W as u};
//# sourceMappingURL=usePersistStatus-2fcfa11b.js.map
