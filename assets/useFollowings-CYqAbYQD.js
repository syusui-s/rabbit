const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/EventDebugModal-BrTntyN5.js","assets/index-C-C10-4j.js","assets/index-BbW6KRtC.css","assets/BasicModal-bQFl_mya.js","assets/SideBar-CVh_7HMa.js","assets/resolveAsset-HZj2CewZ.js","assets/Copy-CTOLV0o-.js","assets/UserList-CcOLFgVd.js","assets/url-DPIb-kBm.js","assets/LazyLoad-DUBSTxgp.js","assets/ZapRequestModal-B40Ch7ll.js","assets/lud16ToLnurlPayUrl-CdLoSRA6.js","assets/_baseClone-CGXo2vtK.js","assets/SafeLink-C1WdAnG8.js"])))=>i.map(i=>d[i]);
import{i as u,t as h,s as q,a as r,h as w,at as Ie,au as st,r as x,y as z,u as I,av as lt,j as M,M as E,ae as it,S as O,c as p,q as H,A as B,p as Pe,d as T,v as De,f as R,F as N,n as j,x as Q,B as Z,a9 as ie,C as ce,_ as ae,b as C,m as J,w as ue,aj as ct,am as at,o as Le,ah as ut,ag as dt,Q as gt,l as ht,D as ft,aw as ve,ai as $e}from"./index-C-C10-4j.js";import{r as Fe,t as X,B as V,f as ee,U as vt,g as de,q as $t,s as Ae,o as ge,b as te,v as mt,j as yt,P as bt,E as wt,e as Ue,n as je,a as _t,k as kt,N as xt,w as pt,x as me,y as se,m as Et,z as Rt,A as Ct}from"./SideBar-CVh_7HMa.js";import{L as F}from"./LazyLoad-DUBSTxgp.js";import{S as D}from"./SafeLink-C1WdAnG8.js";import{t as qe,a as Oe,p as St,b as Mt,c as Tt,d as It,i as Pt}from"./url-DPIb-kBm.js";const Dt=h('<div class="block shrink-0 overflow-hidden border-b border-border p-1">'),le=e=>(()=>{const t=Dt();return u(t,()=>e.children),t})(),Lt=h('<svg xmlns=http://www.w3.org/2000/svg fill=none stroke=currentColor stroke-width=1.5 aria-hidden=true data-slot=icon viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round d="M19.5 12c0-1.232-.046-2.453-.138-3.662a4.006 4.006 0 0 0-3.7-3.7 48.678 48.678 0 0 0-7.324 0 4.006 4.006 0 0 0-3.7 3.7c-.017.22-.032.441-.046.662M19.5 12l3-3m-3 3-3-3m-12 3c0 1.232.046 2.453.138 3.662a4.006 4.006 0 0 0 3.7 3.7 48.656 48.656 0 0 0 7.324 0 4.006 4.006 0 0 0 3.7-3.7c.017-.22.032-.441.046-.662M4.5 12l3 3m-3-3-3 3">'),He=(e={})=>(()=>{const t=Lt();return q(t,e,!0),t})(),Ft=h('<button class="text-link underline">'),At=e=>{try{return Ie(e)}catch(t){return console.error("failed to encode event id into Bech32 entity (NIP-19) but ignore",e,t),e}},Ut=e=>{try{return st({id:e})}catch(t){return console.error("failed to encode event id into Bech32 entity (NIP-19) but ignore",e,t),e}},W=e=>(()=>{const t=Ft();return u(t,r(w,{get when(){return e.kind==null||e.kind===1},get fallback(){return Ut(e.eventId)},get children(){return At(e.eventId)}})),t})(),jt=e=>{const t=x(e),n=z(()=>({queryKey:["useEvent",t()],queryFn:({queryKey:c,signal:i})=>{const[,o]=c;if(o==null)return null;const{eventId:s}=o,a=new V({type:"Event",eventId:s}),d=a.firstEventPromise().catch(()=>{throw new Error(`event not found: ${s}`)});return console.log("useEvent",t()),Fe({task:a,signal:i}),X(15e3,`useEvent: ${s}`)(d)},staleTime:4*60*60*1e3,gcTime:4*60*60*1e3,refetchOnWindowFocus:!1,refetchOnMount:!1}));return{event:()=>n.data??null,query:n}},qt=h("<span>"),Ot=h("<div class=truncate> "),K=e=>{const t=I(),[n,l]=lt(e,["eventId"]),{shouldMuteEvent:c}=M(),{event:i,query:o}=jt(()=>ee([n.eventId])(([a])=>({eventId:a}))),s=()=>{const a=i();return a!=null&&c(a)};return r(O,{get fallback(){return(()=>{const a=qt();return u(a,()=>t.t("post.failedToFetchEvent"),null),u(a,()=>e.eventId,null),a})()},get children(){return[r(E,{get when(){return s()},children:null}),r(E,{get when(){return i()},keyed:!0,children:a=>r(rt,it({event:a},l))}),r(E,{get when(){return o.isLoading&&n.eventId},keyed:!0,children:a=>(()=>{const d=Ot(),g=d.firstChild;return u(d,()=>t.t("general.loading"),g),u(d,r(W,{eventId:a}),null),d})()})]}})},Be=e=>{const[t,n]=p(new Date);return H(()=>{const l=setInterval(()=>{n(new Date)},e().interval);B(()=>clearInterval(l))}),t},Ht=e=>{switch(e.kind){case"now":return"now";case"seconds":return`${e.value}s`;case"minutes":return`${e.value}m`;case"hours":return`${e.value}h`;case"days":return`${e.value}d`;case"abs":default:return e.value.toLocaleDateString()}},ye=e=>`${e.getHours()}:${e.getMinutes().toString().padStart(2,"0")}`,Bt=e=>{switch(e.kind){case"today":return e.value.toLocaleTimeString();case"yesterday":case"abs":default:return e.value.toLocaleString()}},Wt=e=>{switch(e.kind){case"today":return ye(e.value);case"yesterday":return`昨日 ${ye(e.value)}`;case"abs":default:return e.value.toLocaleString()}},Kt=(e,t)=>Math.round(Number(t)-Number(e))/1e3,zt=(e,t)=>{const n=Kt(e,t);return n<10?{kind:"now"}:n<60?{kind:"seconds",value:Math.round(n)}:n<3600?{kind:"minutes",value:Math.round(n/60)}:n<86400?{kind:"hours",value:Math.round(n/3600)}:n<604800?{kind:"days",value:Math.round(n/86400)}:{kind:"abs",value:e}},be=(e,t)=>e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate(),Nt=e=>new Date(+e-24*60*60*1e3),We=(e,t,n)=>be(e,t)?n({kind:"today",value:e}):be(e,Nt(t))?n({kind:"yesterday",value:e}):n({kind:"abs",value:e}),Qt=(e,t=new Date)=>We(e,t,Bt),Vt=(e,t=new Date)=>We(e,t,Wt),we=(e,t=new Date,n=Ht)=>n(zt(e,t)),_e=Pe(()=>Be(()=>({interval:7e3}))),ke=Pe(()=>Be(()=>({interval:60*1e3}))),Ke=()=>{const{config:e}=M();return t=>{switch(e().dateFormat){case"absolute-long":return Qt(t,ke());case"absolute-short":return Vt(t,ke());case"relative":return we(t,_e());default:return we(t,_e())}}},Gt=h('<div><div class="flex items-center gap-1"><div class="flex shrink-0 place-items-center pl-[2px]"aria-hidden=true><span class="size-4 text-r-repost"></span></div><div class="notification-user flex min-w-0 flex-1 overflow-hidden text-xs"><button class="select-text truncate hover:text-link hover:underline"></button><span class="shrink-0 whitespace-pre"></span></div><div class=text-xs></div></div><div class=pt-1>'),Yt=e=>{const t=I(),{showProfile:n}=de(),l=Ke(),c=x(()=>De(e.event)),i=()=>c().lastTaggedEventId();return(()=>{const o=Gt(),s=o.firstChild,a=s.firstChild,d=a.firstChild,g=a.nextSibling,v=g.firstChild,b=v.nextSibling,$=g.nextSibling,m=s.nextSibling;return u(d,r(He,{})),v.$$click=()=>n(e.event.pubkey),u(v,r(vt,{get pubkey(){return e.event.pubkey}})),u(b,()=>t.t("notification.reposted")),u($,()=>l(c().createdAtAsDate())),u(m,r(K,{get eventId(){return i()}})),o})()};T(["click"]);const Zt=h('<svg xmlns=http://www.w3.org/2000/svg fill=none stroke=currentColor stroke-width=1.5 aria-hidden=true data-slot=icon viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round d="m3.75 13.5 10.5-11.25L12 10.5h8.25L9.75 21.75 12 13.5z">'),Jt=(e={})=>(()=>{const t=Zt();return q(t,e,!0),t})(),Xt=h('<svg xmlns=http://www.w3.org/2000/svg fill=none stroke=currentColor stroke-width=1.5 aria-hidden=true data-slot=icon viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round d="M2.25 12.76c0 1.6 1.123 2.994 2.707 3.227 1.087.16 2.185.283 3.293.369V21l4.076-4.076a1.526 1.526 0 0 1 1.037-.443 48.282 48.282 0 0 0 5.68-.494c1.584-.233 2.707-1.626 2.707-3.228V6.741c0-1.602-1.123-2.995-2.707-3.228A48.394 48.394 0 0 0 12 3c-2.392 0-4.744.175-7.043.513C3.373 3.746 2.25 5.14 2.25 6.741z">'),en=(e={})=>(()=>{const t=Xt();return q(t,e,!0),t})(),tn=h('<svg xmlns=http://www.w3.org/2000/svg fill=none stroke=currentColor stroke-width=1.5 aria-hidden=true data-slot=icon viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round d="M6.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0m6 0a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0m6 0a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0">'),nn=(e={})=>(()=>{const t=tn();return q(t,e,!0),t})(),rn=h('<svg xmlns=http://www.w3.org/2000/svg fill=currentColor aria-hidden=true data-slot=icon viewBox="0 0 24 24"><path d="m11.645 20.91-.007-.003-.022-.012a15.247 15.247 0 0 1-.383-.218 25.18 25.18 0 0 1-4.244-3.17C4.688 15.36 2.25 12.174 2.25 8.25 2.25 5.322 4.714 3 7.688 3A5.5 5.5 0 0 1 12 5.052 5.5 5.5 0 0 1 16.313 3c2.973 0 5.437 2.322 5.437 5.25 0 3.925-2.438 7.111-4.739 9.256a25.175 25.175 0 0 1-4.244 3.17 15.247 15.247 0 0 1-.383.219l-.022.012-.007.004-.003.001a.752.752 0 0 1-.704 0l-.003-.001Z">'),ze=(e={})=>(()=>{const t=rn();return q(t,e,!0),t})(),on=h('<span class="inline-block size-4 pt-px text-r-reaction">'),xe=h("<span class=truncate>"),sn=h('<img class="h-4 max-w-24">'),ln=e=>e.type==="LikeDislike"&&e.content==="+",Ne=e=>r(O,{get fallback(){return(()=>{const t=xe();return u(t,()=>e.reactionTypes.content),t})()},get children(){return[r(E,{get when(){return ln(e.reactionTypes)},get children(){const t=on();return u(t,r(ze,{})),t}}),r(E,{get when(){return e.reactionTypes.type==="Emoji"&&e.reactionTypes},keyed:!0,children:({content:t})=>(()=>{const n=xe();return u(n,t),n})()}),r(E,{get when(){return e.reactionTypes.type==="CustomEmoji"&&e.reactionTypes},keyed:!0,children:({shortcode:t,url:n})=>(()=>{const l=sn();return R(l,"src",n),R(l,"alt",`:${t}:`),l})()})]}}),cn=h('<svg xmlns=http://www.w3.org/2000/svg fill=none stroke=currentColor stroke-width=1.5 aria-hidden=true data-slot=icon viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round d="m8.25 4.5 7.5 7.5-7.5 7.5">'),an=(e={})=>(()=>{const t=cn();return q(t,e,!0),t})(),un=h('<li class="border-b border-border hover:bg-bg-tertiary"><button class="w-full px-4 py-1 text-start">'),dn=h('<li class="border-b border-border hover:bg-bg-tertiary"><button class="flex w-full items-center py-1 pe-2 ps-4 text-start"><span class=flex-1></span><span class="inline-block size-4 shrink-0">'),gn=h('<ul class="min-w-[96px] rounded border border-border bg-bg shadow-md">'),hn=e=>{const t=()=>{e.item?.onSelect?.(),e.onClose()};return(()=>{const n=un(),l=n.firstChild;return l.$$click=t,u(l,()=>e.item.content),n})()},fn=e=>{const t=Qe(()=>({menu:e.submenu.items,position:"right"})),n=()=>{t.open()};return(()=>{const l=dn(),c=l.firstChild,i=c.firstChild,o=i.nextSibling,s=t.targetRef;return typeof s=="function"?j(s,l):t.targetRef=l,c.$$click=n,u(i,()=>e.submenu.content),u(o,r(an,{})),u(l,()=>t.popup(),null),l})()},vn=e=>"onSelect"in e?e:null,$n=e=>"items"in e?e:null,Qe=e=>{const t=x(e),n=$t(()=>({ensureWidth:300,...t(),popup:(()=>{const l=gn();return u(l,r(N,{get each(){return t().menu.filter(c=>c.when==null||c.when())},children:c=>r(O,{get children(){return[r(E,{get when(){return vn(c)},keyed:!0,children:i=>r(hn,{item:i,onClose:()=>n.close()})}),r(E,{get when(){return $n(c)},keyed:!0,children:i=>r(fn,{submenu:i,onClose:()=>n.close()})})]}})})),l})()}));return n};T(["click"]);const mn=/\p{Emoji_Presentation}/u,Ve=e=>["useReactions",e],he=e=>{const{shouldMuteEvent:t}=M(),n=Q(),l=x(()=>Ve(e())),c=z(()=>({queryKey:l(),queryFn:Ae({taskProvider:([,d])=>{if(d==null)return null;const{eventId:g}=d;return new V({type:"Reactions",mentionedEventId:g})},queryClient:n}),staleTime:1*60*1e3,gcTime:4*60*60*1e3,refetchInterval:1*60*1e3})),i=()=>(c.data??[]).filter(g=>!t(g));return{reactions:i,reactionsGrouped:()=>{const d=new Map;return i().forEach(g=>{const v=Z(g).isCustomEmoji()?`${g.content}${Z(g).getUrl()??""}`:g.content,b=d.get(v)??[];b.push(g),d.set(v,b)}),d},isReactedBy:d=>i().findIndex(g=>g.pubkey===d)!==-1,isReactedByWithEmoji:d=>i().findIndex(g=>g.pubkey===d&&mn.test(g.content))!==-1,query:c}},Ge=e=>{const t=Q(),n=x(e),l=ge();return ie(()=>({mutationKey:["useReactionMutation",n().eventId],mutationFn:(...i)=>l.publishReaction(...i).then(o=>Promise.allSettled(o.map(X(5e3)))),onSuccess:i=>{const o=i.filter(a=>a.status==="fulfilled").length,s=i.length-o;o===i.length?console.log("Succeeded to publish a reaction"):o>0?console.warn(`failed to publish a reaction on ${s} relays`):console.error("failed to publish reaction on all relays")},onError:i=>{console.error("failed to publish reaction: ",i)},onSettled:()=>{const i=Ve({eventId:n().eventId});t.refetchQueries({queryKey:i}).then(()=>t.invalidateQueries({queryKey:i})).catch(o=>console.error("failed to refetch reactions",o))}}))},Ye=e=>["useReposts",e],Ze=e=>{const{shouldMuteEvent:t}=M(),n=Q(),l=x(e),c=x(()=>Ye(l())),i=z(()=>({queryKey:c(),queryFn:Ae({taskProvider:([,a])=>{if(a==null)return null;const{eventId:d}=a;return new V({type:"Reposts",mentionedEventId:d})},queryClient:n}),staleTime:1*60*1e3,gcTime:4*60*60*1e3,refetchInterval:1*60*1e3})),o=()=>(i.data??[]).filter(d=>!t(d));return{reposts:o,isRepostedBy:a=>o().findIndex(d=>d.pubkey===a)!==-1,query:i}},yn=e=>{const t=Q(),n=x(e),l=ge();return ie(()=>({mutationKey:["useRepostMutation",n().eventId],mutationFn:(...i)=>l.publishRepost(...i).then(o=>Promise.allSettled(o.map(X(1e4)))),onSuccess:i=>{const o=i.filter(a=>a.status==="fulfilled").length,s=i.length-o;o===i.length?console.log("Succeeded to publish a repost"):o>0?console.warn(`Failed to publish a repost on ${s} relays`):console.error("Failed to publish a repost on all relays")},onError:i=>{console.error("failed to publish repost: ",i)},onSettled:()=>{const i=Ye({eventId:n().eventId});t.refetchQueries({queryKey:i}).then(()=>t.invalidateQueries({queryKey:i})).catch(o=>console.error("failed to refetch repost",o))}}))},pe=["k","M","G","T","P"],bn=(e,t)=>{const n=t?.precision??3;if(n<=0)throw new Error(`precision is too small: ${n}`);const c=10**((t?.minDigits??4)-1);if(e<c)return{value:e,prefix:null};const i=10**(Math.floor(Math.log10(e)/3)*3),o=e/i;let s=Math.round(o*10**n)/10**n,a=Math.max(Math.floor(Math.log10(e)/3)-1,0);return s>=1e3&&(s/=1e3,a+=1),a>=pe.length?{value:e,prefix:null}:{value:s,prefix:pe[a]}},Je=(e,t)=>{const{value:n,prefix:l}=bn(e,{precision:2,minDigits:t?.minDigits??5});if(l==null)return`${e}`;const c=t?.digits??3,i=Math.floor(Math.log10(n))+1,o=Math.max(c-i,0);return`${Math.round(n*10**o)/10**o}${l}`},Xe=h('<div class="text-sm text-fg-tertiary">'),Ee=h('<div class="flex shrink-0 items-center gap-1"><button class=size-4>'),wn=h('<div class="flex shrink-0 items-center gap-1"><button><span class="flex size-4">'),_n=h("<div class=w-6>"),kn=h('<div class="scrollbar flex gap-2 overflow-x-auto py-1">'),xn=h('<span class="ml-1 text-sm">'),pn=h('<button class="flex h-6 max-w-[128px] items-center rounded border border-border px-1"type=button>'),En=h("<span class=text-red-500>"),Rn=h('<div class="actions flex w-64 max-w-full items-center justify-between pt-1"><button class="shrink-0 text-fg-tertiary hover:text-fg-tertiary/70"><span class="flex size-4"></span></button><button type=button><span class="flex size-4 text-fg-tertiary hover:text-r-zap"></span></button><button type=button class="size-4 shrink-0 text-fg-tertiary hover:text-fg-tertiary/70">'),Cn=ce(()=>ae(()=>import("./EventDebugModal-BrTntyN5.js"),__vite__mapDeps([0,1,2,3,4,5,6]))),et=ce(()=>ae(()=>import("./UserList-CcOLFgVd.js"),__vite__mapDeps([7,1,2,4,5,8,3,9]))),Sn=ce(()=>ae(()=>import("./ZapRequestModal-B40Ch7ll.js"),__vite__mapDeps([10,1,2,3,4,5,6,11,12,9,13,8]))),Mn=e=>{if(e.native!=null)return{type:"Emoji",content:e.native};if(e.src!=null)return{type:"CustomEmoji",content:`:${e.id}:`,shortcode:e.id,url:e.src};throw new Error("unknown emoji")},Tn=e=>{const{config:t}=M(),n=te(),[l,c]=p(!1),{reactions:i,isReactedByWithEmoji:o,isReactedBy:s}=he(()=>({eventId:e.event.id})),a=x(()=>{const f=n();return f!=null&&s(f)||l()}),d=x(()=>{const f=n();return f!=null&&o(f)}),g=Ge(()=>({eventId:e.event.id})),v=f=>{a()||ee([n(),e.event.id])(([y,k])=>{g.mutate({relayUrls:t().relayUrls,pubkey:y,reactionTypes:f??{type:"LikeDislike",content:"+"},eventId:k,kind:e.event.kind,notifyPubkey:e.event.pubkey}),c(!0)})},b=f=>{f.stopPropagation(),v()},$=f=>{v(Mn(f))},m=mt(()=>({onEmojiSelect:$}));return[(()=>{const f=Ee(),y=f.firstChild;return y.$$click=b,u(y,r(w,{get when(){return x(()=>!!a())()&&!d()},get fallback(){return r(yt,{})},get children(){return r(ze,{})}})),u(f,r(w,{get when(){return x(()=>!t().hideCount&&!t().showEmojiReaction)()&&i().length>0},get children(){const k=Xe();return u(k,()=>Je(i().length,{minDigits:4})),k}}),null),C(k=>{const S={"text-fg-tertiary":!a()||d(),"hover:text-r-reaction":!a()||d(),"text-r-reaction":a()&&!d()||g.isPending},L=g.isPending;return k._v$=J(f,S,k._v$),L!==k._v$2&&(y.disabled=k._v$2=L),k},{_v$:void 0,_v$2:void 0}),f})(),r(w,{get when(){return t().useEmojiReaction},get children(){const f=Ee(),y=f.firstChild;y.$$click=()=>m.open();const k=m.targetRef;return typeof k=="function"?j(k,y):m.targetRef=y,u(y,r(bt,{})),u(f,()=>m.popup(),null),C(S=>J(f,{"text-fg-tertiary":!a()||!d(),"hover:text-r-reaction":!a()||!d(),"text-r-reaction":a()&&d()||g.isPending},S)),f}})]},In=e=>{const{config:t}=M(),n=te(),[l,c]=p(!1),{reposts:i,isRepostedBy:o}=Ze(()=>({eventId:e.event.id})),s=x(()=>{const g=n();return g!=null&&o(g)||l()}),a=yn(()=>({eventId:e.event.id})),d=g=>{g.stopPropagation(),!s()&&ee([n(),e.event.id])(([v,b])=>{a.mutate({relayUrls:t().relayUrls,pubkey:v,eventId:b,kind:e.event.kind,notifyPubkey:e.event.pubkey}),c(!0)})};return(()=>{const g=wn(),v=g.firstChild,b=v.firstChild;return v.$$click=d,u(b,r(He,{})),u(g,r(w,{get when(){return x(()=>!t().hideCount)()&&i().length>0},get children(){const $=Xe();return u($,()=>Je(i().length,{minDigits:4})),$}}),null),C($=>{const m={"text-fg-tertiary":!s(),"hover:text-r-repost":!s(),"text-r-repost":s()||a.isPending},f=a.isPending;return $._v$3=J(g,m,$._v$3),f!==$._v$4&&(v.disabled=$._v$4=f),$},{_v$3:void 0,_v$4:void 0}),g})()},Pn=e=>{const{reactions:t}=he(()=>({eventId:e.event.id}));return r(et,{get data(){return t()},pubkeyExtractor:n=>n.pubkey,renderInfo:n=>(()=>{const l=_n();return u(l,r(Ne,{get reactionTypes(){return Z(n).toReactionTypes()}})),l})(),get onClose(){return e.onClose}})},Dn=e=>{const{reposts:t}=Ze(()=>({eventId:e.event.id}));return r(et,{get data(){return t()},pubkeyExtractor:n=>n.pubkey,get onClose(){return e.onClose}})},Ln=e=>{const{config:t}=M(),n=te(),[l,c]=p(!1),{reactions:i,reactionsGrouped:o,isReactedBy:s}=he(()=>({eventId:e.event.id})),a=Ge(()=>({eventId:e.event.id})),d=()=>{const v=n();return v==null?l():l()||s(v)},g=v=>{d()||ee([n(),e.event.id])(([b,$])=>{a.mutate({relayUrls:t().relayUrls,pubkey:b,reactionTypes:v??{type:"LikeDislike",content:"+"},eventId:$,kind:e.event.kind,notifyPubkey:e.event.pubkey}),c(!0)})};return r(w,{get when(){return x(()=>!!t().showEmojiReaction)()&&i().length>0},get children(){const v=kn();return u(v,r(N,{get each(){return[...o().entries()]},children:([,b])=>{const $=b.findIndex(f=>f.pubkey===n())>=0,m=Z(b[0]).toReactionTypes();return(()=>{const f=pn();return f.$$click=y=>{y.stopPropagation(),g(m)},u(f,r(Ne,{reactionTypes:m}),null),u(f,r(w,{get when(){return!t().hideCount},get children(){const y=xn();return u(y,()=>b.length),y}}),null),C(y=>{const k={"text-fg-tertiary":!$,"hover:bg-r-reaction/10":!$,"hover:border-r-reaction/40":!$,"bg-r-reaction/10":$,"border-r-reaction/40":$,"text-r-reaction":$},S=d();return y._v$5=J(f,k,y._v$5),S!==y._v$6&&(f.disabled=y._v$6=S),y},{_v$5:void 0,_v$6:void 0}),f})()}})),v}})},Fn=e=>{const t=I(),{config:n}=M(),l=te(),c=ge(),[i,o]=p(null),s=()=>o(null),a=ie(()=>({mutationKey:["deleteEvent",e.event.id],mutationFn:(...g)=>c.deleteEvent(...g).then(v=>Promise.allSettled(v.map(X(1e4)))),onSuccess:g=>{const v=g.filter($=>$.status==="fulfilled").length,b=g.length-v;v===g.length?window.alert(t.t("post.deletedSuccessfully")):v>0?window.alert(t.t("post.failedToDeletePartially",{count:b})):window.alert(t.t("post.failedToDelete"))},onError:g=>{console.error("failed to delete",g)}})),d=Qe(()=>({menu:[{content:t.t("post.copyEventId"),onSelect:()=>{navigator.clipboard.writeText(Ie(e.event.id)).catch(g=>window.alert(g))}},{content:t.t("post.showJSON"),onSelect:()=>{o("EventDebugModal")}},{content:t.t("post.showReposts"),onSelect:()=>{o("Reposts")}},{content:t.t("post.showReactions"),onSelect:()=>{o("Reactions")}},{when:()=>e.event.pubkey===l(),content:(()=>{const g=En();return u(g,()=>t.t("post.deletePost")),g})(),onSelect:()=>{const g=l();g!=null&&window.confirm(t.t("post.confirmDelete"))&&a.mutate({relayUrls:n().relayUrls,pubkey:g,eventId:e.event.id})}}]}));return[r(Ln,{get event(){return e.event}}),(()=>{const g=Rn(),v=g.firstChild,b=v.firstChild,$=v.nextSibling,m=$.firstChild,f=$.nextSibling;v.$$click=k=>{k.stopPropagation(),e.onClickReply()},u(b,r(en,{})),u(g,r(In,{get event(){return e.event}}),$),u(g,r(Tn,{get event(){return e.event}}),$),$.$$click=()=>o("ZapRequest"),u(m,r(Jt,{})),f.$$click=()=>d.open();const y=d.targetRef;return typeof y=="function"?j(y,f):d.targetRef=f,u(f,r(nn,{})),u(g,()=>d.popup(),null),g})(),r(O,{get children(){return[r(E,{get when(){return i()==="EventDebugModal"},get children(){return r(Cn,{get event(){return e.event},onClose:s})}}),r(E,{get when(){return i()==="Reactions"},get children(){return r(Pn,{get event(){return e.event},onClose:s})}}),r(E,{get when(){return i()==="Reposts"},get children(){return r(Dn,{get event(){return e.event},onClose:s})}}),r(E,{get when(){return i()==="ZapRequest"},get children(){return r(Sn,{get zapTo(){return{event:e.event}},onClose:s})}})]}})]};T(["click"]);const An=h("<div>"),Un=h('<button class="text-xs text-fg-secondary hover:text-fg-secondary/70">'),jn=h("<span>: "),qn=h('<button class="mt-2 flex w-full flex-col items-center rounded border border-border p-2 text-center text-xs text-fg-secondary"><span class="inline-block size-4"></span><span>'),On=e=>{const t=I(),[n,l]=p(!1);return r(w,{get when(){return!e.contentWarning.contentWarning||n()},get fallback(){return(()=>{const c=qn(),i=c.firstChild,o=i.nextSibling;return c.$$click=()=>l(!0),u(i,r(wt,{})),u(o,()=>t.t("post.contentWarning.show")),u(c,r(w,{get when(){return e.contentWarning.reason!=null},get children(){const s=jn(),a=s.firstChild;return u(s,()=>t.t("post.contentWarning.reason"),a),u(s,()=>e.contentWarning.reason,null),s}}),null),c})()},get children(){return[(()=>{const c=An();return u(c,()=>e.children),c})(),r(w,{get when(){return e.contentWarning.contentWarning},get children(){const c=Un();return c.$$click=()=>l(!1),u(c,()=>t.t("post.contentWarning.hide")),c}})]}})};T(["click"]);const tt=e=>{const{profile:t}=Ue(()=>({pubkey:e.pubkey}));return r(w,{get when(){return(t()?.name?.length??0)>0},get fallback(){return`@${je(e.pubkey)}`},get children(){return["@",x(()=>t()?.name??e.pubkey)]}})},Hn=h('<button class="rounded bg-bg-tertiary p-3 text-xs text-fg-secondary hover:shadow">'),Bn=h("<div class=max-w-full>"),Wn=h("<audio controls><a>"),Kn=e=>{const t=I(),[n,l]=p(e.initialHidden);return r(w,{get when(){return!n()},get fallback(){return(()=>{const c=Hn();return c.$$click=()=>l(!1),u(c,()=>t.t("post.showAudio")),c})()},get children(){return r(F,{get fallback(){return Bn()},children:()=>r(D,{class:"my-2 block",get href(){return e.url},get children(){const c=Wn(),i=c.firstChild;return u(i,()=>t.t("post.download")),C(o=>{const s=e.url,a=e.url;return s!==o._v$&&R(c,"src",o._v$=s),a!==o._v$2&&R(i,"href",o._v$2=a),o},{_v$:void 0,_v$2:void 0}),c}})})}})};T(["click"]);const zn=h('<button class="rounded bg-bg-tertiary p-3 text-xs text-fg-secondary hover:shadow">'),Nn=h('<div class="aspect-video max-w-full">'),Qn=h('<img class="max-h-64 max-w-full rounded object-contain shadow hover:shadow-md">'),Vn=e=>{let t;const n=I(),[l,c]=p(e.initialHidden),[i,o]=p(!1);return r(w,{get when(){return!l()},get fallback(){return(()=>{const s=zn();return s.$$click=()=>c(!1),u(s,()=>n.t("post.showImage")),s})()},get children(){return r(F,{get fallback(){return(()=>{const s=Nn();return u(s,r(D,{class:"text-link underline",get href(){return e.url}})),s})()},children:()=>r(w,{get when(){return!i()},get fallback(){return r(D,{class:"text-link underline",get href(){return e.url}})},get children(){return r(D,{class:"my-2 block",get href(){return e.url},get children(){const s=Qn();s.addEventListener("error",()=>o(!0));const a=t;return typeof a=="function"?j(a,s):t=s,C(d=>{const g=qe(e.url),v=e.url;return g!==d._v$&&R(s,"src",d._v$=g),v!==d._v$2&&R(s,"alt",d._v$2=v),d},{_v$:void 0,_v$2:void 0}),s}})}})})}})};T(["click"]);const Gn=h('<div class="my-1 rounded border p-1">'),Yn=e=>r(w,{get when(){return e.mentionedEvent.marker!=null&&e.mentionedEvent.marker.length>0},get fallback(){return r(W,{get eventId(){return e.mentionedEvent.eventId}})},get children(){const t=Gn();return u(t,r(F,{children:()=>r(K,{get eventId(){return e.mentionedEvent.eventId},embedding:!1,actions:!1,get ensureKinds(){return[ue]}})})),t}}),Zn=h('<button class="inline select-text text-link underline">'),ne=e=>{const{showProfile:t}=de(),n=()=>{t(e.pubkey)};return(()=>{const l=Zn();return l.$$click=n,u(l,r(tt,{get pubkey(){return e.pubkey}})),l})()};T(["click"]);const Jn=e=>{const t={};return Array.from(e.head.querySelectorAll("meta")).forEach(n=>{const l=n.getAttribute("property"),c=n.getAttribute("content");l!=null&&c!=null&&(t[l]=c)}),t["og:image"]!=null&&t["og:title"]!=null&&t["og:description"]!=null&&t["og:url"]?{title:t["og:title"],description:t["og:description"],image:t["og:image"],url:t["og:url"]}:null},Xn=e=>{const t=new DOMParser().parseFromString(e,"text/html");return Jn(t)},nt=e=>{const t=["www3.nhk.or.jp"],n=new URL(e);return t.includes(n.host)},er=async e=>{if(!nt(e))return null;const n=await(await fetch(e,{headers:{Accept:"text/html"}})).text();return Xn(n)},tr=e=>{const t=()=>["useOgp",e().url],n=z(()=>({queryKey:t(),queryFn:({queryKey:[,c]})=>er(c),staleTime:144e5,gcTime:144e5,refetchOnWindowFocus:!1,refetchOnMount:!1}));return{query:n,ogp:()=>n.data}},nr=h('<blockquote class=twitter-tweet><a class="text-link underline"target=_blank rel="noreferrer noopener">'),rr=h('<div class="my-2 rounded-lg border border-border transition-colors hover:bg-bg-tertiary"><img class="max-w-full rounded-t-lg object-contain shadow"><div class="mb-1 p-1"><div class="text-xs text-fg-secondary"></div><div class=text-sm></div><div class="text-xs text-fg-secondary">'),or=h('<div><button class="flex flex-col items-center rounded bg-bg-tertiary p-3 text-xs text-fg-secondary hover:shadow">'),sr=h('<div class="aspect-video max-w-full">'),lr=h('<div class="my-2 aspect-video w-full"><iframe loading=lazy title=YouTube class="my-2 size-full"allowfullscreen>'),Re=e=>{try{const t=new URL(e);return t.host="twitter.com",t.href}catch{return e}},ir=e=>{const t=new URL("https://www.youtube-nocookie.com/embed/");return t.pathname+=e,t.searchParams.set("origin",window.location.origin),t.href},cr=e=>{let t;const{getColorTheme:n}=M();H(()=>{Oe(e.url)&&window.twttr?.widgets?.load(t)});const l=()=>n().brightness==="dark"?"dark":"light";return(()=>{const c=nr(),i=c.firstChild,o=t;return typeof o=="function"?j(o,c):t=c,u(i,()=>Re(e.url)),C(s=>{const a=l(),d=Re(e.url);return a!==s._v$&&R(c,"data-theme",s._v$=a),d!==s._v$2&&R(i,"href",s._v$2=d),s},{_v$:void 0,_v$2:void 0}),c})()},ar=e=>{const{ogp:t}=tr(()=>({url:e.url}));return r(w,{get when(){return t()},get fallback(){return r(D,{class:"text-link underline",get href(){return e.url}})},keyed:!0,children:n=>r(D,{get href(){return e.url},get children(){const l=rr(),c=l.firstChild,i=c.nextSibling,o=i.firstChild,s=o.nextSibling,a=s.nextSibling;return u(o,()=>new URL(n.url).host),u(s,()=>n.title),u(a,()=>n.description),C(d=>{const g=n.title,v=n.image;return g!==d._v$3&&R(c,"alt",d._v$3=g),v!==d._v$4&&R(c,"src",d._v$4=v),d},{_v$3:void 0,_v$4:void 0}),l}})})},re=e=>{const t=I(),[n,l]=p(e.initialHidden);return r(w,{get when(){return!n()},get fallback(){return(()=>{const c=or(),i=c.firstChild;return i.$$click=()=>l(!1),u(i,()=>t.t("post.showPreview")),u(c,r(D,{class:"text-link underline",get href(){return e.url}}),null),c})()},get children(){return e.children}})},ur=e=>{const{config:t}=M();return r(O,{get fallback(){return r(D,{class:"text-link underline",get href(){return e.url}})},get children(){return[r(E,{get when(){return x(()=>!!t().embedding.twitter)()&&Oe(e.url)},get children(){return r(re,{get url(){return e.url},get initialHidden(){return e.initialHidden},get children(){return r(cr,{get url(){return e.url}})}})}}),r(E,{get when(){return x(()=>!!t().embedding.youtube)()&&St(e.url)},keyed:!0,children:({videoId:n})=>r(re,{get url(){return e.url},get initialHidden(){return e.initialHidden},get children(){return r(F,{get fallback(){return(()=>{const l=sr();return u(l,r(D,{get href(){return e.url}})),l})()},children:()=>(()=>{const l=lr(),c=l.firstChild;return C(()=>R(c,"src",ir(n))),l})()})}})}),r(E,{get when(){return x(()=>!!t().embedding.ogp)()&&nt(e.url)},get children(){return r(re,{get url(){return e.url},get initialHidden(){return e.initialHidden},get children(){return r(F,{children:()=>r(ar,{get url(){return e.url}})})}})}})]}})};T(["click"]);const dr=h('<button class="rounded bg-bg-tertiary p-3 text-xs text-fg-secondary hover:shadow">'),gr=h('<div class="aspect-video max-w-full">'),hr=h('<video class="max-h-64 max-w-full rounded-sm object-contain shadow"controls><a>'),fr=e=>{let t;const n=I(),[l,c]=p(e.initialHidden);return r(w,{get when(){return!l()},get fallback(){return(()=>{const i=dr();return i.$$click=()=>c(!1),u(i,()=>n.t("post.showVideo")),i})()},get children(){return r(F,{get fallback(){return gr()},children:()=>r(D,{class:"my-2 block",get href(){return e.url},get children(){const i=hr(),o=i.firstChild,s=t;return typeof s=="function"?j(s,i):t=i,u(o,()=>n.t("post.download")),C(a=>{const d=e.url,g=e.url;return d!==a._v$&&R(i,"src",a._v$=d),g!==a._v$2&&R(o,"href",a._v$2=g),a},{_v$:void 0,_v$2:void 0}),i}})})}})};T(["click"]);const oe=h("<span>"),Ce=h('<button class="select-text text-link underline">'),Se=h('<div class="my-1 rounded border border-border p-1">'),vr=h('<button class="select-text text-link underline"> (<!>)'),$r=h('<span class="text-link underline">'),mr=h('<img class="inline-block h-8 max-w-32">'),yr=e=>{const{config:t,saveColumn:n}=M(),l=_t(),c=o=>{n(ct({query:o})),l({command:"moveToLastColumn"}).catch(s=>console.error(s))},i=o=>{n(at({name:o,relayUrls:[o]})),l({command:"moveToLastColumn"}).catch(s=>console.error(s))};return r(N,{get each(){return e.parsed},children:o=>{if(o.type==="PlainText")return(()=>{const s=oe();return u(s,()=>o.content),s})();if(o.type==="URL"){const s=()=>!t().showMedia||!e.embedding||(e.initialHidden??!1);return Mt(o.content)?r(Vn,{get url(){return o.content},get initialHidden(){return s()}}):Tt(o.content)?r(fr,{get url(){return o.content},get initialHidden(){return s()}}):It(o.content)?r(Kn,{get url(){return o.content},get initialHidden(){return s()}}):Pt(o.content)?(()=>{const a=Ce();return a.$$click=()=>i(o.content),u(a,()=>o.content),a})():r(ur,{get url(){return o.content},get initialHidden(){return s()}})}if(o.type==="TagReferenceResolved"){if(o.reference==null)return(()=>{const s=oe();return u(s,()=>o.content),s})();if(o.reference.type==="MentionedUser")return r(ne,{get pubkey(){return o.reference.pubkey}});if(o.reference.type==="MentionedEvent")return e.embedding?r(Yn,{get mentionedEvent(){return o.reference}}):r(W,{get eventId(){return o.reference.eventId}})}if(o.type==="Bech32Entity"){if(o.data.type==="note"&&e.embedding)return(()=>{const s=Se();return u(s,r(K,{get eventId(){return o.data.data},actions:!1,embedding:!1,get ensureKinds(){return[ue]}})),s})();if(o.data.type==="nevent"&&e.embedding)return(()=>{const s=Se();return u(s,r(K,{get eventId(){return o.data.data.id},actions:!1,embedding:!1})),s})();if(o.data.type==="npub")return r(ne,{get pubkey(){return o.data.data}});if(o.data.type==="nprofile")return r(ne,{get pubkey(){return o.data.data.pubkey}});if(o.data.type==="nrelay"){const s=o.data.data;return(()=>{const a=vr(),d=a.firstChild,g=d.nextSibling;return g.nextSibling,a.$$click=()=>i(s),u(a,s,d),u(a,()=>o.content,g),a})()}return(()=>{const s=$r();return u(s,()=>o.content),s})()}return o.type==="HashTag"?(()=>{const s=Ce();return s.$$click=()=>c(o.content),u(s,()=>o.content),s})():o.type==="CustomEmojiResolved"?o.url==null?(()=>{const s=oe();return u(s,()=>o.content),s})():(()=>{const s=mr();return C(a=>{const d=o.url,g=o.content,v=o.shortcode;return d!==a._v$&&R(s,"src",a._v$=d),g!==a._v$2&&R(s,"alt",a._v$2=g),v!==a._v$3&&R(s,"title",a._v$3=v),a},{_v$:void 0,_v$2:void 0,_v$3:void 0}),s})():(console.error("Not all ParsedTextNoteNodes are covered",o),null)}})};T(["click"]);const Me=2,br=200,wr=()=>{let e;const[t,n]=p(!1),l=i=>{e=i},c=kt(()=>{e!=null&&n(e.scrollHeight>e.clientHeight+Me||e.scrollHeight>document.documentElement.clientHeight+Me)},br);return Le(()=>{if(e!=null){c();const i=new IntersectionObserver(s=>{s.forEach(a=>{a.isIntersecting&&c()})},{threshold:[0,.25,.5,.75,1]});i.observe(e);const o=()=>c();window.addEventListener("resize",o),B(()=>{i.disconnect(),window.removeEventListener("resize",o)})}}),{overflow:t,elementRef:l}},_r=h('<div class="author-name truncate pr-1 font-bold hover:underline">'),kr=h('<button class="mt-2 w-full rounded border border-border p-2 text-center text-xs text-fg-secondary shadow-sm hover:bg-bg-tertiary hover:shadow">'),xr=h('<div class="post flex flex-col"><div class="flex w-full gap-1"><button type=button class="author-icon size-10 shrink-0 overflow-hidden rounded"></button><div class="min-w-0 flex-auto"><div class="flex justify-between gap-1 text-xs"><button type=button class="author flex min-w-0 select-text truncate hover:text-link"><span class="author flex min-w-0 truncate hover:text-link"><div class="author-username truncate text-fg-secondary"></div></span></button><div class="created-at shrink-0"><button type=button class="select-text hover:underline"></button></div></div><div class=overflow-hidden></div><div class=actions>'),pr=h('<img alt=icon referrerpolicy=no-referrer class="size-full object-cover">'),Er=e=>{const t=I(),{overflow:n,elementRef:l}=wr(),c=Ke(),[i,o]=p(!1),s=()=>c(e.createdAt),a=()=>e.createdAt.toLocaleString(),{profile:d}=Ue(()=>({pubkey:e.authorPubkey}));return(()=>{const g=xr(),v=g.firstChild,b=v.firstChild,$=b.nextSibling,m=$.firstChild,f=m.firstChild,y=f.firstChild,k=y.firstChild,S=f.nextSibling,L=S.firstChild,A=m.nextSibling,G=A.nextSibling;return b.$$click=_=>{_.preventDefault(),e.onShowProfile?.()},u(b,r(w,{get when(){return d()?.picture},keyed:!0,children:_=>r(F,{children:()=>(()=>{const P=pr();return C(()=>R(P,"src",qe(_,"icon"))),P})()})})),f.$$click=_=>{_.preventDefault(),e?.onShowProfile?.()},u(y,r(w,{get when(){return(d()?.display_name?.length??0)>0},get children(){const _=_r();return u(_,()=>d()?.display_name),_}}),k),u(k,r(w,{get when(){return d()?.name!=null},get fallback(){return`@${je(e.authorPubkey)}`},get children(){return["@",x(()=>d()?.name)]}})),L.$$click=_=>{_.preventDefault(),e.onShowEvent?.()},u(L,s),j(l,A),u(A,()=>e.content),u($,r(w,{get when(){return n()},get children(){const _=kr();return _.$$click=P=>{P.stopPropagation(),o(U=>!U)},u(_,r(w,{get when(){return!i()},get fallback(){return t.t("post.hideOverflow")},get children(){return t.t("post.showOverflow")}})),_}}),G),u(G,()=>e.actions),u(g,r(w,{get when(){return e.footer},get children(){return e.footer}}),null),C(_=>{const P=a(),U=!i(),fe=!!i();return P!==_._v$&&R(L,"title",_._v$=P),U!==_._v$2&&A.classList.toggle("max-h-screen",_._v$2=U),fe!==_._v$3&&A.classList.toggle("max-h-none",_._v$3=fe),_},{_v$:void 0,_v$2:void 0,_v$3:void 0}),g})()};T(["click"]);const Rr=dt(),Cr=()=>ut(Rr),Qr=()=>{const[e,t]=gt({});return{timelineState:e,setTimeline:n=>t("content",n),clearTimeline:()=>t("content",void 0)}},Sr=h("<div class=nostr-textnote>"),Mr=h("<div class=text-xs>"),Tr=h('<div class="content whitespace-pre-wrap break-all">'),Ir=h("<div class=textnote-content>"),Pr=h('<div class="mt-1 rounded border border-border p-1">'),Dr=h("<div class=h-12>"),Lr=h('<button class="select-text pr-1 text-link hover:underline">'),Fr=h("<div class=h-5>"),Ar=e=>{let t;const n=I(),{showProfile:l}=de(),c=Cr(),[i,o]=p(!1),s=()=>o(!1),a=()=>{o($=>!$),i()&&t!=null&&t.focus()},d=x(()=>ht(e.event)),g=()=>e.embedding??!0,v=()=>e.actions??!0,b=()=>{if(g()){const $=d().replyingToEvent();if($!=null&&!d().containsEventMention($.id))return $.id;const m=d().rootEvent();if($==null&&m!=null&&!d().containsEventMention(m.id))return m.id}};return(()=>{const $=Sr();return u($,r(Er,{get authorPubkey(){return d().pubkey},get createdAt(){return d().createdAtAsDate()},get content(){return(()=>{const m=Ir();return u(m,r(w,{get when(){return b()},keyed:!0,children:f=>(()=>{const y=Pr();return u(y,r(F,{get fallback(){return Dr()},children:()=>r(K,{eventId:f,actions:!1,embedding:!1})})),y})()}),null),u(m,r(w,{get when(){return d().taggedPubkeys().length>0},get children(){const f=Mr();return u(f,()=>n.t("post.replyToPre"),null),u(f,r(N,{get each(){return d().taggedPubkeys()},children:y=>(()=>{const k=Lr();return k.$$click=S=>{S.stopPropagation(),l(y)},u(k,r(tt,{pubkey:y})),k})()}),null),u(f,()=>n.t("post.replyToPost"),null),f}}),null),u(m,r(On,{get contentWarning(){return d().contentWarning()},get children(){const f=Tr();return u(f,r(yr,{get parsed(){return d().parsed()},get embedding(){return g()},get initialHidden(){return d().contentWarning().contentWarning}})),f}}),null),m})()},get actions(){return r(w,{get when(){return v()},get children(){return r(F,{get fallback(){return Fr()},children:()=>r(Fn,{get event(){return e.event},onClickReply:a})})}})},get footer(){return r(w,{get when(){return i()},get children(){return r(xt,{textAreaRef:m=>{t=m},mode:"reply",get replyTo(){return e.event},onClose:s,onPost:s})}})},onShowProfile:()=>{l(d().pubkey)},onShowEvent:()=>{c?.setTimeline({type:"Replies",event:e.event})}})),$})()};T(["click"]);const Te=h("<div><span>"),rt=e=>{const t=I(),n=()=>e.ensureKinds==null||e.ensureKinds.length===0||e.ensureKinds.includes(e.event.kind);return r(O,{get fallback(){return(()=>{const l=Te(),c=l.firstChild;return u(c,()=>t.t("post.unsupportedKind",{kind:e.event.kind})),u(l,r(W,{get eventId(){return e.event.id},get kind(){return e.event.kind}}),null),l})()},get children(){return[r(E,{get when(){return!n()},keyed:!0,get children(){const l=Te(),c=l.firstChild;return u(c,()=>t.t("post.unexpectedKind",{kind:e.event.kind})),u(l,r(W,{get eventId(){return e.event.id},get kind(){return e.event.kind}}),null),l}}),r(E,{get when(){return e.event.kind===ue},get children(){return r(Ar,{get event(){return e.event},get embedding(){return e.actions},get actions(){return e.actions}})}}),r(E,{get when(){return e.event.kind===ft},get children(){return r(Yt,{get event(){return e.event}})}})]}})},Vr=e=>{const{shouldMuteEvent:t}=M();return r(N,{get each(){return e.events},children:n=>r(w,{get when(){return!t(n)},get children(){return r(le,{get children(){return r(rt,{event:n})}})}})})};let Y=0;const{setActiveSubscriptions:Ur}=pt();setInterval(()=>{Ur(Y)},1e3);const jr=({eose:e,limit:t,eoseLimit:n})=>{const[c,i]=p([]),o=[];let s;const a=()=>{i($=>{const m=[...$];return o.forEach(f=>{me(m,f)}),m.slice(0,n())}),o.splice(0,o.length)},d=()=>{s==null&&(s=setTimeout(()=>{s=void 0,a()},100))},g=()=>{s!=null&&clearTimeout(s)},v=$=>{const m=$.created_at-se();if(!(m>300)){if(m>0){setTimeout(()=>v($),m*1e3);return}e()?i(f=>{const y=[...f];return me(y,$),y.slice(0,t())}):(o.push($),d())}},b=()=>{i([]),g()};return H(()=>{e()&&a()}),B(()=>{g()}),{events:c,setEvents:i,addEvent:v,clearEvents:b}},Gr=e=>{const{config:t,shouldMuteEvent:n}=M(),l=Et(),[c,i]=p(!1),o=x(e),s=()=>e()?.eoseLimit??25,a=()=>e()?.limit??50,{events:d,addEvent:g,clearEvents:v,setEvents:b}=jr({eose:c,eoseLimit:s,limit:a});H(ve(()=>[t().mutedPubkeys,t().mutedKeywords],()=>{b(m=>m.filter(f=>!n(f)))},{defer:!0})),Le(()=>{console.debug("subscription mounted",e()?.debugId,e()),B(()=>{console.debug("subscription unmount",e()?.debugId,e())})});const $=()=>{console.debug("startSubscription: start");const m=o();if(m==null)return;const{relayUrls:f,filters:y,options:k,onEvent:S,onEOSE:L,clientEventFilter:A,continuous:G=!0}=m;let _=!0;Y+=1,v(),i(!1);const P=l().subscribeMany(f,y,k??{maxWait:12e3,onevent:U=>{S?.(U),!(A!=null&&!A(U))&&g(U)},oneose:()=>{c()||(L?.(),i(!0),G||(P.close(),_&&(_=!1,Y-=1)))}});B(()=>{console.debug("startSubscription: end"),P.close(),_&&(_=!1,Y-=1)})};return H(ve(()=>[o()],()=>$())),{events:d,eose:c}},qr=h("<div class=none>"),Or=h('<button class="flex h-12 w-full flex-col items-center justify-center hover:text-fg-secondary"><span>'),Hr=h('<button class="flex h-12 w-full flex-col items-center justify-center hover:text-fg-secondary disabled:text-fg-secondary/30"><span>'),Yr=e=>{const t=x(e),n=m=>{const{duration:f}=t();if(f!=null)return m-f},[l,c]=p([]),[i,o]=p(n(se())),[s,a]=p(),[d,g]=p();return{setEvents:c,since:i,until:s,continuous:()=>s()==null,loadLatest:()=>{$e(()=>{a(void 0),o(n(se()))}),d()?.scrollIntoView()},loadOld:()=>{const m=Rt(l());m!=null&&($e(()=>{a(m.created_at),o(n(m.created_at))}),d()?.scrollIntoView())},setTopMarkerRef:g}},Zr=e=>{const t=I();return[r(w,{get when(){return!e.loadMore.continuous()},get children(){return[(()=>{const n=qr(),l=e.loadMore.setTopMarkerRef;return typeof l=="function"?j(l,n):e.loadMore.setTopMarkerRef=n,n})(),r(le,{get children(){const n=Or(),l=n.firstChild;return n.$$click=()=>e.loadMore.loadLatest(),u(l,()=>t.t("column.loadLatest")),n}})]}}),x(()=>e.children),r(le,{get children(){const n=Hr(),l=n.firstChild;return n.$$click=()=>e.loadMore.loadOld(),u(l,()=>t.t("column.loadOld")),C(()=>n.disabled=!e.eose),n}})]};T(["click"]);const ot=e=>{const t=()=>{const l=e();if(l==null)return[];const c=[];return De(l).pTags().forEach(o=>{const[,s,a,d]=o,g={pubkey:s,petname:d};a!=null&&a.length>0&&(g.mainRelayUrl=a),c.push(g)}),c};return{followings:t,followingPubkeys:()=>t().map(l=>l.pubkey),data:e}},Jr=async({pubkey:e},t)=>{const n=new V({type:"Followings",pubkey:e});Fe({task:n,signal:t});const l=await n.latestEventPromise();return ot(()=>l)},Xr=e=>{const t=Q(),n=x(e),l=()=>["useFollowings",n()],c=z(()=>({queryKey:l(),queryFn:Ct({taskProvider:([,o])=>{if(o==null)return null;const{pubkey:s}=o;return new V({type:"Followings",pubkey:s})},queryClient:t}),staleTime:5*60*1e3,gcTime:3*24*60*60*1e3,refetchOnMount:!0,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchInterval:0})),i=()=>t.invalidateQueries({queryKey:l()});return{...ot(()=>c.data),invalidateFollowings:i,query:c}};export{Jt as B,an as C,K as E,Zr as L,Yt as R,Vr as T,Qr as a,Rr as b,le as c,Xr as d,Yr as e,Ke as f,jt as g,Ne as h,rt as i,Ar as j,Qe as k,nn as l,yr as m,Jr as n,Je as o,Gr as u};
//# sourceMappingURL=useFollowings-CYqAbYQD.js.map
