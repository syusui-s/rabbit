import{i as u,t as g,s as W,a as r,j as p,am as Ie,an as rt,w as k,A as z,u as D,ao as ot,k as S,M as x,ap as st,f as O,c as C,v as Y,C as J,r as Te,d as P,x as Me,g as E,F as N,n as A,z as Q,D as X,a8 as ie,E as ce,_ as ae,b as T,p as ee,S as L,y as ue,ae as lt,aq as it,o as Pe,ar as ct,as as at,V as ut,m as dt,G as ht,at as ve}from"./index-a5yQGAwi.js";import{r as De,t as te,B as V,f as ne,U as gt,g as de,k as ft,l as Le,j as he,b as re,m as vt,P as mt,E as $t,d as Ue,n as je,a as yt,h as bt,N as wt,o as pt,i as _t,e as kt,q as xt,s as Rt,v as Et,w as Ct}from"./SideBar-a9udcwtn.js";import{H as St}from"./globe-alt-Bl_aio75.js";import{L as U}from"./LazyLoad-KiiXUb99.js";const It=g('<div class="block shrink-0 overflow-hidden border-b border-border p-1">'),Tt=e=>(()=>{const t=It();return u(t,()=>e.children),t})(),Mt=g('<svg xmlns=http://www.w3.org/2000/svg fill=none stroke=currentColor stroke-width=1.5 aria-hidden=true data-slot=icon viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round d="M19.5 12c0-1.232-.046-2.453-.138-3.662a4.006 4.006 0 0 0-3.7-3.7 48.678 48.678 0 0 0-7.324 0 4.006 4.006 0 0 0-3.7 3.7c-.017.22-.032.441-.046.662M19.5 12l3-3m-3 3-3-3m-12 3c0 1.232.046 2.453.138 3.662a4.006 4.006 0 0 0 3.7 3.7 48.656 48.656 0 0 0 7.324 0 4.006 4.006 0 0 0 3.7-3.7c.017-.22.032-.441.046-.662M4.5 12l3 3m-3-3-3 3">'),Fe=(e={})=>(()=>{const t=Mt();return W(t,e,!0,!0),t})(),Pt=g('<button class="text-link underline">'),Dt=e=>{try{return Ie(e)}catch(t){return console.error("failed to encode event id into Bech32 entity (NIP-19) but ignore",e,t),e}},Lt=e=>{try{return rt({id:e})}catch(t){return console.error("failed to encode event id into Bech32 entity (NIP-19) but ignore",e,t),e}},H=e=>(()=>{const t=Pt();return u(t,r(p,{get when(){return e.kind==null||e.kind===1},get fallback(){return Lt(e.eventId)},get children(){return Dt(e.eventId)}})),t})(),Ut=e=>{const t=k(e),n=z(()=>({queryKey:["useEvent",t()],queryFn:({queryKey:c,signal:i})=>{const[,s]=c;if(s==null)return null;const{eventId:l}=s,a=new V({type:"Event",eventId:l}),d=a.firstEventPromise().catch(()=>{throw new Error(`event not found: ${l}`)});return De({task:a,signal:i}),te(15e3,`useEvent: ${l}`)(d)},staleTime:4*60*60*1e3,gcTime:4*60*60*1e3,refetchOnWindowFocus:!1,refetchOnMount:!1}));return{event:()=>n.data??null,query:n}},jt=g("<span>"),Ft=g("<div class=truncate> "),K=e=>{const t=D(),[n,o]=ot(e,["eventId"]),{shouldMuteEvent:c}=S(),{event:i,query:s}=Ut(()=>ne([n.eventId])(([a])=>({eventId:a}))),l=()=>{const a=i();return a!=null&&c(a)};return r(O,{get fallback(){return(()=>{const a=jt();return u(a,()=>t.t("post.failedToFetchEvent"),null),u(a,()=>e.eventId,null),a})()},get children(){return[r(x,{get when(){return l()},children:null}),r(x,{get when(){return i()},keyed:!0,children:a=>r(tt,st({event:a},o))}),r(x,{get when(){return s.isLoading&&n.eventId},keyed:!0,children:a=>(()=>{const d=Ft(),h=d.firstChild;return u(d,()=>t.t("general.loading"),h),u(d,r(H,{eventId:a}),null),d})()})]}})},qe=e=>{const[t,n]=C(new Date);return Y(()=>{const o=setInterval(()=>{n(new Date)},e().interval);J(()=>clearInterval(o))}),t},qt=e=>{switch(e.kind){case"now":return"now";case"seconds":return`${e.value}s`;case"minutes":return`${e.value}m`;case"hours":return`${e.value}h`;case"days":return`${e.value}d`;case"abs":default:return e.value.toLocaleDateString()}},me=e=>`${e.getHours()}:${e.getMinutes().toString().padStart(2,"0")}`,At=e=>{switch(e.kind){case"today":return e.value.toLocaleTimeString();case"yesterday":case"abs":default:return e.value.toLocaleString()}},Wt=e=>{switch(e.kind){case"today":return me(e.value);case"yesterday":return`昨日 ${me(e.value)}`;case"abs":default:return e.value.toLocaleString()}},Ot=(e,t)=>Math.round(Number(t)-Number(e))/1e3,Bt=(e,t)=>{const n=Ot(e,t);return n<10?{kind:"now"}:n<60?{kind:"seconds",value:Math.round(n)}:n<3600?{kind:"minutes",value:Math.round(n/60)}:n<86400?{kind:"hours",value:Math.round(n/3600)}:n<604800?{kind:"days",value:Math.round(n/86400)}:{kind:"abs",value:e}},$e=(e,t)=>e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate(),Ht=e=>new Date(+e-24*60*60*1e3),Ae=(e,t,n)=>$e(e,t)?n({kind:"today",value:e}):$e(e,Ht(t))?n({kind:"yesterday",value:e}):n({kind:"abs",value:e}),Kt=(e,t=new Date)=>Ae(e,t,At),zt=(e,t=new Date)=>Ae(e,t,Wt),ye=(e,t=new Date,n=qt)=>n(Bt(e,t)),be=Te(()=>qe(()=>({interval:7e3}))),we=Te(()=>qe(()=>({interval:60*1e3}))),We=()=>{const{config:e}=S();return t=>{switch(e().dateFormat){case"absolute-long":return Kt(t,we());case"absolute-short":return zt(t,we());case"relative":return ye(t,be());default:return ye(t,be())}}},Nt=g('<div><div class="flex items-center gap-1"><div class="flex shrink-0 place-items-center pl-[2px]"aria-hidden=true><span class="size-4 text-r-repost"></span></div><div class="notification-user flex min-w-0 flex-1 overflow-hidden text-xs"><button class="select-text truncate hover:text-link hover:underline"></button><span class=shrink-0></span></div><div class=text-xs></div></div><div class=pt-1>'),Qt=e=>{const t=D(),{showProfile:n}=de(),o=We(),c=k(()=>Me(e.event)),i=()=>c().lastTaggedEventId();return(()=>{const s=Nt(),l=s.firstChild,a=l.firstChild,d=a.firstChild,h=a.nextSibling,m=h.firstChild,w=m.nextSibling,v=h.nextSibling,y=l.nextSibling;return u(d,r(Fe,{})),m.$$click=()=>n(e.event.pubkey),u(m,r(gt,{get pubkey(){return e.event.pubkey}})),u(w,()=>t.t("notification.reposted")),u(v,()=>o(c().createdAtAsDate())),u(y,r(K,{get eventId(){return i()}})),s})()};P(["click"]);const Vt=g('<svg xmlns=http://www.w3.org/2000/svg fill=none stroke=currentColor stroke-width=1.5 aria-hidden=true data-slot=icon viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round d="m3.75 13.5 10.5-11.25L12 10.5h8.25L9.75 21.75 12 13.5z">'),Zt=(e={})=>(()=>{const t=Vt();return W(t,e,!0,!0),t})(),Gt=g('<svg xmlns=http://www.w3.org/2000/svg fill=none stroke=currentColor stroke-width=1.5 aria-hidden=true data-slot=icon viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round d="M2.25 12.76c0 1.6 1.123 2.994 2.707 3.227 1.087.16 2.185.283 3.293.369V21l4.076-4.076a1.526 1.526 0 0 1 1.037-.443 48.282 48.282 0 0 0 5.68-.494c1.584-.233 2.707-1.626 2.707-3.228V6.741c0-1.602-1.123-2.995-2.707-3.228A48.394 48.394 0 0 0 12 3c-2.392 0-4.744.175-7.043.513C3.373 3.746 2.25 5.14 2.25 6.741z">'),Yt=(e={})=>(()=>{const t=Gt();return W(t,e,!0,!0),t})(),Jt=g('<svg xmlns=http://www.w3.org/2000/svg fill=none stroke=currentColor stroke-width=1.5 aria-hidden=true data-slot=icon viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round d="M6.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0m6 0a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0m6 0a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0">'),Xt=(e={})=>(()=>{const t=Jt();return W(t,e,!0,!0),t})(),en=g('<svg xmlns=http://www.w3.org/2000/svg fill=currentColor aria-hidden=true data-slot=icon viewBox="0 0 24 24"><path d="m11.645 20.91-.007-.003-.022-.012a15.247 15.247 0 0 1-.383-.218 25.18 25.18 0 0 1-4.244-3.17C4.688 15.36 2.25 12.174 2.25 8.25 2.25 5.322 4.714 3 7.688 3A5.5 5.5 0 0 1 12 5.052 5.5 5.5 0 0 1 16.313 3c2.973 0 5.437 2.322 5.437 5.25 0 3.925-2.438 7.111-4.739 9.256a25.175 25.175 0 0 1-4.244 3.17 15.247 15.247 0 0 1-.383.219l-.022.012-.007.004-.003.001a.752.752 0 0 1-.704 0l-.003-.001Z">'),Oe=(e={})=>(()=>{const t=en();return W(t,e,!0,!0),t})(),tn=g('<span class="inline-block size-4 pt-[1px] text-r-reaction">'),pe=g("<span class=truncate>"),nn=g('<img class="h-4 max-w-[3rem]">'),rn=e=>e.type==="LikeDislike"&&e.content==="+",Be=e=>r(O,{get fallback(){return(()=>{const t=pe();return u(t,()=>e.reactionTypes.content),t})()},get children(){return[r(x,{get when(){return rn(e.reactionTypes)},get children(){const t=tn();return u(t,r(Oe,{})),t}}),r(x,{get when(){return e.reactionTypes.type==="Emoji"&&e.reactionTypes},keyed:!0,children:({content:t})=>(()=>{const n=pe();return u(n,t),n})()}),r(x,{get when(){return e.reactionTypes.type==="CustomEmoji"&&e.reactionTypes},keyed:!0,children:({shortcode:t,url:n})=>(()=>{const o=nn();return E(o,"src",n),E(o,"alt",`:${t}:`),o})()})]}}),on=g('<svg xmlns=http://www.w3.org/2000/svg fill=none stroke=currentColor stroke-width=1.5 aria-hidden=true data-slot=icon viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round d="m8.25 4.5 7.5 7.5-7.5 7.5">'),sn=(e={})=>(()=>{const t=on();return W(t,e,!0,!0),t})(),ln=g('<li class="border-b border-border hover:bg-bg-tertiary"><button class="w-full px-4 py-1 text-start">'),cn=g('<li class="border-b border-border hover:bg-bg-tertiary"><button class="flex w-full items-center py-1 pe-2 ps-4 text-start"><span class=flex-1></span><span class="inline-block size-4 shrink-0">'),an=g('<ul class="min-w-[96px] rounded border border-border bg-bg shadow-md">'),un=e=>{const t=()=>{e.item?.onSelect?.(),e.onClose()};return(()=>{const n=ln(),o=n.firstChild;return o.$$click=t,u(o,()=>e.item.content),n})()},dn=e=>{const t=He(()=>({menu:e.submenu.items,position:"right"})),n=()=>{t.open()};return(()=>{const o=cn(),c=o.firstChild,i=c.firstChild,s=i.nextSibling,l=t.targetRef;return typeof l=="function"?A(l,o):t.targetRef=o,c.$$click=n,u(i,()=>e.submenu.content),u(s,r(sn,{})),u(o,()=>t.popup(),null),o})()},hn=e=>"onSelect"in e?e:null,gn=e=>"items"in e?e:null,He=e=>{const t=k(e),n=ft(()=>({ensureWidth:300,...t(),popup:(()=>{const o=an();return u(o,r(N,{get each(){return t().menu.filter(c=>c.when==null||c.when())},children:c=>r(O,{get children(){return[r(x,{get when(){return hn(c)},keyed:!0,children:i=>r(un,{item:i,onClose:()=>n.close()})}),r(x,{get when(){return gn(c)},keyed:!0,children:i=>r(dn,{submenu:i,onClose:()=>n.close()})})]}})})),o})()}));return n};P(["click"]);const fn=/\p{Emoji_Presentation}/u,Ke=e=>["useReactions",e],ge=e=>{const{shouldMuteEvent:t}=S(),n=Q(),o=k(()=>Ke(e())),c=z(()=>({queryKey:o(),queryFn:Le({taskProvider:([,d])=>{if(d==null)return null;const{eventId:h}=d;return new V({type:"Reactions",mentionedEventId:h})},queryClient:n}),staleTime:1*60*1e3,gcTime:4*60*60*1e3,refetchInterval:1*60*1e3})),i=()=>(c.data??[]).filter(h=>!t(h));return{reactions:i,reactionsGrouped:()=>{const d=new Map;return i().forEach(h=>{const m=X(h).isCustomEmoji()?`${h.content}${X(h).getUrl()??""}`:h.content,w=d.get(m)??[];w.push(h),d.set(m,w)}),d},isReactedBy:d=>i().findIndex(h=>h.pubkey===d)!==-1,isReactedByWithEmoji:d=>i().findIndex(h=>h.pubkey===d&&fn.test(h.content))!==-1,query:c}},ze=e=>{const t=Q(),n=k(e),o=he();return ie(()=>({mutationKey:["useReactionMutation",n().eventId],mutationFn:(...i)=>o.publishReaction(...i).then(s=>Promise.allSettled(s.map(te(5e3)))),onSuccess:i=>{const s=i.filter(a=>a.status==="fulfilled").length,l=i.length-s;s===i.length?console.log("Succeeded to publish a reaction"):s>0?console.warn(`failed to publish a reaction on ${l} relays`):console.error("failed to publish reaction on all relays")},onError:i=>{console.error("failed to publish reaction: ",i)},onSettled:()=>{const i=Ke({eventId:n().eventId});t.refetchQueries({queryKey:i}).then(()=>t.invalidateQueries({queryKey:i})).catch(s=>console.error("failed to refetch reactions",s))}}))},Ne=e=>["useReposts",e],Qe=e=>{const{shouldMuteEvent:t}=S(),n=Q(),o=k(e),c=k(()=>Ne(o())),i=z(()=>({queryKey:c(),queryFn:Le({taskProvider:([,a])=>{if(a==null)return null;const{eventId:d}=a;return new V({type:"Reposts",mentionedEventId:d})},queryClient:n}),staleTime:1*60*1e3,gcTime:4*60*60*1e3,refetchInterval:1*60*1e3})),s=()=>(i.data??[]).filter(d=>!t(d));return{reposts:s,isRepostedBy:a=>s().findIndex(d=>d.pubkey===a)!==-1,query:i}},vn=e=>{const t=Q(),n=k(e),o=he();return ie(()=>({mutationKey:["useRepostMutation",n().eventId],mutationFn:(...i)=>o.publishRepost(...i).then(s=>Promise.allSettled(s.map(te(1e4)))),onSuccess:i=>{const s=i.filter(a=>a.status==="fulfilled").length,l=i.length-s;s===i.length?console.log("Succeeded to publish a repost"):s>0?console.warn(`Failed to publish a repost on ${l} relays`):console.error("Failed to publish a repost on all relays")},onError:i=>{console.error("failed to publish repost: ",i)},onSettled:()=>{const i=Ne({eventId:n().eventId});t.refetchQueries({queryKey:i}).then(()=>t.invalidateQueries({queryKey:i})).catch(s=>console.error("failed to refetch repost",s))}}))},_e=["k","M","G","T","P"],mn=(e,t)=>{const n=t?.precision??3;if(n<=0)throw new Error(`precision is too small: ${n}`);const c=10**((t?.minDigits??4)-1);if(e<c)return{value:e,prefix:null};const i=10**(Math.floor(Math.log10(e)/3)*3),s=e/i;let l=Math.round(s*10**n)/10**n,a=Math.max(Math.floor(Math.log10(e)/3)-1,0);return l>=1e3&&(l/=1e3,a+=1),a>=_e.length?{value:e,prefix:null}:{value:l,prefix:_e[a]}},Ve=(e,t)=>{const{value:n,prefix:o}=mn(e,{precision:2,minDigits:t?.minDigits??5});if(o==null)return`${e}`;const c=t?.digits??3,i=Math.floor(Math.log10(n))+1,s=Math.max(c-i,0);return`${Math.round(n*10**s)/10**s}${o}`},Ze=g('<div class="text-sm text-fg-tertiary">'),ke=g('<div class="flex shrink-0 items-center gap-1"><button class=size-4>'),$n=g('<div class="flex shrink-0 items-center gap-1"><button><span class="flex size-4">'),yn=g("<div class=w-6>"),bn=g('<div class="scrollbar flex gap-2 overflow-x-auto py-1">'),wn=g('<span class="ml-1 text-sm">'),pn=g('<button class="flex h-6 max-w-[128px] items-center rounded border border-border px-1"type=button>'),_n=g("<span class=text-red-500>"),kn=g('<div class="actions flex w-64 max-w-full items-center justify-between pt-1"><button class="shrink-0 text-fg-tertiary hover:text-fg-tertiary/70"><span class="flex size-4"></span></button><button type=button><span class="flex size-4 text-fg-tertiary hover:text-r-zap"></span></button><button type=button class="size-4 shrink-0 text-fg-tertiary hover:text-fg-tertiary/70">'),xn=ce(()=>ae(()=>import("./EventDebugModal-AjmHEwzc.js"),__vite__mapDeps([0,1,2,3,4,5]))),Ge=ce(()=>ae(()=>import("./UserList-I9vWpNbA.js"),__vite__mapDeps([6,1,2,4,5,3,7,8]))),Rn=ce(()=>ae(()=>import("./ZapRequestModal-bODx7XI6.js"),__vite__mapDeps([9,1,2,3,10,4,5,11,8,7]))),En=e=>{if(e.native!=null)return{type:"Emoji",content:e.native};if(e.src!=null)return{type:"CustomEmoji",content:`:${e.id}:`,shortcode:e.id,url:e.src};throw new Error("unknown emoji")},Cn=e=>{const{config:t}=S(),n=re(),[o,c]=C(!1),{reactions:i,isReactedByWithEmoji:s,isReactedBy:l}=ge(()=>({eventId:e.event.id})),a=k(()=>{const f=n();return f!=null&&l(f)||o()}),d=k(()=>{const f=n();return f!=null&&s(f)}),h=ze(()=>({eventId:e.event.id})),m=f=>{a()||ne([n(),e.event.id])(([$,b])=>{h.mutate({relayUrls:t().relayUrls,pubkey:$,reactionTypes:f??{type:"LikeDislike",content:"+"},eventId:b,kind:e.event.kind,notifyPubkey:e.event.pubkey}),c(!0)})},w=f=>{f.stopPropagation(),m()},v=f=>{m(En(f))},y=vt(()=>({onEmojiSelect:v}));return[(()=>{const f=ke(),$=f.firstChild;return $.$$click=w,u($,r(p,{get when(){return k(()=>!!a())()&&!d()},get fallback(){return r(St,{})},get children(){return r(Oe,{})}})),u(f,r(p,{get when(){return k(()=>!t().hideCount&&!t().showEmojiReaction)()&&i().length>0},get children(){const b=Ze();return u(b,()=>Ve(i().length,{minDigits:4})),b}}),null),T(b=>{const R={"text-fg-tertiary":!a()||d(),"hover:text-r-reaction":!a()||d(),"text-r-reaction":a()&&!d()||h.isPending},M=h.isPending;return b._v$=ee(f,R,b._v$),M!==b._v$2&&($.disabled=b._v$2=M),b},{_v$:void 0,_v$2:void 0}),f})(),r(p,{get when(){return t().useEmojiReaction},get children(){const f=ke(),$=f.firstChild;$.$$click=()=>y.open();const b=y.targetRef;return typeof b=="function"?A(b,$):y.targetRef=$,u($,r(mt,{})),u(f,()=>y.popup(),null),T(R=>ee(f,{"text-fg-tertiary":!a()||!d(),"hover:text-r-reaction":!a()||!d(),"text-r-reaction":a()&&d()||h.isPending},R)),f}})]},Sn=e=>{const{config:t}=S(),n=re(),[o,c]=C(!1),{reposts:i,isRepostedBy:s}=Qe(()=>({eventId:e.event.id})),l=k(()=>{const h=n();return h!=null&&s(h)||o()}),a=vn(()=>({eventId:e.event.id})),d=h=>{h.stopPropagation(),!l()&&ne([n(),e.event.id])(([m,w])=>{a.mutate({relayUrls:t().relayUrls,pubkey:m,eventId:w,kind:e.event.kind,notifyPubkey:e.event.pubkey}),c(!0)})};return(()=>{const h=$n(),m=h.firstChild,w=m.firstChild;return m.$$click=d,u(w,r(Fe,{})),u(h,r(p,{get when(){return k(()=>!t().hideCount)()&&i().length>0},get children(){const v=Ze();return u(v,()=>Ve(i().length,{minDigits:4})),v}}),null),T(v=>{const y={"text-fg-tertiary":!l(),"hover:text-r-repost":!l(),"text-r-repost":l()||a.isPending},f=a.isPending;return v._v$3=ee(h,y,v._v$3),f!==v._v$4&&(m.disabled=v._v$4=f),v},{_v$3:void 0,_v$4:void 0}),h})()},In=e=>{const{reactions:t}=ge(()=>({eventId:e.event.id}));return r(Ge,{get data(){return t()},pubkeyExtractor:n=>n.pubkey,renderInfo:n=>(()=>{const o=yn();return u(o,r(Be,{get reactionTypes(){return X(n).toReactionTypes()}})),o})(),get onClose(){return e.onClose}})},Tn=e=>{const{reposts:t}=Qe(()=>({eventId:e.event.id}));return r(Ge,{get data(){return t()},pubkeyExtractor:n=>n.pubkey,get onClose(){return e.onClose}})},Mn=e=>{const{config:t}=S(),n=re(),[o,c]=C(!1),{reactions:i,reactionsGrouped:s,isReactedBy:l}=ge(()=>({eventId:e.event.id})),a=ze(()=>({eventId:e.event.id})),d=()=>{const m=n();return m==null?o():o()||l(m)},h=m=>{d()||ne([n(),e.event.id])(([w,v])=>{a.mutate({relayUrls:t().relayUrls,pubkey:w,reactionTypes:m??{type:"LikeDislike",content:"+"},eventId:v,kind:e.event.kind,notifyPubkey:e.event.pubkey}),c(!0)})};return r(p,{get when(){return k(()=>!!t().showEmojiReaction)()&&i().length>0},get children(){const m=bn();return u(m,r(N,{get each(){return[...s().entries()]},children:([,w])=>{const v=w.findIndex(f=>f.pubkey===n())>=0,y=X(w[0]).toReactionTypes();return(()=>{const f=pn();return f.$$click=$=>{$.stopPropagation(),h(y)},u(f,r(Be,{reactionTypes:y}),null),u(f,r(p,{get when(){return!t().hideCount},get children(){const $=wn();return u($,()=>w.length),$}}),null),T($=>{const b={"text-fg-tertiary":!v,"hover:bg-r-reaction/10":!v,"hover:border-r-reaction/40":!v,"bg-r-reaction/10":v,"border-r-reaction/40":v,"text-r-reaction":v},R=d();return $._v$5=ee(f,b,$._v$5),R!==$._v$6&&(f.disabled=$._v$6=R),$},{_v$5:void 0,_v$6:void 0}),f})()}})),m}})},Pn=e=>{const t=D(),{config:n}=S(),o=re(),c=he(),[i,s]=C(null),l=()=>s(null),a=ie(()=>({mutationKey:["deleteEvent",e.event.id],mutationFn:(...h)=>c.deleteEvent(...h).then(m=>Promise.allSettled(m.map(te(1e4)))),onSuccess:h=>{const m=h.filter(v=>v.status==="fulfilled").length,w=h.length-m;m===h.length?window.alert(t.t("post.deletedSuccessfully")):m>0?window.alert(t.t("post.failedToDeletePartially",{count:w})):window.alert(t.t("post.failedToDelete"))},onError:h=>{console.error("failed to delete",h)}})),d=He(()=>({menu:[{content:t.t("post.copyEventId"),onSelect:()=>{navigator.clipboard.writeText(Ie(e.event.id)).catch(h=>window.alert(h))}},{content:t.t("post.showJSON"),onSelect:()=>{s("EventDebugModal")}},{content:t.t("post.showReposts"),onSelect:()=>{s("Reposts")}},{content:t.t("post.showReactions"),onSelect:()=>{s("Reactions")}},{when:()=>e.event.pubkey===o(),content:(()=>{const h=_n();return u(h,()=>t.t("post.deletePost")),h})(),onSelect:()=>{const h=o();h!=null&&window.confirm(t.t("post.confirmDelete"))&&a.mutate({relayUrls:n().relayUrls,pubkey:h,eventId:e.event.id})}}]}));return[r(Mn,{get event(){return e.event}}),(()=>{const h=kn(),m=h.firstChild,w=m.firstChild,v=m.nextSibling,y=v.firstChild,f=v.nextSibling;m.$$click=b=>{b.stopPropagation(),e.onClickReply()},u(w,r(Yt,{})),u(h,r(Sn,{get event(){return e.event}}),v),u(h,r(Cn,{get event(){return e.event}}),v),v.$$click=()=>s("ZapRequest"),u(y,r(Zt,{})),f.$$click=()=>d.open();const $=d.targetRef;return typeof $=="function"?A($,f):d.targetRef=f,u(f,r(Xt,{})),u(h,()=>d.popup(),null),h})(),r(O,{get children(){return[r(x,{get when(){return i()==="EventDebugModal"},get children(){return r(xn,{get event(){return e.event},onClose:l})}}),r(x,{get when(){return i()==="Reactions"},get children(){return r(In,{get event(){return e.event},onClose:l})}}),r(x,{get when(){return i()==="Reposts"},get children(){return r(Tn,{get event(){return e.event},onClose:l})}}),r(x,{get when(){return i()==="ZapRequest"},get children(){return r(Rn,{get event(){return e.event},onClose:l})}})]}})]};P(["click"]);const Dn=g("<div>"),Ln=g('<button class="text-xs text-fg-secondary hover:text-fg-secondary/70">'),Un=g("<span>: "),jn=g('<button class="mt-2 flex w-full flex-col items-center rounded border border-border p-2 text-center text-xs text-fg-secondary"><span class="inline-block size-4"></span><span>'),Fn=e=>{const t=D(),[n,o]=C(!1);return r(p,{get when(){return!e.contentWarning.contentWarning||n()},get fallback(){return(()=>{const c=jn(),i=c.firstChild,s=i.nextSibling;return c.$$click=()=>o(!0),u(i,r($t,{})),u(s,()=>t.t("post.contentWarning.show")),u(c,r(p,{get when(){return e.contentWarning.reason!=null},get children(){const l=Un(),a=l.firstChild;return u(l,()=>t.t("post.contentWarning.reason"),a),u(l,()=>e.contentWarning.reason,null),l}}),null),c})()},get children(){return[(()=>{const c=Dn();return u(c,()=>e.children),c})(),r(p,{get when(){return e.contentWarning.contentWarning},get children(){const c=Ln();return c.$$click=()=>o(!1),u(c,()=>t.t("post.contentWarning.hide")),c}})]}})};P(["click"]);const Ye=e=>{const{profile:t}=Ue(()=>({pubkey:e.pubkey}));return r(p,{get when(){return(t()?.name?.length??0)>0},get fallback(){return`@${je(e.pubkey)}`},get children(){return["@",k(()=>t()?.name??e.pubkey)]}})},qn=e=>{try{const t=new URL(e);return/\.(jpeg|jpg|png|gif|webp|avif|apng|svg)$/i.test(t.pathname)}catch{return!1}},An=e=>{try{const t=new URL(e);return/\.(mpg|mpeg|mp4|avi|mov|webm|ogv)$/i.test(t.pathname)}catch{return!1}},Wn=e=>{try{const t=new URL(e);return/^wss?:$/.test(t.protocol)}catch{return!1}},Je=(e,t="thumbnail")=>{try{const n=new URL(e);if(n.host==="i.imgur.com"||n.host==="imgur.com"){const o=n.pathname.match(/^\/([a-zA-Z0-9]+)\.(jpeg|jpg|png|gif|webp|avif|apng)/);if(o!=null){const c=new URL(n),i=o[1],s=o[2];if(c.host="i.imgur.com",t==="icon")c.pathname=`${i}s.${s}`;else if(t==="thumbnail")c.pathname=`${i}l.${s}`;else return e;return c.toString()}return n.toString()}if(n.host==="i.gyazo.com"){const o=new URL(n);if(o.host="thumb.gyazo.com",t==="icon")o.pathname=`/thumb/160${n.pathname}`;else if(t==="thumbnail")o.pathname=`/thumb/640${n.pathname}`;else return e;return o.toString()}if(n.host==="nostr.build"||n.host==="i.nostr.build"||n.host==="image.nostr.build"||n.host==="cdn.nostr.build"){if(n.pathname.startsWith("/i/p/"))return e;const o=new URL(n);if(n.pathname.startsWith("/i/")){const c=n.pathname.replace(/^\/i/,"");o.hostname="image.nostr.build",o.pathname=`/resp/240p${c}`}else if(n.pathname.match(/^\/[0-9a-zA-Z]+\.(jpeg|jpg|png|gif|webp|avif|apng)$/))o.pathname=`/resp/240p${n.pathname}`;else return e;return o.toString()}if(n.host==="pbs.twimg.com"){if(n.pathname.startsWith("/profile_images/")){const o=new URL(n);return o.pathname=n.pathname.replace(/(?:_(?:mini|normal|bigger|200x200|400x400))?\.(jpg|png)$/,"_normal.$1"),o.toString()}if(n.pathname.startsWith("/media/")){const o=new URL(n);return o.searchParams.set("format","jpg"),o.searchParams.set("name","small"),o.toString()}return e}if(n.hostname==="media.discordapp.net"&&n.pathname.match(/^\/attachments\/\d+\/\d+\/[a-z0-9]+\.(png|jpg|gif)/)){const o=new URL(n);if(o.searchParams.set("format","webp"),t==="icon")o.searchParams.set("width","100"),o.searchParams.set("height","100");else if(t==="thumbnail")o.searchParams.set("width","320"),o.searchParams.set("height","320");else return e}return n.toString()}catch{return e}},Xe=e=>{try{const t=new URL(e);return t.protocol==="https:"&&(t.host==="twitter.com"||t.host==="x.com")}catch{return!1}},On=["www.youtube.com","m.youtube.com","youtube.com"],Bn=e=>{try{const t=new URL(e);if(t.protocol!=="https:")return null;if(On.includes(t.host)){if(t.pathname==="/watch"){const n=t.searchParams.get("v");if(n!=null)return{videoId:n}}if(t.pathname.startsWith("/shorts/")){const n=t.pathname.match(/^\/shorts\/([0-9a-zA-Z_-]*)$/);if(n)return{videoId:n[1]}}}return t.host==="youtu.be"&&t.pathname.lastIndexOf("/")===0?{videoId:t.pathname}:null}catch{return null}},Hn=g('<button class="rounded bg-bg-tertiary p-3 text-xs text-fg-secondary hover:shadow">'),Kn=g('<div class="aspect-video max-w-full">'),zn=g('<img class="max-h-64 max-w-full rounded object-contain shadow hover:shadow-md">'),Nn=e=>{let t;const n=D(),[o,c]=C(e.initialHidden),[i,s]=C(!1);return r(p,{get when(){return!o()},get fallback(){return(()=>{const l=Hn();return l.$$click=()=>c(!1),u(l,()=>n.t("post.showImage")),l})()},get children(){return r(U,{get fallback(){return(()=>{const l=Kn();return u(l,r(L,{class:"text-link underline",get href(){return e.url}})),l})()},children:()=>r(p,{get when(){return!i()},get fallback(){return r(L,{class:"text-link underline",get href(){return e.url}})},get children(){return r(L,{class:"my-2 block",get href(){return e.url},get children(){const l=zn();l.addEventListener("error",()=>s(!0));const a=t;return typeof a=="function"?A(a,l):t=l,T(d=>{const h=Je(e.url),m=e.url;return h!==d._v$&&E(l,"src",d._v$=h),m!==d._v$2&&E(l,"alt",d._v$2=m),d},{_v$:void 0,_v$2:void 0}),l}})}})})}})};P(["click"]);const Qn=g('<div class="my-1 rounded border p-1">'),Vn=e=>r(p,{get when(){return e.mentionedEvent.marker!=null&&e.mentionedEvent.marker.length>0},get fallback(){return r(H,{get eventId(){return e.mentionedEvent.eventId}})},get children(){const t=Qn();return u(t,r(U,{children:()=>r(K,{get eventId(){return e.mentionedEvent.eventId},embedding:!1,actions:!1,get ensureKinds(){return[ue]}})})),t}}),Zn=g('<button class="inline select-text text-link underline">'),oe=e=>{const{showProfile:t}=de(),n=()=>{t(e.pubkey)};return(()=>{const o=Zn();return o.$$click=n,u(o,r(Ye,{get pubkey(){return e.pubkey}})),o})()};P(["click"]);const Gn=e=>{const t={};return Array.from(e.head.querySelectorAll("meta")).forEach(n=>{const o=n.getAttribute("property"),c=n.getAttribute("content");o!=null&&c!=null&&(t[o]=c)}),t["og:image"]!=null&&t["og:title"]!=null&&t["og:description"]!=null&&t["og:url"]?{title:t["og:title"],description:t["og:description"],image:t["og:image"],url:t["og:url"]}:null},Yn=e=>{const t=new DOMParser().parseFromString(e,"text/html");return Gn(t)},et=e=>{const t=["www3.nhk.or.jp"],n=new URL(e);return t.includes(n.host)},Jn=async e=>{if(!et(e))return null;const n=await(await fetch(e,{headers:{Accept:"text/html"}})).text();return Yn(n)},Xn=e=>{const t=()=>["useOgp",e().url],n=z(()=>({queryKey:t(),queryFn:({queryKey:[,c]})=>Jn(c),staleTime:144e5,gcTime:144e5,refetchOnWindowFocus:!1,refetchOnMount:!1}));return{query:n,ogp:()=>n.data}},er=g('<blockquote class=twitter-tweet><a class="text-link underline"target=_blank rel="noreferrer noopener">'),tr=g('<div class="my-2 rounded-lg border border-border transition-colors hover:bg-bg-tertiary"><img class="max-w-full rounded-t-lg object-contain shadow"><div class="mb-1 p-1"><div class="text-xs text-fg-secondary"></div><div class=text-sm></div><div class="text-xs text-fg-secondary">'),nr=g('<div><button class="flex flex-col items-center rounded bg-bg-tertiary p-3 text-xs text-fg-secondary hover:shadow">'),rr=g('<div class="aspect-video max-w-full">'),or=g('<div class="my-2 aspect-video w-full"><iframe loading=lazy title=YouTube class="my-2 size-full"allowfullscreen>'),xe=e=>{try{const t=new URL(e);return t.host="twitter.com",t.href}catch{return e}},sr=e=>{const t=new URL("https://www.youtube-nocookie.com/embed/");return t.pathname+=e,t.searchParams.set("origin",window.location.origin),t.href},lr=e=>{let t;const{getColorTheme:n}=S();Y(()=>{Xe(e.url)&&window.twttr?.widgets?.load(t)});const o=()=>n().brightness==="dark"?"dark":"light";return(()=>{const c=er(),i=c.firstChild,s=t;return typeof s=="function"?A(s,c):t=c,u(i,()=>xe(e.url)),T(l=>{const a=o(),d=xe(e.url);return a!==l._v$&&E(c,"data-theme",l._v$=a),d!==l._v$2&&E(i,"href",l._v$2=d),l},{_v$:void 0,_v$2:void 0}),c})()},ir=e=>{const{ogp:t}=Xn(()=>({url:e.url}));return r(p,{get when(){return t()},get fallback(){return r(L,{class:"text-link underline",get href(){return e.url}})},keyed:!0,children:n=>r(L,{get href(){return e.url},get children(){const o=tr(),c=o.firstChild,i=c.nextSibling,s=i.firstChild,l=s.nextSibling,a=l.nextSibling;return u(s,()=>new URL(n.url).host),u(l,()=>n.title),u(a,()=>n.description),T(d=>{const h=n.title,m=n.image;return h!==d._v$3&&E(c,"alt",d._v$3=h),m!==d._v$4&&E(c,"src",d._v$4=m),d},{_v$3:void 0,_v$4:void 0}),o}})})},se=e=>{const t=D(),[n,o]=C(e.initialHidden);return r(p,{get when(){return!n()},get fallback(){return(()=>{const c=nr(),i=c.firstChild;return i.$$click=()=>o(!1),u(i,()=>t.t("post.showPreview")),u(c,r(L,{class:"text-link underline",get href(){return e.url}}),null),c})()},get children(){return e.children}})},cr=e=>{const{config:t}=S();return r(O,{get fallback(){return r(L,{class:"text-link underline",get href(){return e.url}})},get children(){return[r(x,{get when(){return k(()=>!!t().embedding.twitter)()&&Xe(e.url)},get children(){return r(se,{get url(){return e.url},get initialHidden(){return e.initialHidden},get children(){return r(lr,{get url(){return e.url}})}})}}),r(x,{get when(){return k(()=>!!t().embedding.youtube)()&&Bn(e.url)},keyed:!0,children:({videoId:n})=>r(se,{get url(){return e.url},get initialHidden(){return e.initialHidden},get children(){return r(U,{get fallback(){return(()=>{const o=rr();return u(o,r(L,{get href(){return e.url}})),o})()},children:()=>(()=>{const o=or(),c=o.firstChild;return T(()=>E(c,"src",sr(n))),o})()})}})}),r(x,{get when(){return k(()=>!!t().embedding.ogp)()&&et(e.url)},get children(){return r(se,{get url(){return e.url},get initialHidden(){return e.initialHidden},get children(){return r(U,{children:()=>r(ir,{get url(){return e.url}})})}})}})]}})};P(["click"]);const ar=g('<button class="rounded bg-bg-tertiary p-3 text-xs text-fg-secondary hover:shadow">'),ur=g('<div class="aspect-video max-w-full">'),dr=g('<video class="max-h-64 max-w-full rounded-sm object-contain shadow"controls><a>'),hr=e=>{let t;const n=D(),[o,c]=C(e.initialHidden);return r(p,{get when(){return!o()},get fallback(){return(()=>{const i=ar();return i.$$click=()=>c(!1),u(i,()=>n.t("post.showVideo")),i})()},get children(){return r(U,{get fallback(){return ur()},children:()=>r(L,{class:"my-2 block",get href(){return e.url},get children(){const i=dr(),s=i.firstChild,l=t;return typeof l=="function"?A(l,i):t=i,u(s,()=>n.t("post.download")),T(a=>{const d=e.url,h=e.url;return d!==a._v$&&E(i,"src",a._v$=d),h!==a._v$2&&E(s,"href",a._v$2=h),a},{_v$:void 0,_v$2:void 0}),i}})})}})};P(["click"]);const le=g("<span>"),Re=g('<button class="select-text text-link underline">'),Ee=g('<div class="my-1 rounded border border-border p-1">'),gr=g('<button class="select-text text-link underline"> (<!>)'),fr=g('<span class="text-link underline">'),vr=g('<img class="inline-block h-8 max-w-[128px] align-middle">'),mr=e=>{const{config:t,saveColumn:n}=S(),o=yt(),c=s=>{n(lt({query:s})),o({command:"moveToLastColumn"}).catch(l=>console.error(l))},i=s=>{n(it({name:s,relayUrls:[s]})),o({command:"moveToLastColumn"}).catch(l=>console.error(l))};return r(N,{get each(){return e.parsed},children:s=>{if(s.type==="PlainText")return(()=>{const l=le();return u(l,()=>s.content),l})();if(s.type==="URL"){const l=()=>!t().showMedia||!e.embedding||(e.initialHidden??!1);return qn(s.content)?r(Nn,{get url(){return s.content},get initialHidden(){return l()}}):An(s.content)?r(hr,{get url(){return s.content},get initialHidden(){return l()}}):Wn(s.content)?(()=>{const a=Re();return a.$$click=()=>i(s.content),u(a,()=>s.content),a})():r(cr,{get url(){return s.content},get initialHidden(){return l()}})}if(s.type==="TagReferenceResolved"){if(s.reference==null)return(()=>{const l=le();return u(l,()=>s.content),l})();if(s.reference.type==="MentionedUser")return r(oe,{get pubkey(){return s.reference.pubkey}});if(s.reference.type==="MentionedEvent")return e.embedding?r(Vn,{get mentionedEvent(){return s.reference}}):r(H,{get eventId(){return s.reference.eventId}})}if(s.type==="Bech32Entity"){if(s.data.type==="note"&&e.embedding)return(()=>{const l=Ee();return u(l,r(K,{get eventId(){return s.data.data},actions:!1,embedding:!1,get ensureKinds(){return[ue]}})),l})();if(s.data.type==="nevent"&&e.embedding)return(()=>{const l=Ee();return u(l,r(K,{get eventId(){return s.data.data.id},actions:!1,embedding:!1})),l})();if(s.data.type==="npub")return r(oe,{get pubkey(){return s.data.data}});if(s.data.type==="nprofile")return r(oe,{get pubkey(){return s.data.data.pubkey}});if(s.data.type==="nrelay"){const l=s.data.data;return(()=>{const a=gr(),d=a.firstChild,h=d.nextSibling;return h.nextSibling,a.$$click=()=>i(l),u(a,l,d),u(a,()=>s.content,h),a})()}return(()=>{const l=fr();return u(l,()=>s.content),l})()}return s.type==="HashTag"?(()=>{const l=Re();return l.$$click=()=>c(s.content),u(l,()=>s.content),l})():s.type==="CustomEmojiResolved"?s.url==null?(()=>{const l=le();return u(l,()=>s.content),l})():(()=>{const l=vr();return T(a=>{const d=s.url,h=s.content,m=s.shortcode;return d!==a._v$&&E(l,"src",a._v$=d),h!==a._v$2&&E(l,"alt",a._v$2=h),m!==a._v$3&&E(l,"title",a._v$3=m),a},{_v$:void 0,_v$2:void 0,_v$3:void 0}),l})():(console.error("Not all ParsedTextNoteNodes are covered",s),null)}})};P(["click"]);const Ce=2,$r=200,yr=()=>{let e;const[t,n]=C(!1),o=i=>{e=i},c=bt(()=>{e!=null&&n(e.scrollHeight>e.clientHeight+Ce||e.scrollHeight>document.documentElement.clientHeight+Ce)},$r);return Pe(()=>{if(e!=null){c();const i=new IntersectionObserver(l=>{l.forEach(a=>{a.isIntersecting&&c()})},{threshold:[0,.25,.5,.75,1]});i.observe(e);const s=()=>c();window.addEventListener("resize",s),J(()=>{i.disconnect(),window.removeEventListener("resize",s)})}}),{overflow:t,elementRef:o}},br=g('<div class="author-name truncate pr-1 font-bold hover:underline">'),wr=g('<button class="mt-2 w-full rounded border border-border p-2 text-center text-xs text-fg-secondary shadow-sm hover:bg-bg-tertiary hover:shadow">'),pr=g('<div class="post flex flex-col"><div class="flex w-full gap-1"><button type=button class="author-icon size-10 shrink-0 overflow-hidden rounded"></button><div class="min-w-0 flex-auto"><div class="flex justify-between gap-1 text-xs"><button type=button class="author flex min-w-0 select-text truncate hover:text-link"><span class="author flex min-w-0 truncate hover:text-link"><div class="author-username truncate text-fg-secondary"></div></span></button><div class="created-at shrink-0"><button type=button class="select-text hover:underline"></button></div></div><div class=overflow-hidden></div><div class=actions>'),_r=g('<img alt=icon referrerpolicy=no-referrer class="size-full object-cover">'),kr=e=>{const t=D(),{overflow:n,elementRef:o}=yr(),c=We(),[i,s]=C(!1),l=()=>c(e.createdAt),a=()=>e.createdAt.toLocaleString(),{profile:d}=Ue(()=>({pubkey:e.authorPubkey}));return(()=>{const h=pr(),m=h.firstChild,w=m.firstChild,v=w.nextSibling,y=v.firstChild,f=y.firstChild,$=f.firstChild,b=$.firstChild,R=f.nextSibling,M=R.firstChild,j=y.nextSibling,F=j.nextSibling;return w.$$click=_=>{_.preventDefault(),e.onShowProfile?.()},u(w,r(p,{get when(){return d()?.picture},keyed:!0,children:_=>r(U,{children:()=>(()=>{const I=_r();return T(()=>E(I,"src",Je(_,"icon"))),I})()})})),f.$$click=_=>{_.preventDefault(),e?.onShowProfile?.()},u($,r(p,{get when(){return(d()?.display_name?.length??0)>0},get children(){const _=br();return u(_,()=>d()?.display_name),_}}),b),u(b,r(p,{get when(){return d()?.name!=null},get fallback(){return`@${je(e.authorPubkey)}`},get children(){return["@",k(()=>d()?.name)]}})),M.$$click=_=>{_.preventDefault(),e.onShowEvent?.()},u(M,l),A(o,j),u(j,()=>e.content),u(v,r(p,{get when(){return n()},get children(){const _=wr();return _.$$click=I=>{I.stopPropagation(),s(q=>!q)},u(_,r(p,{get when(){return!i()},get fallback(){return t.t("post.hideOverflow")},get children(){return t.t("post.showOverflow")}})),_}}),F),u(F,()=>e.actions),u(h,r(p,{get when(){return e.footer},get children(){return e.footer}}),null),T(_=>{const I=a(),q=!i(),B=!!i();return I!==_._v$&&E(M,"title",_._v$=I),q!==_._v$2&&j.classList.toggle("max-h-screen",_._v$2=q),B!==_._v$3&&j.classList.toggle("max-h-none",_._v$3=B),_},{_v$:void 0,_v$2:void 0,_v$3:void 0}),h})()};P(["click"]);const xr=at(),Rr=()=>ct(xr),Wr=()=>{const[e,t]=ut({});return{timelineState:e,setTimeline:n=>t("content",n),clearTimeline:()=>t("content",void 0)}},Er=g("<div class=nostr-textnote>"),Cr=g("<div class=text-xs>"),Sr=g('<div class="content whitespace-pre-wrap break-all">'),Ir=g("<div class=textnote-content>"),Tr=g('<div class="mt-1 rounded border border-border p-1">'),Mr=g("<div class=h-12>"),Pr=g('<button class="select-text pr-1 text-link hover:underline">'),Dr=g("<div class=h-5>"),Lr=e=>{let t;const n=D(),{showProfile:o}=de(),c=Rr(),[i,s]=C(!1),l=()=>s(!1),a=()=>{s(v=>!v),i()&&t!=null&&t.focus()},d=k(()=>dt(e.event)),h=()=>e.embedding??!0,m=()=>e.actions??!0,w=()=>{if(h()){const v=d().replyingToEvent();if(v!=null&&!d().containsEventMention(v.id))return v.id;const y=d().rootEvent();if(v==null&&y!=null&&!d().containsEventMention(y.id))return y.id}};return(()=>{const v=Er();return u(v,r(kr,{get authorPubkey(){return d().pubkey},get createdAt(){return d().createdAtAsDate()},get content(){return(()=>{const y=Ir();return u(y,r(p,{get when(){return w()},keyed:!0,children:f=>(()=>{const $=Tr();return u($,r(U,{get fallback(){return Mr()},children:()=>r(K,{eventId:f,actions:!1,embedding:!1})})),$})()}),null),u(y,r(p,{get when(){return d().taggedPubkeys().length>0},get children(){const f=Cr();return u(f,()=>n.t("post.replyToPre"),null),u(f,r(N,{get each(){return d().taggedPubkeys()},children:$=>(()=>{const b=Pr();return b.$$click=R=>{R.stopPropagation(),o($)},u(b,r(Ye,{pubkey:$})),b})()}),null),u(f,()=>n.t("post.replyToPost"),null),f}}),null),u(y,r(Fn,{get contentWarning(){return d().contentWarning()},get children(){const f=Sr();return u(f,r(mr,{get parsed(){return d().parsed()},get embedding(){return h()},get initialHidden(){return d().contentWarning().contentWarning}})),f}}),null),y})()},get actions(){return r(p,{get when(){return m()},get children(){return r(U,{get fallback(){return Dr()},children:()=>r(Pn,{get event(){return e.event},onClickReply:a})})}})},get footer(){return r(p,{get when(){return i()},get children(){return r(wt,{textAreaRef:y=>{t=y},mode:"reply",get replyTo(){return e.event},onClose:l,onPost:l})}})},onShowProfile:()=>{o(d().pubkey)},onShowEvent:()=>{c?.setTimeline({type:"Replies",event:e.event})}})),v})()};P(["click"]);const Se=g("<div><span>"),tt=e=>{const t=D(),n=()=>e.ensureKinds==null||e.ensureKinds.length===0||e.ensureKinds.includes(e.event.kind);return r(O,{get fallback(){return(()=>{const o=Se(),c=o.firstChild;return u(c,()=>t.t("post.unsupportedKind",{kind:e.event.kind})),u(o,r(H,{get eventId(){return e.event.id},get kind(){return e.event.kind}}),null),o})()},get children(){return[r(x,{get when(){return!n()},keyed:!0,get children(){const o=Se(),c=o.firstChild;return u(c,()=>t.t("post.unexpectedKind",{kind:e.event.kind})),u(o,r(H,{get eventId(){return e.event.id},get kind(){return e.event.kind}}),null),o}}),r(x,{get when(){return e.event.kind===ue},get children(){return r(Lr,{get event(){return e.event},get embedding(){return e.actions},get actions(){return e.actions}})}}),r(x,{get when(){return e.event.kind===ht},get children(){return r(Qt,{get event(){return e.event}})}})]}})},Or=e=>{const{shouldMuteEvent:t}=S();return r(N,{get each(){return e.events},children:n=>r(p,{get when(){return!t(n)},get children(){return r(Tt,{get children(){return r(tt,{event:n})}})}})})};let G=0;const{setActiveSubscriptions:Ur}=pt();setInterval(()=>{Ur(G)},1e3);const Br=e=>{const{config:t,shouldMuteEvent:n}=S(),o=_t(),[c,i]=C([]),[s,l]=C(!1),a=k(e),d=()=>e()?.eoseLimit??25,h=()=>e()?.limit??50;Y(ve(()=>[t().mutedPubkeys,t().mutedKeywords],()=>{i(v=>v.filter(y=>!n(y)))},{defer:!0})),Pe(()=>{console.debug("subscription mounted",e()?.debugId,e()),J(()=>{console.debug("subscription unmount",e()?.debugId,e())})});const m=v=>{const f=v.created_at-kt();if(!(f>300)){if(f>0){setTimeout(()=>m(v),f*1e3);return}i($=>{const b=xt($,v).slice(0,h()),R=Rt(b,M=>M.id);return R.length!==b.length&&console.warn("duplicated event",v),R})}},w=()=>{console.debug("startSubscription: start");const v=a();if(v==null)return;const{relayUrls:y,filters:f,options:$,onEvent:b,onEOSE:R,clientEventFilter:M,continuous:j=!0}=v;let F=!0;G+=1;let _=!1;l(!1);const I=[],q=()=>i(Et(I).slice(0,d())),B=o().subscribeMany(y,f,$??{eoseTimeout:12e3,maxWait:6e3,onevent:Z=>{b?.(Z),!(M!=null&&!M(Z))&&(s()?m(Z):(_=!0,I.push(Z)))},oneose:()=>{s()||(R?.(),l(!0),q(),I.splice(0,I.length),j||(B.close(),F&&(F=!1,G-=1)))}}),fe=setInterval(()=>{if(s()){clearInterval(fe);return}_&&(_=!1,q())},100);J(()=>{console.debug("startSubscription: end"),B.close(),F&&(F=!1,G-=1),clearInterval(fe)})};return Y(ve(()=>[a()],()=>w())),{events:c,eose:s}},nt=e=>{const t=()=>{const o=e();if(o==null)return[];const c=[];return Me(o).pTags().forEach(s=>{const[,l,a,d]=s,h={pubkey:l,petname:d};a!=null&&a.length>0&&(h.mainRelayUrl=a),c.push(h)}),c};return{followings:t,followingPubkeys:()=>t().map(o=>o.pubkey),data:e}},Hr=async({pubkey:e},t)=>{const n=new V({type:"Followings",pubkey:e});De({task:n,signal:t});const o=await n.latestEventPromise();return nt(()=>o)},Kr=e=>{const t=Q(),n=k(e),o=()=>["useFollowings",n()],c=z(()=>({queryKey:o(),queryFn:Ct({taskProvider:([,s])=>{if(s==null)return null;const{pubkey:l}=s;return new V({type:"Followings",pubkey:l})},queryClient:t}),staleTime:5*60*1e3,gcTime:3*24*60*60*1e3,refetchOnMount:!0,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchInterval:0})),i=()=>t.invalidateQueries({queryKey:o()});return{...nt(()=>c.data),invalidateFollowings:i,query:c}};export{Zt as B,sn as C,K as E,Qt as R,Or as T,Wr as a,xr as b,Tt as c,Kr as d,We as e,Ut as f,Be as g,tt as h,Lr as i,He as j,Xt as k,mr as l,Hr as m,Ve as n,Je as t,Br as u};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/EventDebugModal-AjmHEwzc.js","assets/index-a5yQGAwi.js","assets/index-lobdN9gG.css","assets/BasicModal-RK-406EA.js","assets/SideBar-a9udcwtn.js","assets/resolveAsset-LB_mqz0-.js","assets/UserList-I9vWpNbA.js","assets/LazyLoad-KiiXUb99.js","assets/globe-alt-Bl_aio75.js","assets/ZapRequestModal-bODx7XI6.js","assets/lud16ToLnurlPayUrl-8BXL_rVA.js","assets/_baseClone-OwsmKJog.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
//# sourceMappingURL=useFollowings-Mb7NY8FK.js.map
