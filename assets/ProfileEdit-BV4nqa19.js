import{av as Pe,aw as K,ax as Se,ay as Be,az as Ue,aA as Me,aB as ze,aC as Fe,X as Ce,aD as Le,aE as Ke,ae as De,Y as Ee,T as Ge,z as Xe,w as je,u as qe,c as m,o as Ze,v as Je,a as $,i as d,h as O,b,f as j,F as He,d as Qe,t as h}from"./index-DkTQHblH.js";import{A as Ye}from"./arrow-left-BgWzaeaa.js";import{_ as We,a as Ve,b as ke,c as et,d as tt}from"./_baseClone-CPKZAixl.js";import{B as rt}from"./BasicModal-8UENZVcn.js";import{q as nt,s as lt,y as it,b as at,i as st,g as ot,z as dt}from"./SideBar-CbpXYsVp.js";import"./resolveAsset-DF7KbUf6.js";function ct(t){var e=t==null?0:t.length;return e?t[e-1]:void 0}var ut=ct;function ft(t,e,n){var i=-1,a=t.length;e<0&&(e=-e>a?0:a+e),n=n>a?a:n,n<0&&(n+=a),a=e>n?0:n-e>>>0,e>>>=0;for(var o=Array(a);++i<a;)o[i]=t[i+e];return o}var bt=ft,gt=Pe,vt=bt;function pt(t,e){return e.length<2?t:gt(t,vt(e,0,-1))}var _t=pt,mt=K,$t=ut,ht=_t,yt=Se;function xt(t,e){return e=mt(e,t),t=ht(t,e),t==null||delete t[yt($t(e))]}var wt=xt,Pt=Be,St=We,Ct=Ue,Lt="[object Object]",Et=Function.prototype,kt=Object.prototype,Oe=Et.toString,Ot=kt.hasOwnProperty,At=Oe.call(Object);function Tt(t){if(!Ct(t)||Pt(t)!=Lt)return!1;var e=St(t);if(e===null)return!0;var n=Ot.call(e,"constructor")&&e.constructor;return typeof n=="function"&&n instanceof n&&Oe.call(n)==At}var Nt=Tt,Rt=Nt;function It(t){return Rt(t)?void 0:t}var Bt=It,Ut=Me;function Mt(t){var e=t==null?0:t.length;return e?Ut(t,1):[]}var zt=Mt,Ft=zt,Kt=ze,Dt=Fe;function Gt(t){return Dt(Kt(t,void 0,Ft),t+"")}var Xt=Gt,jt=Le,qt=et,Zt=wt,Jt=K,Ht=Ve,Qt=Bt,Yt=Xt,Wt=ke,Vt=1,er=2,tr=4,rr=Yt(function(t,e){var n={};if(t==null)return n;var i=!1;e=jt(e,function(o){return o=Jt(o,t),i||(i=o.length>1),o}),Ht(t,Wt(t),n),i&&(n=qt(n,Vt|er|tr,Qt));for(var a=e.length;a--;)Zt(n,e[a]);return n}),nr=rr;const lr=Ce(nr);var ir="Expected a function";function ar(t){if(typeof t!="function")throw new TypeError(ir);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}var sr=ar,or=tt,dr=K,cr=Ke,we=De,ur=Se;function fr(t,e,n,i){if(!we(t))return t;e=dr(e,t);for(var a=-1,o=e.length,u=o-1,c=t;c!=null&&++a<o;){var f=ur(e[a]),v=n;if(f==="__proto__"||f==="constructor"||f==="prototype")return t;if(a!=u){var x=c[f];v=i?i(x,f,c):void 0,v===void 0&&(v=we(x)?x:cr(e[a+1])?[]:{})}or(c,f,v),c=c[f]}return t}var br=fr,gr=Pe,vr=br,pr=K;function _r(t,e,n){for(var i=-1,a=e.length,o={};++i<a;){var u=e[i],c=gr(t,u);n(c,u)&&vr(o,pr(u,t),c)}return o}var mr=_r,$r=Le,hr=Ee,yr=mr,xr=ke;function wr(t,e){if(t==null)return{};var n=$r(xr(t),function(i){return[i]});return e=hr(e),yr(t,n,function(i,a){return e(i,a[0])})}var Pr=wr,Sr=Ee,Cr=sr,Lr=Pr;function Er(t,e){return Lr(t,Cr(Sr(e)))}var kr=Er;const Or=Ce(kr),Ar=({pubkey:t,profile:e,otherProperties:n})=>{const i={...e,...n};delete i.deleted;const a=JSON.stringify(i);return{kind:Ge,pubkey:t,created_at:nt(),tags:[],content:a}},Tr=t=>{const e=Xe(),n=je(t),{mutation:i,wrapMutate:a}=lt(()=>({mutationKey:["updateProfile",n().pubkey],onSuccess:u=>{const{pubkey:c}=n();if(c==null)return;const f=it({pubkey:c});e.invalidateQueries({queryKey:f}).catch(v=>console.error("failed to invalidate profile",v)),n().onSuccess?.(u)},onError:u=>{n().onError?.(u)}})),o=a(Ar);return{mutation:i,publishProfile:o}},Nr=h('<div class="h-40 w-full shrink-0 sm:h-52"><img alt=header class="size-full object-cover">'),Rr=h('<img alt="user icon"class="size-full rounded-lg object-cover">'),Ir=h('<div><div class="ml-4 mt-[-64px] size-28 rounded-lg shadow-md">'),Br=h('<div class="px-4 pt-4">'),Ur=h("<div><span class=font-bold></span><div>"),Mr=h('<div><form class="flex flex-col gap-4 p-4"><div class="flex flex-col items-start gap-1"><label class=font-bold for=picture></label><input class="w-full rounded-md border-border bg-bg ring-border focus:border-border focus:ring-primary"type=text id=picture name=picture placeholder=https://....../picture.png></div><div class="flex flex-col items-start gap-1"><label class=font-bold for=picture></label><input class="w-full rounded-md border-border bg-bg focus:border-border focus:ring-primary"type=text id=banner name=banner placeholder=https://....../banner.png></div><div class="flex flex-col items-start gap-1"><label class=font-bold for=name></label><div class="flex w-full items-center gap-2"><span>@</span><input class="flex-1 rounded-md border-border bg-bg ring-border focus:border-border focus:ring-primary"type=text id=name name=name maxlength=32 required></div></div><div class="flex flex-col items-start gap-1"><label class=font-bold for=name></label><input class="w-full rounded-md border-border bg-bg ring-border focus:border-border focus:ring-primary"type=text name=displayName maxlength=32></div><div class="flex flex-col items-start gap-1"><label class=font-bold for=name></label><textarea class="w-full rounded-md border-border bg-bg ring-border focus:border-border focus:ring-primary"name=about rows=5></textarea></div><div class="flex flex-col items-start gap-1"><label class=font-bold for=name></label><input class="w-full rounded-md border-border bg-bg ring-border focus:border-border focus:ring-primary"type=text name=website placeholder=https://....../></div><div class="flex flex-col items-start gap-1"><label class=font-bold for=name></label><input class="w-full rounded-md border-border bg-bg ring-border focus:border-border focus:ring-primary"type=text name=nip05 placeholder=yourname@domain.example.com></div><div class="flex flex-col items-start gap-1"><label class=font-bold for=name></label><span class=text-xs></span><input class="w-full rounded-md border-border bg-bg ring-border focus:border-border focus:ring-primary"type=text name=website pattern=^((LNURL1[AC-HJ-NP-Z02-9]+|lnurl1[ac-hj-np-z02-9]+)|[-_a-zA-Z0-9.]+@[-a-zA-Z0-9.]+)$ placeholder="LNURL1XXXXXX / abcdef@wallet.example.com"></div><div class="flex gap-2"><button type=submit class="rounded p-2 font-bold text-primary-fg hover:bg-primary-hover"></button><button type=button class="rounded border border-primary p-2 font-bold text-primary hover:border-primary-hover hover:text-primary-hover">'),zr=h('<div class="h-24 shrink-0">'),Fr=h('<div class="flex flex-col items-start"><span class="text-sm font-bold"></span><span class="whitespace-pre-wrap break-all text-sm">'),Kr="(LNURL1[AC-HJ-NP-Z02-9]+|lnurl1[ac-hj-np-z02-9]+)",Dr="[-_a-zA-Z0-9.]+@[-a-zA-Z0-9.]+",Gr=new RegExp(`^${Kr}$`),Ae=new RegExp(`^${Dr}$`),Xr=t=>Gr.test(t),jr=t=>Ae.test(t),Wr=t=>{const e=qe(),n=at(),[i,a]=m(""),[o,u]=m(""),[c,f]=m(""),[v,x]=m(""),[q,Z]=m(""),[J,H]=m(""),[Q,Y]=m(""),[w,D]=m(""),{profile:W,query:V}=st(()=>ot([n()])(([l])=>({pubkey:l}))),{mutation:P,publishProfile:Te}=Tr(()=>({pubkey:n(),onSuccess:l=>{l.failed.length===0?window.alert(e.t("profile.edit.updateSucceeded")):l.succeeded.length>0?window.alert(e.t("profile.edit.failedToUpdatePartially",{count:l.failed.length})):window.alert(e.t("profile.edit.failedToUpdate")),t.onClose()}})),ee=()=>V.isPending||P.isPending,_=()=>ee(),G=()=>lr(W(),["picture","banner","name","display_name","about","website","nip05","lud06","lud16"]),Ne=l=>{l.preventDefault();const s=n();if(s==null)return;const g=Or({picture:i(),banner:o(),name:c(),display_name:v(),about:q(),website:J(),nip05:Q(),lud06:Xr(w())?w():null,lud16:jr(w())?w():null},p=>p==null||p.length===0);Te({pubkey:s,profile:g,otherProperties:G()}).catch(p=>{window.alert(dt(p))})},y=l=>l.key==="Enter"&&l.preventDefault();return Ze(()=>{const l=W();l!=null&&(V.refetch().catch(s=>console.error(s)),Je(()=>{a(s=>l.picture??s),u(s=>l.banner??s),f(s=>l.name??s),x(s=>l.display_name??s),Z(s=>l.about??s),H(s=>l.website??s),Y(s=>l.nip05??s),l.lud16!=null?D(l.lud16):l.lud06!=null&&D(l.lud06)}))}),$(rt,{closeButton:()=>$(Ye,{}),get onClose(){return t.onClose},get children(){return[(()=>{const l=Ir(),s=l.firstChild;return d(l,$(O,{get when(){return o().length>0},get fallback(){return zr()},keyed:!0,get children(){const g=Nr(),p=g.firstChild;return b(()=>j(p,"src",o())),g}}),s),d(s,$(O,{get when(){return i().length>0},get children(){const g=Rr();return b(()=>j(g,"src",i())),g}})),l})(),$(O,{get when(){return ee()},get children(){const l=Br();return d(l,()=>e.t("general.loading")),l}}),(()=>{const l=Mr(),s=l.firstChild,g=s.firstChild,p=g.firstChild,A=p.nextSibling,te=g.nextSibling,re=te.firstChild,T=re.nextSibling,ne=te.nextSibling,le=ne.firstChild,Re=le.nextSibling,Ie=Re.firstChild,N=Ie.nextSibling,ie=ne.nextSibling,ae=ie.firstChild,R=ae.nextSibling,se=ie.nextSibling,oe=se.firstChild,X=oe.nextSibling,de=se.nextSibling,ce=de.firstChild,I=ce.nextSibling,ue=de.nextSibling,fe=ue.firstChild,S=fe.nextSibling,be=ue.nextSibling,ge=be.firstChild,ve=ge.nextSibling,B=ve.nextSibling,pe=be.nextSibling,C=pe.firstChild,_e=C.nextSibling;return s.addEventListener("submit",Ne),d(p,()=>e.t("profile.edit.icon")),A.$$keydown=y,A.addEventListener("blur",r=>a(r.currentTarget.value)),d(re,()=>e.t("profile.edit.banner")),T.$$keydown=y,T.addEventListener("blur",r=>u(r.currentTarget.value)),d(le,()=>e.t("profile.edit.name")),N.$$keydown=y,N.addEventListener("change",r=>f(r.currentTarget.value)),d(ae,()=>e.t("profile.edit.displayName")),R.$$keydown=y,R.addEventListener("change",r=>x(r.currentTarget.value)),d(oe,()=>e.t("profile.edit.about")),X.addEventListener("change",r=>Z(r.currentTarget.value)),d(ce,()=>e.t("profile.edit.website")),I.$$keydown=y,I.addEventListener("change",r=>H(r.currentTarget.value)),d(fe,()=>e.t("profile.edit.nip05")),S.$$keydown=y,S.addEventListener("change",r=>Y(r.currentTarget.value)),d(ge,()=>e.t("profile.edit.lightningAddress")),d(ve,()=>e.t("profile.edit.lightningAddressDescription")),B.$$keydown=y,B.addEventListener("change",r=>D(r.currentTarget.value)),d(s,$(O,{get when(){return Object.entries(G()).length>0},get children(){const r=Ur(),L=r.firstChild,U=L.nextSibling;return d(L,()=>e.t("profile.edit.otherProperties")),d(U,$(He,{get each(){return Object.entries(G())},children:([M,z])=>(()=>{const E=Fr(),k=E.firstChild,F=k.nextSibling;return d(k,M),d(F,z),E})()})),r}}),pe),d(C,()=>e.t("profile.edit.save")),_e.$$click=()=>t.onClose(),d(_e,()=>e.t("profile.edit.cancel")),d(s,$(O,{get when(){return P.isPending},get children(){return e.t("profile.edit.updating")}}),null),b(r=>{const L=_(),U=_(),M=_(),z=_(),E=_(),k=_(),F=Ae.source,me=_(),$e=_(),he=!P.isPending,ye=!!P.isPending,xe=P.isPending;return L!==r._v$&&(A.disabled=r._v$=L),U!==r._v$2&&(T.disabled=r._v$2=U),M!==r._v$3&&(N.disabled=r._v$3=M),z!==r._v$4&&(R.disabled=r._v$4=z),E!==r._v$5&&(X.disabled=r._v$5=E),k!==r._v$6&&(I.disabled=r._v$6=k),F!==r._v$7&&j(S,"pattern",r._v$7=F),me!==r._v$8&&(S.disabled=r._v$8=me),$e!==r._v$9&&(B.disabled=r._v$9=$e),he!==r._v$10&&C.classList.toggle("bg-primary",r._v$10=he),ye!==r._v$11&&C.classList.toggle("bg-primary-disabled",r._v$11=ye),xe!==r._v$12&&(C.disabled=r._v$12=xe),r},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0,_v$5:void 0,_v$6:void 0,_v$7:void 0,_v$8:void 0,_v$9:void 0,_v$10:void 0,_v$11:void 0,_v$12:void 0}),b(()=>A.value=i()),b(()=>T.value=o()),b(()=>N.value=c()),b(()=>R.value=v()),b(()=>X.value=q()),b(()=>I.value=J()),b(()=>S.value=Q()),b(()=>B.value=w()),l})()]}})};Qe(["keydown","click"]);export{Wr as default};
//# sourceMappingURL=ProfileEdit-BV4nqa19.js.map
